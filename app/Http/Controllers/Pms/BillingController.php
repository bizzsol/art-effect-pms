<?php
bolt_decrypt( __FILE__ , 'Q2yPdP'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVySXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5QWN0aW9uQ29udHJvbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMZWRnZXJzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEJpbGxpbmdDaGFsYW47CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgWWFqcmFcRGF0YVRhYmxlc1xGYWNhZGVzXERhdGFUYWJsZXM7CgpjbGFzcyBCaWxsaW5nQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcc3RyaW5nW11bXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwb19kYXRlJywgJ3BvX2RhdGUnLCAndGV4dC1sZWZ0JywgJ3dpZHRoOjE1JSddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncG9fcXR5JywgJ3BvX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dybl9xdHknLCAnZ3JuX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2N1cnJlbmN5JywgJ2N1cnJlbmN5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncG9fYW1vdW50JywgJ3BvX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FkdmFuY2VfYW1vdW50JywgJ2FkdmFuY2VfYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ3JuX2Ftb3VudCcsICdncm5fYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmlsbF9hbW91bnQnLCAnYmlsbF9hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydiaWxsX25vJywgJ2JpbGxfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdGF0dXMnLCAnc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXR0YWNobWVudCcsICdhdHRhY2htZW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnaW52b2ljZScsICdpbnZvaWNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndmF0JywgJ3ZhdCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCduYW1lJywgaWdub3JlU3VwcGxpZXJzKCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdBdWRpdCcsICdCaWxsaW5nJywgJ01hbmFnZW1lbnQnLCAnQWNjb3VudHMnXSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Fzc2lnbmVkX3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcikKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSAuICcgKCcgLiAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZSAuICcpJyA6ICcnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4tbGluayBzaG93UE9EZXRhaWxzIiBvbmNsaWNrPSJzaG93UE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHZhbHVlcy0+aWQpIC4gJyI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA6IDA7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX3F0eScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCAkaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2N1cnJlbmNpZXMnLCAnY3VycmVuY2llcy5pZCcsICc9JywgJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FkdmFuY2VfYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9IHBvQWR2YW5jZSgkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcG9BZHZhbmNlWydhZHZhbmNlJ107CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5Ub3RhbEFtb3VudCA9ICR2YWx1ZXMtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+c3VtKCd0b3RhbF9hbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYmlsbF9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdyblRvdGFsQW1vdW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT5zdW0oJ2JpbGxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCRncm5Ub3RhbEFtb3VudCA+IDApID8gc3lzdGVtTW9uZXlGb3JtYXQoJGdyblRvdGFsQW1vdW50KSA6ICdOb3QgVXBkYXRlZCBZZXQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTm90IFVwZGF0ZWQgWWV0JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiaWxsX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcG9BdHRhY2htZW50LT5iaWxsX251bWJlcikgPyAkcG9BdHRhY2htZW50LT5iaWxsX251bWJlciA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTm90IFVwbG9hZGVkIFlldCc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmlsbF9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiaWxsX251bWJlcicsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2JpbGxfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudC5iaWxsX251bWJlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50LnB1cmNoYXNlX29yZGVyX2lkJywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdCwgJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpdFsnZ3JuX3F0eSddID0gJGl0LT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9ICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpID09ICR0b3RhbF9ncm5fcXR5ID8/IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzIC49ICc8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiPkZ1bGwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgLj0gJyA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiPlBhcnRpYWwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdHVzczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhdHRhY2htZW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYoY2hlY2tQb0F0dGFjaG1lbnQoJHZhbHVlcy0+aWQsICJwbyIpICYmICgkdmFsdWVzLT5ncm9zc19wcmljZSA+IChwb0FkdmFuY2UoJHZhbHVlcy0+aWQpWydhZHZhbmNlJ10rJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT5zdW0oJ2JpbGxfYW1vdW50JykpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja1BvQXR0YWNobWVudCgkdmFsdWVzLT5pZCwgInBvIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJVcGxvYWRQT0F0dGFjaG1lbnQoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWluZm8gYnRuLXhzIFVwbG9hZFBPQXR0YWNobWVudCIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyI+PGkgY2xhc3M9ImxhcyBsYS11cGxvYWQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2ludm9pY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHBvQXR0YWNobWVudC0+aW52b2ljZV9maWxlKSAuICciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1pbnZvaWNlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd2YXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIGFzc2V0KCRwb0F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpIC4gJyIgdGFyZ2V0PSJfX2JsYW5rIiAgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgdmF0IGNoYWxhbiI+PGkgY2xhc3M9ImxhcyBsYS1tb25leS1jaGVjay1hbHQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLmxpc3QnLCAkdmFsdWVzLT5pZCkgLiAnIiAgZGF0YS10b2dnbGU9InRvb2x0aXAiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgUE8gQ2hhbGxhbiI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjay1jaXJjbGUiPjwvaT4gQ2hhbGFuKCcgLiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgLiAnKSA8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5wcmludCcsICR2YWx1ZXMtPmlkKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT4gUHJpbnQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnN0YXR1cykgJiYgIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnJlbWFya3MpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgcG8tYXR0YWNobWVudD0iJyAuIHN0cmlwX3RhZ3MoJHBvQXR0YWNobWVudC0+cmVtYXJrcykgLiAnIiBjbGFzcz0idmlld1JlbWFya3MiIG9uQ2xpY2s9InZpZXdSZW1hcmtzKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLWV5ZSI+PC9pPiBWaWV3IFJlbWFya3M8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywgJHZhbHVlcy0+aWQpIC4gJyIgdGl0bGU9Ikhpc3RvcnkiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPiBIaXN0b3J5PC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydzdXBwbGllcicsICdyZWZlcmVuY2Vfbm8nLCAnYmlsbF9hbW91bnQnLCAnc3RhdHVzJywgJ2F0dGFjaG1lbnQnLCAnaW52b2ljZScsICd2YXQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8tbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1BPIExpc3QnLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGF0dGFjaG1lbnRVcGxvYWRGb3JtKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHBvID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbJ3JlbEdvb2RSZWNlaXZlTm90ZScsICdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgJ3JlbFBvQXR0YWNobWVudCddKQogICAgICAgICAgICAtPndoZXJlKCdpZCcsICRyZXF1ZXN0LT5pZCkKICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICBpZiAoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRwby0+cmVsR29vZFJlY2VpdmVOb3RlIGFzICRrZXkgPT4gJGdybikgewogICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcG8tPmlkKS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCktPndoZXJlKCdiaWxsX3R5cGUnLCAnZ3JuJyktPndoZXJlSW4oJ3N0YXR1cycsIFsnYXBwcm92ZWQnXSktPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkcG9BdHRhY2htZW50LT5pZCkpIHsKCiAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zSWQgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCktPnBsdWNrKCdpZCcpLT5hbGwoKTsKCiAgICAgICAgICAgICAgICAgICAgJGdyblsnZ3JuX2Ftb3VudCddID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcG8tPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCd0b3RhbF9hbW91bnQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHBvX2JpbGwgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHJlcXVlc3QtPmlkKQogICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKQogICAgICAgICAgICAtPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdoYWx0J10pCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCgogICAgICAgIGlmICgkcG8tPnJlbFF1b3RhdGlvbi0+dHlwZSA9PSAnZGlyZWN0LXB1cmNoYXNlJykgewogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5kaXJlY3QtcHVyY2hhc2UuX2l0b19wb19hdHRhY2hlbWVudF9mb3JtJywgY29tcGFjdCgncG8nLCAncG9fYmlsbCcpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLl9wby1hdHRhY2hlbWVudC11cGxvYWQnLCBjb21wYWN0KCdwbycsICdwb19iaWxsJykpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0ludm9pY2VMaXN0KCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAiUHVyY2hhc2UgT3JkZXIgV2lzZSBDaGFsbGFuIExpc3QiOwoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLCAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsICdyZWxRdW90YXRpb24nLCAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICRjdXJyZW5jeSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU7CgogICAgICAgICAgICBpZiAoJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUgYXMgJGtleSA9PiAkZ3JuKSB7CgogICAgICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVJdGVtc0lkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICAgICAgICAgICRncm5bJ2dybl9hbW91bnQnXSA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCd0b3RhbF9hbW91bnQnKTsKCiAgICAgICAgICAgICAgICAgICAgJGdyblsncG9BdHRhY2htZW50J10gPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICdncm4nKQogICAgICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWludm9pY2UtbGlzdCcsIGNvbXBhY3QoJ3RpdGxlJywgJ3B1cmNoYXNlT3JkZXInLCAnY3VycmVuY3knKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9JbnZvaWNlTGlzdEdybkRldGFpbHMoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRncm4gPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuZGlyZWN0LXB1cmNoYXNlLnBvLWludm9pY2UtbGlzdC1ncm4tZGV0YWlscycsIGNvbXBhY3QoJ2dybicpKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBhdWRpdFBvSW52b2ljZUxpc3QoJGlkKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciBXaXNlIENoYWxsYW4gTGlzdCAoIiAuICRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnKSc7CgogICAgICAgICAgICAkY3VycmVuY3kgPSAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuYXVkaXQtcG8taW52b2ljZS1saXN0JywgY29tcGFjdCgndGl0bGUnLCAncHVyY2hhc2VPcmRlcicsICdjdXJyZW5jeScpKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0ludm9pY2VQcmludCgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gIlB1cmNoYXNlIE9yZGVyIjsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdVbml0JywKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uJwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGRlbGl2ZXJ5Q29udGFjdCA9IFxBcHBcVXNlcjo6ZmluZChnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsICRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSk7CgogICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkcHVyY2hhc2VPcmRlciwKICAgICAgICAgICAgICAgICdkZWxpdmVyeUNvbnRhY3QnID0+ICRkZWxpdmVyeUNvbnRhY3QsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtcycgPT4gJHJlcXVpc2l0aW9uSXRlbXMKICAgICAgICAgICAgXSwgJHRpdGxlLCAkdGl0bGUpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0ludm9pY2VCaWxscygkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQb0F0dGFjaG1lbnQnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1pbnZvaWNlLWJpbGxzJywgWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXInID0+ICRwdXJjaGFzZU9yZGVyCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBiUE9oZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3BvX2RhdGUnLCAncG9fZGF0ZScsICd0ZXh0LWxlZnQnLCAnd2lkdGg6MTAlJ10sCiAgICAgICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3BvX3F0eScsICdwb19xdHknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydncm5fcXR5JywgJ2dybl9xdHknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjdXJyZW5jeScsICdjdXJyZW5jeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3BvX2Ftb3VudCcsICdwb19hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhZHZhbmNlX2Ftb3VudCcsICdhZHZhbmNlX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dybl9hbW91bnQnLCAnZ3JuX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2JpbGxfYW1vdW50JywgJ2JpbGxfYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3RhdHVzJywgJ3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2ludm9pY2UnLCAnaW52b2ljZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3ZhdCcsICd2YXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZCcsICdhcHByb3ZlZCcsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoxNSUhaW1wb3J0YW50J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyIGFjdGlvbiddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1BPQXR0YWNobWVudExpc3QoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdjYW5jZWwtYmlsbCcpKXsKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgJGJpbGwgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycKICAgICAgICAgICAgICAgIF0pLT5maW5kKHJlcXVlc3QoKS0+Z2V0KCdiaWxsJykpOwoKICAgICAgICAgICAgICAgICRiaWxsLT5zdGF0dXMgPSAnaGFsdCc7CiAgICAgICAgICAgICAgICAkYmlsbC0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIGlmKCRiaWxsKXsKCiAgICAgICAgICAgICAgICAgICAgU3VwcGxpZXJQYXltZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+aWQpCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAnY2FuY2VsZWQnCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygnanNvbicpOwogICAgICAgICAgICAgICAgICAgICRhcnJheSA9IGFycmF5KFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkID4gMCA/ICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3N1cHBsaWVyX3BheWFibGVfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkYmlsbC0+YmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdCaWxsIENhbmNlbCA6OiBTdXBwbGllciBQYXlhYmxlIERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwby1iaWxsJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGJpbGwtPmlkCiAgICAgICAgICAgICAgICAgICAgXSwgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydncmlyX2FjY291bnQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkYmlsbC0+YmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdCaWxsIENhbmNlbCA6OiBHUi9JUiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3BvLWJpbGwnLAogICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkYmlsbC0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICdCaWxsIEFwcHJvdmFsIENhbmNlbGxhdGlvbicsICRhcnJheSwgJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZW50cnlbJ2VudHJ5J11bJ2lkJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYmlsbC1hcHByb3ZhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXVsnaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgXSwgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBzYXZlU3VwcGxpZXJMZWRnZXIoJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsIGRhdGUoJ1ktbS1kJyksICRiaWxsLT5iaWxsX2Ftb3VudCwgMCwgJycsICcnLCAnQmlsbCBBcHByb3ZhbCBDYW5jZWxsYXRpb24gOjogU3VwcGxpZXIgUGF5YWJsZSBDcmVkaXQnLCAwLCAwLCAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAkZW50cnlbJ2VudHJ5J11bJ2lkJ10pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICcuIEJpbGwgQXBwcm92YWwgaGFzIGJlZW4gQ2FuY2VsbGVkLjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdBY2NvdW50cycsIG51bGwsIHRydWUpLCAnc2VuZC10by1hY2NvdW50cycpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkJpbGwgQXBwcm92YWwgaGFzIGJlZW4gQ2FuY2VsbGVkIFN1Y2Nlc3NmdWxseS4iCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfWNhdGNoIChcRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRlLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAiQmlsbGluZyBBdHRhY2htZW50IExpc3QiOwoKICAgICAgICAgICAgJHB1cmNoYXNlX29yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAncmVsU3VwcGxpZXJQYXltZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVuKCFhdXRoKCktPnVzZXIoKS0+aGFzQW55Um9sZShbJ1B1cmNoYXNlLURlcGFydG1lbnQnLCAnQXVkaXQnLCAnQmlsbGluZycsICdNYW5hZ2VtZW50JywgJ0FjY291bnRzJ10pLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc3NpZ25lZF91c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywgJ3llcycpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFBvQXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2JpbGxfdHlwZScsIFsncG8nLCAnZ3JuJ10pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCdmcm9tX2RhdGUnKSAmJiAhZW1wdHkocmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdwb19kYXRlJywgJz49JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpKSkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ3RvX2RhdGUnKSAmJiAhZW1wdHkocmVxdWVzdCgpLT5nZXQoJ3RvX2RhdGUnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmVEYXRlKCdwb19kYXRlJywgJzw9JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvX2RhdGUnKSkpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCdzdGF0dXMnKSAmJiAhZW1wdHkocmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFBvQXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJywgcmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2Vfb3JkZXIpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncG9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUgLiAnICgnIC4gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUgLiAnKScgOiAnJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKS0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4tbGluayBzaG93UE9EZXRhaWxzIiBvbmNsaWNrPSJzaG93UE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHZhbHVlcy0+aWQpIC4gJyI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA6IDA7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX3F0eScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCAkaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2N1cnJlbmNpZXMnLCAnY3VycmVuY2llcy5pZCcsICc9JywgJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FkdmFuY2VfYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9IHBvQWR2YW5jZSgkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcG9BZHZhbmNlWydhZHZhbmNlJ107CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5Ub3RhbEFtb3VudCA9ICR2YWx1ZXMtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+c3VtKCd0b3RhbF9hbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYmlsbF9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ3JuVG90YWxBbW91bnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+c3VtKCdiaWxsX2Ftb3VudCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkZ3JuVG90YWxBbW91bnQgPiAwKSA/IHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCkgOiAnTm90IFVwZGF0ZWQgWWV0JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ05vdCBVcGRhdGVkIFlldCc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXQsICRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRbJ2dybl9xdHknXSA9ICRpdC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA9PSAkdG90YWxfZ3JuX3F0eSA/PyAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzcyAuPSAnPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0Ij5GdWxsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzIC49ICcgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0Ij5QYXJ0aWFsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXR1c3M7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignaW52b2ljZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnRbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcG9BdHRhY2htZW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiBhc3NldCgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpIC4gJyIgdGFyZ2V0PSJfX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+PGkgY2xhc3M9ImxhcyBsYS1maWxlLWludm9pY2UiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnRbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcG9BdHRhY2htZW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHBvQXR0YWNobWVudC0+dmF0X2NoYWxsYW5fZmlsZSkgLiAnIiB0YXJnZXQ9Il9fYmxhbmsiICBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyB2YXQgY2hhbGFuIj48aSBjbGFzcz0ibGFzIGxhLW1vbmV5LWNoZWNrLWFsdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92ZWQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkbGVkZ2VycyA9IFN1cHBsaWVyTGVkZ2Vyczo6d2hlcmVIYXMoJ3JlbFN1cHBsaWVyUGF5bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHZhbHVlcy0+aWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAnYXBwcm92ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSktPmNvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlID0gJzxkaXYgc3R5bGU9IndpZHRoOiAxMDBweCI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsZWRnZXJzID09IDAgJiYgJHBvQXR0YWNobWVudC0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3BvLWJpbGwtYXBwcm92YWwnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRwb0F0dGFjaG1lbnQtPmZpcnN0KCktPnN0YXR1cykgJiYgJHBvQXR0YWNobWVudC0+Zmlyc3QoKS0+c3RhdHVzID09PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyIgdGl0bGU9IkFwcHJvdmVkIj48aSBjbGFzcz0ibGEgbGEtY2hlY2siPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR2YWx1ZXMtPnJlbFN1cHBsaWVyUGF5bWVudHMtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKS0+cGF5X2Ftb3VudCA9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIiB0aXRsZT0iQ2FuY2VsIiBvbmNsaWNrPSJDYW5jZWxCaWxsQXBwcm92YWwoJCh0aGlzKSkiIGRhdGEtaWQ9IicuJHBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpLT5pZC4nIj48aSBjbGFzcz0ibGEgbGEtYmFuIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PHNlbGVjdCBjbGFzcz0iY2hhbmdlU3RhdHVzIGZvcm0tY29udHJvbCIgb25jaGFuZ2U9ImNoYW5nZVN0YXR1cygkKHRoaXMpKSIgc3R5bGU9IndpZHRoOiAxMDAlIiBiaWxsLXR5cGU9InBvIiBwby1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgaWQ9ImNoYW5nZVN0YXR1cycgLiAkdmFsdWVzLT5pZCAuICciPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKGlzc2V0KCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgJiYgJHBvQXR0YWNobWVudFswXS0+c3RhdHVzID09PSAncGVuZGluZycgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0icGVuZGluZyI+UGVuZGluZzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSAmJiAkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMgPT09ICdhcHByb3ZlZCcgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0iYXBwcm92ZWQiPkFwcHJvdmVkPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJyAuIChpc3NldCgkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMpICYmICRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cyA9PT0gJ2hhbHQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImhhbHQiPkhhbHQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhcmsgbXItMSIgdGl0bGU9IicuKGlzc2V0KCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgPyB1Y3dvcmRzKCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgOiAnJykuJyI+Jy4oaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSA/IHVjd29yZHMoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSA6ICcnKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaGlzdG9yeScsICR2YWx1ZXMtPmlkKSAuICciIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIiB0aXRsZT0iSGlzdG9yeSI+PGkgY2xhc3M9ImxhcyBsYS11c2VyLWNsb2NrIj48L2k+PC9hPic7CgoKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhcHByb3ZlOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LmF1ZGl0LnBvLmludm9pY2UubGlzdCcsICR2YWx1ZXMtPmlkKSAuICciICBkYXRhLXRvZ2dsZT0idG9vbHRpcCIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyBQTyBDaGFsbGFuIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrLWNpcmNsZSI+PC9pPiBDaGFsYW4oJyAuICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKSAuICcpIDwvYT48L2xpPgogICAgICAgICAgICAgICAgPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLnByaW50JywgJHZhbHVlcy0+aWQpIC4gJyI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPiBQcmludDwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHBvQXR0YWNobWVudC0+c3RhdHVzKSAmJiAhZW1wdHkoJHBvQXR0YWNobWVudC0+cmVtYXJrcykpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBwby1hdHRhY2htZW50PSInIC4gc3RyaXBfdGFncygkcG9BdHRhY2htZW50LT5yZW1hcmtzKSAuICciIGNsYXNzPSJ2aWV3UmVtYXJrcyIgb25DbGljaz0idmlld1JlbWFya3MoJCh0aGlzKSkiPjxpIGNsYXNzPSJsYXMgbGEtZXllIj48L2k+IFZpZXcgUmVtYXJrczwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwoKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3N1cHBsaWVyJywgJ3JlZmVyZW5jZV9ubycsICdiaWxsX2Ftb3VudCcsICdzdGF0dXMnLCAnYXBwcm92ZWQnLCAnaW52b2ljZScsICd2YXQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8tYXR0YWNobWVudC1saXN0JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnUE8gTGlzdCcsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmJQT2hlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0FoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3BvX2RhdGUnLCAncG9fZGF0ZScsICd0ZXh0LWxlZnQnLCAnd2lkdGg6MTUlJ10sCiAgICAgICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydwb19xdHknLCAncG9fcXR5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwb19hbW91bnQnLCAncG9fYW1vdW50JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydhZHZhbmNlX2Ftb3VudCcsICdhZHZhbmNlX2Ftb3VudCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyIGFjdGlvbiddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1BPQWR2YW5lTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICJQTyBBZHZhbmNlIExpc3QiOwoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsUXVvdGF0aW9uJywgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLCAncmVsU3VwcGxpZXJQYXltZW50cyddKQogICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsU3VwcGxpZXJQYXltZW50cycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiaWxsX3R5cGUnLCAncG8tYWR2YW5jZScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnc3RhdHVzJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsU3VwcGxpZXJQYXltZW50cycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcikKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSAuICcgKCcgLiAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZSAuICcpJyA6ICcnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4tbGluayBzaG93UE9EZXRhaWxzIiBvbmNsaWNrPSJzaG93UE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHZhbHVlcy0+aWQpIC4gJyI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyX2Zvcm1hdChpc3NldCgkdmFsdWVzLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMpID8gJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpIDogMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyktPm9yV2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ2N1cnJlbmNpZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2V4Y2hhbmdlX3JhdGVzJywgJ2V4Y2hhbmdlX3JhdGVzLmlkJywgJz0nLCAncXVvdGF0aW9ucy5leGNoYW5nZV9yYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY3VycmVuY2llcycsICdjdXJyZW5jaWVzLmlkJywgJz0nLCAnZXhjaGFuZ2VfcmF0ZXMuY3VycmVuY3lfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3BvX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT5ncm9zc19wcmljZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWR2YW5jZV9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyRwb0FkdmFuY2UgPSBwb0FkdmFuY2UoJHZhbHVlcy0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcG9BZHZhbmNlID0gJHZhbHVlcy0+cmVsU3VwcGxpZXJQYXltZW50cy0+d2hlcmUoJ2JpbGxfdHlwZScsICdwby1hZHZhbmNlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdChpc3NldCgkcG9BZHZhbmNlWzBdLT5wYXlfYW1vdW50KSA/ICRwb0FkdmFuY2VbMF0tPnBheV9hbW91bnQgOiAwKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9ICR2YWx1ZXMtPnJlbFN1cHBsaWVyUGF5bWVudHMtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8tYWR2YW5jZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygncG8tYWR2YW5jZS1hcHByb3ZhbCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG9BZHZhbmNlWzBdLT5zdGF0dXMpICYmIGluX2FycmF5KCRwb0FkdmFuY2VbMF0tPnN0YXR1cywgWydhdWRpdGVkJywgJ2FwcHJvdmVkJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIj48aSBjbGFzcz0ibGEgbGEtY2hlY2siPjwvaT4gQXBwcm92ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxzZWxlY3QgY2xhc3M9ImNoYW5nZVN0YXR1cyBmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJjaGFuZ2VTdGF0dXMoJCh0aGlzKSkiIHN0eWxlPSJ3aWR0aDogMTAwJSIgYmlsbC10eXBlPSJwby1hZHZhbmNlIiBwby1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgaWQ9ImNoYW5nZVN0YXR1cycgLiAkdmFsdWVzLT5pZCAuICciPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8b3B0aW9uICcgLiAoaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSAmJiAkcG9BZHZhbmNlWzBdLT5zdGF0dXMgPT09ICdwZW5kaW5nJyA/ICdzZWxlY3RlZCcgOiAiIikgLiAnIHZhbHVlPSJwZW5kaW5nIj5QZW5kaW5nPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPG9wdGlvbiAnIC4gKGlzc2V0KCRwb0FkdmFuY2VbMF0tPnN0YXR1cykgJiYgJHBvQWR2YW5jZVswXS0+c3RhdHVzID09PSAnYXVkaXRlZCcgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0iYXVkaXRlZCI+QXBwcm92ZWQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8b3B0aW9uICcgLiAoaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSAmJiAkcG9BZHZhbmNlWzBdLT5zdGF0dXMgPT09ICdjYW5jZWxlZCcgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0iY2FuY2VsZWQiPkhhbHQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFyayBtci0xIj4nLihpc3NldCgkcG9BZHZhbmNlWzBdLT5zdGF0dXMpID8gdWN3b3JkcygkcG9BZHZhbmNlWzBdLT5zdGF0dXMpIDogJycpLic8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnc3VwcGxpZXInLCAncmVmZXJlbmNlX25vJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWFkdmFuY2UtbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5wb0FoZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVkaXJlY3RSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ0F0dGFjaG1lbnRTdWJtaXQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAicmVxdWlyZWR8bWF4OjEwMCIsCiAgICAgICAgICAgICdiaWxsX2Ftb3VudCcgPT4gInJlcXVpcmVkfG1heDoxMDAiLAogICAgICAgICAgICAnaW52b2ljZV9maWxlJyA9PiAnbWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8cmVxdWlyZWR8bWF4OjUwNDgnLAogICAgICAgICAgICAndmF0X2NoYWxsYW5fZmlsZScgPT4gJ21pbWVzOmpwZWcsanBnLHBuZyxnaWYscGRmfHJlcXVpcmVkfG1heDo1MDQ4JwogICAgICAgIF0pOwoKICAgICAgICAkbW9kZWwgPSBQdXJjaGFzZU9yZGVyOjp3aGVyZSgnaWQnLCAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQpLT5maXJzdCgpOwogICAgICAgIGlmIChlbXB0eSgkbW9kZWwpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignUHVyY2hhc2UgT3JkZXIgTm90IEZvdW5kISEnKTsKICAgICAgICB9CgogICAgICAgICRiaWxsX2Ftb3VudCA9IGRvdWJsZXZhbChzdHJfcmVwbGFjZSgnLCcsICcnLCAkcmVxdWVzdC0+YmlsbF9hbW91bnQpKTsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICBpZiAoJG1vZGVsLT5yZWxRdW90YXRpb24tPnR5cGUgPT0gJ2RpcmVjdC1wdXJjaGFzZScpIHsKICAgICAgICAgICAgICAgICR0aGlzLT51cGRhdGVEaXJlY3RQdXJjaGFzZVByaWNlKCRyZXF1ZXN0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICcnOwogICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICcnOwoKICAgICAgICAgICAgJGV4aXNpbmdfYXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbyddKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKSB7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRleGlzaW5nX2F0dGFjaG1lbnQpICYmICFlbXB0eSgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVubGluayhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdpbnZvaWNlX2ZpbGUnKSwgJ3VwbG9hZC9wdXJjaGFzZS1vcmRlci9pbnZvaWNlJyk7CgogICAgICAgICAgICAgICAgJHZhdF9jaGFsbGFuX2ZpbGUgPSAkdGhpcy0+ZmlsZVVwbG9hZCgkcmVxdWVzdC0+ZmlsZSgndmF0X2NoYWxsYW5fZmlsZScpLCAndXBsb2FkL3B1cmNoYXNlLW9yZGVyL3ZhdC1jaGFsYW4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OnVwZGF0ZU9yQ3JlYXRlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbycKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2ludm9pY2VfZmlsZScgPT4gJGludm9pY2VfZmlsZSwKICAgICAgICAgICAgICAgICAgICAndmF0X2NoYWxsYW5fZmlsZScgPT4gJHZhdF9jaGFsbGFuX2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAkYmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfbnVtYmVyJyA9PiAkcmVxdWVzdC0+YmlsbF9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJ3BlbmRpbmcnLAogICAgICAgICAgICAgICAgICAgICdtYW5hZ2VtZW50X2FwcHJvdmFsJyA9PiAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+dHlwZSA9PSAnZGlyZWN0LXB1cmNoYXNlJyA/ICdwZW5kaW5nJyA6ICdhcHByb3ZlZCcsICdhY2NvdW50c19hcHByb3ZhbCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnR5cGUgPT0gJ2RpcmVjdC1wdXJjaGFzZScgPyAncGVuZGluZycgOiAnYXBwcm92ZWQnLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQgPSBTdXBwbGllclBheW1lbnQ6OnVwZGF0ZU9yQ3JlYXRlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbycsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfbnVtYmVyJyA9PiAkcmVxdWVzdC0+YmlsbF9udW1iZXIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZWN0aW9uX2RhdGUnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJyksCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZWN0aW9uX3R5cGUnID0+ICdwdXJjaGFzZScsCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlX3JhdGVfaWQnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX2Ftb3VudCcgPT4gJGJpbGxfYW1vdW50LAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJGdybnMgPSBHb29kc1JlY2VpdmVkTm90ZTo6ZG9lc250SGF2ZSgncmVsUG9BdHRhY2htZW50JykKICAgICAgICAgICAgLT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICBpZiAoaXNzZXQoJGdybnNbMF0pKSB7CiAgICAgICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcsICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+aWQpLT5kZWxldGUoKTsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRncm5zIGFzICRrZXkgPT4gJGdybikgewogICAgICAgICAgICAgICAgICAgIEJpbGxpbmdDaGFsYW46OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50X2lkJyA9PiAkUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdybi0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ3JucyBhcyAka2V5ID0+ICRncm4pIHsKICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdC0+aGFzRmlsZSgnY2hhbGxhbl9maWxlcy4nLiRncm4tPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm4tPmNoYWxsYW5fZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdjaGFsbGFuX2ZpbGVzLicuJGdybi0+aWQpLCAndXBsb2FkL2dybi1jaGFsbGFucycpOwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJG1vZGVsLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJG1vZGVsLT5yZWZlcmVuY2Vfbm8gLiAnLiBXYWl0aW5nIGZvciB0aGUgQXVkaXRlZC48L3NwYW4+JzsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdBdWRpdCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1hdWRpdCcpOwoKICAgICAgICAgICAgJG1lc3NhZ2UyID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLAogICAgICAgICAgICAgICAgICAgICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4KICAgICAgICAgICAgICAgICcuIFdhaXRpbmcgZm9yIHRoZSBkaXJlY3QgcHVyY2hhc2UgcHJpY2UgdXBkYXRlIGFwcHJvdmFsLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UyLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdNYW5hZ2VtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLW1hbmFnZXInKTsKCiAgICAgICAgICAgIC8vZGF0YSBjb21taXQKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSB1cGxvYWRlZCBwbyBpbnZvaWNlICYgdmF0IGZpbGUuJyk7CgogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgLy9kYXRhIHJvbGxiYWNrIGlmIHNvbWV0aGluZyB3cm9uZwogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCRlLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZURpcmVjdFB1cmNoYXNlUHJpY2UoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT51bml0X2Ftb3VudCkpIHsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT51bml0X2Ftb3VudCBhcyAkZ3JuSWQgPT4gJGRhdGEpIHsKICAgICAgICAgICAgICAgICRncm5TdWJUb3RhbCA9IDA7CiAgICAgICAgICAgICAgICAkZ3JuRGlzY291bnQgPSAwOwogICAgICAgICAgICAgICAgJGdyblZhdCA9IDA7CiAgICAgICAgICAgICAgICAkZ3JuR3Jvc3NUb3RhbCA9IDA7CgogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGdybkl0ZW1JZCA9PiAkdW5pdEFtb3VudCkgewoKICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbSA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnaWQnLCAkZ3JuSXRlbUlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGdvb2RzUmVjZWl2ZUl0ZW0tPmlkKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgJHF0eSA9ICRnb29kc1JlY2VpdmVJdGVtLT5xdHk7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJUb3RhbCA9ICR1bml0QW1vdW50ICogJHF0eTsKICAgICAgICAgICAgICAgICAgICAgICAgJGdyblN1YlRvdGFsICs9ICRzdWJUb3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpc2NvdW50QW1vdW50ID0gKCRnb29kc1JlY2VpdmVJdGVtLT5kaXNjb3VudF9wZXJjZW50YWdlICogKCR1bml0QW1vdW50ICogJHF0eSkpIC8gMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuRGlzY291bnQgKz0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkdmF0QW1vdW50ID0gKCRnb29kc1JlY2VpdmVJdGVtLT52YXRfcGVyY2VudGFnZSAqICgkdW5pdEFtb3VudCAqICRxdHkpKSAvIDEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGdyblZhdCArPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZ3Jvc3NUb3RhbCA9ICgkc3ViVG90YWwgKyAkdmF0QW1vdW50KSAtICRkaXNjb3VudEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgJGdybkdyb3NzVG90YWwgKz0gJGdyb3NzVG90YWw7CgogICAgICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbS0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2Ftb3VudCcgPT4gJHVuaXRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAkc3ViVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRkaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXQnID0+ICR2YXRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxfYW1vdW50JyA9PiAkZ3Jvc3NUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPndoZXJlKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywgJGdybkl0ZW1JZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+ICR1bml0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWJfdG90YWwnID0+ICRzdWJUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRkaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkdmF0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hbW91bnQnID0+ICRncm9zc1RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RQcm9kdWN0UHJpY2VVcGRhdGUoJGdvb2RzUmVjZWl2ZUl0ZW0tPnByb2R1Y3RfaWQsICR1bml0QW1vdW50KTsKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVOb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OndoZXJlKCdpZCcsICRncm5JZCktPmZpcnN0KCk7CgoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZ29vZHNSZWNlaXZlTm90ZS0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZU5vdGUtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gJGdyblN1YlRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRncm5EaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJGdyblZhdCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAkZ3JuR3Jvc3NUb3RhbCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UucwogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuQXR0YWNobWVudFVwbG9hZChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAicmVxdWlyZWR8bWF4OjEwMCIsCiAgICAgICAgICAgICdpbnZvaWNlX2ZpbGUnID0+ICdtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxyZXF1aXJlZHxtYXg6NTA0OCcsCiAgICAgICAgICAgICd2YXRfY2hhbGxhbl9maWxlJyA9PiAnbWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8cmVxdWlyZWR8bWF4OjUwNDgnCiAgICAgICAgXSk7CgogICAgICAgICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPmZpcnN0KCk7CiAgICAgICAgaWYgKGVtcHR5KCRtb2RlbCkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdQdXJjaGFzZSBPcmRlciBOb3QgRm91bmQhIScpOwogICAgICAgIH0KCiAgICAgICAgJGJpbGxfYW1vdW50ID0gZG91YmxldmFsKHN0cl9yZXBsYWNlKCcsJywgJycsICRyZXF1ZXN0LT5iaWxsX2Ftb3VudCkpOwoKCiAgICAgICAgaWYgKCRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnKSB7CiAgICAgICAgICAgICR0aGlzLT51cGRhdGVEaXJlY3RQdXJjaGFzZVByaWNlKCRyZXF1ZXN0KTsKCiAgICAgICAgICAgICRnb29kc1JlY2VpdmVJdGVtc0lkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpCiAgICAgICAgICAgICAgICAtPnBsdWNrKCdpZCcpCiAgICAgICAgICAgICAgICAtPmFsbCgpOwogICAgICAgICAgICAkc3VidG90YWxBbW91bnQgPSAkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbigpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgLT5zdW0oJ3RvdGFsX2Ftb3VudCcpOwoKICAgICAgICAgICAgaWYgKGRvdWJsZXZhbCgkc3VidG90YWxBbW91bnQpICE9PSAkYmlsbF9hbW91bnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignWW91ciBpbnB1dCBhbW91bnQgaXMgZ3JlYXRlciB0aGVuIEdSTiBhbW91bnQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvL2JlZ2luIHRyYW5zYWN0aW9uCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICcnOwogICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICcnOwoKICAgICAgICAgICAgJGV4aXNpbmdfYXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCwKICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdncm4nCiAgICAgICAgICAgIF0pLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGV4aXNpbmdfYXR0YWNobWVudCkgJiYgIWVtcHR5KCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+aW52b2ljZV9maWxlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bmxpbmsocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+dmF0X2NoYWxsYW5fZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkaW52b2ljZV9maWxlID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2ludm9pY2VfZmlsZScpLCAndXBsb2FkL3B1cmNoYXNlLW9yZGVyL2ludm9pY2UnKTsKCiAgICAgICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCd2YXRfY2hhbGxhbl9maWxlJyksICd1cGxvYWQvcHVyY2hhc2Utb3JkZXIvdmF0LWNoYWxhbicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6dXBkYXRlT3JDcmVhdGUoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdncm4nCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCwKICAgICAgICAgICAgICAgICAgICAnaW52b2ljZV9maWxlJyA9PiAkaW52b2ljZV9maWxlLAogICAgICAgICAgICAgICAgICAgICd2YXRfY2hhbGxhbl9maWxlJyA9PiAkdmF0X2NoYWxsYW5fZmlsZSwKICAgICAgICAgICAgICAgICAgICAnYmlsbF9hbW91bnQnID0+ICRiaWxsX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAnZ3JuJywKICAgICAgICAgICAgICAgICAgICAnYmlsbF9udW1iZXInID0+ICRyZXF1ZXN0LT5iaWxsX251bWJlciwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgJ21hbmFnZW1lbnRfYXBwcm92YWwnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnID8gJ3BlbmRpbmcnIDogJ2FwcHJvdmVkJywKICAgICAgICAgICAgICAgICAgICAnYWNjb3VudHNfYXBwcm92YWwnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnID8gJ3BlbmRpbmcnIDogJ2FwcHJvdmVkJywKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gXEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IFxBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCFpc3NldCgkZXhpc2luZ19hdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkpIHsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50ID0gbmV3IFN1cHBsaWVyUGF5bWVudCgpOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnN1cHBsaWVyX2lkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnB1cmNoYXNlX29yZGVyX2lkID0gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQgPSAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZDsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl9kYXRlID0gZGF0ZSgnWS1tLWQgaDppOnMnKTsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl90eXBlID0gJ3B1cmNoYXNlJzsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5iaWxsX251bWJlciA9ICRyZXF1ZXN0LT5iaWxsX251bWJlcjsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5leGNoYW5nZV9yYXRlX2lkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQ7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF9hbW91bnQgPSAkYmlsbF9hbW91bnQ7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF90eXBlID0gImdybiI7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+c2F2ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmQoJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpOwogICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcgPT4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5pZAogICAgICAgICAgICBdLCBbCiAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdybi0+aWQKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCAkZ3JuLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IkdSTiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRncm4tPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIHRoZSBBdWRpdGVkLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJ1JlZmVyZW5jZSBObzogPHN0cm9uZz4nIC4gJGdybi0+cmVmZXJlbmNlX25vIC4gJzwvc3Ryb25nPi4gV2FpdGluZyBmb3IgdGhlIEF1ZGl0ZWQnLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdBdWRpdCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1hdWRpdCcpOwoKICAgICAgICAgICAgJG1lc3NhZ2UyID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsCiAgICAgICAgICAgICAgICAgICAgJGdybi0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJHUk4gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkZ3JuLT5yZWZlcmVuY2Vfbm8gLgogICAgICAgICAgICAgICAgJy4gV2FpdGluZyBmb3IgdGhlIGRpcmVjdCBwdXJjaGFzZSBwcmljZSB1cGRhdGUgYXBwcm92YWwuPC9zcGFuPic7CgogICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZTIsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ01hbmFnZW1lbnQnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tbWFuYWdlcicpOwoKICAgICAgICAgICAgLy9kYXRhIGNvbW1pdAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHBvIGludm9pY2UgJiB2YXQgZmlsZS4nKTsKCiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAvL2RhdGEgcm9sbGJhY2sgaWYgc29tZXRoaW5nIHdyb25nCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1VwZGF0ZUFjdGlvbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRpZCA9ICRyZXF1ZXN0LT5wb19pZDsKICAgICAgICAkYmlsbFR5cGUgPSAkcmVxdWVzdC0+YmlsbF90eXBlOwogICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwogICAgICAgICRncm5JZCA9IGlzc2V0KCRyZXF1ZXN0LT5ncm5faWQpID8gJHJlcXVlc3QtPmdybl9pZCA6ICcnOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkaWQpCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRncm5JZCksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGdybklkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuSWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAkcmVxdWVzdC0+cmVtYXJrcwogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZiAoJHN0YXR1cyA9PSAncGVuZGluZycpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdwZW5kaW5nJzsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2UgPSAiQmlsbGluZyBzdGF0dXMgdXBkYXRlZCB0byBwZW5kaW5nIjsKICAgICAgICAgICAgfSBlbHNlaWYgKCRzdGF0dXMgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgJGF1ZGl0U3RhdHVzID0gJ2F1ZGl0ZWQnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJTdWNjZXNzZnVsbHkgYXVkaXRlZCBieSBhdWRpdCBkZXBhcnRtZW50IjsKICAgICAgICAgICAgfSBlbHNlaWYgKCRzdGF0dXMgPT0gJ2hhbHQnKSB7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAnY2FuY2VsZWQnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJUaGlzIGJpbGwgaGFsdCBieSBhdWRpdCBkZXBhcnRtZW50LiBQbGVhc2UgdXBsb2FkIGl0IGFnYWluLiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZ3JuSWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRncm5JZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAkYmlsbFR5cGUpCiAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJGF1ZGl0U3RhdHVzCiAgICAgICAgICAgICAgICBdKTsKCgogICAgICAgICAgICAkbW9kZWwgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICBpZiAoJHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CgogICAgICAgICAgICAgICAgLy9HUi9JUiBQcm9jZXNzCiAgICAgICAgICAgICAgICAkYW1vdW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRpZCwKICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAkYmlsbFR5cGUsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHN0YXR1cywKICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgPT4gJHJlcXVlc3QtPnJlbWFya3MKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZ3JuSWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRncm5JZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5JZCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYmlsbF9hbW91bnQnKTsKCiAgICAgICAgICAgICAgICAkcG9CaWxsID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRpZCkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRncm5JZCksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGdybklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyk7CiAgICAgICAgICAgICAgICAkYXJyYXkgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkbW9kZWwtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snZ3Jpcl9hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0JpbGwgQXBwcm92YWwgOjogR1IvSVIgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAncG8tYmlsbCcsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBvQmlsbC0+aWQKICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRtb2RlbC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfcGF5YWJsZV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdCaWxsIEFwcHJvdmFsIDo6IFN1cHBsaWVyIFBheWFibGUgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3BvLWJpbGwnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwb0JpbGwtPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycpLCAxLCAnJywgJ0JpbGwgQXBwcm92YWwnLCAkYXJyYXksICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkbW9kZWwtPmNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRlbnRyeVsnZW50cnknXVsnaWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckVudHJ5Ojp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRtb2RlbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYmlsbC1hcHByb3ZhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddWydpZCddLAogICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgc2F2ZVN1cHBsaWVyTGVkZ2VyKCRtb2RlbC0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCwgZGF0ZSgnWS1tLWQnKSwgMCwgJGFtb3VudCwgJycsICcnLCAnQmlsbCBBcHByb3ZhbCA6OiBTdXBwbGllciBQYXlhYmxlIENyZWRpdCcsIDAsIDAsICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAkZW50cnlbJ2VudHJ5J11bJ2lkJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9HUi9JUiBQcm9jZXNzCgogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4gV2FpdGluZyBmb3IgUGF5bWVudHMuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4nIC4gJHB1cmNoYXNlTWVzc2FnZSAuICcuPC9zcGFuPic7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICBpZiAoIWVtcHR5KCRncm5JZCkpIHsKICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICJCaWxsaW5nIEludm9pY2UgdXBkYXRlZCBzdWNjZXNzZnVsbHkiKTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJCaWxsaW5nIEludm9pY2UgdXBkYXRlZCBzdWNjZXNzZnVsbHkiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0FkdmFuY2VVcGRhdGVBY3Rpb24oUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkaWQgPSAkcmVxdWVzdC0+cG9faWQ7CiAgICAgICAgJGJpbGxUeXBlID0gJHJlcXVlc3QtPmJpbGxfdHlwZTsKICAgICAgICAkc3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdXBwbGllclBheW1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRpZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAvL3N0YXJ0IHN1cHBsaWVyIHBheW1lbnQgdXBkYXRlCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdwZW5kaW5nJykgewogICAgICAgICAgICAgICAgJGF1ZGl0U3RhdHVzID0gJ3BlbmRpbmcnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJBZHZhbmNlIHN0YXR1cyB1cGRhdGVkIHRvIHBlbmRpbmciOwogICAgICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAnYXVkaXRlZCcpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdhdWRpdGVkJzsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2UgPSAiU3VjY2Vzc2Z1bGx5IGF1ZGl0ZWQgYnkgYXVkaXQgZGVwYXJ0bWVudCI7CiAgICAgICAgICAgIH0gZWxzZWlmICgkc3RhdHVzID09ICdjYW5jZWxlZCcpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdjYW5jZWxlZCc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlID0gIlRoaXMgQWR2YW5jZSBoYWx0IGJ5IGF1ZGl0IGRlcGFydG1lbnQuIFBsZWFzZSB1cGxvYWQgaXQgYWdhaW4uIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2VuZCBzdXBwbGllciBwYXltZW50IHVwZGF0ZQoKICAgICAgICAgICAgJG1vZGVsID0gUHVyY2hhc2VPcmRlcjo6d2hlcmUoJ2lkJywgJGlkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdhdWRpdGVkJykgewogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4gV2FpdGluZyBmb3IgUGF5bWVudHMuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4nIC4gJHB1cmNoYXNlTWVzc2FnZSAuICcuPC9zcGFuPic7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdBZHZhbmNlIFN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGlzdG9yeSgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciBIaXN0b3J5IjsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsR29vZFJlY2VpdmVOb3RlJywgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxQdXJjaGFzZU9yZGVyJywgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnXSktPndoZXJlKCdpZCcsICRpZCkKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgICRwcm9wb3NhbHMgPSBSZXF1ZXN0UHJvcG9zYWw6OndpdGgoWydyZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbi5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsICdyZWxRdW90YXRpb25zLnJlbFN1cHBsaWVycyddKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsIChpc3NldCgkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkKSA/ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQgOiAwKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlcmJ5KCdpZCcsICdkZXNjJyktPmZpcnN0KCk7CgoKICAgICAgICAgICAgJGJpbGxNYW5hZ2UgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+d2hlcmUoJ3RvdGFsX2Ftb3VudCcsICc+JywgMCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkaWQpCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1oaXN0b3J5JywgY29tcGFjdCgndGl0bGUnLCAncHVyY2hhc2VPcmRlcicsICdwcm9wb3NhbHMnLCAnYmlsbE1hbmFnZScpKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgZnVuY3Rpb24gc3BvdFBPaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwb19yZWZlcmVuY2Vfbm8nLCAncG9fcmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ3JuX3JlZmVyZW5jZV9ubycsICdncm5fcmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmlsbF90eXBlJywgJ2JpbGxfdHlwZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2JpbGxfbnVtYmVyJywgJ2JpbGxfbnVtYmVyJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmlsbF9hbW91bnQnLCAnYmlsbF9hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdGF0dXMnLCAnc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnaW52b2ljZScsICdpbnZvaWNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndmF0JywgJ3ZhdCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAnbWFuYWdlbWVudF9hcHByb3ZhbCcsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoxNSUhaW1wb3J0YW50J10sCiAgICAgICAgICAgIFsnYWNjb3VudHNfYXBwcm92YWwnLCAnYWNjb3VudHNfYXBwcm92YWwnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlIWltcG9ydGFudCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNwb3RQdXJjaGFzZVByaWNlQXBwcm92YWxMaXN0KCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHRpdGxlID0gIlNwb3QgUHVyY2hhc2UgUHJpY2UgQXBwcm92YWwgTGlzdCI7CgogICAgICAgICAgICAkcHVyY2hhc2VBdHRhY2htZW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgovLyAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdkaXJlY3QtcHVyY2hhc2UtbWFuYWdlbWVudC1hcHByb3ZhbCcpKSB7Ci8vICAgICAgICAgICAgICAgICRwdXJjaGFzZUF0dGFjaG1lbnQgPSAkcHVyY2hhc2VBdHRhY2htZW50LT53aGVyZUluKCdtYW5hZ2VtZW50X2FwcHJvdmFsJywgWydwZW5kaW5nJywgJ2hhbHQnXSk7Ci8vICAgICAgICAgICAgfQovLwovLyAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdkaXJlY3QtcHVyY2hhc2UtYWNjb3VudHMtYXBwcm92YWwnKSkgewovLyAgICAgICAgICAgICAgICAkcHVyY2hhc2VBdHRhY2htZW50ID0gJHB1cmNoYXNlQXR0YWNobWVudC0+d2hlcmUoJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAnYXBwcm92ZWQnKQovLyAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhY2NvdW50c19hcHByb3ZhbCcsIFsncGVuZGluZycsICdoYWx0J10pOwovLyAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRwdXJjaGFzZUF0dGFjaG1lbnQpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3BvX3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgb25jbGljaz0ic2hvd1BPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICR2YWx1ZXMtPnB1cmNoYXNlX29yZGVyX2lkKSAuICciPicgLiBpc3NldCgkdmFsdWVzLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8pID8gJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vIDogJycgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncG9fcmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19yZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVyX2F0dGFjaG1lbnQucHVyY2hhc2Vfb3JkZXJfaWQnLCAncHVyY2hhc2Vfb3JkZXJzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dybl9yZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICR2YWx1ZXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ3JuX3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkTm90ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2dybl9yZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdncm5fcmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIEdvb2RzUmVjZWl2ZWROb3RlOjpzZWxlY3QoJ2dvb2RzX3JlY2VpdmVkX25vdGVzLmdybl9yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudC5nb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdiaWxsX3R5cGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdWNmaXJzdCgkdmFsdWVzLT5iaWxsX3R5cGUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdiaWxsX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT5iaWxsX2Ftb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3N0YXR1cycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1Y2ZpcnN0KCR2YWx1ZXMtPnN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignaW52b2ljZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHZhbHVlcy0+aW52b2ljZV9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHZhbHVlcy0+aW52b2ljZV9maWxlKSAuICciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1pbnZvaWNlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd2YXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR2YWx1ZXMtPnZhdF9jaGFsbGFuX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiBhc3NldCgkdmFsdWVzLT52YXRfY2hhbGxhbl9maWxlKSAuICciIHRhcmdldD0iX19ibGFuayIgIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIiB0aXRsZT0iQ2xpY2sgaGVyZSB0byB2aWV3IHZhdCBjaGFsYW4iPjxpIGNsYXNzPSJsYXMgbGEtbW9uZXktY2hlY2stYWx0Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignbWFuYWdlbWVudF9hcHByb3ZhbCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlID0gJzxkaXYgc3R5bGU9IndpZHRoOiAxMDBweCI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdkaXJlY3QtcHVyY2hhc2UtbWFuYWdlbWVudC1hcHByb3ZhbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PHNlbGVjdCBjbGFzcz0iY2hhbmdlU3RhdHVzIGZvcm0tY29udHJvbCIgb25jaGFuZ2U9ImNoYW5nZVN0YXR1cygkKHRoaXMpKSIgc3R5bGU9IndpZHRoOiAxMDAlIiBhcHByb3ZhbC10eXBlPSJtYW5hZ2VtZW50IiAgYXBwcm92YWwtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGlkPSJjaGFuZ2VTdGF0dXMnIC4gJHZhbHVlcy0+aWQgLiAnIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoJHZhbHVlcy0+bWFuYWdlbWVudF9hcHByb3ZhbCA9PT0gJ3BlbmRpbmcnID8gJ3NlbGVjdGVkJyA6ICIiKSAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyB2YWx1ZT0icGVuZGluZyI+UGVuZGluZzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKCR2YWx1ZXMtPm1hbmFnZW1lbnRfYXBwcm92YWwgPT09ICdhcHByb3ZlZCcgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0iYXBwcm92ZWQiPkFwcHJvdmVkPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoJHZhbHVlcy0+bWFuYWdlbWVudF9hcHByb3ZhbCA9PT0gJ2hhbHQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImhhbHQiPkhhbHQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSB1Y2ZpcnN0KCR2YWx1ZXMtPm1hbmFnZW1lbnRfYXBwcm92YWwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGRpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFwcHJvdmU7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2FjY291bnRzX2FwcHJvdmFsJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgPSAnPGRpdiBzdHlsZT0id2lkdGg6IDEwMHB4Ij4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2RpcmVjdC1wdXJjaGFzZS1hY2NvdW50cy1hcHByb3ZhbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PHNlbGVjdCBjbGFzcz0iY2hhbmdlU3RhdHVzIGZvcm0tY29udHJvbCIgb25jaGFuZ2U9ImNoYW5nZVN0YXR1cygkKHRoaXMpKSIgc3R5bGU9IndpZHRoOiAxMDAlIiBhcHByb3ZhbC1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgYXBwcm92YWwtdHlwZT0iYWNjb3VudHMiIGlkPSJjaGFuZ2VTdGF0dXMnIC4gJHZhbHVlcy0+aWQgLiAnIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoJHZhbHVlcy0+YWNjb3VudHNfYXBwcm92YWwgPT09ICdwZW5kaW5nJyA/ICdzZWxlY3RlZCcgOiAiIikgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgdmFsdWU9InBlbmRpbmciPlBlbmRpbmc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJyAuICgkdmFsdWVzLT5hY2NvdW50c19hcHByb3ZhbCA9PT0gJ2FwcHJvdmVkJyA/ICdzZWxlY3RlZCcgOiAiIikgLiAnIHZhbHVlPSJhcHByb3ZlZCI+QXBwcm92ZWQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJyAuICgkdmFsdWVzLT5hY2NvdW50c19hcHByb3ZhbCA9PT0gJ2hhbHQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImhhbHQiPkhhbHQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSB1Y2ZpcnN0KCR2YWx1ZXMtPmFjY291bnRzX2FwcHJvdmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhcHByb3ZlOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5wcmludCcsICR2YWx1ZXMtPnB1cmNoYXNlX29yZGVyX2lkKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT4gUHJpbnQ8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydwb19yZWZlcmVuY2Vfbm8nLCAnYmlsbF9hbW91bnQnLCAnbWFuYWdlbWVudF9hcHByb3ZhbCcsICdhY2NvdW50c19hcHByb3ZhbCcsICdpbnZvaWNlJywgJ3ZhdCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5kaXJlY3QtcHVyY2hhc2Uuc3BvdC1wdXJjaGFzZS1hcHByb3ZhbC1saXN0JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnNwb3RQT2hlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzcG90UHVyY2hhc2VQcmljZUFwcHJvdmFsKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJGlkID0gJHJlcXVlc3QtPmF0dGFjaG1lbnRJZDsKICAgICAgICAkYmlsbFR5cGUgPSAkcmVxdWVzdC0+YXBwcm92YWxUeXBlOwogICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ2lkJywgJGlkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICgkYmlsbFR5cGUgPT0gJ21hbmFnZW1lbnQnKSB7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ21hbmFnZW1lbnRfYXBwcm92YWwnID0+ICRzdGF0dXMsCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBpZiAoJHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJTcG90IHB1cmNoYXNlIGFwcHJvdmFsIHN0YXR1cyBhcHByb3ZlZCBieSBtYW5hZ2VtZW50IjsKCiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPnB1cmNoYXNlX29yZGVyX2lkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLgogICAgICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICcgfCAnIC4gJHB1cmNoYXNlTWVzc2FnZSAuICc8L3NwYW4+JzsKCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ0FjY291bnRzJywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLWFjY291bnRzJyk7CgogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRzdGF0dXMgPT0gJ2hhbHQnKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJUaGlzIHNwb3QgcHVyY2hhc2UgcHJpY2Ugc3RhdHVzIGhhbHQgYnkgbWFuYWdlbWVudC4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwoKICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnLicgLiAkcHVyY2hhc2VNZXNzYWdlIC4gJy48L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1wdXJjaGFzZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJGJpbGxUeXBlID09ICdhY2NvdW50cycpIHsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+d2hlcmUoJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRzX2FwcHJvdmFsJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdwZW5kaW5nJykgewogICAgICAgICAgICAgICAgICAgICRhY2NvdW50c01lc3NhZ2UgPSAiU3BvdCBwdXJjaGFzZSBhcHByb3ZhbCBzdGF0dXMgdXBkYXRlZCB0byBwZW5kaW5nIjsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkc3RhdHVzID09ICdhcHByb3ZlZCcpIHsKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudHNNZXNzYWdlID0gIlN1Y2Nlc3NmdWxseSBhcHByb3ZlZCBieSBhY2NvdW50cyI7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAnaGFsdCcpIHsKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudHNNZXNzYWdlID0gIlRoaXMgc3BvdCBwdXJjaGFzZSBwcmljZSBzdGF0dXMgaGFsdCBieSBhY2NvdW50cy4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnLicgLiAkYWNjb3VudHNNZXNzYWdlIC4gJy48L3NwYW4+JzsKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTcG90IHB1cmNoYXNlIHByaWNlIGFwcHJvdmFsIHN0YXR1cyBoYXMgYmVlbiB1cGRhdGVkIgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCn0K