<?php
bolt_decrypt( __FILE__ , 'RBVPXn'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVySXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5QWN0aW9uQ29udHJvbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMZWRnZXJzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEJpbGxpbmdDaGFsYW47CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgWWFqcmFcRGF0YVRhYmxlc1xGYWNhZGVzXERhdGFUYWJsZXM7CgpjbGFzcyBCaWxsaW5nQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcc3RyaW5nW11bXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwb19kYXRlJywgJ3BvX2RhdGUnLCAndGV4dC1sZWZ0JywgJ3dpZHRoOjE1JSddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncG9fcXR5JywgJ3BvX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dybl9xdHknLCAnZ3JuX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2N1cnJlbmN5JywgJ2N1cnJlbmN5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncG9fYW1vdW50JywgJ3BvX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FkdmFuY2VfYW1vdW50JywgJ2FkdmFuY2VfYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ3JuX2Ftb3VudCcsICdncm5fYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmlsbF9hbW91bnQnLCAnYmlsbF9hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydiaWxsX25vJywgJ2JpbGxfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdGF0dXMnLCAnc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXR0YWNobWVudCcsICdhdHRhY2htZW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnaW52b2ljZScsICdpbnZvaWNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndmF0JywgJ3ZhdCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCduYW1lJywgaWdub3JlU3VwcGxpZXJzKCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdBdWRpdCcsICdCaWxsaW5nJywgJ01hbmFnZW1lbnQnLCAnQWNjb3VudHMnXSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Fzc2lnbmVkX3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcikKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSAuICcgKCcgLiAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZSAuICcpJyA6ICcnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4tbGluayBzaG93UE9EZXRhaWxzIiBvbmNsaWNrPSJzaG93UE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHZhbHVlcy0+aWQpIC4gJyI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA6IDA7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX3F0eScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCAkaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2N1cnJlbmNpZXMnLCAnY3VycmVuY2llcy5pZCcsICc9JywgJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FkdmFuY2VfYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9IHBvQWR2YW5jZSgkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcG9BZHZhbmNlWydhZHZhbmNlJ107CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ3JuX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm5Ub3RhbEFtb3VudCA9ICR2YWx1ZXMtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+c3VtKCd0b3RhbF9hbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRncm5Ub3RhbEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYmlsbF9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdyblRvdGFsQW1vdW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT5zdW0oJ2JpbGxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCRncm5Ub3RhbEFtb3VudCA+IDApID8gc3lzdGVtTW9uZXlGb3JtYXQoJGdyblRvdGFsQW1vdW50KSA6ICdOb3QgVXBkYXRlZCBZZXQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTm90IFVwZGF0ZWQgWWV0JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiaWxsX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcG9BdHRhY2htZW50LT5iaWxsX251bWJlcikgPyAkcG9BdHRhY2htZW50LT5iaWxsX251bWJlciA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTm90IFVwbG9hZGVkIFlldCc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmlsbF9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiaWxsX251bWJlcicsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2JpbGxfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudC5iaWxsX251bWJlcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50LnB1cmNoYXNlX29yZGVyX2lkJywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdCwgJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpdFsnZ3JuX3F0eSddID0gJGl0LT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9ICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpID09ICR0b3RhbF9ncm5fcXR5ID8/IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzIC49ICc8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiPkZ1bGwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgLj0gJyA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiPlBhcnRpYWwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdHVzczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhdHRhY2htZW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYoY2hlY2tQb0F0dGFjaG1lbnQoJHZhbHVlcy0+aWQsICJwbyIpICYmICgkdmFsdWVzLT5ncm9zc19wcmljZSA+IChwb0FkdmFuY2UoJHZhbHVlcy0+aWQpWydhZHZhbmNlJ10rJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT5zdW0oJ2JpbGxfYW1vdW50JykpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja1BvQXR0YWNobWVudCgkdmFsdWVzLT5pZCwgInBvIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJVcGxvYWRQT0F0dGFjaG1lbnQoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWluZm8gYnRuLXhzIFVwbG9hZFBPQXR0YWNobWVudCIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyI+PGkgY2xhc3M9ImxhcyBsYS11cGxvYWQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2ludm9pY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHBvQXR0YWNobWVudC0+aW52b2ljZV9maWxlKSAuICciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1pbnZvaWNlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd2YXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIGFzc2V0KCRwb0F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpIC4gJyIgdGFyZ2V0PSJfX2JsYW5rIiAgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgdmF0IGNoYWxhbiI+PGkgY2xhc3M9ImxhcyBsYS1tb25leS1jaGVjay1hbHQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLmxpc3QnLCAkdmFsdWVzLT5pZCkgLiAnIiAgZGF0YS10b2dnbGU9InRvb2x0aXAiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgUE8gQ2hhbGxhbiI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjay1jaXJjbGUiPjwvaT4gQ2hhbGFuKCcgLiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgLiAnKSA8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5wcmludCcsICR2YWx1ZXMtPmlkKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT4gUHJpbnQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnN0YXR1cykgJiYgIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnJlbWFya3MpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgcG8tYXR0YWNobWVudD0iJyAuIHN0cmlwX3RhZ3MoJHBvQXR0YWNobWVudC0+cmVtYXJrcykgLiAnIiBjbGFzcz0idmlld1JlbWFya3MiIG9uQ2xpY2s9InZpZXdSZW1hcmtzKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLWV5ZSI+PC9pPiBWaWV3IFJlbWFya3M8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywgJHZhbHVlcy0+aWQpIC4gJyIgdGl0bGU9Ikhpc3RvcnkiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPiBIaXN0b3J5PC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbklkID0gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxSZXF1ZXN0UHJvcG9zYWwtPnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLT5maXJzdCgpLT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNrIFByb2dyZXNzIgogICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cyIgb25jbGljaz0idHJhY2tSZXF1aXNpdGlvblByb2dyZXNzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHJlcXVpc2l0aW9uSWQgLiAnIj48aSBjbGFzcz0ibGEgbGEtbWFwIj48L2k+VHJhY2sgUHJvZ3Jlc3M8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnc3VwcGxpZXInLCAncmVmZXJlbmNlX25vJywgJ2JpbGxfYW1vdW50JywgJ3N0YXR1cycsICdhdHRhY2htZW50JywgJ2ludm9pY2UnLCAndmF0JywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdQTyBMaXN0JywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBhdHRhY2htZW50VXBsb2FkRm9ybShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRwbyA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWydyZWxHb29kUmVjZWl2ZU5vdGUnLCAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycsICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLCAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsICdyZWxQb0F0dGFjaG1lbnQnXSkKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgaWYgKCRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICBmb3JlYWNoICgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZSBhcyAka2V5ID0+ICRncm4pIHsKICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHBvLT5pZCktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpLT53aGVyZSgnYmlsbF90eXBlJywgJ2dybicpLT53aGVyZUluKCdzdGF0dXMnLCBbJ2FwcHJvdmVkJ10pLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJHBvQXR0YWNobWVudC0+aWQpKSB7CgogICAgICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVJdGVtc0lkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICAgICAgICAgICRncm5bJ2dybl9hbW91bnQnXSA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHBvLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywgJGdvb2RzUmVjZWl2ZUl0ZW1zSWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgndG90YWxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRwb19iaWxsID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRyZXF1ZXN0LT5pZCkKICAgICAgICAgICAgLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJykKICAgICAgICAgICAgLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgICAgICAgICAtPmZpcnN0KCk7CgoKICAgICAgICBpZiAoJHBvLT5yZWxRdW90YXRpb24tPnR5cGUgPT0gJ2RpcmVjdC1wdXJjaGFzZScpIHsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuZGlyZWN0LXB1cmNoYXNlLl9pdG9fcG9fYXR0YWNoZW1lbnRfZm9ybScsIGNvbXBhY3QoJ3BvJywgJ3BvX2JpbGwnKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5fcG8tYXR0YWNoZW1lbnQtdXBsb2FkJywgY29tcGFjdCgncG8nLCAncG9fYmlsbCcpKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9JbnZvaWNlTGlzdCgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gIlB1cmNoYXNlIE9yZGVyIFdpc2UgQ2hhbGxhbiBMaXN0IjsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlJywgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLCAncmVsUXVvdGF0aW9uJywgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICAkY3VycmVuY3kgPSAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlOwoKICAgICAgICAgICAgaWYgKCRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcHVyY2hhc2VPcmRlci0+cmVsR29vZFJlY2VpdmVOb3RlIGFzICRrZXkgPT4gJGdybikgewoKICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbXNJZCA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKS0+cGx1Y2soJ2lkJyktPmFsbCgpOwoKICAgICAgICAgICAgICAgICAgICAkZ3JuWydncm5fYW1vdW50J10gPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwdXJjaGFzZU9yZGVyLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywgJGdvb2RzUmVjZWl2ZUl0ZW1zSWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgndG90YWxfYW1vdW50Jyk7CgogICAgICAgICAgICAgICAgICAgICRncm5bJ3BvQXR0YWNobWVudCddID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwdXJjaGFzZU9yZGVyLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAnZ3JuJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1pbnZvaWNlLWxpc3QnLCBjb21wYWN0KCd0aXRsZScsICdwdXJjaGFzZU9yZGVyJywgJ2N1cnJlbmN5JykpOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBvSW52b2ljZUxpc3RHcm5EZXRhaWxzKCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLmRpcmVjdC1wdXJjaGFzZS5wby1pbnZvaWNlLWxpc3QtZ3JuLWRldGFpbHMnLCBjb21wYWN0KCdncm4nKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYXVkaXRQb0ludm9pY2VMaXN0KCRpZCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICAkdGl0bGUgPSAiUHVyY2hhc2UgT3JkZXIgV2lzZSBDaGFsbGFuIExpc3QgKCIgLiAkcHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vIC4gJyknOwoKICAgICAgICAgICAgJGN1cnJlbmN5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLmF1ZGl0LXBvLWludm9pY2UtbGlzdCcsIGNvbXBhY3QoJ3RpdGxlJywgJ3B1cmNoYXNlT3JkZXInLCAnY3VycmVuY3knKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9JbnZvaWNlUHJpbnQoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciI7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxSZXF1ZXN0UHJvcG9zYWwnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxRdW90YXRpb25JdGVtcycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAnVW5pdCcsCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAnd2FyZWhvdXNlJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24nCgogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGRlbGl2ZXJ5Q29udGFjdCA9IFxBcHBcVXNlcjo6ZmluZChnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsICRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSk7CgogICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkcHVyY2hhc2VPcmRlciwKICAgICAgICAgICAgICAgICdkZWxpdmVyeUNvbnRhY3QnID0+ICRkZWxpdmVyeUNvbnRhY3QsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtcycgPT4gJHJlcXVpc2l0aW9uSXRlbXMsCiAgICAgICAgICAgIF0sICR0aXRsZSwgJHRpdGxlKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9JbnZvaWNlQmlsbHMoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUG9BdHRhY2htZW50JwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1iaWxscycsIFsKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkcHVyY2hhc2VPcmRlcgogICAgICAgICAgICBdKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYlBPaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwb19kYXRlJywgJ3BvX2RhdGUnLCAndGV4dC1sZWZ0JywgJ3dpZHRoOjEwJSddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwb19xdHknLCAncG9fcXR5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ3JuX3F0eScsICdncm5fcXR5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwb19hbW91bnQnLCAncG9fYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYWR2YW5jZV9hbW91bnQnLCAnYWR2YW5jZV9hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydncm5fYW1vdW50JywgJ2dybl9hbW91bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydiaWxsX2Ftb3VudCcsICdiaWxsX2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdzdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydpbnZvaWNlJywgJ2ludm9pY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyd2YXQnLCAndmF0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXBwcm92ZWQnLCAnYXBwcm92ZWQnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlIWltcG9ydGFudCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGJpbGxpbmdQT0F0dGFjaG1lbnRMaXN0KCkKICAgIHsKICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygnY2FuY2VsLWJpbGwnKSl7CiAgICAgICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICRiaWxsID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnCiAgICAgICAgICAgICAgICBdKS0+ZmluZChyZXF1ZXN0KCktPmdldCgnYmlsbCcpKTsKCiAgICAgICAgICAgICAgICAkYmlsbC0+c3RhdHVzID0gJ2hhbHQnOwogICAgICAgICAgICAgICAgJGJpbGwtPnNhdmUoKTsKCiAgICAgICAgICAgICAgICBpZigkYmlsbCl7CgogICAgICAgICAgICAgICAgICAgIFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJ2NhbmNlbGVkJwogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoJ2pzb24nKTsKICAgICAgICAgICAgICAgICAgICAkYXJyYXkgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGJpbGwtPmJpbGxfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQmlsbCBDYW5jZWwgOjogU3VwcGxpZXIgUGF5YWJsZSBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAncG8tYmlsbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRiaWxsLT5pZAogICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snZ3Jpcl9hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGJpbGwtPmJpbGxfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQmlsbCBDYW5jZWwgOjogR1IvSVIgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwby1iaWxsJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGJpbGwtPmlkCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKDUsIGRhdGUoJ1ktbS1kIEg6aTpzJyksIDEsICcnLCAnQmlsbCBBcHByb3ZhbCBDYW5jZWxsYXRpb24nLCAkYXJyYXksICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsIDAsIDAsIDAsIGdldENvc3RDZW50cmVDb21wYW55KCRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCksIGZhbHNlLCAnanNvbicpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGVudHJ5WydlbnRyeSddWydpZCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckVudHJ5Ojp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkYmlsbC0+cmVsUHVyY2hhc2VPcmRlci0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2JpbGwtYXBwcm92YWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnlbJ2VudHJ5J11bJ2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2F0JyA9PiBkYXRlKCdZLW0tZCBIOmk6cycpCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVN1cHBsaWVyTGVkZ2VyKCRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLCBkYXRlKCdZLW0tZCcpLCAkYmlsbC0+YmlsbF9hbW91bnQsIDAsICcnLCAnJywgJ0JpbGwgQXBwcm92YWwgQ2FuY2VsbGF0aW9uIDo6IFN1cHBsaWVyIFBheWFibGUgQ3JlZGl0JywgMCwgMCwgJGJpbGwtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgJGVudHJ5WydlbnRyeSddWydpZCddKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gZ2V0TW9kdWxlcygpWydmaW5hbmNlJ10tPnVybCAuICcvcG1zL3B1cmNoYXNlL29yZGVyLWxpc3QvJyAuICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCAuICcvc2hvdz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRiaWxsLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnLiBCaWxsIEFwcHJvdmFsIGhhcyBiZWVuIENhbmNlbGxlZC48L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJCaWxsIEFwcHJvdmFsIGhhcyBiZWVuIENhbmNlbGxlZCBTdWNjZXNzZnVsbHkuIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH1jYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZS0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gIkJpbGxpbmcgQXR0YWNobWVudCBMaXN0IjsKCiAgICAgICAgICAgICRwdXJjaGFzZV9vcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxQb0F0dGFjaG1lbnQnLAogICAgICAgICAgICAgICAgJ3JlbFN1cHBsaWVyUGF5bWVudHMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydQdXJjaGFzZS1EZXBhcnRtZW50JywgJ0F1ZGl0JywgJ0JpbGxpbmcnLCAnTWFuYWdlbWVudCcsICdBY2NvdW50cyddKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNzaWduZWRfdXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdiaWxsX3R5cGUnLCBbJ3BvJywgJ2dybiddKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncG9fZGF0ZScsICc+PScsIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlRGF0ZSgncG9fZGF0ZScsICc8PScsIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygnc3RhdHVzJykgJiYgIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHB1cmNoYXNlX29yZGVyKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncG9fZGF0ZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncG9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncG9fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lIC4gJyAoJyAuICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5jb2RlIC4gJyknIDogJycpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyktPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgnc3VwcGxpZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdzdXBwbGllcnMnLCAnc3VwcGxpZXJzLmlkJywgJz0nLCAncXVvdGF0aW9ucy5zdXBwbGllcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgb25jbGljaz0ic2hvd1BPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICR2YWx1ZXMtPmlkKSAuICciPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncG9fcXR5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcykgPyAkdmFsdWVzLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5JykgOiAwOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dybl9xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdCwgJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpdFsnZ3JuX3F0eSddID0gJGl0LT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKS0+b3JXaGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgnY3VycmVuY2llcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignZXhjaGFuZ2VfcmF0ZXMnLCAnZXhjaGFuZ2VfcmF0ZXMuaWQnLCAnPScsICdxdW90YXRpb25zLmV4Y2hhbmdlX3JhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjdXJyZW5jaWVzJywgJ2N1cnJlbmNpZXMuaWQnLCAnPScsICdleGNoYW5nZV9yYXRlcy5jdXJyZW5jeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncG9fYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPmdyb3NzX3ByaWNlKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhZHZhbmNlX2Ftb3VudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0FkdmFuY2UgPSBwb0FkdmFuY2UoJHZhbHVlcy0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBvQWR2YW5jZVsnYWR2YW5jZSddOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dybl9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuVG90YWxBbW91bnQgPSAkdmFsdWVzLT5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4tPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPnN1bSgndG90YWxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkZ3JuVG90YWxBbW91bnQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2JpbGxfYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdyblRvdGFsQW1vdW50ID0gJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPnN1bSgnYmlsbF9hbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJGdyblRvdGFsQW1vdW50ID4gMCkgPyBzeXN0ZW1Nb25leUZvcm1hdCgkZ3JuVG90YWxBbW91bnQpIDogJ05vdCBVcGRhdGVkIFlldCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdOb3QgVXBkYXRlZCBZZXQnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N0YXR1cycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZXMtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0LCAkaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0Wydncm5fcXR5J10gPSAkaXQtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9ncm5fcXR5ID0gJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5JykgPT0gJHRvdGFsX2dybl9xdHkgPz8gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1c3MgLj0gJzxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+RnVsbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzcyAuPSAnIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGVmYXVsdCI+UGFydGlhbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0dXNzOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2ludm9pY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHBvQXR0YWNobWVudC0+aW52b2ljZV9maWxlKSAuICciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1pbnZvaWNlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd2YXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvQXR0YWNobWVudCA9ICR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcG9BdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIGFzc2V0KCRwb0F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpIC4gJyIgdGFyZ2V0PSJfX2JsYW5rIiAgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgdmF0IGNoYWxhbiI+PGkgY2xhc3M9ImxhcyBsYS1tb25leS1jaGVjay1hbHQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmVkJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGxlZGdlcnMgPSBTdXBwbGllckxlZGdlcnM6OndoZXJlSGFzKCdyZWxTdXBwbGllclBheW1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICR2YWx1ZXMtPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnc3RhdHVzJywgJ2FwcHJvdmVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSA9ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwcHgiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbGVkZ2VycyA9PSAwICYmICRwb0F0dGFjaG1lbnQtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdwby1iaWxsLWFwcHJvdmFsJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG9BdHRhY2htZW50LT5maXJzdCgpLT5zdGF0dXMpICYmICRwb0F0dGFjaG1lbnQtPmZpcnN0KCktPnN0YXR1cyA9PT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiIHRpdGxlPSJBcHByb3ZlZCI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkdmFsdWVzLT5yZWxTdXBwbGllclBheW1lbnRzLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmZpcnN0KCktPnBheV9hbW91bnQgPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciIgdGl0bGU9IkNhbmNlbCIgb25jbGljaz0iQ2FuY2VsQmlsbEFwcHJvdmFsKCQodGhpcykpIiBkYXRhLWlkPSInLiRwb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKS0+aWQuJyI+PGkgY2xhc3M9ImxhIGxhLWJhbiI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxzZWxlY3QgY2xhc3M9ImNoYW5nZVN0YXR1cyBmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJjaGFuZ2VTdGF0dXMoJCh0aGlzKSkiIHN0eWxlPSJ3aWR0aDogMTAwJSIgYmlsbC10eXBlPSJwbyIgcG8taWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGlkPSJjaGFuZ2VTdGF0dXMnIC4gJHZhbHVlcy0+aWQgLiAnIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJyAuIChpc3NldCgkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMpICYmICRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cyA9PT0gJ3BlbmRpbmcnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9InBlbmRpbmciPlBlbmRpbmc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKGlzc2V0KCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgJiYgJHBvQXR0YWNobWVudFswXS0+c3RhdHVzID09PSAnYXBwcm92ZWQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImFwcHJvdmVkIj5BcHByb3ZlZDwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoaXNzZXQoJHBvQXR0YWNobWVudFswXS0+c3RhdHVzKSAmJiAkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMgPT09ICdoYWx0JyA/ICdzZWxlY3RlZCcgOiAiIikgLiAnIHZhbHVlPSJoYWx0Ij5IYWx0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYXJrIG1yLTEiIHRpdGxlPSInLihpc3NldCgkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMpID8gdWN3b3JkcygkcG9BdHRhY2htZW50WzBdLT5zdGF0dXMpIDogJycpLiciPicuKGlzc2V0KCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgPyB1Y3dvcmRzKCRwb0F0dGFjaG1lbnRbMF0tPnN0YXR1cykgOiAnJykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LnBvLmhpc3RvcnknLCAkdmFsdWVzLT5pZCkgLiAnIiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi14cyIgdGl0bGU9Ikhpc3RvcnkiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPjwvYT4nOwoKCiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8ZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXBwcm92ZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj48c3Bhbj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJjdXJyZW50Q29sb3IiIGNsYXNzPSJiaSBiaS10aHJlZS1kb3RzLXZlcnRpY2FsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPjxwYXRoIGQ9Ik05LjUgMTNhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAweiIvPjwvc3ZnPjwvc3Bhbj48L2J1dHRvbj48dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5hdWRpdC5wby5pbnZvaWNlLmxpc3QnLCAkdmFsdWVzLT5pZCkgLiAnIiAgZGF0YS10b2dnbGU9InRvb2x0aXAiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgUE8gQ2hhbGxhbiI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjay1jaXJjbGUiPjwvaT4gQ2hhbGFuKCcgLiAkdmFsdWVzLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgLiAnKSA8L2E+PC9saT4KICAgICAgICAgICAgICAgIDxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5wcmludCcsICR2YWx1ZXMtPmlkKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT4gUHJpbnQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPnJlbFBvQXR0YWNobWVudFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb0F0dGFjaG1lbnQgPSAkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnN0YXR1cykgJiYgIWVtcHR5KCRwb0F0dGFjaG1lbnQtPnJlbWFya3MpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgcG8tYXR0YWNobWVudD0iJyAuIHN0cmlwX3RhZ3MoJHBvQXR0YWNobWVudC0+cmVtYXJrcykgLiAnIiBjbGFzcz0idmlld1JlbWFya3MiIG9uQ2xpY2s9InZpZXdSZW1hcmtzKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLWV5ZSI+PC9pPiBWaWV3IFJlbWFya3M8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydzdXBwbGllcicsICdyZWZlcmVuY2Vfbm8nLCAnYmlsbF9hbW91bnQnLCAnc3RhdHVzJywgJ2FwcHJvdmVkJywgJ2ludm9pY2UnLCAndmF0JywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWF0dGFjaG1lbnQtbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1BPIExpc3QnLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5iUE9oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9BaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwb19kYXRlJywgJ3BvX2RhdGUnLCAndGV4dC1sZWZ0JywgJ3dpZHRoOjE1JSddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncG9fcXR5JywgJ3BvX3F0eScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2N1cnJlbmN5JywgJ2N1cnJlbmN5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncG9fYW1vdW50JywgJ3BvX2Ftb3VudCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYWR2YW5jZV9hbW91bnQnLCAnYWR2YW5jZV9hbW91bnQnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGJpbGxpbmdQT0FkdmFuZUxpc3QoKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkdGl0bGUgPSAiUE8gQWR2YW5jZSBMaXN0IjsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbJ3JlbFF1b3RhdGlvbicsICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLCAncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywgJ3JlbFN1cHBsaWVyUGF5bWVudHMnXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFN1cHBsaWVyUGF5bWVudHMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnYmlsbF90eXBlJywgJ3BvLWFkdmFuY2UnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdwb19kYXRlJywgJz49JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpKSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmVEYXRlKCdwb19kYXRlJywgJzw9JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvX2RhdGUnKSkpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ3N0YXR1cycpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgnc3RhdHVzJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFN1cHBsaWVyUGF5bWVudHMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdGF0dXMnLCByZXF1ZXN0KCktPmdldCgnc3RhdHVzJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHB1cmNoYXNlT3JkZXIpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncG9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUgLiAnICgnIC4gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUgLiAnKScgOiAnJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKS0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgnc3VwcGxpZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdzdXBwbGllcnMnLCAnc3VwcGxpZXJzLmlkJywgJz0nLCAncXVvdGF0aW9ucy5zdXBwbGllcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgb25jbGljaz0ic2hvd1BPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICR2YWx1ZXMtPmlkKSAuICciPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncG9fcXR5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcl9mb3JtYXQoaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA6IDAsIDApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2N1cnJlbmNpZXMnLCAnY3VycmVuY2llcy5pZCcsICc9JywgJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FkdmFuY2VfYW1vdW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8kcG9BZHZhbmNlID0gcG9BZHZhbmNlKCR2YWx1ZXMtPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHBvQWR2YW5jZSA9ICR2YWx1ZXMtPnJlbFN1cHBsaWVyUGF5bWVudHMtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8tYWR2YW5jZScpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoaXNzZXQoJHBvQWR2YW5jZVswXS0+cGF5X2Ftb3VudCkgPyAkcG9BZHZhbmNlWzBdLT5wYXlfYW1vdW50IDogMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0FkdmFuY2UgPSAkdmFsdWVzLT5yZWxTdXBwbGllclBheW1lbnRzLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvLWFkdmFuY2UnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3BvLWFkdmFuY2UtYXBwcm92YWwnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSAmJiBpbl9hcnJheSgkcG9BZHZhbmNlWzBdLT5zdGF0dXMsIFsnYXVkaXRlZCcsICdhcHByb3ZlZCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+IEFwcHJvdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48c2VsZWN0IGNsYXNzPSJjaGFuZ2VTdGF0dXMgZm9ybS1jb250cm9sIiBvbmNoYW5nZT0iY2hhbmdlU3RhdHVzKCQodGhpcykpIiBzdHlsZT0id2lkdGg6IDEwMCUiIGJpbGwtdHlwZT0icG8tYWR2YW5jZSIgcG8taWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGlkPSJjaGFuZ2VTdGF0dXMnIC4gJHZhbHVlcy0+aWQgLiAnIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPG9wdGlvbiAnIC4gKGlzc2V0KCRwb0FkdmFuY2VbMF0tPnN0YXR1cykgJiYgJHBvQWR2YW5jZVswXS0+c3RhdHVzID09PSAncGVuZGluZycgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0icGVuZGluZyI+UGVuZGluZzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxvcHRpb24gJyAuIChpc3NldCgkcG9BZHZhbmNlWzBdLT5zdGF0dXMpICYmICRwb0FkdmFuY2VbMF0tPnN0YXR1cyA9PT0gJ2F1ZGl0ZWQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImF1ZGl0ZWQiPkFwcHJvdmVkPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPG9wdGlvbiAnIC4gKGlzc2V0KCRwb0FkdmFuY2VbMF0tPnN0YXR1cykgJiYgJHBvQWR2YW5jZVswXS0+c3RhdHVzID09PSAnY2FuY2VsZWQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImNhbmNlbGVkIj5IYWx0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhcmsgbXItMSI+Jy4oaXNzZXQoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSA/IHVjd29yZHMoJHBvQWR2YW5jZVswXS0+c3RhdHVzKSA6ICcnKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3N1cHBsaWVyJywgJ3JlZmVyZW5jZV9ubycsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1hZHZhbmNlLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cG9BaGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlZGlyZWN0UmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGJpbGxpbmdBdHRhY2htZW50U3VibWl0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gInJlcXVpcmVkfG1heDoxMDAiLAogICAgICAgICAgICAnYmlsbF9hbW91bnQnID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2ludm9pY2VfZmlsZScgPT4gJ21pbWVzOmpwZWcsanBnLHBuZyxnaWYscGRmfHJlcXVpcmVkfG1heDo1MDQ4JywKICAgICAgICAgICAgJ3ZhdF9jaGFsbGFuX2ZpbGUnID0+ICdtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxudWxsYWJsZXxtYXg6NTA0OCcsCiAgICAgICAgXSk7CgogICAgICAgICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPmZpcnN0KCk7CiAgICAgICAgaWYgKGVtcHR5KCRtb2RlbCkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdQdXJjaGFzZSBPcmRlciBOb3QgRm91bmQhIScpOwogICAgICAgIH0KCiAgICAgICAgJGJpbGxfYW1vdW50ID0gZG91YmxldmFsKHN0cl9yZXBsYWNlKCcsJywgJycsICRyZXF1ZXN0LT5iaWxsX2Ftb3VudCkpOwogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRyZXF1aXNpdGlvbklkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPnJlbFJlcXVlc3RQcm9wb3NhbC0+cmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24tPmZpcnN0KCktPnJlcXVpc2l0aW9uX2lkOwogICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ2ludm9pY2Vfc3VibWl0dGVkJywgJ0ludm9pY2UgU3VibWl0dGVkJyk7CgogICAgICAgICAgICBpZiAoJG1vZGVsLT5yZWxRdW90YXRpb24tPnR5cGUgPT0gJ2RpcmVjdC1wdXJjaGFzZScpIHsKICAgICAgICAgICAgICAgICR0aGlzLT51cGRhdGVEaXJlY3RQdXJjaGFzZVByaWNlKCRyZXF1ZXN0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICcnOwogICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICcnOwoKICAgICAgICAgICAgJGV4aXNpbmdfYXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbyddKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKSB7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRleGlzaW5nX2F0dGFjaG1lbnQpICYmICFlbXB0eSgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVubGluayhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT5pbnZvaWNlX2ZpbGUpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkZXhpc2luZ19hdHRhY2htZW50LT52YXRfY2hhbGxhbl9maWxlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdpbnZvaWNlX2ZpbGUnKSwgJ3VwbG9hZC9wdXJjaGFzZS1vcmRlci9pbnZvaWNlJyk7CgogICAgICAgICAgICAgICAgJHZhdF9jaGFsbGFuX2ZpbGUgPSAkdGhpcy0+ZmlsZVVwbG9hZCgkcmVxdWVzdC0+ZmlsZSgndmF0X2NoYWxsYW5fZmlsZScpLCAndXBsb2FkL3B1cmNoYXNlLW9yZGVyL3ZhdC1jaGFsYW4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFB1cmNoYXNlT3JkZXJBdHRhY2htZW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OnVwZGF0ZU9yQ3JlYXRlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbycKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2ludm9pY2VfZmlsZScgPT4gJGludm9pY2VfZmlsZSwKICAgICAgICAgICAgICAgICAgICAndmF0X2NoYWxsYW5fZmlsZScgPT4gJHZhdF9jaGFsbGFuX2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAkYmlsbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfbnVtYmVyJyA9PiAkcmVxdWVzdC0+YmlsbF9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJ3BlbmRpbmcnLAogICAgICAgICAgICAgICAgICAgICdtYW5hZ2VtZW50X2FwcHJvdmFsJyA9PiAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+dHlwZSA9PSAnZGlyZWN0LXB1cmNoYXNlJyA/ICdwZW5kaW5nJyA6ICdhcHByb3ZlZCcsICdhY2NvdW50c19hcHByb3ZhbCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnR5cGUgPT0gJ2RpcmVjdC1wdXJjaGFzZScgPyAncGVuZGluZycgOiAnYXBwcm92ZWQnLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQgPSBTdXBwbGllclBheW1lbnQ6OnVwZGF0ZU9yQ3JlYXRlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwbycsCiAgICAgICAgICAgICAgICAgICAgJ2JpbGxfbnVtYmVyJyA9PiAkcmVxdWVzdC0+YmlsbF9udW1iZXIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZWN0aW9uX2RhdGUnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJyksCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZWN0aW9uX3R5cGUnID0+ICdwdXJjaGFzZScsCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlX3JhdGVfaWQnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX2Ftb3VudCcgPT4gJGJpbGxfYW1vdW50LAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJGdybnMgPSBHb29kc1JlY2VpdmVkTm90ZTo6ZG9lc250SGF2ZSgncmVsUG9BdHRhY2htZW50JykKICAgICAgICAgICAgLT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICBpZiAoaXNzZXQoJGdybnNbMF0pKSB7CiAgICAgICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcsICRQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+aWQpLT5kZWxldGUoKTsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRncm5zIGFzICRrZXkgPT4gJGdybikgewogICAgICAgICAgICAgICAgICAgIEJpbGxpbmdDaGFsYW46OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50X2lkJyA9PiAkUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdybi0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ3JucyBhcyAka2V5ID0+ICRncm4pIHsKICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdC0+aGFzRmlsZSgnY2hhbGxhbl9maWxlcy4nLiRncm4tPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRncm4tPmNoYWxsYW5fZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdjaGFsbGFuX2ZpbGVzLicuJGdybi0+aWQpLCAndXBsb2FkL2dybi1jaGFsbGFucycpOwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJG1vZGVsLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJG1vZGVsLT5yZWZlcmVuY2Vfbm8gLiAnLiBXYWl0aW5nIGZvciB0aGUgQXVkaXRlZC48L3NwYW4+JzsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdBdWRpdCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1hdWRpdCcpOwoKICAgICAgICAgICAgJG1lc3NhZ2UyID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLAogICAgICAgICAgICAgICAgICAgICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4KICAgICAgICAgICAgICAgICcuIFdhaXRpbmcgZm9yIHRoZSBkaXJlY3QgcHVyY2hhc2UgcHJpY2UgdXBkYXRlIGFwcHJvdmFsLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UyLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdNYW5hZ2VtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLW1hbmFnZXInKTsKCiAgICAgICAgICAgIC8vZGF0YSBjb21taXQKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSB1cGxvYWRlZCBwbyBpbnZvaWNlICYgdmF0IGZpbGUuJyk7CgogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgLy9kYXRhIHJvbGxiYWNrIGlmIHNvbWV0aGluZyB3cm9uZwogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCRlLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZURpcmVjdFB1cmNoYXNlUHJpY2UoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT51bml0X2Ftb3VudCkpIHsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT51bml0X2Ftb3VudCBhcyAkZ3JuSWQgPT4gJGRhdGEpIHsKICAgICAgICAgICAgICAgICRncm5TdWJUb3RhbCA9IDA7CiAgICAgICAgICAgICAgICAkZ3JuRGlzY291bnQgPSAwOwogICAgICAgICAgICAgICAgJGdyblZhdCA9IDA7CiAgICAgICAgICAgICAgICAkZ3JuR3Jvc3NUb3RhbCA9IDA7CgogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGdybkl0ZW1JZCA9PiAkdW5pdEFtb3VudCkgewoKICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbSA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnaWQnLCAkZ3JuSXRlbUlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGdvb2RzUmVjZWl2ZUl0ZW0tPmlkKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgJHF0eSA9ICRnb29kc1JlY2VpdmVJdGVtLT5xdHk7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJUb3RhbCA9ICR1bml0QW1vdW50ICogJHF0eTsKICAgICAgICAgICAgICAgICAgICAgICAgJGdyblN1YlRvdGFsICs9ICRzdWJUb3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpc2NvdW50QW1vdW50ID0gKCRnb29kc1JlY2VpdmVJdGVtLT5kaXNjb3VudF9wZXJjZW50YWdlICogKCR1bml0QW1vdW50ICogJHF0eSkpIC8gMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAkZ3JuRGlzY291bnQgKz0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkdmF0QW1vdW50ID0gKCRnb29kc1JlY2VpdmVJdGVtLT52YXRfcGVyY2VudGFnZSAqICgkdW5pdEFtb3VudCAqICRxdHkpKSAvIDEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGdyblZhdCArPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZ3Jvc3NUb3RhbCA9ICgkc3ViVG90YWwgKyAkdmF0QW1vdW50KSAtICRkaXNjb3VudEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgJGdybkdyb3NzVG90YWwgKz0gJGdyb3NzVG90YWw7CgogICAgICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlSXRlbS0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2Ftb3VudCcgPT4gJHVuaXRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAkc3ViVG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRkaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXQnID0+ICR2YXRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxfYW1vdW50JyA9PiAkZ3Jvc3NUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPndoZXJlKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywgJGdybkl0ZW1JZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+ICR1bml0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWJfdG90YWwnID0+ICRzdWJUb3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRkaXNjb3VudEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkdmF0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hbW91bnQnID0+ICRncm9zc1RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RQcm9kdWN0UHJpY2VVcGRhdGUoJGdvb2RzUmVjZWl2ZUl0ZW0tPnByb2R1Y3RfaWQsICR1bml0QW1vdW50KTsKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVOb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OndoZXJlKCdpZCcsICRncm5JZCktPmZpcnN0KCk7CgoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZ29vZHNSZWNlaXZlTm90ZS0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZU5vdGUtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gJGdyblN1YlRvdGFsLAogICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRncm5EaXNjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJGdyblZhdCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAkZ3JuR3Jvc3NUb3RhbCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UucwogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuQXR0YWNobWVudFVwbG9hZChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAicmVxdWlyZWR8bWF4OjEwMCIsCiAgICAgICAgICAgICdpbnZvaWNlX2ZpbGUnID0+ICdtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxyZXF1aXJlZHxtYXg6NTA0OCcsCiAgICAgICAgICAgICd2YXRfY2hhbGxhbl9maWxlJyA9PiAnbWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8cmVxdWlyZWR8bWF4OjUwNDgnCiAgICAgICAgXSk7CgogICAgICAgICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCktPmZpcnN0KCk7CiAgICAgICAgaWYgKGVtcHR5KCRtb2RlbCkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdQdXJjaGFzZSBPcmRlciBOb3QgRm91bmQhIScpOwogICAgICAgIH0KCiAgICAgICAgJGJpbGxfYW1vdW50ID0gZG91YmxldmFsKHN0cl9yZXBsYWNlKCcsJywgJycsICRyZXF1ZXN0LT5iaWxsX2Ftb3VudCkpOwoKCiAgICAgICAgaWYgKCRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnKSB7CiAgICAgICAgICAgICR0aGlzLT51cGRhdGVEaXJlY3RQdXJjaGFzZVByaWNlKCRyZXF1ZXN0KTsKCiAgICAgICAgICAgICRnb29kc1JlY2VpdmVJdGVtc0lkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpCiAgICAgICAgICAgICAgICAtPnBsdWNrKCdpZCcpCiAgICAgICAgICAgICAgICAtPmFsbCgpOwogICAgICAgICAgICAkc3VidG90YWxBbW91bnQgPSAkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbigpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAkZ29vZHNSZWNlaXZlSXRlbXNJZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgLT5zdW0oJ3RvdGFsX2Ftb3VudCcpOwoKICAgICAgICAgICAgaWYgKGRvdWJsZXZhbCgkc3VidG90YWxBbW91bnQpICE9PSAkYmlsbF9hbW91bnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignWW91ciBpbnB1dCBhbW91bnQgaXMgZ3JlYXRlciB0aGVuIEdSTiBhbW91bnQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvL2JlZ2luIHRyYW5zYWN0aW9uCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGludm9pY2VfZmlsZSA9ICcnOwogICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICcnOwoKICAgICAgICAgICAgJGV4aXNpbmdfYXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCwKICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdncm4nCiAgICAgICAgICAgIF0pLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdpbnZvaWNlX2ZpbGUnKSB8fCAkcmVxdWVzdC0+aGFzRmlsZSgndmF0X2NoYWxsYW5fZmlsZScpKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGV4aXNpbmdfYXR0YWNobWVudCkgJiYgIWVtcHR5KCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+aW52b2ljZV9maWxlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPmludm9pY2VfZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRleGlzaW5nX2F0dGFjaG1lbnQtPnZhdF9jaGFsbGFuX2ZpbGUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bmxpbmsocHVibGljX3BhdGgoJGV4aXNpbmdfYXR0YWNobWVudC0+dmF0X2NoYWxsYW5fZmlsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkaW52b2ljZV9maWxlID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2ludm9pY2VfZmlsZScpLCAndXBsb2FkL3B1cmNoYXNlLW9yZGVyL2ludm9pY2UnKTsKCiAgICAgICAgICAgICAgICAkdmF0X2NoYWxsYW5fZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCd2YXRfY2hhbGxhbl9maWxlJyksICd1cGxvYWQvcHVyY2hhc2Utb3JkZXIvdmF0LWNoYWxhbicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQgPSBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6dXBkYXRlT3JDcmVhdGUoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdncm4nCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCwKICAgICAgICAgICAgICAgICAgICAnaW52b2ljZV9maWxlJyA9PiAkaW52b2ljZV9maWxlLAogICAgICAgICAgICAgICAgICAgICd2YXRfY2hhbGxhbl9maWxlJyA9PiAkdmF0X2NoYWxsYW5fZmlsZSwKICAgICAgICAgICAgICAgICAgICAnYmlsbF9hbW91bnQnID0+ICRiaWxsX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAnZ3JuJywKICAgICAgICAgICAgICAgICAgICAnYmlsbF9udW1iZXInID0+ICRyZXF1ZXN0LT5iaWxsX251bWJlciwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAicGVuZGluZyIsCiAgICAgICAgICAgICAgICAgICAgJ21hbmFnZW1lbnRfYXBwcm92YWwnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnID8gJ3BlbmRpbmcnIDogJ2FwcHJvdmVkJywKICAgICAgICAgICAgICAgICAgICAnYWNjb3VudHNfYXBwcm92YWwnID0+ICRtb2RlbC0+cmVsUXVvdGF0aW9uLT50eXBlID09ICdkaXJlY3QtcHVyY2hhc2UnID8gJ3BlbmRpbmcnIDogJ2FwcHJvdmVkJywKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gXEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IFxBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCFpc3NldCgkZXhpc2luZ19hdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkpIHsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50ID0gbmV3IFN1cHBsaWVyUGF5bWVudCgpOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnN1cHBsaWVyX2lkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnB1cmNoYXNlX29yZGVyX2lkID0gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQgPSAkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZDsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl9kYXRlID0gZGF0ZSgnWS1tLWQgaDppOnMnKTsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl90eXBlID0gJ3B1cmNoYXNlJzsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5iaWxsX251bWJlciA9ICRyZXF1ZXN0LT5iaWxsX251bWJlcjsKICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5leGNoYW5nZV9yYXRlX2lkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQ7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF9hbW91bnQgPSAkYmlsbF9hbW91bnQ7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF90eXBlID0gImdybiI7CiAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+c2F2ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmQoJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpOwogICAgICAgICAgICBCaWxsaW5nQ2hhbGFuOjp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfYXR0YWNobWVudF9pZCcgPT4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5pZAogICAgICAgICAgICBdLCBbCiAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdybi0+aWQKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCAkZ3JuLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IkdSTiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRncm4tPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIHRoZSBBdWRpdGVkLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJ1JlZmVyZW5jZSBObzogPHN0cm9uZz4nIC4gJGdybi0+cmVmZXJlbmNlX25vIC4gJzwvc3Ryb25nPi4gV2FpdGluZyBmb3IgdGhlIEF1ZGl0ZWQnLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdBdWRpdCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1hdWRpdCcpOwoKICAgICAgICAgICAgJG1lc3NhZ2UyID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsCiAgICAgICAgICAgICAgICAgICAgJGdybi0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJHUk4gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkZ3JuLT5yZWZlcmVuY2Vfbm8gLgogICAgICAgICAgICAgICAgJy4gV2FpdGluZyBmb3IgdGhlIGRpcmVjdCBwdXJjaGFzZSBwcmljZSB1cGRhdGUgYXBwcm92YWwuPC9zcGFuPic7CgogICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZTIsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ01hbmFnZW1lbnQnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tbWFuYWdlcicpOwoKICAgICAgICAgICAgLy9kYXRhIGNvbW1pdAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIHBvIGludm9pY2UgJiB2YXQgZmlsZS4nKTsKCiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAvL2RhdGEgcm9sbGJhY2sgaWYgc29tZXRoaW5nIHdyb25nCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYmlsbGluZ1VwZGF0ZUFjdGlvbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRpZCA9ICRyZXF1ZXN0LT5wb19pZDsKICAgICAgICAkYmlsbFR5cGUgPSAkcmVxdWVzdC0+YmlsbF90eXBlOwogICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwogICAgICAgICRncm5JZCA9IGlzc2V0KCRyZXF1ZXN0LT5ncm5faWQpID8gJHJlcXVlc3QtPmdybl9pZCA6ICcnOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICBQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZ3JuSWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRncm5JZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAkYmlsbFR5cGUpCiAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHN0YXR1cywKICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgPT4gJHJlcXVlc3QtPnJlbWFya3MKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgaWYgKCRzdGF0dXMgPT0gJ3BlbmRpbmcnKSB7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAncGVuZGluZyc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlID0gIkJpbGxpbmcgc3RhdHVzIHVwZGF0ZWQgdG8gcGVuZGluZyI7CiAgICAgICAgICAgICAgICAkc3RhdGU9J2F1ZGl0LXBlbmRpbmcnOwogICAgICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgICAgICAgICAkYXVkaXRTdGF0dXMgPSAnYXVkaXRlZCc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlID0gIlN1Y2Nlc3NmdWxseSBhdWRpdGVkIGJ5IGF1ZGl0IGRlcGFydG1lbnQiOwogICAgICAgICAgICAgICAgJHN0YXRlPSdhdWRpdC1hcHByb3ZlZCc7CiAgICAgICAgICAgIH0gZWxzZWlmICgkc3RhdHVzID09ICdoYWx0JykgewogICAgICAgICAgICAgICAgJGF1ZGl0U3RhdHVzID0gJ2NhbmNlbGVkJzsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2UgPSAiVGhpcyBiaWxsIGhhbHQgYnkgYXVkaXQgZGVwYXJ0bWVudC4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwogICAgICAgICAgICAgICAgJHN0YXRlPSdhdWRpdC1oYWx0JzsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZ3JuSWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRncm5JZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAkYmlsbFR5cGUpCiAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJGF1ZGl0U3RhdHVzCiAgICAgICAgICAgICAgICBdKTsKCgogICAgICAgICAgICAkbW9kZWwgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICBpZiAoJHN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CgogICAgICAgICAgICAgICAgLy9HUi9JUiBQcm9jZXNzCiAgICAgICAgICAgICAgICAkYW1vdW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRpZCwKICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAkYmlsbFR5cGUsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHN0YXR1cywKICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgPT4gJHJlcXVlc3QtPnJlbWFya3MKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZ3JuSWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRncm5JZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5JZCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYmlsbF9hbW91bnQnKTsKCiAgICAgICAgICAgICAgICAkcG9CaWxsID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRpZCkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRncm5JZCksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGdybklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybklkKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyk7CiAgICAgICAgICAgICAgICAkYXJyYXkgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkbW9kZWwtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snZ3Jpcl9hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0JpbGwgQXBwcm92YWwgOjogR1IvSVIgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAncG8tYmlsbCcsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBvQmlsbC0+aWQKICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRtb2RlbC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkbW9kZWwtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfcGF5YWJsZV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdCaWxsIEFwcHJvdmFsIDo6IFN1cHBsaWVyIFBheWFibGUgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3BvLWJpbGwnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwb0JpbGwtPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycpLCAxLCAnJywgJ0JpbGwgQXBwcm92YWwnLCAkYXJyYXksICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkbW9kZWwtPmNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRlbnRyeVsnZW50cnknXVsnaWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckVudHJ5Ojp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJG1vZGVsLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRtb2RlbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYmlsbC1hcHByb3ZhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddWydpZCddLAogICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgc2F2ZVN1cHBsaWVyTGVkZ2VyKCRtb2RlbC0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCwgZGF0ZSgnWS1tLWQnKSwgMCwgJGFtb3VudCwgJycsICcnLCAnQmlsbCBBcHByb3ZhbCA6OiBTdXBwbGllciBQYXlhYmxlIENyZWRpdCcsIDAsIDAsICRtb2RlbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAkZW50cnlbJ2VudHJ5J11bJ2lkJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9HUi9JUiBQcm9jZXNzCgogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiBnZXRNb2R1bGVzKClbJ2ZpbmFuY2UnXS0+dXJsIC4gJy9wbXMvcHVyY2hhc2Uvb3JkZXItbGlzdC8nIC4gJG1vZGVsLT5pZCAuICcvc2hvdz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4gV2FpdGluZyBmb3IgUGF5bWVudHMuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICRyZXF1aXNpdGlvbklkID0gJG1vZGVsLT5yZWxRdW90YXRpb24tPnJlbFJlcXVlc3RQcm9wb3NhbC0+cmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24tPmZpcnN0KCktPnJlcXVpc2l0aW9uX2lkOwogICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwkc3RhdGUsJHB1cmNoYXNlTWVzc2FnZSk7CgoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4nIC4gJHB1cmNoYXNlTWVzc2FnZSAuICcuPC9zcGFuPic7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICBpZiAoIWVtcHR5KCRncm5JZCkpIHsKICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICJCaWxsaW5nIEludm9pY2UgdXBkYXRlZCBzdWNjZXNzZnVsbHkiKTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJCaWxsaW5nIEludm9pY2UgdXBkYXRlZCBzdWNjZXNzZnVsbHkiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb0FkdmFuY2VVcGRhdGVBY3Rpb24oUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkaWQgPSAkcmVxdWVzdC0+cG9faWQ7CiAgICAgICAgJGJpbGxUeXBlID0gJHJlcXVlc3QtPmJpbGxfdHlwZTsKICAgICAgICAkc3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdXBwbGllclBheW1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRpZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsVHlwZSkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAvL3N0YXJ0IHN1cHBsaWVyIHBheW1lbnQgdXBkYXRlCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdwZW5kaW5nJykgewogICAgICAgICAgICAgICAgJGF1ZGl0U3RhdHVzID0gJ3BlbmRpbmcnOwogICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJBZHZhbmNlIHN0YXR1cyB1cGRhdGVkIHRvIHBlbmRpbmciOwogICAgICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAnYXVkaXRlZCcpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdhdWRpdGVkJzsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2UgPSAiU3VjY2Vzc2Z1bGx5IGF1ZGl0ZWQgYnkgYXVkaXQgZGVwYXJ0bWVudCI7CiAgICAgICAgICAgIH0gZWxzZWlmICgkc3RhdHVzID09ICdjYW5jZWxlZCcpIHsKICAgICAgICAgICAgICAgICRhdWRpdFN0YXR1cyA9ICdjYW5jZWxlZCc7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VNZXNzYWdlID0gIlRoaXMgQWR2YW5jZSBoYWx0IGJ5IGF1ZGl0IGRlcGFydG1lbnQuIFBsZWFzZSB1cGxvYWQgaXQgYWdhaW4uIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2VuZCBzdXBwbGllciBwYXltZW50IHVwZGF0ZQoKICAgICAgICAgICAgJG1vZGVsID0gUHVyY2hhc2VPcmRlcjo6d2hlcmUoJ2lkJywgJGlkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdhdWRpdGVkJykgewogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiBnZXRNb2R1bGVzKClbJ2ZpbmFuY2UnXS0+dXJsIC4gJy9wbXMvcHVyY2hhc2Uvb3JkZXItbGlzdC8nIC4gJG1vZGVsLT5pZCAuICcvc2hvdz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4gV2FpdGluZyBmb3IgUGF5bWVudHMuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRtb2RlbC0+aWQpIC4gJz92aWV3IiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRtb2RlbC0+cmVmZXJlbmNlX25vIC4gJy4nIC4gJHB1cmNoYXNlTWVzc2FnZSAuICcuPC9zcGFuPic7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdBZHZhbmNlIFN0YXR1cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGlzdG9yeSgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICJQdXJjaGFzZSBPcmRlciBIaXN0b3J5IjsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxQdXJjaGFzZU9yZGVyJywKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsUmVxdWVzdFByb3Bvc2FsLnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uJwogICAgICAgICAgICBdKS0+d2hlcmUoJ2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgJHByb3Bvc2FscyA9IFJlcXVlc3RQcm9wb3NhbDo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24ucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbnMucmVsU3VwcGxpZXJzJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsIChpc3NldCgkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkKSA/ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQgOiAwKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlcmJ5KCdpZCcsICdkZXNjJyktPmZpcnN0KCk7CgoKICAgICAgICAgICAgJGJpbGxNYW5hZ2UgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucGFyZW50UXVvdGF0aW9uLnJlbFJlcXVlc3RQcm9wb3NhbCcsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxQb0F0dGFjaG1lbnQnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywgJ3llcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taGlzdG9yeScsIGNvbXBhY3QoJ3RpdGxlJywgJ3B1cmNoYXNlT3JkZXInLCAncHJvcG9zYWxzJywgJ2JpbGxNYW5hZ2UnKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIHNwb3RQT2hlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsncG9fcmVmZXJlbmNlX25vJywgJ3BvX3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dybl9yZWZlcmVuY2Vfbm8nLCAnZ3JuX3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2JpbGxfdHlwZScsICdiaWxsX3R5cGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydiaWxsX251bWJlcicsICdiaWxsX251bWJlcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2JpbGxfYW1vdW50JywgJ2JpbGxfYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3RhdHVzJywgJ3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2ludm9pY2UnLCAnaW52b2ljZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3ZhdCcsICd2YXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydtYW5hZ2VtZW50X2FwcHJvdmFsJywgJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlIWltcG9ydGFudCddLAogICAgICAgICAgICBbJ2FjY291bnRzX2FwcHJvdmFsJywgJ2FjY291bnRzX2FwcHJvdmFsJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSFpbXBvcnRhbnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXIgYWN0aW9uJ10KICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzcG90UHVyY2hhc2VQcmljZUFwcHJvdmFsTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICJTcG90IFB1cmNoYXNlIFByaWNlIEFwcHJvdmFsIExpc3QiOwoKICAgICAgICAgICAgJHB1cmNoYXNlQXR0YWNobWVudCA9IFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKLy8gICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnZGlyZWN0LXB1cmNoYXNlLW1hbmFnZW1lbnQtYXBwcm92YWwnKSkgewovLyAgICAgICAgICAgICAgICAkcHVyY2hhc2VBdHRhY2htZW50ID0gJHB1cmNoYXNlQXR0YWNobWVudC0+d2hlcmVJbignbWFuYWdlbWVudF9hcHByb3ZhbCcsIFsncGVuZGluZycsICdoYWx0J10pOwovLyAgICAgICAgICAgIH0KLy8KLy8gICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnZGlyZWN0LXB1cmNoYXNlLWFjY291bnRzLWFwcHJvdmFsJykpIHsKLy8gICAgICAgICAgICAgICAgJHB1cmNoYXNlQXR0YWNobWVudCA9ICRwdXJjaGFzZUF0dGFjaG1lbnQtPndoZXJlKCdtYW5hZ2VtZW50X2FwcHJvdmFsJywgJ2FwcHJvdmVkJykKLy8gICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYWNjb3VudHNfYXBwcm92YWwnLCBbJ3BlbmRpbmcnLCAnaGFsdCddKTsKLy8gICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VBdHRhY2htZW50KQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwb19yZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0bi1saW5rIHNob3dQT0RldGFpbHMiIG9uY2xpY2s9InNob3dQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkdmFsdWVzLT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnIj4nIC4gaXNzZXQoJHZhbHVlcy0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vKSA/ICR2YWx1ZXMtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyA6ICcnIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncG9fcmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnJlZmVyZW5jZV9ubycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcl9hdHRhY2htZW50LnB1cmNoYXNlX29yZGVyX2lkJywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdncm5fcmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAkdmFsdWVzLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+Z3JuX3JlZmVyZW5jZV9ubyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dybl9yZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZE5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdncm5fcmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ3JuX3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBHb29kc1JlY2VpdmVkTm90ZTo6c2VsZWN0KCdnb29kc19yZWNlaXZlZF9ub3Rlcy5ncm5fcmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVyX2F0dGFjaG1lbnQuZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignYmlsbF90eXBlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjZmlyc3QoJHZhbHVlcy0+YmlsbF90eXBlKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignYmlsbF9hbW91bnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+YmlsbF9hbW91bnQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdWNmaXJzdCgkdmFsdWVzLT5zdGF0dXMpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2ludm9pY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR2YWx1ZXMtPmludm9pY2VfZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIGFzc2V0KCR2YWx1ZXMtPmludm9pY2VfZmlsZSkgLiAnIiB0YXJnZXQ9Il9fYmxhbmsiIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj48aSBjbGFzcz0ibGFzIGxhLWZpbGUtaW52b2ljZSI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndmF0JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdmFsdWVzLT52YXRfY2hhbGxhbl9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gYXNzZXQoJHZhbHVlcy0+dmF0X2NoYWxsYW5fZmlsZSkgLiAnIiB0YXJnZXQ9Il9fYmxhbmsiICBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gdmlldyB2YXQgY2hhbGFuIj48aSBjbGFzcz0ibGFzIGxhLW1vbmV5LWNoZWNrLWFsdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ21hbmFnZW1lbnRfYXBwcm92YWwnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSA9ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwcHgiPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnZGlyZWN0LXB1cmNoYXNlLW1hbmFnZW1lbnQtYXBwcm92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxzZWxlY3QgY2xhc3M9ImNoYW5nZVN0YXR1cyBmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJjaGFuZ2VTdGF0dXMoJCh0aGlzKSkiIHN0eWxlPSJ3aWR0aDogMTAwJSIgYXBwcm92YWwtdHlwZT0ibWFuYWdlbWVudCIgIGFwcHJvdmFsLWlkPSInIC4gJHZhbHVlcy0+aWQgLiAnIiBpZD0iY2hhbmdlU3RhdHVzJyAuICR2YWx1ZXMtPmlkIC4gJyI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKCR2YWx1ZXMtPm1hbmFnZW1lbnRfYXBwcm92YWwgPT09ICdwZW5kaW5nJyA/ICdzZWxlY3RlZCcgOiAiIikgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgdmFsdWU9InBlbmRpbmciPlBlbmRpbmc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxvcHRpb24gJyAuICgkdmFsdWVzLT5tYW5hZ2VtZW50X2FwcHJvdmFsID09PSAnYXBwcm92ZWQnID8gJ3NlbGVjdGVkJyA6ICIiKSAuICcgdmFsdWU9ImFwcHJvdmVkIj5BcHByb3ZlZDwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKCR2YWx1ZXMtPm1hbmFnZW1lbnRfYXBwcm92YWwgPT09ICdoYWx0JyA/ICdzZWxlY3RlZCcgOiAiIikgLiAnIHZhbHVlPSJoYWx0Ij5IYWx0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gdWNmaXJzdCgkdmFsdWVzLT5tYW5hZ2VtZW50X2FwcHJvdmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhcHByb3ZlOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdhY2NvdW50c19hcHByb3ZhbCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlID0gJzxkaXYgc3R5bGU9IndpZHRoOiAxMDBweCI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdkaXJlY3QtcHVyY2hhc2UtYWNjb3VudHMtYXBwcm92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxzZWxlY3QgY2xhc3M9ImNoYW5nZVN0YXR1cyBmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJjaGFuZ2VTdGF0dXMoJCh0aGlzKSkiIHN0eWxlPSJ3aWR0aDogMTAwJSIgYXBwcm92YWwtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGFwcHJvdmFsLXR5cGU9ImFjY291bnRzIiBpZD0iY2hhbmdlU3RhdHVzJyAuICR2YWx1ZXMtPmlkIC4gJyI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92ZSAuPSAnPG9wdGlvbiAnIC4gKCR2YWx1ZXMtPmFjY291bnRzX2FwcHJvdmFsID09PSAncGVuZGluZycgPyAnc2VsZWN0ZWQnIDogIiIpIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHZhbHVlPSJwZW5kaW5nIj5QZW5kaW5nPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoJHZhbHVlcy0+YWNjb3VudHNfYXBwcm92YWwgPT09ICdhcHByb3ZlZCcgPyAnc2VsZWN0ZWQnIDogIiIpIC4gJyB2YWx1ZT0iYXBwcm92ZWQiPkFwcHJvdmVkPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8b3B0aW9uICcgLiAoJHZhbHVlcy0+YWNjb3VudHNfYXBwcm92YWwgPT09ICdoYWx0JyA/ICdzZWxlY3RlZCcgOiAiIikgLiAnIHZhbHVlPSJoYWx0Ij5IYWx0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmUgLj0gdWNmaXJzdCgkdmFsdWVzLT5hY2NvdW50c19hcHByb3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlIC49ICc8ZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXBwcm92ZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj48c3Bhbj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJjdXJyZW50Q29sb3IiIGNsYXNzPSJiaSBiaS10aHJlZS1kb3RzLXZlcnRpY2FsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPjxwYXRoIGQ9Ik05LjUgMTNhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAweiIvPjwvc3ZnPjwvc3Bhbj48L2J1dHRvbj48dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LnBvLmludm9pY2UucHJpbnQnLCAkdmFsdWVzLT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+IFByaW50PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncG9fcmVmZXJlbmNlX25vJywgJ2JpbGxfYW1vdW50JywgJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAnYWNjb3VudHNfYXBwcm92YWwnLCAnaW52b2ljZScsICd2YXQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcuZGlyZWN0LXB1cmNoYXNlLnNwb3QtcHVyY2hhc2UtYXBwcm92YWwtbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5zcG90UE9oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3BvdFB1cmNoYXNlUHJpY2VBcHByb3ZhbChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRpZCA9ICRyZXF1ZXN0LT5hdHRhY2htZW50SWQ7CiAgICAgICAgJGJpbGxUeXBlID0gJHJlcXVlc3QtPmFwcHJvdmFsVHlwZTsKICAgICAgICAkc3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50ID0gUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdpZCcsICRpZCktPmZpcnN0KCk7CgogICAgICAgICAgICBpZiAoJGJpbGxUeXBlID09ICdtYW5hZ2VtZW50JykgewogICAgICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdtYW5hZ2VtZW50X2FwcHJvdmFsJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgaWYgKCRzdGF0dXMgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZU1lc3NhZ2UgPSAiU3BvdCBwdXJjaGFzZSBhcHByb3ZhbCBzdGF0dXMgYXBwcm92ZWQgYnkgbWFuYWdlbWVudCI7CgogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gZ2V0TW9kdWxlcygpWydmaW5hbmNlJ10tPnVybCAuICcvcG1zL3B1cmNoYXNlL29yZGVyLWxpc3QvJyAuICRwdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+cHVyY2hhc2Vfb3JkZXJfaWQgLiAnL3Nob3c/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLgogICAgICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICcgfCAnIC4gJHB1cmNoYXNlTWVzc2FnZSAuICc8L3NwYW4+JzsKCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ0FjY291bnRzJywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLWFjY291bnRzJyk7CgogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRzdGF0dXMgPT0gJ2hhbHQnKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlTWVzc2FnZSA9ICJUaGlzIHNwb3QgcHVyY2hhc2UgcHJpY2Ugc3RhdHVzIGhhbHQgYnkgbWFuYWdlbWVudC4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwoKICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnLicgLiAkcHVyY2hhc2VNZXNzYWdlIC4gJy48L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1wdXJjaGFzZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJGJpbGxUeXBlID09ICdhY2NvdW50cycpIHsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+d2hlcmUoJ21hbmFnZW1lbnRfYXBwcm92YWwnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRzX2FwcHJvdmFsJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmICgkc3RhdHVzID09ICdwZW5kaW5nJykgewogICAgICAgICAgICAgICAgICAgICRhY2NvdW50c01lc3NhZ2UgPSAiU3BvdCBwdXJjaGFzZSBhcHByb3ZhbCBzdGF0dXMgdXBkYXRlZCB0byBwZW5kaW5nIjsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkc3RhdHVzID09ICdhcHByb3ZlZCcpIHsKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudHNNZXNzYWdlID0gIlN1Y2Nlc3NmdWxseSBhcHByb3ZlZCBieSBhY2NvdW50cyI7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAnaGFsdCcpIHsKICAgICAgICAgICAgICAgICAgICAkYWNjb3VudHNNZXNzYWdlID0gIlRoaXMgc3BvdCBwdXJjaGFzZSBwcmljZSBzdGF0dXMgaGFsdCBieSBhY2NvdW50cy4gUGxlYXNlIHVwbG9hZCBpdCBhZ2Fpbi4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gLiAnLicgLiAkYWNjb3VudHNNZXNzYWdlIC4gJy48L3NwYW4+JzsKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTcG90IHB1cmNoYXNlIHByaWNlIGFwcHJvdmFsIHN0YXR1cyBoYXMgYmVlbiB1cGRhdGVkIgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCn0K