<?php
bolt_decrypt( __FILE__ , 'lEHy7W'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7Cgp1c2UgQXBwXE1vZGVsc1xNeVByb2plY3RcRGVsaXZlcmFibGVzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcTWVudVxNZW51Owp1c2UgQXBwXE1vZGVsc1xIclxVbml0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uRXhwbGFuYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbUxvZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uTG9nOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25TdGFnZUhpc3Rvcnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvblRyYWNraW5nOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtQXR0cmlidXRlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UeXBlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQ2F0ZWdvcnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeURlcGFydG1lbnQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbkRlbGl2ZXJ5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBdHRyaWJ1dGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBdHRyaWJ1dGVPcHRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeUF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uTm90ZUxvZ3M7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIEFwcFxNb2RlbHNcTXlQcm9qZWN0XFByb2plY3Q7CnVzZSBBcHBcTW9kZWxzXE15UHJvamVjdFxQcm9qZWN0VGFzazsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uQXR0YWNobWVudDsKdXNlIEFwcFxVc2VyOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBNYWF0d2Vic2l0ZVxFeGNlbFxGYWNhZGVzXEV4Y2VsOwp1c2UgVmlldzsKdXNlIEFwcFxIdHRwXFJlcXVlc3RzOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQXV0aDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCLCBWYWxpZGF0b3IsIFN0ciwgWWFqcmFcRGF0YVRhYmxlc1xGYWNhZGVzXERhdGFUYWJsZXM7CnVzZSBDYXJib25cQ2FyYm9uOwp1c2UgXEFwcFxJbXBvcnRzXFJlcXVpc2l0aW9uSW1wb3J0OwoKY2xhc3MgUmVxdWlzaXRpb25Db250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CgogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgJHJvdyA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY29zdF9jZW50cmUnLCAnY29zdF9jZW50cmUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIC8vWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3Zlcl9kYXRlJywgJ2FwcHJvdmVyX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzYWxlYWJsZScsICdzYWxlYWJsZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdzdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydmaW5hbmNlX2FwcHJvdmFsJywgJ2ZpbmFuY2VfYXBwcm92YWwnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhdHRhY2htZW50JywgJ2F0dGFjaG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwoKICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdQdXJjaGFzZS1EZXBhcnRtZW50JykpIHsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1bnNldCgkcm93WzVdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkc3RhdHVzID0gcmVxdWVzdCgpLT5oYXMoJ3N0YXR1cycpID8gcmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpIDogLTE7CiAgICAgICAgICAgIC8vICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBkYXRlKCdZLW0tMDEnKTsKICAgICAgICAgICAgLy8gJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IGRhdGUoJ1ktbS10Jyk7CiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBudWxsOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogbnVsbDsKICAgICAgICAgICAgJGNhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CiAgICAgICAgICAgICRjYXRlZ29yeUlkcyA9IENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0pLT5wbHVjaygnY2F0ZWdvcnlfaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsICRjYXRlZ29yeUlkcykKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmUnLAogICAgICAgICAgICAgICAgJ2l0ZW1zJywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkxvZ3MnLAogICAgICAgICAgICAgICAgJ3N0YWdlSGlzdG9yaWVzJywKICAgICAgICAgICAgICAgICdsYXRlc3RBcHByb3ZlclN0YWdlJywKICAgICAgICAgICAgICAgICdhdHRhY2htZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJGZyb20pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCR0bykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRzdGF0dXMgPj0gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICRzdGF0dXMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY2F0ZWdvcnlfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdzZWFyY2hfdGV4dCcpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gcmVxdWVzdCgpLT5nZXQoJ3NlYXJjaF90ZXh0JykgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ3JlbWFya3MnLCAnTElLRScsICclJyAuIHJlcXVlc3QoKS0+Z2V0KCdzZWFyY2hfdGV4dCcpIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNzZXNzbWVudCcsICdubycpCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ3N0YXR1cycsIFsyXSk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZCA9IFJlcXVpc2l0aW9uU3RhZ2VIaXN0b3J5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbicKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHJlcXVpc2l0aW9uLT51bml0LT5ocl91bml0X3Nob3J0X25hbWU7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVW5pdDo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfc2hvcnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignaHJfdW5pdC5ocl91bml0X2lkJywgJ3JlcXVpc2l0aW9ucy5ocl91bml0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzYWxlYWJsZScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjd29yZHMoJHJlcXVpc2l0aW9uLT5zYWxlYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgY2xhc3M9ImJ0biBidG4tbGluayByZXF1aXNpdGlvbiBtLTEgcm91bmRlZCBzaG93UmVxdWlzdGlvbkRldGFpbHMiIG9uY2xpY2s9InJlcXVpc3Rpb25EZXRhaWxzKCQodGhpcykpIj4nIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmVyX2RhdGUnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGFnZSA9IHN0YWdlRmluZGVyKCRyZXF1aXNpdGlvbi0+aWQsICdhcHByb3ZlZF9ieV9maW5hbmNlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhZ2UgJiYgJHN0YWdlLT5zdGFnZV91cGRhdGVkX2F0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRzdGFnZS0+c3RhZ2VfdXBkYXRlZF9hdCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSkKLy8gICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3Zlcl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdhcHByb3Zlcl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7Ci8vICAgICAgICAgICAgICAgICAgICB9KQovLyAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYXBwcm92ZXJfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewovLyAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ2FwcHJvdmVyX2RhdGUnLCAkb3JkZXIpOwovLyAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRyZXF1aXNpdGlvbi0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwcm9kdWN0cycsICdwcm9kdWN0cy5pZCcsICc9JywgJ3JlcXVpc2l0aW9uX2l0ZW1zLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtcy5yZXF1aXNpdGlvbl9pZCcsICdyZXF1aXNpdGlvbnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHAgaWQ9InN0YXR1cycgLiAkcmVxdWlzaXRpb24tPmlkIC4gJyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+c3RhdHVzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxzcGFuIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj5QZW5kaW5nPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAxKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiPkFwcHJvdmVkPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIj5IYWx0PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyI+RHJhZnQ8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8L3A+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29zdF9jZW50cmUnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcmVxdWlzaXRpb24tPmNvc3RDZW50cmUgPyAkcmVxdWlzaXRpb24tPmNvc3RDZW50cmUtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb3N0X2NlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb3N0Q2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2Nvc3RfY2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3JkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3N0Q2VudHJlOjpzZWxlY3QoJ2Nvc3RfY2VudHJlcy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjb3N0X2NlbnRyZXMuaWQnLCAncmVxdWlzaXRpb25zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdmaW5hbmNlX2FwcHJvdmFsJywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsIC49ICc8cCBpZD0iZmluYW5jZV9hcHByb3ZhbF9zdGF0dXMnIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwsIFsnZHJhZnQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbCAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXdhcm5pbmciPicgLiB1Y3dvcmRzKCRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCkgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChpbl9hcnJheSgkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwsIFsncGVuZGluZycsICdyZXNlbnQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbCAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXdhcm5pbmciPicgLiB1Y3dvcmRzKCRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCkgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyI+JyAuIHVjd29yZHMoJHJlcXVpc2l0aW9uLT5pc19maW5hbmNlX2FwcHJvdmFsKSAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCA9PSAnZGVuaWVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIj4nIC4gdWN3b3JkcygkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwpIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXBwcm92YWw7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnRMaW5rcyA9ICcnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnRW1wbG95ZWUnLCAnRGVwYXJ0bWVudC1IZWFkJywgJ1B1cmNoYXNlLURlcGFydG1lbnQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnRzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudHMgYXMgJGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkZmlsZS0+ZmlsZV9sb2NhdGlvbikgJiYgZmlsZV9leGlzdHMocHVibGljX3BhdGgoJGZpbGUtPmZpbGVfbG9jYXRpb24pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnRMaW5rcyAuPSAnPGEgaHJlZj0iJyAuIHVybCgkZmlsZS0+ZmlsZV9sb2NhdGlvbikgLiAnIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ9Il9ibGFuayIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkgbS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0ibGFzIGxhLXBhcGVyY2xpcCI+PC9pPiBBdHRhY2htZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhdHRhY2htZW50TGlua3M7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4gaWQ9InN0YXR1c05hbWUnIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1lbGxpcHNpcy12Ij48L2k+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+PGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNraW5nIFJlcXVpc2l0aW9uIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24ubGlzdC52aWV3LnNob3cnLCAkcmVxdWlzaXRpb24tPmlkKSAuICciIGNsYXNzPSJzaG93UmVxdWlzdGlvbkRldGFpbHMiICBvbmNsaWNrPSJyZXF1aXN0aW9uRGV0YWlscygkKHRoaXMpKSI+PGkgY2xhc3M9ImxhIGxhLWV5ZSI+PC9pPiZuYnNwO1ZpZXc8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5lZGl0JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnP3JlZGlyZWN0PXJlcXVpc2l0aW9uJmVkaXRvcj1hdXRob3IiIHRpdGxlPSJDbGljayBIZXJlIFRvIEVkaXQiIGNsYXNzPSJyZXF1aXNpdGlvbi1lZGl0Ij48aSBjbGFzcz0ibGEgbGEtZWRpdCI+PC9pPiZuYnNwO0VkaXQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtcm9sZT0iZHVwbGljYXRlIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24uZHVwbGljYXRlJywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIiBjbGFzcz0idGV4dC1kYW5nZXIgZGVsZXRlQnRuIHJlcXVpc2l0aW9uLWR1cGxpY2F0ZSIgb25jbGljaz0iZHVwbGljYXRlUmVxdWlzaXRpb24oJCh0aGlzKSkiPjxpIGNsYXNzPSJsYXMgbGEtY29weSI+PC9pPiZuYnNwO0R1cGxpY2F0ZTwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInIC4gdXJsKCdwbXMvcmVxdWlzaXRpb24vcmVxdWlzaXRpb24vJyAuICRyZXF1aXNpdGlvbi0+aWQgLiAnP3ByaW50JykgLiAnIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+Jm5ic3A7UHJpbnQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+c3RhdHVzID09IDMpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgIG9uY2xpY2s9InNlbmRSZXF1aXNpdGlvbigkKHRoaXMpKSIgY2xhc3M9InNlbmRSZXF1aXNpdGlvbiIgZGF0YS1pZD0iJyAuICRyZXF1aXNpdGlvbi0+aWQgLiAnIiBkYXRhLXN0YXR1cz0iMCIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gU2VuZCI+PGkgY2xhc3M9ImxhIGxhLXBhcGVyLXBsYW5lIj48L2k+Jm5ic3A7U2VuZDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1yb2xlPSJkZWxldGUiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5kZXN0cm95JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIiBjbGFzcz0idGV4dC1kYW5nZXIgZGVsZXRlQnRuIHJlcXVpc2l0aW9uLWRlbGV0ZSIgb25jbGljaz0iZGVsZXRlQnRuKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXRyYXNoIj48L2k+Jm5ic3A7RGVsZXRlPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25Mb2dzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Btcy5yZXF1aXNpdGlvbi5sb2cuaGlzdG9yeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWhpc3RvcnkiIHRpdGxlPSJSZXF1aXNpdGlvbiBMb2cgSGlzdG9yeSI+PC9pPiZuYnNwO1JlcXVpc2l0aW9uIExvZ3M8L2E+PC9saTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5oaXN0b3J5JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtaGlzdG9yeSIgdGl0bGU9IlJlcXVpc2l0aW9uIEhpc3RvcnkiPjwvaT4mbmJzcDtSZXF1aXNpdGlvbiBIaXN0b3J5PC9hPjwvbGk8L2E+PC9saT4nOwoKLy8gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24ucmVxdWlzaXRpb24uc3RhZ2UuaGlzdG9yeScsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWhpc3RvcnkiIHRpdGxlPSJSZXF1aXNpdGlvbiBIaXN0b3J5Ij48L2k+Jm5ic3A7IFN0YWdlIFRyYWNraW5nPC9hPjwvbGk8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJUcmFja2luZyBSZXF1aXNpdGlvbiIgY2xhc3M9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cyIgb25jbGljaz0idHJhY2tSZXF1aXNpdGlvblByb2dyZXNzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1tYXAiPjwvaT4mbmJzcDtUcmFjayBQcm9ncmVzczwvYT48L2xpPjwvdWw+PC9kaXY+JzsKCgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3N0YXR1cycsICdmaW5hbmNlX2FwcHJvdmFsJywgJ2F0dGFjaG1lbnQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1JlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkY2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFsdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdIYWx0IFJlcXVpc2l0aW9ucyc7CgogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogbnVsbDsKICAgICAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IG51bGw7CiAgICAgICAgICAgICRjYXRlZ29yeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjYXRlZ29yeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NhdGVnb3J5X2lkJykgOiAwOwogICAgICAgICAgICAkY2F0ZWdvcnlJZHMgPSBDYXRlZ29yeURlcGFydG1lbnQ6OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9KS0+cGx1Y2soJ2NhdGVnb3J5X2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkY2F0ZWdvcnlJZHMpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKFsnaXRlbXMnLCAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeSddKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXV0aG9yX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCRmcm9tKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb20pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPj0nLCAkZnJvbSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkdG8pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG8pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG8pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY2F0ZWdvcnlfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdzZWFyY2hfdGV4dCcpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gcmVxdWVzdCgpLT5nZXQoJ3NlYXJjaF90ZXh0JykgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ3JlbWFya3MnLCAnTElLRScsICclJyAuIHJlcXVlc3QoKS0+Z2V0KCdzZWFyY2hfdGV4dCcpIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdzdGF0dXMnLCBbMl0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHJlcXVpc2l0aW9ucykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgY2xhc3M9ImJ0biBidG4tbGluayByZXF1aXNpdGlvbiBtLTEgcm91bmRlZCBzaG93UmVxdWlzdGlvbkRldGFpbHMiIG9uY2xpY2s9InJlcXVpc3Rpb25EZXRhaWxzKCQodGhpcykpIj4nIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uSXRlbTo6c2VsZWN0KCdtYWluX2NhdGVnb3J5Lm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZHVjdHMnLCAncHJvZHVjdHMuaWQnLCAnPScsICdyZXF1aXNpdGlvbl9pdGVtcy5wcm9kdWN0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgbWFpbl9jYXRlZ29yeScsICdtYWluX2NhdGVnb3J5LmlkJywgJz0nLCAnc3ViX2NhdGVnb3J5LnBhcmVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncmVxdWlzaXRpb25faXRlbXMucmVxdWlzaXRpb25faWQnLCAncmVxdWlzaXRpb25zLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxwIGlkPSJzdGF0dXMnIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyI+UGVuZGluZzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxzcGFuIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIj5BcHByb3ZlZDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciI+SGFsdDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLXdhcm5pbmciPkRyYWZ0PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPC9wPic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdHVzOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhdHRhY2htZW50ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1B1cmNoYXNlLURlcGFydG1lbnQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQpICYmIGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnQgLj0gJzxhIGhyZWY9IicgLiB1cmwoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSAuICciIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSI+PGkgY2xhc3M9ImxhcyBsYS1wYXBlcmNsaXAiPjwvaT5BdHRhY2htZW50PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXR0YWNobWVudDsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3RhdHVzTmFtZScgLiAkcmVxdWlzaXRpb24tPmlkIC4gJyI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImxhIGxhLWVsbGlwc2lzLXYiPjwvaT48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4KICAgICAgICAgICAgICAgICAgICA8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iVHJhY2tpbmcgUmVxdWlzaXRpb24iIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgY2xhc3M9InNob3dSZXF1aXN0aW9uRGV0YWlscyIgIG9uY2xpY2s9InJlcXVpc3Rpb25EZXRhaWxzKCQodGhpcykpIj48aSBjbGFzcz0ibGEgbGEtZXllIj48L2k+IFZpZXc8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uLmVkaXQnLCAkcmVxdWlzaXRpb24tPmlkKSAuICc/cmVkaXJlY3Q9aGFsdC1yZXF1aXNpdGlvbiZlZGl0b3I9YXV0aG9yIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBFZGl0IiBjbGFzcz0icmVxdWlzaXRpb24tZWRpdCI+PGkgY2xhc3M9ImxhIGxhLWVkaXQiPjwvaT4mbmJzcDtFZGl0PC9hPgogICAgICAgICAgICAgICAgICAgIDwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiICBvbmNsaWNrPSJzZW5kUmVxdWlzaXRpb24oJCh0aGlzKSkiIGNsYXNzPSJzZW5kUmVxdWlzaXRpb24iIGRhdGEtaWQ9IicgLiAkcmVxdWlzaXRpb24tPmlkIC4gJyIgZGF0YS1zdGF0dXM9IjAiIHRpdGxlPSJDbGljayBIZXJlIFRvIFNlbmQiPjxpIGNsYXNzPSJsYSBsYS1wYXBlci1wbGFuZSI+PC9pPiBSZVNlbmQ8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uTG9ncy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInIC4gcm91dGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwbXMucmVxdWlzaXRpb24ubG9nLmhpc3RvcnknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAuICciPjxpIGNsYXNzPSJsYSBsYS1oaXN0b3J5IiB0aXRsZT0iUmVxdWlzaXRpb24gTG9nIEhpc3RvcnkiPjwvaT4mbmJzcDtSZXF1aXNpdGlvbiBMb2dzPC9hPjwvbGk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPgogICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1yb2xlPSJkZWxldGUiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5kZXN0cm95JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIiBjbGFzcz0idGV4dC1kYW5nZXIgZGVsZXRlQnRuIHJlcXVpc2l0aW9uLWRlbGV0ZSIgb25jbGljaz0iZGVsZXRlQnRuKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXRyYXNoIj48L2k+Jm5ic3A7RGVsZXRlPC9hPgogICAgICAgICAgICAgICAgICAgIDwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJUcmFja2luZyBSZXF1aXNpdGlvbiIgY2xhc3M9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cyIgb25jbGljaz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1tYXAiPjwvaT5UcmFjayBQcm9ncmVzczwvYT48L2xpPjwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3N0YXR1cycsICdhdHRhY2htZW50JywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbnMuaGFsdC1pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1JlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkY2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1jb3N0LWNlbnRyZXMnKSkgewogICAgICAgICAgICByZXR1cm4gZ2V0Q29zdENlbnRyZXMoZmFsc2UsIFVuaXQ6OmZpbmQocmVxdWVzdCgpLT5nZXQoJ2hyX3VuaXRfaWQnKSktPmNvbXBhbnlfaWQsIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdnZXQtYXR0cmlidXRlcycpKSB7CiAgICAgICAgICAgICRwcm9kdWN0ID0gUHJvZHVjdDo6ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpKTsKICAgICAgICAgICAgJGl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uJwogICAgICAgICAgICBdKS0+ZmluZChyZXF1ZXN0KCktPmdldCgnaXRlbV9pZCcpKTsKICAgICAgICAgICAgJHNlbGVjdGVkQXR0cmlidXRlcyA9IFtdOwogICAgICAgICAgICBpZiAoaXNzZXQoJGl0ZW0tPmF0dHJpYnV0ZXNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkaXRlbS0+YXR0cmlidXRlcyBhcyAkYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkc2VsZWN0ZWRBdHRyaWJ1dGVzLCAkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZV9pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbnMuYXR0cmlidXRlcycsIFsKICAgICAgICAgICAgICAgICdzZXJpYWwnID0+IHJlcXVlc3QoKS0+Z2V0KCdzZXJpYWwnKSwKICAgICAgICAgICAgICAgICdwcm9kdWN0JyA9PiAkcHJvZHVjdCwKICAgICAgICAgICAgICAgICdpdGVtJyA9PiAkaXRlbSwKICAgICAgICAgICAgICAgICdzZWxlY3RlZEF0dHJpYnV0ZXMnID0+ICRzZWxlY3RlZEF0dHJpYnV0ZXMsCiAgICAgICAgICAgICAgICAnYXR0cmlidXRlcycgPT4gQXR0cmlidXRlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnb3B0aW9ucycsCiAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2NhdGVnb3JpZXMuY2F0ZWdvcnkucHJvZHVjdHMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsIHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWF1dGgoKS0+dXNlcigpLT5lbXBsb3llZSkgewogICAgICAgICAgICByZXR1cm4gcmVkaXJlY3QoKS0+YmFjaygpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRhc2sgPSBudWxsOwogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3Rhc2staWQnKSkgewogICAgICAgICAgICAgICAgJHRhc2sgPSBQcm9qZWN0VGFzazo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3N1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlLnByb2plY3QnCiAgICAgICAgICAgICAgICBdKS0+ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgndGFzay1pZCcpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNhdGVnb3J5SWQgPSBDYXRlZ29yeURlcGFydG1lbnQ6OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9KS0+cGx1Y2soJ2NhdGVnb3J5X2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+d2l0aChbJ3N1YkNhdGVnb3J5J10pCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2lkJywgJGNhdGVnb3J5SWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+IDAsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGZpeGVkQXNzZXRDYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+d2l0aChbJ3N1YkNhdGVnb3J5J10pCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2lkJywgJGNhdGVnb3J5SWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+IDAsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGN3aXBDYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+d2l0aChbJ3N1YkNhdGVnb3J5J10pCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2lkJywgJGNhdGVnb3J5SWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+IDEsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICdDcmVhdGUgUmVxdWlzaXRpb24nOwogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBudWxsOwoKICAgICAgICAgICAgJHByZWZpeCA9ICdSUS0nIC4gZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkgLiAnLScgLiBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSAuICctJzsKICAgICAgICAgICAgJHJlZk5vID0gdW5pcXVlQ29kZSgxNiwgJHByZWZpeCwgJ3JlcXVpc2l0aW9ucycsICdpZCcpOwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICRwcm9qZWN0cyA9IFtdOwogICAgICAgICAgICAgICAgJHRhc2tzID0gUHJvamVjdFRhc2s6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdzdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZS5wcm9qZWN0JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpCiAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHRhc2tzWzBdKSl7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRhc2tzIGFzICR0YXNrKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHByb2plY3RzW10gPSAkdGFzay0+c3ViRGVsaXZlcmFibGUtPmRlbGl2ZXJhYmxlLT5wcm9qZWN0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcHJvamVjdHMgPSBQcm9qZWN0Ojp3aGVyZUluKCJpZCIsIGFycmF5X2tleXMoY29sbGVjdCgkcHJvamVjdHMpLT5ncm91cEJ5KCdpZCcpLT50b0FycmF5KCkpKS0+Z2V0KCk7CiAgICAgICAgICAgICovCgogICAgICAgICAgICAkZXhwbGFuYXRpb25zID0gUmVxdWlzaXRpb25FeHBsYW5hdGlvbjo6YWxsKCk7CgogICAgICAgICAgICAkdW5pdHMgPSBVbml0Ojp3aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgIH0pLT5nZXQoKTsKCiAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkZmluYW5jZVVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzKSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgfSktPndoZXJlSGFzKCdyb2xlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnQWNjb3VudHMnKTsKICAgICAgICAgICAgfSktPndoZXJlSGFzKCdwZXJtaXNzaW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAncmVxdWlzaXRpb24tZmluYW5jZS1hcHByb3ZhbC1saXN0Jyk7CiAgICAgICAgICAgIH0pLT5zZWxlY3QoJ2lkJywgJ25hbWUnKS0+Z2V0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLmNyZWF0ZScsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uJywgJ3JlZk5vJywgJ2NhdGVnb3JpZXMnLCAnZml4ZWRBc3NldENhdGVnb3JpZXMnLCAnY3dpcENhdGVnb3JpZXMnLCAndGFzaycsICdleHBsYW5hdGlvbnMnLCAndW5pdHMnLCAnZmluYW5jZVVzZXJzJykpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGxvYWRQcm9qZWN0V2lzZURlbGl2ZXJhYmxlcyhQcm9qZWN0ICRwcm9qZWN0ID0gbnVsbCkKICAgIHsKICAgICAgICAkZGVsaXZlcmFibGVzID0gW107CiAgICAgICAgZm9yZWFjaCAoQXV0aDo6dXNlcigpLT5wcm9qZWN0VGFzayBhcyAkdGFzaykgewogICAgICAgICAgICBpZiAoJHRhc2stPnN1YkRlbGl2ZXJhYmxlLT5kZWxpdmVyYWJsZS0+cHJvamVjdF9pZCA9PSAkcHJvamVjdC0+aWQpIHsKICAgICAgICAgICAgICAgICRkZWxpdmVyYWJsZXNbXSA9ICR0YXNrLT5zdWJEZWxpdmVyYWJsZS0+ZGVsaXZlcmFibGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJGRlbGl2ZXJhYmxlcyA9IGFycmF5X2tleXMoY29sbGVjdCgkZGVsaXZlcmFibGVzKS0+Z3JvdXBCeSgnaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAkZGVsaXZlcmFibGVzID0gRGVsaXZlcmFibGVzOjp3aGVyZUluKCJpZCIsICRkZWxpdmVyYWJsZXMpLT5nZXQoKTsKCiAgICAgICAgJG91dHB1dCA9IFtdOwogICAgICAgICRvdXRwdXRbXSA9ICI8b3B0aW9uPlNlbGVjdCBPbmU8L29wdGlvbj4iOwogICAgICAgIGZvcmVhY2ggKCRkZWxpdmVyYWJsZXMgYXMgJGRlbGl2ZXJhYmxlKSB7CiAgICAgICAgICAgICRvdXRwdXRbXSA9ICc8b3B0aW9uIHZhbHVlPSInIC4gJGRlbGl2ZXJhYmxlLT5pZCAuICciPicgLiAkZGVsaXZlcmFibGUtPm5hbWUgLiAnPC9vcHRpb24+JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oaW1wbG9kZSgnLCcsICRvdXRwdXQpKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gbG9hZENhdGVnb3J5V2lzZVByb2R1Y3RzKCRjYXRlZ29yeUlkLCBSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9ICcnOwoKICAgICAgICAkY2F0ZWdvcnlJZHMgPSBDYXRlZ29yeURlcGFydG1lbnQ6OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgfSktPnBsdWNrKCdjYXRlZ29yeV9pZCcpLT50b0FycmF5KCk7CgoKICAgICAgICAkY2F0ZWdvcnlQcm9kdWN0cyA9IFByb2R1Y3Q6OndpdGgoWwogICAgICAgICAgICAncHJvZHVjdFVuaXQnLAogICAgICAgICAgICAnY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdhcHByb3ZlZCcpCiAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGNhdGVnb3J5SWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeUlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeUlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5SWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3BhcmVudF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwYXJlbnRfaWQnKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2ZpbmFsX2Fzc2V0JywgMCkKICAgICAgICAgICAgLT53aGVyZUluKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeUlkcykKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAvKgogICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+cHJvZHVjdHNfaWQpKSB7CiAgICAgICAgICAgICRleGlzdGVkUHJvZHVjdHMgPSBleHBsb2RlKCcsJywgJHJlcXVlc3QtPnByb2R1Y3RzX2lkKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdzZWxlY3RlZCcpKSB7CiAgICAgICAgICAgICAgICAkZXhpc3RlZFByb2R1Y3RzID0gYXJyYXlfZGlmZigkZXhpc3RlZFByb2R1Y3RzLCBbcmVxdWVzdCgpLT5nZXQoJ3NlbGVjdGVkJyldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNhdGVnb3J5UHJvZHVjdHMgPSAkY2F0ZWdvcnlQcm9kdWN0cy0+d2hlcmVOb3RJbignaWQnLCAkZXhpc3RlZFByb2R1Y3RzKTsKICAgICAgICB9CgogICAgICAgICRjYXRlZ29yeVByb2R1Y3RzID0gJGNhdGVnb3J5UHJvZHVjdHMtPmdldCgpOwogICAgICAgICovCgogICAgICAgIC8vJHJlc3BvbnNlIC49ICc8c2VsZWN0IG5hbWU9InByb2R1Y3RfaWRbXSIgaWQ9InByb2R1Y3RfMSIgY2xhc3M9ImZvcm0tY29udHJvbCBzZWxlY3QyIHByb2R1Y3QiIHJlcXVpcmVkPic7CiAgICAgICAgJHJlc3BvbnNlIC49ICc8b3B0aW9uIHZhbHVlPSIiIGRhdGEtdW9tPSIiPlNlbGVjdCBQcm9kdWN0PC9vcHRpb24+JzsKICAgICAgICBpZiAoIWVtcHR5KCRjYXRlZ29yeVByb2R1Y3RzKSkgewogICAgICAgICAgICBmb3JlYWNoICgkY2F0ZWdvcnlQcm9kdWN0cyBhcyAkZGF0YSkgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlIC49ICc8b3B0aW9uIGRhdGEtdW9tPSInIC4gKCRkYXRhLT5wcm9kdWN0VW5pdCA/ICRkYXRhLT5wcm9kdWN0VW5pdC0+dW5pdF9uYW1lIDogJycpIC4gJyIgdmFsdWU9IicgLiAkZGF0YS0+aWQgLiAnIiBkYXRhLXN1Yi1jYXRlZ29yeS1pZD0iJyAuICRkYXRhLT5jYXRlZ29yeV9pZCAuICciIGRhdGEtY2F0ZWdvcnktaWQ9IicgLiAkZGF0YS0+Y2F0ZWdvcnktPnBhcmVudF9pZCAuICciICcgLiAocmVxdWVzdCgpLT5nZXQoJ3NlbGVjdGVkJykgPT0gJGRhdGEtPmlkID8gJ3NlbGVjdGVkJyA6ICcnKSAuICcgZGF0YS11bml0LXByaWNlPSInIC4gJGRhdGEtPnVuaXRfcHJpY2UgLiAnIj4nIC4gJGRhdGEtPm5hbWUgLiAnICcgLiBnZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkZGF0YSkgLiAnIChVT006ICcgLiAoJGRhdGEtPnByb2R1Y3RVbml0ID8gJGRhdGEtPnByb2R1Y3RVbml0LT51bml0X25hbWUgOiAnJykgLiAnKTwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzcG9uc2UgLj0gIjxvcHRpb24gdmFsdWU9Jyc+Tm8gUHJvZHVjdCBGb3VuZCEhPC9vcHRpb24+IjsKICAgICAgICB9CiAgICAgICAgLy8kcmVzcG9uc2UgLj0gIjwvc2VsZWN0PiI7CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGxvYWRDYXRlZ29yeVdpc2VTdWJjYXRlZ29yeSgkY2F0ZWdvcnlJZCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSAnJzsKICAgICAgICAkc3ViQ2F0ZWdvcnkgPSBDYXRlZ29yeTo6d2hlbighZW1wdHkoJGNhdGVnb3J5SWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeUlkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwYXJlbnRfaWQnLCAkY2F0ZWdvcnlJZCk7CiAgICAgICAgfSktPmdldCgpOwoKICAgICAgICBpZiAoaXNzZXQoJHN1YkNhdGVnb3J5KSAmJiBjb3VudCgoYXJyYXkpJHN1YkNhdGVnb3J5KSA+IDApIHsKICAgICAgICAgICAgJHJlc3BvbnNlIC49ICc8b3B0aW9uIHZhbHVlPSIiPi0tU2VsZWN0IFN1YmNhdGVnb3J5LS08L29wdGlvbj4nOwogICAgICAgICAgICBmb3JlYWNoICgkc3ViQ2F0ZWdvcnkgYXMgJGRhdGEpIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZSAuPSAnPG9wdGlvbiB2YWx1ZT0iJyAuICRkYXRhLT5pZCAuICciPicgLiAkZGF0YS0+bmFtZSAuICcoJyAuICRkYXRhLT5jb2RlIC4gJyknIC4gJzwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzcG9uc2UgLj0gIjxvcHRpb24gdmFsdWU9Jyc+Tm8gQ2F0ZWdvcnkgRm91bmQhITwvb3B0aW9uPiI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja0F0dHJpYnV0ZXMoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgLyogQ2hlY2sgaWYgb25lIGl0ZW0gc2VsZWN0ZWQgbW9yZSB0aGFuIG9uY2UgKi8KICAgICAgICAkYXR0cmlidXRlT3B0aW9ucyA9IEF0dHJpYnV0ZU9wdGlvbjo6d2l0aChbCiAgICAgICAgICAgICdhdHRyaWJ1dGUnCiAgICAgICAgXSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAkYXR0cmlidXRlRXJyb3JzID0gW107CiAgICAgICAgJG5hbWVzID0gW107CiAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2lkWzBdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cHJvZHVjdF9pZCBhcyAka2V5ID0+ICRwcm9kdWN0X2lkKSB7CiAgICAgICAgICAgICAgICAkc2VyaWFsID0gJGtleSArIDE7CiAgICAgICAgICAgICAgICAkcHJvZHVjdCA9IFByb2R1Y3Q6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkcHJvZHVjdF9pZCk7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRwcm9kdWN0LT5uYW1lIC4gZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJHByb2R1Y3QpOwoKICAgICAgICAgICAgICAgICRvcHRpb25zID0gW107CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RfYXR0cmlidXRlc1skc2VyaWFsXSkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cHJvZHVjdF9hdHRyaWJ1dGVzWyRzZXJpYWxdIGFzICRhdHRyaWJ1dGVfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5hdHRyaWJ1dGVfb3B0aW9uc1skc2VyaWFsXVskYXR0cmlidXRlX2lkXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdHRyaWJ1dGVPcHRpb24gPSAkYXR0cmlidXRlT3B0aW9ucy0+d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRzZXJpYWxdWyRhdHRyaWJ1dGVfaWRdKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlT3B0aW9uLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRvcHRpb25zLCAoaXNzZXQoJGF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlKSA/ICRhdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSA6ICcnKSAuICc6JyAuIChpc3NldCgkYXR0cmlidXRlT3B0aW9uLT5uYW1lKSA/ICRhdHRyaWJ1dGVPcHRpb24tPm5hbWUgOiAnJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRuYW1lIC49IGlzc2V0KCRvcHRpb25zWzBdKSA/ICcgKCcgLiBpbXBsb2RlKCcsICcsICRvcHRpb25zKSAuICcpJyA6ICcnOwoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkbmFtZXNbJG5hbWVdKSkgewogICAgICAgICAgICAgICAgICAgICRuYW1lc1skbmFtZV0rKzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG5hbWVzWyRuYW1lXSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvcmVhY2ggKCRuYW1lcyBhcyAkbmFtZSA9PiAkY291bnQpIHsKICAgICAgICAgICAgICAgIGlmICgkY291bnQgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXR0cmlidXRlRXJyb3JzLCAkbmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlRXJyb3JzWzBdKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJXaG9vcHMhIFlvdSBjYW5ub3QgYWRkIHNhbWUgaXRlbSBtb3JlIHRoYW4gb25jZS4gTm90ZSB0aGF0IHRoZXNlIGl0ZW1zIHNlbGVjdGVkIG1vcmUgdGhhbiBvbmNlOiAiIC4gaW1wbG9kZSgnLCAnLCAkYXR0cmlidXRlRXJyb3JzKQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUKICAgICAgICBdOwogICAgICAgIC8qIENoZWNrIGlmIG9uZSBpdGVtIHNlbGVjdGVkIG1vcmUgdGhhbiBvbmNlICovCiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QsICRlZGl0ID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdzYWxlYWJsZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2V4cGxhbmF0aW9ucycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnYXNzaWduZWRfZmluYW5jZV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwcm9kdWN0X2lkLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdmaWxlJyA9PiAnYXJyYXknLAogICAgICAgICAgICAnZmlsZS4qJyA9PiAnbWF4OjUxMjAwJywKICAgICAgICBdKTsKCiAgICAgICAgLy8gaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdmaWxlJykpIHsKICAgICAgICAvLyAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgLy8gICAgICAgICAnZmlsZScgPT4gWydtYXg6MTAwMDAnXSwKICAgICAgICAvLyAgICAgXSk7CiAgICAgICAgLy8gfQoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkY2hlY2tBdHRyaWJ1dGVzID0gJHRoaXMtPmNoZWNrQXR0cmlidXRlcygkcmVxdWVzdCk7CiAgICAgICAgICAgIGlmICghJGNoZWNrQXR0cmlidXRlc1snc3VjY2VzcyddKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkY2hlY2tBdHRyaWJ1dGVzWydtZXNzYWdlJ10KICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvKiBDaGVjayBQcm9qZWN0IEJhbGFuY2UgKi8KICAgICAgICAgICAgJHByb2plY3RfdGFza19pZCA9ICgkcmVxdWVzdC0+YXBwcm92YWxfcXR5ID09ICd0cnVlJykgPyAkcmVxdWVzdC0+cHJvamVjdF90YXNrX2lkIDogKGlzc2V0KCRyZXF1ZXN0LT5wcm9qZWN0X3Rhc2tfaWQpID8gJHJlcXVlc3QtPnByb2plY3RfdGFza19pZCA6IG51bGwpOwogICAgICAgICAgICAkcHJvamVjdFRhc2sgPSBQcm9qZWN0VGFzazo6ZmluZCgkcHJvamVjdF90YXNrX2lkKTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRwcm9qZWN0VGFzay0+aWQpKSB7CiAgICAgICAgICAgICAgICAkY29uc3VtcHRpb25zID0gMDsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcHJvamVjdFRhc2stPnJlcXVpc2l0aW9uc1swXSkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcHJvamVjdFRhc2stPnJlcXVpc2l0aW9ucyBhcyAka2V5ID0+ICR0aGlzX3JlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb25zdW1wdGlvbnMgKz0gZXN0aW1hdGVkVmFsdWUoJHRoaXNfcmVxdWlzaXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25fY29uc3VtcHRpb24gPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnF0eSBhcyAka2V5ID0+ICRxdHkpIHsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25fY29uc3VtcHRpb24gKz0gUHJvZHVjdDo6ZmluZCgkcmVxdWVzdC0+cHJvZHVjdF9pZFska2V5XSktPnVuaXRfcHJpY2UgKiAkcXR5OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRjb25zdW1wdGlvbnMgKz0gJHJlcXVpc2l0aW9uX2NvbnN1bXB0aW9uOwoKICAgICAgICAgICAgICAgIGlmICgkY29uc3VtcHRpb25zID4gJHByb2plY3RUYXNrLT5zdWJEZWxpdmVyYWJsZS0+YnVkZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnUHJvamVjdCBCdWRnZXQgYWxsb2NhdGlvbiAoJyAuICRwcm9qZWN0VGFzay0+YnVkZ2V0IC4gJyBCRFQpIGhhcyBiZWVuIGV4Y2VlZGVkIGZvciB0aGlzIHJlcXVpc2l0aW9uICgnIC4gJHJlcXVpc2l0aW9uX2NvbnN1bXB0aW9uIC4gJyBCRFQpLiBSZW1haW5pbmcgQnVkZ2V0IGlzICgnIC4gKCRwcm9qZWN0VGFzay0+c3ViRGVsaXZlcmFibGUtPmJ1ZGdldCA+ICRjb25zdW1wdGlvbnMgPyAkcHJvamVjdFRhc2stPnN1YkRlbGl2ZXJhYmxlLT5idWRnZXQgLSAkY29uc3VtcHRpb25zIDogMCkgLiAnIEJEVCknCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyogQ2hlY2sgUHJvamVjdCBCYWxhbmNlICovCgogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbicgPT4gdW5pcXVlU3RyaW5nR2VuZXJhdG9yKCksCiAgICAgICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAkcmVxdWVzdC0+cmVmZXJlbmNlX25vLAoKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAkcmVxdWVzdC0+aHJfdW5pdF9pZCwKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgJ3NhbGVhYmxlJyA9PiAkcmVxdWVzdC0+c2FsZWFibGUsCgogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2RhdGUnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9kYXRlKSksCgogICAgICAgICAgICAgICAgJ2F1dGhvcl9pZCcgPT4gKCRyZXF1ZXN0LT5hcHByb3ZhbF9xdHkgPT0gJ3RydWUnKSA/ICRyZXF1ZXN0LT5hdXRob3JfaWQgOiBhdXRoKCktPnVzZXIoKS0+aWQsCgogICAgICAgICAgICAgICAgJ3Byb2plY3RfaWQnID0+ICgkcmVxdWVzdC0+YXBwcm92YWxfcXR5ID09ICd0cnVlJykgPyAkcmVxdWVzdC0+cHJvamVjdF9pZCA6IChpc3NldCgkcmVxdWVzdC0+cHJvamVjdF9pZCkgPyAkcmVxdWVzdC0+cHJvamVjdF9pZCA6IG51bGwpLAoKICAgICAgICAgICAgICAgICdkZWxpdmVyYWJsZV9pZCcgPT4gKCRyZXF1ZXN0LT5hcHByb3ZhbF9xdHkgPT0gJ3RydWUnKSA/ICRyZXF1ZXN0LT5kZWxpdmVyYWJsZV9pZCA6IChpc3NldCgkcmVxdWVzdC0+ZGVsaXZlcmFibGVfaWQpID8gJHJlcXVlc3QtPmRlbGl2ZXJhYmxlX2lkIDogbnVsbCksCgogICAgICAgICAgICAgICAgJ3Byb2plY3RfdGFza19pZCcgPT4gKCRyZXF1ZXN0LT5hcHByb3ZhbF9xdHkgPT0gJ3RydWUnKSA/ICRyZXF1ZXN0LT5wcm9qZWN0X3Rhc2tfaWQgOiAoaXNzZXQoJHJlcXVlc3QtPnByb2plY3RfdGFza19pZCkgPyAkcmVxdWVzdC0+cHJvamVjdF90YXNrX2lkIDogbnVsbCksCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAoJHJlcXVlc3QtPmFwcHJvdmFsX3F0eSA9PSAndHJ1ZScpID8gMCA6IDMsCiAgICAgICAgICAgICAgICAncmVtYXJrcycgPT4gJHJlcXVlc3QtPnJlbWFya3MsCiAgICAgICAgICAgICAgICAvLyAnZXhwbGFuYXRpb25zJyA9PiBqc29uX2VuY29kZShpc3NldCgkcmVxdWVzdC0+ZXhwbGFuYXRpb25zWzBdKSA/ICRyZXF1ZXN0LT5leHBsYW5hdGlvbnMgOiBbXSksCiAgICAgICAgICAgICAgICAnZXhwbGFuYXRpb25zJyA9PiAkcmVxdWVzdC0+ZXhwbGFuYXRpb25zLAogICAgICAgICAgICAgICAgJ2Fzc2lnbmVkX2ZpbmFuY2VfaWQnID0+ICRyZXF1ZXN0LT5hc3NpZ25lZF9maW5hbmNlX2lkLAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIHJlcXVpc2l0aW9uVHJhY2tpbmdIaXN0b3J5KCRyZXF1aXNpdGlvbi0+aWQsICdyZXF1aXNpdGlvbl9jcmVhdGVkJywgJ1JlcXVpc2l0aW9uIGhhcyBiZWVuIGNyZWF0ZWQuJyk7CiAgICAgICAgICAgIC8vb2xkIGF0dGFjaG1lbnQgY29kZQogICAgICAgICAgICAvLyBpZiAoJHJlcXVlc3QtPmhhc0ZpbGUoJ2ZpbGUnKSkgewogICAgICAgICAgICAvLyAgICAgJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50ID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2ZpbGUnKSwgJ3VwbG9hZC9yZXF1aXNpdGlvbi1hdHRhY2htZW50cycpOwogICAgICAgICAgICAvLyAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdmaWxlJykpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5maWxlKCdmaWxlJykgYXMgJGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICAkZmlsZVBhdGggPSAkdGhpcy0+ZmlsZVVwbG9hZCgkZmlsZSwgJ3VwbG9hZC9yZXF1aXNpdGlvbi1hdHRhY2htZW50cycpOwogICAgICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uQXR0YWNobWVudDo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9sb2NhdGlvbicgPT4gJGZpbGVQYXRoLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cXR5IGFzICRrZXkgPT4gJHF0eSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbUlucHV0W10gPSBbCiAgICAgICAgICAgICAgICAgICAgJ3VpZCcgPT4gXFN0cjo6cmFuZG9tKDgpLAogICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uLT5pZCwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHJlcXVlc3QtPnByb2R1Y3RfaWRbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgJ3VuaXRfcHJpY2UnID0+IGlzc2V0KCRyZXF1ZXN0LT5vbGRfdW5pdF9wcmljZVska2V5XSkgPyAkcmVxdWVzdC0+b2xkX3VuaXRfcHJpY2VbJGtleV0gOiAoaXNzZXQoJHJlcXVlc3QtPnVuaXRfcHJpY2VbJGtleV0pID8gJHJlcXVlc3QtPnVuaXRfcHJpY2VbJGtleV0gOiAwKSwKICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkcXR5LAogICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9xdHknID0+ICgkcmVxdWVzdC0+YXBwcm92YWxfcXR5ID09ICd0cnVlJykgPyAoaXNzZXQoJHJlcXVlc3QtPm9sZF9xdHlbJGtleV0pID8gJHJlcXVlc3QtPm9sZF9xdHlbJGtleV0gOiAkcXR5KSA6ICRxdHksCiAgICAgICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJyA9PiAkcmVxdWVzdC0+ZGVzY3JpcHRpb25bJGtleV0gPz8gbnVsbCwKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgaDppJyksCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+ICgkcmVxdWVzdC0+YXBwcm92YWxfcXR5ID09ICd0cnVlJykgPyAkcmVxdWVzdC0+YXV0aG9yX2lkIDogYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjppbnNlcnQoJHJlcXVpc2l0aW9uSXRlbUlucHV0KTsKCiAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAncGVuZGluZycpOwoKICAgICAgICAgICAgLy9JbnNlcnQgbm90ZXMgbG9nZ2luZwogICAgICAgICAgICBSZXF1aXNpdGlvbk5vdGVMb2dzOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgJ25vdGVzJyA9PiAkcmVxdWVzdC0+cmVtYXJrcywKICAgICAgICAgICAgICAgICd0eXBlJyA9PiAoJHJlcXVlc3QtPmFwcHJvdmFsX3F0eSA9PSAndHJ1ZScpID8gJ2RlcGFydG1lbnQtaGVhZCcgOiAncmVxdWlzaXRpb24nLAogICAgICAgICAgICBdKTsKICAgICAgICAgICAgLy9UcmFja2luZwoKICAgICAgICAgICAgJGl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdwcm9kdWN0JwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb24tPmlkKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSBbXTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRpdGVtc1swXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAkaXRlbV9rZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRpdGVtX2tleSArIDFdKSAmJiBpc19hcnJheSgkcmVxdWVzdC0+YXR0cmlidXRlX29wdGlvbnNbJGl0ZW1fa2V5ICsgMV0pICYmIGNvdW50KCRyZXF1ZXN0LT5hdHRyaWJ1dGVfb3B0aW9uc1skaXRlbV9rZXkgKyAxXSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5hdHRyaWJ1dGVfb3B0aW9uc1skaXRlbV9rZXkgKyAxXSBhcyAkYXR0cmlidXRlX2lkID0+ICRhdHRyaWJ1dGVfb3B0aW9uX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RfYXR0cmlidXRlc1skaXRlbV9rZXkgKyAxXSkgJiYgaW5fYXJyYXkoJGF0dHJpYnV0ZV9pZCwgJHJlcXVlc3QtPnByb2R1Y3RfYXR0cmlidXRlc1skaXRlbV9rZXkgKyAxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhdHRyaWJ1dGVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pdGVtX2lkJyA9PiAkaXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVfb3B0aW9uX2lkJyA9PiBnZXRBdHRyaWJ1dGVPcHRpb24oJGl0ZW0tPnByb2R1Y3QtPmNhdGVnb3J5X2lkLCAkYXR0cmlidXRlX2lkLCAkYXR0cmlidXRlX29wdGlvbl9pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlc1swXSkpIHsKICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uSXRlbUF0dHJpYnV0ZTo6aW5zZXJ0KCRhdHRyaWJ1dGVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgc2Vzc2lvbigpLT5mb3JnZXQoJ3JlcXVpc2l0aW9uLWl0ZW1zJyk7CgogICAgICAgICAgICBpZiAoJGVkaXQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdSZXF1aXNpdGlvbiBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYXBwbGllZCcpOwoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+d2hlcmVfdG9fZ28pICYmICRyZXF1ZXN0LT53aGVyZV90b19nbyA9PSAnYmFjaycpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAncmVkaXJlY3QnID0+IHVybCgncG1zL3JlcXVpc2l0aW9uL3JlcXVpc2l0aW9uL2NyZWF0ZScpCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICdyZWRpcmVjdCcgPT4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5pbmRleCcpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcmVxdWlzaXRpb247CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpLAogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEdXBsaWNhdGUgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXEpzb25SZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGR1cGxpY2F0ZSgkaWQpCiAgICB7CiAgICAgICAgJG1vZGVsID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeScsCiAgICAgICAgICAgICdpdGVtcy5hdHRyaWJ1dGVzJywKICAgICAgICAgICAgJ3Byb2plY3RUYXNrJwogICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIC8vVGFzayBCdWRnZXQgVmFsaWRhdGlvbgogICAgICAgICAgICAkcHJvamVjdFRhc2tJZCA9IGlzc2V0KCRtb2RlbC0+cHJvamVjdF90YXNrX2lkKSA/ICRtb2RlbC0+cHJvamVjdF90YXNrX2lkIDogbnVsbDsKICAgICAgICAgICAgJHByb2plY3RUYXNrID0gUHJvamVjdFRhc2s6OmZpbmQoJHByb2plY3RUYXNrSWQpOwogICAgICAgICAgICBpZiAoaXNzZXQoJHByb2plY3RUYXNrLT5pZCkpIHsKICAgICAgICAgICAgICAgICRjb25zdW1wdGlvbnMgPSAwOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRwcm9qZWN0VGFzay0+cmVxdWlzaXRpb25zWzBdKSkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRwcm9qZWN0VGFzay0+cmVxdWlzaXRpb25zIGFzICRrZXkgPT4gJHRoaXNfcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnN1bXB0aW9ucyArPSBlc3RpbWF0ZWRWYWx1ZSgkdGhpc19yZXF1aXNpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uQ29uc3VtcHRpb24gPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJG1vZGVsLT5pdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkNvbnN1bXB0aW9uICs9IFByb2R1Y3Q6OmZpbmQoJGl0ZW0tPnByb2R1Y3RfaWQpLT51bml0X3ByaWNlICogJGl0ZW0tPnF0eTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkY29uc3VtcHRpb25zICs9ICRyZXF1aXNpdGlvbkNvbnN1bXB0aW9uOwogICAgICAgICAgICAgICAgaWYgKCRjb25zdW1wdGlvbnMgPiAkcHJvamVjdFRhc2stPnN1YkRlbGl2ZXJhYmxlLT5idWRnZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdQcm9qZWN0IEJ1ZGdldCBhbGxvY2F0aW9uICgnIC4gJHByb2plY3RUYXNrLT5idWRnZXQgLiAnIEJEVCkgaGFzIGJlZW4gZXhjZWVkZWQgZm9yIHRoaXMgcmVxdWlzaXRpb24gKCcgLiAkcmVxdWlzaXRpb25Db25zdW1wdGlvbiAuICcgQkRUKS4gUmVtYWluaW5nIEJ1ZGdldCBpcyAoJyAuICgkcHJvamVjdFRhc2stPnN1YkRlbGl2ZXJhYmxlLT5idWRnZXQgPiAkY29uc3VtcHRpb25zID8gJHByb2plY3RUYXNrLT5zdWJEZWxpdmVyYWJsZS0+YnVkZ2V0IC0gJGNvbnN1bXB0aW9ucyA6IDApIC4gJyBCRFQpJwogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vVGFzayBCdWRnZXQgVmFsaWRhdGlvbgoKICAgICAgICAgICAgJHByZWZpeCA9ICdSUS0nIC4gZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkgLiAnLScgLiBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSAuICctJzsKICAgICAgICAgICAgJHJlZk5vID0gdW5pcXVlQ29kZSgxNiwgJHByZWZpeCwgJ3JlcXVpc2l0aW9ucycsICdpZCcpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb24nID0+IHVuaXF1ZVN0cmluZ0dlbmVyYXRvcigpLAogICAgICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gJHJlZk5vLAogICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGlzc2V0KCRtb2RlbC0+aHJfdW5pdF9pZCkgPyAkbW9kZWwtPmhyX3VuaXRfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBpc3NldCgkbW9kZWwtPmNvc3RfY2VudHJlX2lkKSA/ICRtb2RlbC0+Y29zdF9jZW50cmVfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2RhdGUnID0+IGRhdGUoJ1ktbS1kIGg6aScpLAogICAgICAgICAgICAgICAgJ2F1dGhvcl9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgJ3Byb2plY3RfaWQnID0+IGlzc2V0KCRtb2RlbC0+cHJvamVjdF9pZCkgPyAkbW9kZWwtPnByb2plY3RfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgJ2RlbGl2ZXJhYmxlX2lkJyA9PiBpc3NldCgkbW9kZWwtPmRlbGl2ZXJhYmxlX2lkKSA/ICRtb2RlbC0+ZGVsaXZlcmFibGVfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgJ3Byb2plY3RfdGFza19pZCcgPT4gaXNzZXQoJG1vZGVsLT5wcm9qZWN0X3Rhc2tfaWQpID8gJG1vZGVsLT5wcm9qZWN0X3Rhc2tfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMywKICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAkbW9kZWwtPnJlbWFya3MsCiAgICAgICAgICAgICAgICAnZXhwbGFuYXRpb25zJyA9PiAkbW9kZWwtPmV4cGxhbmF0aW9ucywKICAgICAgICAgICAgICAgICdhdHRhY2htZW50JyA9PiAkbW9kZWwtPmF0dGFjaG1lbnQsCiAgICAgICAgICAgICAgICAnYXNzaWduZWRfZmluYW5jZV9pZCcgPT4gJG1vZGVsLT5hc3NpZ25lZF9maW5hbmNlX2lkLAogICAgICAgICAgICAgICAgJ3NhbGVhYmxlJyA9PiAkbW9kZWwtPnNhbGVhYmxlCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCAoJG1vZGVsLT5pdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9IFJlcXVpc2l0aW9uSXRlbTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAndWlkJyA9PiBcU3RyOjpyYW5kb20oOCksCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkaXRlbS0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAndW5pdF9wcmljZScgPT4gJGl0ZW0tPnVuaXRfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgJ3F0eScgPT4gJGl0ZW0tPnF0eSwKICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25fcXR5JyA9PiAkaXRlbS0+cXR5LAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2F0JyA9PiBkYXRlKCdZLW0tZCBoOmk6cycpLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGl0ZW0tPmF0dHJpYnV0ZXNbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGl0ZW0tPmF0dHJpYnV0ZXMgYXMgJGF0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhdHRyaWJ1dGVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25faXRlbV9pZCcgPT4gJHJlcXVpc2l0aW9uSXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlX29wdGlvbl9pZCcgPT4gJGF0dHJpYnV0ZS0+YXR0cmlidXRlX29wdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNzZXQoJGF0dHJpYnV0ZXNbMF0pKSB7CiAgICAgICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW1BdHRyaWJ1dGU6Omluc2VydCgkYXR0cmlidXRlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAncGVuZGluZycpOwoKICAgICAgICAgICAgLy9JbnNlcnQgbm90ZXMgbG9nZ2luZwogICAgICAgICAgICBSZXF1aXNpdGlvbk5vdGVMb2dzOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgJ25vdGVzJyA9PiAkbW9kZWwtPnJlbWFya3MsCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3JlcXVpc2l0aW9uJywKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAvLyBEdXBsaWNhdGUgUmVxdWlzaXRpb24gQXR0YWNobWVudHMKICAgICAgICAgICAgJGF0dGFjaG1lbnRzID0gUmVxdWlzaXRpb25BdHRhY2htZW50Ojp3aGVyZSgncmVxdWlzaXRpb25faWQnLCAkbW9kZWwtPmlkKS0+Z2V0KCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRhdHRhY2htZW50cyBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICAgICAgJG9yaWdpbmFsUGF0aCA9IHB1YmxpY19wYXRoKCRhdHRhY2htZW50LT5maWxlX2xvY2F0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cygkb3JpZ2luYWxQYXRoKSkgewogICAgICAgICAgICAgICAgICAgICRuZXdGaWxlTmFtZSA9IHVuaXFpZCgpIC4gJy0nIC4gYmFzZW5hbWUoJGF0dGFjaG1lbnQtPmZpbGVfbG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICRuZXdGaWxlUGF0aCA9ICd1cGxvYWQvcmVxdWlzaXRpb24tYXR0YWNobWVudHMvJyAuICRuZXdGaWxlTmFtZTsKICAgICAgICAgICAgICAgICAgICAkY29waWVkID0gY29weSgkb3JpZ2luYWxQYXRoLCBwdWJsaWNfcGF0aCgkbmV3RmlsZVBhdGgpKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb3BpZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25BdHRhY2htZW50OjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGVfbG9jYXRpb24nID0+ICRuZXdGaWxlUGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uICRyZXF1aXNpdGlvbgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KFJlcXVpc2l0aW9uICRyZXF1aXNpdGlvbikKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncHJvamVjdFRhc2snCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uLT5pZCk7CgogICAgICAgICAgICAkdGl0bGUgPSAnUmVxdWlzaXRpb24gIycgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdwcmludCcpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5wcmludCcsIFsKICAgICAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb24nID0+ICRyZXF1aXNpdGlvbiwKICAgICAgICAgICAgICAgIF0sICR0aXRsZSwgJHRpdGxlLCAnYTQnLCAnTCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLnNob3cnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbicgPT4gJHJlcXVpc2l0aW9uCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93UmVxdWlzaXRpb24oJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aXRsZSA9ICdSZXF1aXNpdGlvbiBTaG93JzsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlLnByb2plY3QnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnJlbEludmVudG9yeVN1bW1hcnknLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS5sb2NhdGlvbicsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywKICAgICAgICAgICAgICAgICdpdGVtcy5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ2F0dGFjaG1lbnRzJwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgLy9kZCgkcmVxdWlzaXRpb24tPml0ZW1zKTsKCgogICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoCiAgICAgICAgICAgICAgICAncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLnNob3cnLAogICAgICAgICAgICAgICAgWydyZXF1aXNpdGlvbicgPT4gJHJlcXVpc2l0aW9uLCAndGl0bGUnID0+ICR0aXRsZV0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgJGNvbnRlbnRzID0gJGJvZHktPnJlbmRlcigpOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCd2aWV3JykpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRjb250ZW50cyk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBlZGl0aW5nIHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtIFxBcHBcTW9kZWxzXFJlcXVpc2l0aW9uICRyZXF1aXNpdGlvbgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0JywKICAgICAgICAgICAgJ2l0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICdhdHRhY2htZW50cycKICAgICAgICBdKQogICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSAmJiBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSAmJiAhYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpICYmICFhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU0JVIEhlYWQnKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJyksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2F1dGhvcl9pZCcsIGluY2x1ZGVVc2VycygpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU0JVIEhlYWQnKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXV0aG9yX2lkJywgaW5jbHVkZVVzZXJzKCkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXV0aG9yX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkaWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgaWYgKGlzc2V0KCRyZXF1aXNpdGlvbi0+aWQpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkdGl0bGUgPSAnVXBkYXRlIFJlcXVpc2l0aW9uJzsKCiAgICAgICAgICAgICAgICAkY2F0ZWdvcnlJZCA9IENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgfSktPnBsdWNrKCdjYXRlZ29yeV9pZCcpLT50b0FycmF5KCk7CgogICAgICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgICAgIC0+d2l0aChbJ3N1YkNhdGVnb3J5J10pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsICRjYXRlZ29yeUlkKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICdpc19jd2lwJyA9PiAwLAogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgICAgICRmaXhlZEFzc2V0Q2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgICAgICAgICAgICAgLT53aXRoKFsnc3ViQ2F0ZWdvcnknXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2lkJywgJGNhdGVnb3J5SWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdpc19maXhlZF9hc3NldCcgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAgICAgJGN3aXBDYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgICAgICAtPndpdGgoWydzdWJDYXRlZ29yeSddKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkY2F0ZWdvcnlJZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX2ZpeGVkX2Fzc2V0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnaXNfY3dpcCcgPT4gMSwKICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdzdWJDYXRlZ29yeS5wcm9kdWN0cycgPT4gZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJywgJ2FwcHJvdmVkJyktPndoZXJlKCdpc19maW5hbF9hc3NldCcsIDApOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ3N1YkNhdGVnb3J5LnByb2R1Y3RzLnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICAgICAnc3ViQ2F0ZWdvcnkucHJvZHVjdHMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnc3ViQ2F0ZWdvcnkucHJvZHVjdHMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdpZCcsICRyZXF1aXNpdGlvbi0+aXRlbXMtPnBsdWNrKCdwcm9kdWN0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICAgICAgfSktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAkY2F0ZWdvcnlfaWQgPSAoaXNzZXQoJGNhdGVnb3J5LT5pZCkgPyAkY2F0ZWdvcnktPmlkIDogMCk7CgogICAgICAgICAgICAgICAgJHByb2plY3RzID0gW107CiAgICAgICAgICAgICAgICAkdGFza3MgPSBQcm9qZWN0VGFzazo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3N1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlLnByb2plY3QnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGFza3NbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRhc2tzIGFzICR0YXNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9qZWN0c1tdID0gJHRhc2stPnN1YkRlbGl2ZXJhYmxlLT5kZWxpdmVyYWJsZS0+cHJvamVjdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcHJvamVjdHMgPSBQcm9qZWN0Ojp3aGVyZUluKCJpZCIsIGFycmF5X2tleXMoY29sbGVjdCgkcHJvamVjdHMpLT5ncm91cEJ5KCdpZCcpLT50b0FycmF5KCkpKS0+Z2V0KCk7CgogICAgICAgICAgICAgICAgJGRlbGl2ZXJhYmxlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0YXNrc1swXSkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGFza3MgYXMgJHRhc2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0YXNrLT5zdWJEZWxpdmVyYWJsZS0+ZGVsaXZlcmFibGUtPnByb2plY3RfaWQgPT0gJHJlcXVpc2l0aW9uLT5wcm9qZWN0X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGVsaXZlcmFibGVzW10gPSAkdGFzay0+c3ViRGVsaXZlcmFibGUtPmRlbGl2ZXJhYmxlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGRlbGl2ZXJhYmxlcyA9IERlbGl2ZXJhYmxlczo6d2hlcmVJbigiaWQiLCBhcnJheV9rZXlzKGNvbGxlY3QoJGRlbGl2ZXJhYmxlcyktPmdyb3VwQnkoJ2lkJyktPnRvQXJyYXkoKSkpLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkbW9kaWZpZWROYW1lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAkdGFzayA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+cHJvamVjdF90YXNrX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgJHRhc2sgPSBQcm9qZWN0VGFzazo6ZmluZE9yRmFpbCgkcmVxdWlzaXRpb24tPnByb2plY3RfdGFza19pZCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGV4cGxhbmF0aW9ucyA9IFJlcXVpc2l0aW9uRXhwbGFuYXRpb246OmFsbCgpOwoKICAgICAgICAgICAgICAgICR1bml0cyA9IFVuaXQ6OndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KS0+Z2V0KCk7CgoKICAgICAgICAgICAgICAgICRzdWJDYXRlZ29yaWVzID0gJzxvcHRpb24gdmFsdWU9IiI+U2VsZWN0IFN1YmNhdGVnb3J5PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICRzdWJDYXRlZ29yeVByb2R1Y3RzID0gW107CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGNhdGVnb3J5LT5zdWJDYXRlZ29yeVswXSkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY2F0ZWdvcnktPnN1YkNhdGVnb3J5IGFzICRzdWJDYXRlZ29yeSkgewogICAgICAgICAgICAgICAgICAgICAgICAkc3ViQ2F0ZWdvcmllcyAuPSAnPG9wdGlvbiB2YWx1ZT0iJyAuICRzdWJDYXRlZ29yeS0+aWQgLiAnIj4nIC4gJHN1YkNhdGVnb3J5LT5uYW1lIC4gJyAoJyAuICRzdWJDYXRlZ29yeS0+Y29kZSAuICcpPC9vcHRpb24+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9kdWN0cyA9ICc8b3B0aW9uIHZhbHVlPSIiIGRhdGEtdW9tPSIiPlNlbGVjdCBQcm9kdWN0PC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRzdWJDYXRlZ29yeS0+cHJvZHVjdHNbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3ViQ2F0ZWdvcnktPnByb2R1Y3RzIGFzICRwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3RzIC49ICc8b3B0aW9uIGRhdGEtdW9tPSInIC4gKCRwcm9kdWN0LT5wcm9kdWN0VW5pdCA/ICRwcm9kdWN0LT5wcm9kdWN0VW5pdC0+dW5pdF9uYW1lIDogJycpIC4gJyIgdmFsdWU9IicgLiAkcHJvZHVjdC0+aWQgLiAnIiBkYXRhLXN1Yi1jYXRlZ29yeS1pZD0iJyAuICRwcm9kdWN0LT5jYXRlZ29yeV9pZCAuICciIGRhdGEtY2F0ZWdvcnktaWQ9IicgLiAkc3ViQ2F0ZWdvcnktPnBhcmVudF9pZCAuICciICBkYXRhLXVuaXQtcHJpY2U9IicgLiAkcHJvZHVjdC0+dW5pdF9wcmljZSAuICciPicgLiAkcHJvZHVjdC0+bmFtZSAuICcgJyAuIGdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRwcm9kdWN0KSAuICcgKFVPTTogJyAuICgkcHJvZHVjdC0+cHJvZHVjdFVuaXQgPyAkcHJvZHVjdC0+cHJvZHVjdFVuaXQtPnVuaXRfbmFtZSA6ICcnKSAuICcpPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YkNhdGVnb3J5UHJvZHVjdHNbJHN1YkNhdGVnb3J5LT5pZF0gPSAkcHJvZHVjdHM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwcm9kdWN0QXR0cmlidXRlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1aXNpdGlvbi0+aXRlbXNbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uLT5pdGVtcyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZWxlY3RlZEF0dHJpYnV0ZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRpdGVtLT5hdHRyaWJ1dGVzWzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGl0ZW0tPmF0dHJpYnV0ZXMgYXMgJGF0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHNlbGVjdGVkQXR0cmlidXRlcywgJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdEF0dHJpYnV0ZXNbJGl0ZW0tPmlkXSA9IHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5hdHRyaWJ1dGVzJywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NlcmlhbCcgPT4gJGtleSArIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdCcgPT4gJGl0ZW0tPnByb2R1Y3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbScgPT4gJGl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2VsZWN0ZWRBdHRyaWJ1dGVzJyA9PiAkc2VsZWN0ZWRBdHRyaWJ1dGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnID0+IEF0dHJpYnV0ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29wdGlvbnMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRlZ29yaWVzJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdjYXRlZ29yaWVzLmNhdGVnb3J5LnByb2R1Y3RzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkaXRlbS0+cHJvZHVjdF9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NlbGVjdDInID0+IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLT5yZW5kZXIoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkZmluYW5jZVVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICB9KS0+d2hlcmVIYXMoJ3JvbGVzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnQWNjb3VudHMnKTsKICAgICAgICAgICAgICAgIH0pLT53aGVyZUhhcygncGVybWlzc2lvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdyZXF1aXNpdGlvbi1maW5hbmNlLWFwcHJvdmFsLWxpc3QnKTsKICAgICAgICAgICAgICAgIH0pLT5zZWxlY3QoJ2lkJywgJ25hbWUnKS0+Z2V0KCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5lZGl0JywgY29tcGFjdCgndGl0bGUnLCAnY2F0ZWdvcmllcycsICdmaXhlZEFzc2V0Q2F0ZWdvcmllcycsICdjd2lwQ2F0ZWdvcmllcycsICdyZXF1aXNpdGlvbicsICdwcm9qZWN0cycsICdkZWxpdmVyYWJsZXMnLCAnY2F0ZWdvcnlfaWQnLCAnbW9kaWZpZWROYW1lJywgJ3Rhc2snLCAnZXhwbGFuYXRpb25zJywgJ3VuaXRzJywgJ3N1YkNhdGVnb3JpZXMnLCAnc3ViQ2F0ZWdvcnlQcm9kdWN0cycsICdwcm9kdWN0QXR0cmlidXRlcycsICdmaW5hbmNlVXNlcnMnKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdyZWRpcmVjdCcpICYmIHJlcXVlc3QoKS0+Z2V0KCdyZWRpcmVjdCcpID09ICdsaXN0LXZpZXcnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJlZGlyZWN0QmFja1dpdGhFcnJvcignUmVxdWlzaXRpb24gbm90IGZvdW5kJywgJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuaW5kZXgnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cmVkaXJlY3RCYWNrV2l0aEVycm9yKCdSZXF1aXNpdGlvbiBub3QgZm91bmQnLCAncG1zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uLmluZGV4Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEBwYXJhbSBcQXBwXE1vZGVsc1xSZXF1aXNpdGlvbiAkcmVxdWlzaXRpb24KICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZWRpcmVjdFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgUmVxdWlzaXRpb24gJHJlcXVpc2l0aW9uKQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdlZGl0X2ZpbGUuKicgPT4gJ2ZpbGV8bWF4OjEwMDAwJywKICAgICAgICBdKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkY2hlY2tBdHRyaWJ1dGVzID0gJHRoaXMtPmNoZWNrQXR0cmlidXRlcygkcmVxdWVzdCk7CiAgICAgICAgICAgIGlmICghJGNoZWNrQXR0cmlidXRlc1snc3VjY2VzcyddKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkY2hlY2tBdHRyaWJ1dGVzWydtZXNzYWdlJ10KICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5yZW1hcmtzID0gJHJlcXVlc3QtPnJlbWFya3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBEZWxldGUgb2xkIGl0ZW1zIGFuZCBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW1BdHRyaWJ1dGU6OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2l0ZW1faWQnLCAkcmVxdWlzaXRpb24tPml0ZW1zLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW06OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbi0+aWQpLT5kZWxldGUoKTsKCiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5yZW1hcmtzID0gJHJlcXVlc3QtPnJlbWFya3M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgb3RoZXIgcmVxdWlzaXRpb24gZmllbGRzCiAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aHJfdW5pdF9pZCA9ICRyZXF1ZXN0LT5ocl91bml0X2lkOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPmNvc3RfY2VudHJlX2lkID0gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPnNhbGVhYmxlID0gJHJlcXVlc3QtPnNhbGVhYmxlOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPmV4cGxhbmF0aW9ucyA9ICRyZXF1ZXN0LT5leHBsYW5hdGlvbnM7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+YXNzaWduZWRfZmluYW5jZV9pZCA9ICRyZXF1ZXN0LT5hc3NpZ25lZF9maW5hbmNlX2lkOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPnNhdmUoKTsKCiAgICAgICAgICAgIC8vIEhhbmRsZSBuZXcgaXRlbXMgaWYgc3RhdHVzICE9IDEKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+c3RhdHVzICE9IDEpIHsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1JbnB1dCA9IFtdOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnByb2R1Y3RfaWQgYXMgJGtleSA9PiAkcHJvZHVjdF9pZCkgewogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1JbnB1dFtdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAndWlkJyA9PiBcU3RyOjpyYW5kb20oOCksCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRyZXF1ZXN0LT5wcm9kdWN0X2lkWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9wcmljZScgPT4gKHJlcXVlc3QoKS0+aGFzKCdlZGl0b3InKSAmJiByZXF1ZXN0KCktPmdldCgnZWRpdG9yJykgPT0gImJvc3MiID8gJHJlcXVlc3QtPm9sZF91bml0X3ByaWNlWyRrZXldIDogJHJlcXVlc3QtPnVuaXRfcHJpY2VbJGtleV0pLAogICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkcmVxdWVzdC0+cXR5WyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25fcXR5JyA9PiAocmVxdWVzdCgpLT5oYXMoJ2VkaXRvcicpICYmIHJlcXVlc3QoKS0+Z2V0KCdlZGl0b3InKSA9PSAiYm9zcyIgPyAkcmVxdWVzdC0+b2xkX3F0eVska2V5XSA6ICRyZXF1ZXN0LT5xdHlbJGtleV0pLAogICAgICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nID0+ICRyZXF1ZXN0LT5kZXNjcmlwdGlvblska2V5XSA/PyBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCcgPT4gbm93KCksCiAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uSXRlbTo6aW5zZXJ0KCRyZXF1aXNpdGlvbkl0ZW1JbnB1dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEhhbmRsZSBhdHRyaWJ1dGVzCiAgICAgICAgICAgICRpdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aCgncHJvZHVjdCcpLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb24tPmlkKS0+Z2V0KCk7CiAgICAgICAgICAgICRhdHRyaWJ1dGVzID0gW107CiAgICAgICAgICAgIGlmICgkaXRlbXMtPmNvdW50KCkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAkaXRlbV9rZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRpdGVtX2tleSArIDFdKSAmJiBpc19hcnJheSgkcmVxdWVzdC0+YXR0cmlidXRlX29wdGlvbnNbJGl0ZW1fa2V5ICsgMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5hdHRyaWJ1dGVfb3B0aW9uc1skaXRlbV9rZXkgKyAxXSBhcyAkYXR0cmlidXRlX2lkID0+ICRhdHRyaWJ1dGVfb3B0aW9uX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RfYXR0cmlidXRlc1skaXRlbV9rZXkgKyAxXSkgJiYgaW5fYXJyYXkoJGF0dHJpYnV0ZV9pZCwgJHJlcXVlc3QtPnByb2R1Y3RfYXR0cmlidXRlc1skaXRlbV9rZXkgKyAxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25faXRlbV9pZCcgPT4gJGl0ZW0tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlX29wdGlvbl9pZCcgPT4gZ2V0QXR0cmlidXRlT3B0aW9uKCRpdGVtLT5wcm9kdWN0LT5jYXRlZ29yeV9pZCwgJGF0dHJpYnV0ZV9pZCwgJGF0dHJpYnV0ZV9vcHRpb25faWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gJHJlcXVpc2l0aW9uLT5hdXRob3JfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1cGRhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWVtcHR5KCRhdHRyaWJ1dGVzKSkgewogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtQXR0cmlidXRlOjppbnNlcnQoJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gTkVXIENPREUgRk9SIEFUVEFDSE1FTlRTIC0tLQogICAgICAgICAgICAvLyBDaGVjayBmb3IgbmV3IHVwbG9hZGVkIGZpbGVzCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnZWRpdF9maWxlJykpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5maWxlKCdlZGl0X2ZpbGUnKSBhcyAkdXBsb2FkZWRGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVXBsb2FkIGZpbGUgYW5kIGdldCBwYXRoICh5b3UgY2FuIGFkanVzdCBmaWxlVXBsb2FkIG1ldGhvZCBhY2NvcmRpbmdseSkKICAgICAgICAgICAgICAgICAgICAkZmlsZVBhdGggPSAkdGhpcy0+ZmlsZVVwbG9hZCgkdXBsb2FkZWRGaWxlLCAndXBsb2FkL3JlcXVpc2l0aW9uLWF0dGFjaG1lbnRzJyk7CgogICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgcmVjb3JkIHRvIHJlcXVpc2l0aW9uX2F0dGFjaG1lbnRzIHRhYmxlCiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50cygpLT5jcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9sb2NhdGlvbicgPT4gJGZpbGVQYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT5pZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT5pZCgpLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBFTkQgYXR0YWNobWVudHMgLS0tCgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdSZXF1aXNpdGlvbiBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdXBkYXRlZCcpOwoKICAgICAgICAgICAgLy8gUmV0dXJuIEpTT04gd2l0aCByZWRpcmVjdHMsIHNhbWUgYXMgYmVmb3JlCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzKCdyZWRpcmVjdCcpKSB7CiAgICAgICAgICAgICAgICAkcmVkaXJlY3RSb3V0ZXMgPSBbCiAgICAgICAgICAgICAgICAgICAgJ2xpc3QtdmlldycgPT4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuaW5kZXgnKSwKICAgICAgICAgICAgICAgICAgICAnaGFsdC1yZXF1aXNpdGlvbicgPT4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5oYWx0LnJlcXVpc2l0aW9uLmluZGV4JyksCiAgICAgICAgICAgICAgICAgICAgJ3Bhc3NlZC1yZXF1aXNpdGlvbi1hcHByb3ZhbCcgPT4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5wYXNzZWQtcmVxdWlzaXRpb24tYXBwcm92YWwnKSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAkcmVkaXJlY3QgPSAkcmVkaXJlY3RSb3V0ZXNbJHJlcXVlc3QtPmdldCgncmVkaXJlY3QnKV0gPz8gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5pbmRleCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWydzdWNjZXNzJyA9PiB0cnVlLCAncmVkaXJlY3QnID0+ICRyZWRpcmVjdF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbJ3N1Y2Nlc3MnID0+IHRydWUsICdyZWRpcmVjdCcgPT4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5pbmRleCcpXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsnc3VjY2VzcycgPT4gZmFsc2UsICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKV0pOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBmcm9tIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtIFxBcHBcTW9kZWxzXFJlcXVpc2l0aW9uICRyZXF1aXNpdGlvbgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXEpzb25SZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVzdHJveSgkaWQpCiAgICB7CiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmQoJGlkKTsKICAgICAgICBpZiAoIWluX2FycmF5KCRyZXF1aXNpdGlvbi0+c3RhdHVzLCBbMCwgMiwgM10pKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiUmVxdWlzaXRpb24gY2Fubm90IGJlIGRlbGV0ZWQhIgogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjpmaW5kKCRpZCk7CiAgICAgICAgJGRlbGV0ZSA9IFJlcXVpc2l0aW9uOjpmaW5kKCRpZCktPmRlbGV0ZSgpOwogICAgICAgIGlmICgkZGVsZXRlKSB7CiAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSAmJiBmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQpKSkgewogICAgICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTb21ldGhpbmcgd2VudCB3cm9uZyEiCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3lBdHRhY2htZW50KCRpZCkKICAgIHsKICAgICAgICAkYXR0YWNobWVudCA9IFJlcXVpc2l0aW9uQXR0YWNobWVudDo6ZmluZCgkaWQpOwoKICAgICAgICBpZiAoISRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnQXR0YWNobWVudCBub3QgZm91bmQnLAogICAgICAgICAgICBdLCA0MDQpOwogICAgICAgIH0KCiAgICAgICAgLy8gT3B0aW9uYWw6IGNoZWNrIGlmIHRoZSByZWxhdGVkIHJlcXVpc2l0aW9uIGFsbG93cyBkZWxldGluZyBhdHRhY2htZW50cwogICAgICAgICRyZXF1aXNpdGlvbiA9ICRhdHRhY2htZW50LT5yZWxSZXF1aXNpdGlvbjsKICAgICAgICBpZiAoISRyZXF1aXNpdGlvbikgewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1JlbGF0ZWQgcmVxdWlzaXRpb24gbm90IGZvdW5kJywKICAgICAgICAgICAgXSwgNDA0KTsKICAgICAgICB9CgogICAgICAgIC8vIEV4YW1wbGUgc3RhdHVzIGNoZWNrIChtb2RpZnkgYXMgbmVlZGVkKQogICAgICAgIGlmICghaW5fYXJyYXkoJHJlcXVpc2l0aW9uLT5zdGF0dXMsIFswLCAyLCAzXSkpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdDYW5ub3QgZGVsZXRlIGF0dGFjaG1lbnQgZm9yIHRoaXMgcmVxdWlzaXRpb24gc3RhdHVzJywKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgdGhlIHBoeXNpY2FsIGZpbGUgaWYgZXhpc3RzCiAgICAgICAgaWYgKCRhdHRhY2htZW50LT5maWxlX2xvY2F0aW9uICYmIGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRhdHRhY2htZW50LT5maWxlX2xvY2F0aW9uKSkpIHsKICAgICAgICAgICAgdW5saW5rKHB1YmxpY19wYXRoKCRhdHRhY2htZW50LT5maWxlX2xvY2F0aW9uKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgdGhlIERCIHJlY29yZAogICAgICAgICRhdHRhY2htZW50LT5kZWxldGUoKTsKCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdBdHRhY2htZW50IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JywKICAgICAgICBdKTsKICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3lJdGVtKFJlcXVpc2l0aW9uSXRlbSAkaXRlbSkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSAkaXRlbS0+cmVxdWlzaXRpb247CiAgICAgICAgICAgICRpdGVtLT5kZWxldGUoKTsKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+aXRlbXMtPmNvdW50KCkgPCAxKSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPmRlbGV0ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRyZXF1aXNpdGlvbi0+aXRlbXMtPmNvdW50KCkpOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3LgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXNlckhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgJHJvdyA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY29zdF9jZW50cmUnLCAnY29zdF9jZW50cmUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fZGF0ZScsICdyZXF1aXNpdGlvbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncHJvZHVjdF9jYXRlZ29yeScsICdwcm9kdWN0X2NhdGVnb3J5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fYnknLCAncmVxdWlzaXRpb25fYnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhdHRhY2htZW50JywgJ2F0dGFjaG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzYWxlYWJsZScsICdzYWxlYWJsZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdzdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydmaW5hbmNlX2FwcHJvdmFsJywgJ2ZpbmFuY2VfYXBwcm92YWwnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXQogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRyb3c7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJlcXVpc2l0aW9uTGlzdFZpZXcoKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygncmVzZW5kJykpIHsKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCdyZXF1aXNpdGlvbl9pZCcpKTsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCA9ICdyZXNlbnQnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiUmVxdWlzaXRpb24gaGFzIGJlZW4gcmVzZW50IHRvIGZpbmFuY2UgZm9yIGFwcHJvdmFsIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdjb21tZW50cycpKSB7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbnMuY29tbWVudHMnLCBbCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb24nID0+IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCdyZXF1aXNpdGlvbl9pZCcpKQogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkdGl0bGUgPSAnVXNlciBSZXF1aXNpdGlvbiBMaXN0JzsKICAgICAgICAgICAgJHN0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdzdGF0dXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSA6IC0xOwogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogbnVsbDsKICAgICAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IG51bGw7CiAgICAgICAgICAgICRjYXRlZ29yeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjYXRlZ29yeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NhdGVnb3J5X2lkJykgOiAwOwo7ICAgICAgICAgICAgJGF1dGhvcl9pZCA9IHJlcXVlc3QoKS0+aGFzKCdhdXRob3JfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdhdXRob3JfaWQnKSA6IDA7CgogICAgICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdkZXBhcnRtZW50c0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkaW5jbHVkZVVzZXJzID0gaW5jbHVkZVVzZXJzKCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25Vc2VyTGlzdHMgPSBSZXF1aXNpdGlvbjo6d2hlcmVJbignYXV0aG9yX2lkJywgJGluY2x1ZGVVc2VycykKICAgICAgICAgICAgICAgIC0+am9pbigndXNlcnMnLCAndXNlcnMuaWQnLCAnPScsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAtPmdldChbJ3VzZXJzLmlkJywgJ3VzZXJzLm5hbWUnXSk7CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1JlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvblVzZXJMaXN0cycgPT4gJHJlcXVpc2l0aW9uVXNlckxpc3RzLAogICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG8sCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkc3RhdHVzLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkY2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAnYXV0aG9yX2lkJyA9PiAkYXV0aG9yX2lkLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT51c2VySGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF07CgogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmUnLAogICAgICAgICAgICAgICAgJ2l0ZW1zJywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdhdXRob3JfaWQnLCAkaW5jbHVkZVVzZXJzKQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkZnJvbSkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJz49JywgJGZyb20pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJHRvKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJHN0YXR1cyA+PSAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRzdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJywgJHN0YXR1cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRhdXRob3JfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRhdXRob3JfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXV0aG9yX2lkJywgJGF1dGhvcl9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRjYXRlZ29yeV9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkY2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ3N0YXR1cycsIFszXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3Bhc3NlZCcsICdubycpOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHJlcXVpc2l0aW9ucykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRyZXF1aXNpdGlvbi0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVuaXQ6OnNlbGVjdCgnaHJfdW5pdC5ocl91bml0X3Nob3J0X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2hyX3VuaXQuaHJfdW5pdF9pZCcsICdyZXF1aXNpdGlvbnMuaHJfdW5pdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29zdF9jZW50cmUnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcmVxdWlzaXRpb24tPmNvc3RDZW50cmUgPyAkcmVxdWlzaXRpb24tPmNvc3RDZW50cmUtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb3N0X2NlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb3N0Q2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2Nvc3RfY2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3JkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3N0Q2VudHJlOjpzZWxlY3QoJ2Nvc3RfY2VudHJlcy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjb3N0X2NlbnRyZXMuaWQnLCAncmVxdWlzaXRpb25zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzYWxlYWJsZScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjd29yZHMoJHJlcXVpc2l0aW9uLT5zYWxlYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgY2xhc3M9ImJ0biBidG4tbGluayByZXF1aXNpdGlvbiBtLTEgcm91bmRlZCBzaG93UmVxdWlzdGlvbkRldGFpbHMiIG9uY2xpY2s9InJlcXVpc3Rpb25EZXRhaWxzKCQodGhpcykpIj4nIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVxdWlzaXRpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRyZXF1aXNpdGlvbi0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwcm9kdWN0cycsICdwcm9kdWN0cy5pZCcsICc9JywgJ3JlcXVpc2l0aW9uX2l0ZW1zLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtcy5yZXF1aXNpdGlvbl9pZCcsICdyZXF1aXNpdGlvbnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXI6OnNlbGVjdCgnbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudCkgJiYgZmlsZV9leGlzdHMocHVibGljX3BhdGgoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0YWNobWVudCAuPSAnPGEgaHJlZj0iJyAuIHVybCgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1wcmltYXJ5Ij48aSBjbGFzcz0ibGFzIGxhLXBhcGVyY2xpcCI+PC9pPkF0dGFjaG1lbnQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGF0dGFjaG1lbnQ7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3N0YXR1cycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9ICcnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+c3RhdHVzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxzcGFuIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj5QZW5kaW5nPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAxKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiPkFja25vd2xlZGdlPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIj5IYWx0PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPC9wPic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdHVzOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2ZpbmFuY2VfYXBwcm92YWwnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbCA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5fYXJyYXkoJHJlcXVpc2l0aW9uLT5pc19maW5hbmNlX2FwcHJvdmFsLCBbJ3BlbmRpbmcnLCAncmVzZW50J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj4nIC4gdWN3b3JkcygkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwpIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5pc19maW5hbmNlX2FwcHJvdmFsID09ICdhcHByb3ZlZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbCAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiPicgLiB1Y3dvcmRzKCRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCkgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwgPT0gJ2RlbmllZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbCAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciIgb25jbGljaz0ic2hvd0NvbW1lbnRzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciPicgLiB1Y3dvcmRzKCRyZXF1aXNpdGlvbi0+aXNfZmluYW5jZV9hcHByb3ZhbCkgLiAnPC9hPjxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIiBvbmNsaWNrPSJyZXNlbmRGb3JGaW5hbmNlQXBwcm92YWwoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkcmVxdWlzaXRpb24tPmlkIC4gJyI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjayI+PC9pPiZuYnNwO1Jlc2VuZDwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXBwcm92YWw7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuIGlkPSJzdGF0dXNOYW1lJyAuICR2YWx1ZXMtPmlkIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWVsbGlwc2lzLXYiPjwvaT48L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPmlzX3NlbmRfdG9fcmZwID09ICdubycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5zdGF0dXMgIT0gMCAmJiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdwZW5kaW5nJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gUGVuZGluZyIgY2xhc3M9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4iIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIG9uY2xpY2s9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4oJCh0aGlzKSkiICBkYXRhLWRhdGE9InBlbmRpbmciIGRhdGEtc3RhdHVzPSIwIj48aSBjbGFzcz0ibGEgbGEtcGF1c2UiPjwvaT4mbmJzcDtQZW5kaW5nPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24ucmVxdWlzaXRpb24uZWRpdCcsICR2YWx1ZXMtPmlkKSAuICc/cmVkaXJlY3Q9bGlzdC12aWV3JmVkaXRvcj1ib3NzIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBFZGl0Ij48aSBjbGFzcz0ibGEgbGEtZWRpdCI+PC9pPiZuYnNwO0VkaXQ8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5zdGF0dXMgIT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdyZXF1aXNpdGlvbi1hY2tub3dsZWRnZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBBY2tub3dsZWRnZSIgY2xhc3M9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4iIG9uY2xpY2s9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4oJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGRhdGEtZGF0YT0iYWNrbm93bGVkZ2VkIiBkYXRhLXN0YXR1cz0iMSI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+Jm5ic3A7QWNrbm93bGVkZ2U8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSAmJiAkdmFsdWVzLT5pc19wYXNzZWQgPT0gJ25vJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJTZW5kIHRvIE1hbmFnZW1lbnQiIGNsYXNzPSJyZXF1aXNpdGlvbkFwcHJvdmVkQnRuIiBvbmNsaWNrPSJzZW5kVG9NYW5hZ2VtZW50KCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24ucmVxdWlzaXRpb25zLnNlbmRUb01hbmFnZW1lbnQnKSAuICciIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1wYXBlci1wbGFuZSI+PC9pPiZuYnNwO1NlbmQgdG8gTWFuYWdlbWVudDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2hhbHQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5zdGF0dXMgIT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gSGFsdCIgY2xhc3M9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4iIG9uY2xpY2s9InJlcXVpc2l0aW9uQXBwcm92ZWRCdG4oJCh0aGlzKSkiIGRhdGEtZGF0YT0iaGFsdCIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgZGF0YS1zdGF0dXM9IjIiPjxpIGNsYXNzPSJsYSBsYS1iYW4iPjwvaT4mbmJzcDtIYWx0PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3NlbmQtdG8tcmZwJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgY2xhc3M9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zZW5kLnRvLnB1cmNoYXNlLmRlcGFydG1lbnQnKSAuICciIG9uY2xpY2s9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCgkKHRoaXMpKSIgIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciICB0aXRsZT0iU2VuZCBUbyBwcm9jdXJlbWVudCI+Jm5ic3A7U2VuZCBUbyBQcm9jdXJlbWVudDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iVHJhY2sgUHJvZ3Jlc3MiCiAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzIiBvbmNsaWNrPSJ0cmFja1JlcXVpc2l0aW9uUHJvZ3Jlc3MoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1tYXAiPjwvaT5UcmFjayBQcm9ncmVzczwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24uaGlzdG9yeScsICR2YWx1ZXMtPmlkKSAuICciPjxpIGNsYXNzPSJsYSBsYS1oaXN0b3J5IiB0aXRsZT0iUmVxdWlzaXRpb24gSGlzdG9yeSI+PC9pPiZuYnNwO1JlcXVpc2l0aW9uIEhpc3Rvcnk8L2E+PC9saTwvYT48L2xpPic7CgoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3N0YXR1cycsICdmaW5hbmNlX2FwcHJvdmFsJywgJ2F0dGFjaG1lbnQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi1saXN0LWluZGV4JywgJGRhdGEpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIGZ1bmN0aW9uIG5lZWR0b2tlZXAoKQogICAgewogICAgICAgICRyZXF1aXN0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aGVuKGlzc2V0KEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAwKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAkcmVxdWlzdGlvbl9kYXRhID0gW107CiAgICAgICAgZm9yZWFjaCAoJHJlcXVpc3Rpb25zIGFzICRyZXF1aXN0aW9uKSB7CiAgICAgICAgICAgICR0cCA9IDA7CiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1aXN0aW9uLT5pdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgJHRwICs9ICgkaXRlbS0+cHJvZHVjdC0+dW5pdF9wcmljZSAqICRpdGVtLT5xdHkpOwogICAgICAgICAgICB9OwogICAgICAgICAgICAkcmVxdWlzdGlvbi0+dG90YWxfcHJpY2UgPSAkdHA7CiAgICAgICAgICAgIGZvcmVhY2ggKEF1dGg6OnVzZXIoKS0+cmVsQXBwcm92YWxSYW5nZSBhcyAkcmFuZ2UpIHsKICAgICAgICAgICAgICAgIGlmICgkcmFuZ2UtPm1pbl9hbW91bnQgPD0gJHJlcXVpc3Rpb24tPnRvdGFsX3ByaWNlICYmICRyYW5nZS0+bWF4X2Ftb3VudCA+PSAkcmVxdWlzdGlvbi0+dG90YWxfcHJpY2UpIHsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzdGlvbl9kYXRhW10gPSAkcmVxdWlzdGlvbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPnBhZ2luYXRlKCRyZXF1aXN0aW9uX2RhdGEsIDMwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcuCiAgICAgKiBDaGFuZ2UgcmVxdWlzaXRpb24gc3RhdHVzIChBcHByb3ZlIGFuZCByZWplY3RlZCkKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxKc29uUmVzcG9uc2UKICAgICAqLwoKCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFsdFJlcXVpc2l0aW9uU3RhdHVzKFJlcXVlc3RzXFBtc1xSZXF1aXNpdGlvblJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CgogICAgICAgIC8vRmluZCByZXF1aXNpdGlvbgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy9JZiB5b3UgZmluZCwgdGhlbiB1cGRhdGUKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT51cGRhdGUoWwogICAgICAgICAgICAgICAgJ2FkbWluX3JlbWFyaycgPT4gJHJlcXVlc3QtPmFkbWluX3JlbWFyaywKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDIsCiAgICAgICAgICAgICAgICAnaXNfcGFzc2VkJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJyksCiAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmxpc3Qudmlldy5zaG93JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIiBkYXRhLXRpdGxlPSJSZXF1aXNpdGlvbiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRyZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIC4gJy4gRGVwYXJ0bWVudCBIZWFkIEhhbHQgVGhpcyBSZXF1aXNpdGlvbi4uPC9zcGFuPic7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIFskcmVxdWlzaXRpb24tPmF1dGhvcl9pZF0sICdyZXF1aXNpdGlvbicpOwoKICAgICAgICAgICAgLy9SZXF1aXNpdGlvbiB0cmFja2luZyBmdW5jdGlvbiBjYWxsCiAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAnaGFsdCcsICRyZXF1ZXN0LT5hZG1pbl9yZW1hcmspOwogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAvL0lmIHN1Y2Nlc3MgdGhlbiByZXR1cm4gd2l0aCBzdWNjZXNzIG1lc3NhZ2UKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJ1JlcXVpc2l0aW9uIFN1Y2Nlc3NmdWxseSBIYWx0Jyk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3dUcmFja2luZyhSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aXRoKCdyZXF1aXNpdGlvblRyYWNraW5nJyktPmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKCiAgICAgICAgICAgICRoaXN0b3JpZXMgPSBSZXF1aXNpdGlvblN0YWdlSGlzdG9yeTo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVlc3QtPmlkKQogICAgICAgICAgICAgICAgLT53aXRoKCdjcmVhdGVkQnknKQogICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdzdGFnZV91cGRhdGVkX2F0JywgJ2FzYycpCiAgICAgICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ3N0YWdlJykKICAgICAgICAgICAgICAgIC0+bWFwKGZ1bmN0aW9uICgkZ3JvdXApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdyb3VwLT5zb3J0QnlEZXNjKCdzdGFnZV91cGRhdGVkX2F0JyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT52YWx1ZXMoKTsKCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdyZXN1bHQnID0+ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgICdib2R5JyA9PiBWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbnMudHJhY2tpbmcnLCBbCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uJyA9PiAkcmVxdWlzaXRpb24sCiAgICAgICAgICAgICAgICAgICAgJ2hpc3RvcmllcycgPT4gJGhpc3RvcmllcwogICAgICAgICAgICAgICAgXSktPnJlbmRlcigpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdyZXN1bHQnID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICB9CiAgICB9CgoKICAgIHB1YmxpYyBmdW5jdGlvbiBub3RpZmljYXRpb25IZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2RhdGUnLCAnY3JlYXRlZF9hdCcsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoxNSUnXSwKICAgICAgICAgICAgWydtZXNzYWdlcycsICdtZXNzYWdlcycsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydzdGF0dXMnLCAndHlwZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBub3RpZmljYXRpb25BbGwoKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkdGl0bGUgPSAiTm90aWZpY2F0aW9uIjsKICAgICAgICAgICAgJG5vdGlmaWNhdGlvbiA9IE5vdGlmaWNhdGlvbjo6d2hlcmUoJ3VzZXJfaWQnLCBcYXV0aCgpLT51c2VyKCktPmlkKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkdW5yZWFkTm90aWZpY2F0aW9uID0gTm90aWZpY2F0aW9uOjp3aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCktPndoZXJlKCd0eXBlJywgJ3VucmVhZCcpLT5jb3VudCgpOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJG5vdGlmaWNhdGlvbikKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+Y3JlYXRlZF9hdCkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdjcmVhdGVkX2F0JywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8cCBpZD0idHlwZScgLiAkdmFsdWVzLT5pZCAuICciIGNsYXNzPSJ0eXBlIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnR5cGUgPT0gJ3JlYWQnKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3MiPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj48L2k+PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4td2FybmluZyI+PGkgY2xhc3M9ImxhcyBsYS1pbmJveCI+PC9pPjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8L3A+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJzxwIGlkPSJhY3Rpb24nIC4gJHZhbHVlcy0+aWQgLiAnIiBjbGFzcz0iYWN0aW9uIj4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+dHlwZSA9PSAndW5yZWFkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3RhdHVzTmFtZScgLiAkdmFsdWVzLT5pZCAuICciPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJsYSBsYS1lbGxpcHNpcy12Ij48L2k+PC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9Im1hcmtBc1JlYWQiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIG9uY2xpY2s9Im1hcmtBc1JlYWQoJCh0aGlzKSkiIHRpdGxlPSJNYXJrIEFzIFJlYWQiPjxpIGNsYXNzPSJsYSBsYS1jaGVjayI+PC9pPiBNYXJrIEFzIFJlYWQ8L2E+PC9saT48L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnQWxyZWFkeSBSZWFkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC9wPic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZXNjYXBlQ29sdW1ucyhbXSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydtZXNzYWdlcycsICdzdGF0dXMnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5ub3RpZmljYXRpb24tbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ3VucmVhZE5vdGlmaWNhdGlvbicgPT4gJHVucmVhZE5vdGlmaWNhdGlvbiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+bm90aWZpY2F0aW9uSGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBtYXJrQXNSZWFkKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgLy9GaW5kIG5vdGlmaWNhdGlvbgogICAgICAgICRub3RpZmljYXRpb24gPSBOb3RpZmljYXRpb246OndoZXJlKCdpZCcsICRyZXF1ZXN0LT5pZCktPmZpcnN0KCk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmIChpc3NldCgkbm90aWZpY2F0aW9uKSkgewogICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+dHlwZSA9ICdyZWFkJzsKICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnJlYWRfYXQgPSBkYXRlKCdZLW0tZCBoOmk6cycpOwogICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgUmVhZCBOb3RpZmljYXRpb24nOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWyd0b3RhbF9ub3RpZmljYXRpb24nXSA9IE5vdGlmaWNhdGlvbjo6d2hlcmUoJ3R5cGUnLCAndW5yZWFkJyktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKS0+d2hlbihpc3NldChBdXRoOjp1c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2VyLmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSktPmNvdW50KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ05vIE5vdGlmaWNhdGlvbiBGb3VuZCc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3RvdGFsX25vdGlmaWNhdGlvbiddID0gTm90aWZpY2F0aW9uOjp3aGVyZSgndHlwZScsICd1bnJlYWQnKS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpLT53aGVuKGlzc2V0KEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXIuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgQXV0aDo6dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KS0+Y291bnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gbWFya0FzUmVhZEFsbChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICAkbm90aWZpY2F0aW9ucyA9IE5vdGlmaWNhdGlvbjo6d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpLT53aGVyZSgndHlwZScsICd1bnJlYWQnKS0+Z2V0KCk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmIChjb3VudCgkbm90aWZpY2F0aW9ucykgPiAwKSB7CgogICAgICAgICAgICAgICAgZm9yZWFjaCAoJG5vdGlmaWNhdGlvbnMgYXMgJG5vdGlmaWNhdGlvbikgewogICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbjo6d2hlcmUoJ2lkJywgJG5vdGlmaWNhdGlvbi0+aWQpLT51cGRhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIFsndHlwZScgPT4gJ3JlYWQnLCAncmVhZF9hdCcgPT4gZGF0ZSgnWS1tLWQgaDppOnMnKV0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBSZWFkIE5vdGlmaWNhdGlvbic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3RvdGFsX25vdGlmaWNhdGlvbiddID0gTm90aWZpY2F0aW9uOjp3aGVyZSgndHlwZScsICd1bnJlYWQnKS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpLT53aGVuKGlzc2V0KEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXIuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgQXV0aDo6dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KS0+Y291bnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnTm8gTm90aWZpY2F0aW9uIEZvdW5kJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsndG90YWxfbm90aWZpY2F0aW9uJ10gPSBOb3RpZmljYXRpb246OndoZXJlKCd0eXBlJywgJ3VucmVhZCcpLT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCktPndoZW4oaXNzZXQoQXV0aDo6dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlci5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCBBdXRoOjp1c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pLT5jb3VudCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CgogICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAkdGgtPmdldE1lc3NhZ2UoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRIZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZWxpdmVyZWRfcmVmX25vJywgJ2RlbGl2ZXJlZF9yZWZfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZWxpdmVyeV9kYXRlJywgJ2RlbGl2ZXJ5X2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjYXRlZ29yeScsICdjYXRlZ29yeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0JywgJ3Byb2R1Y3QnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZWxpdmVyeV9xdHknLCAnZGVsaXZlcnlfcXR5JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoxNSUnXQogICAgICAgICk7CgogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxpdmVyZWRSZXF1aXNpdGlvbkxpc3QoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRzdGF0dXMgPSByZXF1ZXN0KCktPmhhcygnc3RhdHVzJykgPyByZXF1ZXN0KCktPmdldCgnc3RhdHVzJykgOiAnJzsKCiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBudWxsOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogbnVsbDsKICAgICAgICAgICAgJGNhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CgogICAgICAgICAgICAkY2F0ZWdvcnlJZHMgPSBDYXRlZ29yeURlcGFydG1lbnQ6OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9KS0+cGx1Y2soJ2NhdGVnb3J5X2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkY2F0ZWdvcnlJZHMpCiAgICAgICAgICAgICAgICAtPmdldChbJ2lkJywgJ25hbWUnLCAnY29kZSddKTsKCiAgICAgICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLml0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkZnJvbSkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgnZGVsaXZlcnlfZGF0ZScsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCR0bykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdkZWxpdmVyeV9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRzdGF0dXMpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRzdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJywgJHN0YXR1cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRjYXRlZ29yeV9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24uaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRjYXRlZ29yeV9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eShyZXF1ZXN0KCktPmdldCgnc2VhcmNoX3RleHQnKSksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gcmVxdWVzdCgpLT5nZXQoJ3NlYXJjaF90ZXh0JykgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJGRlbGl2ZXJlZFJlcXVpc2l0aW9uKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmxpc3Qudmlldy5zaG93JywgJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPmlkKSAuICciICBjbGFzcz0iYnRuIGJ0bi1saW5rIHJlcXVpc2l0aW9uIG0tMSByb3VuZGVkIHNob3dSZXF1aXN0aW9uRGV0YWlscyIgb25jbGljaz0ic2hvd1JlcXVpc3Rpb25EZXRhaWxzKCQodGhpcykpIj4nIC4gKGlzc2V0KCR2YWx1ZXMtPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8pID8gJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyA6ICcnKSAuICc8L2E+PC90ZD4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpID8gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVmZXJlbmNlX25vKSA/ICR2YWx1ZXMtPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlZmVyZW5jZV9ubyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyeV9kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPmRlbGl2ZXJ5X2RhdGUpID8gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+ZGVsaXZlcnlfZGF0ZSkpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkdmFsdWVzLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdWJfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cHJvZHVjdC0+Y2F0ZWdvcnktPm5hbWUpID8gJHZhbHVlcy0+cHJvZHVjdC0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdWJfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJvZHVjdC5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5wcm9kdWN0LT5uYW1lKSA/ICR2YWx1ZXMtPnByb2R1Y3QtPm5hbWUgLiAnICcgLiBnZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkdmFsdWVzLT5wcm9kdWN0KSAuICcgJyAuIGdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCR2YWx1ZXMtPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5pdGVtcy0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkdmFsdWVzLT5wcm9kdWN0X2lkKS0+Zmlyc3QoKSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3Byb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdkZWxpdmVyeV9xdHknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyX2Zvcm1hdCgkdmFsdWVzLT5kZWxpdmVyeV9xdHksIDApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICc8cCBpZD0iYWN0aW9uJyAuICR2YWx1ZXMtPmlkIC4gJyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnN0YXR1cyA9PSAncGVuZGluZycgfHwgJHZhbHVlcy0+c3RhdHVzID09ICdkZWxpdmVyZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InN0YXR1c05hbWUnIC4gJHZhbHVlcy0+aWQgLiAnIj4nIC4gdWNmaXJzdCgkdmFsdWVzLT5zdGF0dXMpIC4gJyA8aSBjbGFzcz0ibGEgbGEtZWxsaXBzaXMtdiI+PC9pPjwvc3Bhbj48L2J1dHRvbj48dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPjxsaSBpZD0iaGlkZUJ0bicgLiAkdmFsdWVzLT5pZCAuICciPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0iZGVsaXZlcmVkQWNrbm93bGVkZ2UoJCh0aGlzKSkiIGNsYXNzPSJkZWxpdmVyZWRBY2tub3dsZWRnZSIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgdGl0bGU9IkFja25vd2xlZGdlZCI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+QWNrbm93bGVkZ2VkPC9hPjwvbGk+PC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJ0Fja25vd2xlZGdlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3Byb2R1Y3QnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdEZWxpdmVyZCBSZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdzdGF0dXNzJyA9PiBbJ3BlbmRpbmcnLCAnYWNrbm93bGVkZ2UnLCAnZGVsaXZlcmVkJ10sCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdjYXRlZ29yaWVzJyA9PiAkY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+ZEhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbi1kZWxpdmVyeS5kZWxpdmVyZWQtcmVxdWlzaXRpb24tbGlzdCcsICRkYXRhKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkUmVxdWlzaXRpb25BY2soUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKCiAgICAgICAgJHJlc3BvbnNlID0gW107CgogICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOjp3aGVuKGlzc2V0KEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgQXV0aDo6dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pLT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzc2V0KCRkZWxpdmVyZWRSZXF1aXNpdGlvbikpIHsKCiAgICAgICAgICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24tPnN0YXR1cyA9ICdhY2tub3dsZWRnZSc7CiAgICAgICAgICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IEFja25vd2xlZGdlZC4nOwoKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbklkID0gJGRlbGl2ZXJlZFJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+aWQ7CiAgICAgICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uSWQpIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ2Fja25vd2xlZGdlZF9ieV9yZXF1aXNpdG9yJywgJ1JlcXVpc2l0aW9uIEFja25vd2xlZGdlZCBieSBSZXF1aXNpdG9yJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRkZWxpdmVyZWRSZXF1aXNpdGlvbi0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPmlkLCAncmVjZWl2ZWQnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnTm8gRGF0YSBGb3VuZCc7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewoKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxpdmVyZWRSZXF1aXNpdGlvblNlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICAkZnJvbURhdGUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvRGF0ZSA9IGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CgogICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwoKICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbTo6d2hlbihpc3NldChBdXRoOjp1c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIEF1dGg6OnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkc3RhdHVzLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRzdGF0dXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdGF0dXMnLCAkc3RhdHVzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRmcm9tRGF0ZSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbURhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbURhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPj0nLCAkZnJvbURhdGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkdG9EYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b0RhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG9EYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdkZWxpdmVyeV9kYXRlJywgJzw9JywgJHRvRGF0ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsICdERVNDJykKICAgICAgICAgICAgLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb3VudCgkZGVsaXZlcmVkUmVxdWlzaXRpb24pID4gMCkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBWaWV3OjptYWtlKAogICAgICAgICAgICAgICAgICAgICdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbi1kZWxpdmVyeS5kZWxpdmVyZWQtcmVxdWlzaXRpb24tc2VhcmNoJywKICAgICAgICAgICAgICAgICAgICBbJ2RlbGl2ZXJlZFJlcXVpc2l0aW9uJyA9PiAkZGVsaXZlcmVkUmVxdWlzaXRpb25dCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGNvbnRlbnRzID0gJGJvZHktPnJlbmRlcigpOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdObyBEYXRhIEZvdW5kISEnOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKCiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBoaXN0b3J5KCRpZCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHRpdGxlID0gIlJlcXVpc2l0aW9uIEhpc3RvcnkiOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb25zOjp3aGVyZSgncmVxdWlzaXRpb25faWQnLCAkaWQpLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgJHByb3Bvc2FscyA9ICgkcmVxdWlzaXRpb24tPnJlbFJlcXVlc3RQcm9wb3NhbCkgPyAkcmVxdWlzaXRpb24tPnJlbFJlcXVlc3RQcm9wb3NhbCA6ICcnOwoKICAgICAgICAgICAgICAgIGlmICgkcHJvcG9zYWxzICYmIGNvdW50KCRwcm9wb3NhbHMtPnJlbFF1b3RhdGlvbnMpID4gMCkgewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZSA9ICRwcm9wb3NhbHMtPnJlbFF1b3RhdGlvbnMoKS0+d2l0aCgncmVsUHVyY2hhc2VPcmRlcicpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gaXNzZXQoJHB1cmNoYXNlKSA/ICghZW1wdHkoJHB1cmNoYXNlLT5yZWxQdXJjaGFzZU9yZGVyKSA/ICRwdXJjaGFzZS0+cmVsUHVyY2hhc2VPcmRlciA6ICcnKSA6ICcnOwoKICAgICAgICAgICAgICAgIGlmICgkcHVyY2hhc2VPcmRlcikgewogICAgICAgICAgICAgICAgICAgICRiaWxsTWFuYWdlID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgICAgICAgICAncmVsUG9BdHRhY2htZW50JwogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpZCcsICRwdXJjaGFzZU9yZGVyLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkYmlsbE1hbmFnZSA9ICcnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZnAucmZwLWhpc3RvcnknLCBjb21wYWN0KCd0aXRsZScsICdwdXJjaGFzZU9yZGVyJywgJ3Byb3Bvc2FscycsICdiaWxsTWFuYWdlJykpOwogICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZSgnaWQnLCAkaWQpLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbnMuaGlzdG9yeScsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uJykpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVzZW5kUmVxdWlzaXRpb25Mb2dTdG9yZSgkcmVxdWlzaXRpb24pCiAgICB7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIC8vVGFzayBCdWRnZXQgVmFsaWRhdGlvbgogICAgICAgICAgICAkcHJvamVjdFRhc2tJZCA9IGlzc2V0KCRyZXF1aXNpdGlvbi0+cHJvamVjdF90YXNrX2lkKSA/ICRyZXF1aXNpdGlvbi0+cHJvamVjdF90YXNrX2lkIDogbnVsbDsKICAgICAgICAgICAgJHByb2plY3RUYXNrID0gUHJvamVjdFRhc2s6OmZpbmQoJHByb2plY3RUYXNrSWQpOwogICAgICAgICAgICBpZiAoaXNzZXQoJHByb2plY3RUYXNrLT5pZCkpIHsKICAgICAgICAgICAgICAgICRjb25zdW1wdGlvbnMgPSAwOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRwcm9qZWN0VGFzay0+cmVxdWlzaXRpb25zWzBdKSkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRwcm9qZWN0VGFzay0+cmVxdWlzaXRpb25zIGFzICRrZXkgPT4gJHRoaXNfcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnN1bXB0aW9ucyArPSBlc3RpbWF0ZWRWYWx1ZSgkdGhpc19yZXF1aXNpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uQ29uc3VtcHRpb24gPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uLT5pdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkNvbnN1bXB0aW9uICs9IFByb2R1Y3Q6OmZpbmQoJGl0ZW0tPnByb2R1Y3RfaWQpLT51bml0X3ByaWNlICogJGl0ZW0tPnF0eTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkY29uc3VtcHRpb25zICs9ICRyZXF1aXNpdGlvbkNvbnN1bXB0aW9uOwogICAgICAgICAgICAgICAgaWYgKCRjb25zdW1wdGlvbnMgPiAkcHJvamVjdFRhc2stPnN1YkRlbGl2ZXJhYmxlLT5idWRnZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdQcm9qZWN0IEJ1ZGdldCBhbGxvY2F0aW9uICgnIC4gJHByb2plY3RUYXNrLT5idWRnZXQgLiAnIEJEVCkgaGFzIGJlZW4gZXhjZWVkZWQgZm9yIHRoaXMgcmVxdWlzaXRpb24gKCcgLiAkcmVxdWlzaXRpb25Db25zdW1wdGlvbiAuICcgQkRUKS4gUmVtYWluaW5nIEJ1ZGdldCBpcyAoJyAuICgkcHJvamVjdFRhc2stPnN1YkRlbGl2ZXJhYmxlLT5idWRnZXQgPiAkY29uc3VtcHRpb25zID8gJHByb2plY3RUYXNrLT5zdWJEZWxpdmVyYWJsZS0+YnVkZ2V0IC0gJGNvbnN1bXB0aW9ucyA6IDApIC4gJyBCRFQpJwogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vVGFzayBCdWRnZXQgVmFsaWRhdGlvbgoKICAgICAgICAgICAgJHJlc2VuZExvZ1JlcXVpc2l0aW9uID0gUmVxdWlzaXRpb25Mb2c6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1aXNpdGlvbi0+aWQsCiAgICAgICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9kYXRlJyA9PiAkcmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUsCiAgICAgICAgICAgICAgICAnYXV0aG9yX2lkJyA9PiAkcmVxdWlzaXRpb24tPmF1dGhvcl9pZCwKICAgICAgICAgICAgICAgICdkZWxpdmVyYWJsZV9pZCcgPT4gaXNzZXQoJHJlcXVpc2l0aW9uLT5kZWxpdmVyYWJsZV9pZCkgPyAkcmVxdWlzaXRpb24tPmRlbGl2ZXJhYmxlX2lkIDogbnVsbCwKICAgICAgICAgICAgICAgICdwcm9qZWN0X3Rhc2tfaWQnID0+IGlzc2V0KCRyZXF1aXNpdGlvbi0+cHJvamVjdF90YXNrX2lkKSA/ICRyZXF1aXNpdGlvbi0+cHJvamVjdF90YXNrX2lkIDogbnVsbCwKICAgICAgICAgICAgICAgICdwcm9qZWN0X2lkJyA9PiBpc3NldCgkcmVxdWlzaXRpb24tPnByb2plY3RfaWQpID8gJHJlcXVpc2l0aW9uLT5wcm9qZWN0X2lkIDogbnVsbCwKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiBpc3NldCgkcmVxdWlzaXRpb24tPmhyX3VuaXRfaWQpID8gJHJlcXVpc2l0aW9uLT5ocl91bml0X2lkIDogbnVsbCwKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gaXNzZXQoJHJlcXVpc2l0aW9uLT5jb3N0X2NlbnRyZV9pZCkgPyAkcmVxdWlzaXRpb24tPmNvc3RfY2VudHJlX2lkIDogbnVsbCwKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbicgPT4gJHJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbiwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDIsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+ICRyZXF1aXNpdGlvbi0+YXBwcm92ZWRfaWQsCiAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICRyZXF1aXNpdGlvbi0+aXNfc2VuZF90b19yZnAsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAkcmVxdWlzaXRpb24tPmRlbGl2ZXJ5X3N0YXR1cywKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3N0YXR1cycgPT4gJHJlcXVpc2l0aW9uLT5yZXF1ZXN0X3N0YXR1cywKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJHJlcXVpc2l0aW9uLT5pc19wb19nZW5lcmF0ZSwKICAgICAgICAgICAgICAgICdleHBsYW5hdGlvbnMnID0+ICRyZXF1aXNpdGlvbi0+ZXhwbGFuYXRpb25zLAogICAgICAgICAgICAgICAgJ3JlbWFya3MnID0+ICRyZXF1aXNpdGlvbi0+cmVtYXJrcywKICAgICAgICAgICAgICAgICdkZWxpdmVyeV9ub3RlJyA9PiAkcmVxdWlzaXRpb24tPmRlbGl2ZXJ5X25vdGUsCiAgICAgICAgICAgICAgICAnYWRtaW5fcmVtYXJrJyA9PiAkcmVxdWlzaXRpb24tPmFkbWluX3JlbWFyaywKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSB7CiAgICAgICAgICAgICAgICAkcmVzZW5kTG9nUmVxdWlzaXRpb24tPmF0dGFjaG1lbnQgPSAkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQ7CiAgICAgICAgICAgICAgICAkcmVzZW5kTG9nUmVxdWlzaXRpb24tPnNhdmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uLT5pdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbUlucHV0W10gPSBbCiAgICAgICAgICAgICAgICAgICAgJ3VpZCcgPT4gJGl0ZW0tPnVpZCwKICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25fbG9nX2lkJyA9PiAkcmVzZW5kTG9nUmVxdWlzaXRpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkaXRlbS0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkaXRlbS0+cXR5LAogICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9xdHknID0+ICRpdGVtLT5yZXF1aXNpdGlvbl9xdHksCiAgICAgICAgICAgICAgICAgICAgJ2RlbGl2ZXJ5X3F0eScgPT4gJGl0ZW0tPmRlbGl2ZXJ5X3F0eSwKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2VfcXR5JyA9PiAkaXRlbS0+cHVyY2hhc2VfcXR5LAogICAgICAgICAgICAgICAgICAgICdxY19xdHknID0+ICRpdGVtLT5xY19xdHksCiAgICAgICAgICAgICAgICAgICAgJ2NvbW1lbnQnID0+ICRpdGVtLT5jb21tZW50LAogICAgICAgICAgICAgICAgICAgICdpc19zZW5kJyA9PiAkaXRlbS0+aXNfc2VuZCwKICAgICAgICAgICAgICAgICAgICAncG9fZ2VuZXJhdGUnID0+ICRpdGVtLT5wb19nZW5lcmF0ZSwKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCcgPT4gJGl0ZW0tPmNyZWF0ZWRfYXQsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtTG9nOjppbnNlcnQoJHJlcXVpc2l0aW9uSXRlbUlucHV0KTsKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtICRpZAogICAgICogQHBhcmFtICRyZXF1aXNpdGlvbkxvZ3MKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcQ29udHJhY3RzXEZvdW5kYXRpb25cQXBwbGljYXRpb258XElsbHVtaW5hdGVcQ29udHJhY3RzXFZpZXdcRmFjdG9yeXxcSWxsdW1pbmF0ZVxDb250cmFjdHNcVmlld1xWaWV3fFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBsb2dIZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhdHRhY2htZW50JywgJ2F0dGFjaG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhZG1pbl9yZW1hcmsnLCAnYWRtaW5fcmVtYXJrJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3RhdHVzJywgJ3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRyb3c7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtICRpZAogICAgICogQHBhcmFtICRyZXF1aXNpdGlvbkxvZ3MKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcQ29udHJhY3RzXEZvdW5kYXRpb25cQXBwbGljYXRpb258XElsbHVtaW5hdGVcQ29udHJhY3RzXFZpZXdcRmFjdG9yeXxcSWxsdW1pbmF0ZVxDb250cmFjdHNcVmlld1xWaWV3fFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBsb2dIaXN0b3J5KCRpZCkKICAgIHsKICAgICAgICAkdGl0bGUgPSAnUmVxdWlzaXRpb24gTG9nIEhpc3RvcnknOwogICAgICAgICRyZXF1aXNpdGlvbkxvZ3MgPSBSZXF1aXNpdGlvbkxvZzo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJGlkKS0+d2l0aChbJ3JlcXVpc2l0aW9uSXRlbUxvZ3MnXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB0cnkgewoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHJlcXVpc2l0aW9uTG9ncykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtc3JjPSInIC4gcm91dGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Btcy5yZXF1aXNpdGlvbi5oaXN0b3J5LnZpZXcuc2hvdycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAuICciIGNsYXNzPSJidG4gYnRuLWxpbmsgcmVxdWlzaXRpb24gbS0xIHJvdW5kZWQgc2hvd1JlcXVpc3Rpb25EZXRhaWxzIiBvbmNsaWNrPSJyZXF1aXN0aW9uRGV0YWlscygkKHRoaXMpKSI+JyAuICRyZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZXF1aXNpdGlvbl9kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbkl0ZW1Mb2dzWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbkl0ZW1Mb2dzWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uSXRlbUxvZ3MucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3JkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW1Mb2c6OnNlbGVjdCgnbWFpbl9jYXRlZ29yeS5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbV9sb2dzLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtX2xvZ3MucmVxdWlzaXRpb25fbG9nX2lkJywgJ3JlcXVpc2l0aW9uX2xvZ3MuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHAgaWQ9InN0YXR1cycgLiAkcmVxdWlzaXRpb24tPmlkIC4gJyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+c3RhdHVzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxzcGFuIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj5QZW5kaW5nPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAxKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiPkFwcHJvdmVkPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIj5IYWx0PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyI+RHJhZnQ8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8L3A+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudCkgJiYgZmlsZV9leGlzdHMocHVibGljX3BhdGgoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0YWNobWVudCAuPSAnPGEgaHJlZj0iJyAuIHVybCgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1wcmltYXJ5Ij48aSBjbGFzcz0ibGFzIGxhLXBhcGVyY2xpcCI+PC9pPkF0dGFjaG1lbnQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhdHRhY2htZW50OwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3N0YXR1cycsICdhdHRhY2htZW50J10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLmxvZ0hpc3RvcnknLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+bG9nSGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93TG9nUmVxdWlzaXRpb25JdGVtcygkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gJ1JlcXVpc2l0aW9uIExvZyBJdGVtcyBTaG93JzsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb25Mb2c6OndpdGgoWwogICAgICAgICAgICAgICAgJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlLnByb2plY3QnLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uSXRlbUxvZ3MucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtTG9ncy5wcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1Mb2dzLnByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1Mb2dzLnByb2R1Y3QucmVsSW52ZW50b3J5U3VtbWFyeScsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLmxvY2F0aW9uJywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoCiAgICAgICAgICAgICAgICAncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLmxvZ1Nob3cnLAogICAgICAgICAgICAgICAgWydyZXF1aXNpdGlvbicgPT4gJHJlcXVpc2l0aW9uLCAndGl0bGUnID0+ICR0aXRsZV0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgJGNvbnRlbnRzID0gJGJvZHktPnJlbmRlcigpOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCd2aWV3JykpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudHM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRjb250ZW50cyk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwbG9hZEV4Y2VsKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2NhdGVnb3J5JyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZXhjZWxfZmlsZScgPT4gJ3JlcXVpcmVkfG1pbWVzOnhscyx4bHN4JwogICAgICAgIF0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkcGF0aCA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdleGNlbF9maWxlJyksICd1cGxvYWQvdXBsb2FkLWV4Y2VscycpOwogICAgICAgICAgICAkc2hlZXRzID0gRXhjZWw6OnRvQXJyYXkobmV3IFJlcXVpc2l0aW9uSW1wb3J0LCBwdWJsaWNfcGF0aCgkcGF0aCkpOwogICAgICAgICAgICAkdGhpcy0+ZmlsZURlbGV0ZSgkcGF0aCk7CgogICAgICAgICAgICAkcHJvZHVjdHMgPSBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdwcm9kdWN0VW5pdCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWVzdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwYXJlbnRfaWQnLCAkcmVxdWVzdC0+Y2F0ZWdvcnkpOwogICAgICAgICAgICAgICAgfSktPmdldCgpOwoKICAgICAgICAgICAgJGl0ZW1zID0gW107CiAgICAgICAgICAgIGlmIChpc3NldCgkc2hlZXRzWzBdWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHNoZWV0c1swXSBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkcHJvZHVjdHMtPndoZXJlKCdza3UnLCAkdmFsdWVbJ3Byb2R1Y3Rfc2t1J10pLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdCA9ICRwcm9kdWN0cy0+d2hlcmUoJ3NrdScsICR2YWx1ZVsncHJvZHVjdF9za3UnXSktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRwcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncXVhbnRpdHknID0+ICR2YWx1ZVsncXVhbnRpdHknXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1b20nID0+ICRwcm9kdWN0LT5wcm9kdWN0VW5pdC0+dW5pdF9uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2Vzc2lvbigpLT5wdXQoJ3JlcXVpc2l0aW9uLWl0ZW1zJywgWwogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkcmVxdWVzdC0+Y2F0ZWdvcnksCiAgICAgICAgICAgICAgICAnaXRlbXMnID0+ICRpdGVtcwogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIkV4Y2VsIGZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5ICYgSXRlbXMgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHJlcXVpc2lvbiBmb3JtLiIpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRSZXF1aXNpdGlvblRvTWFuYWdlbWVudChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2hlcmUoWydpZCcgPT4gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkLCAnaXNfcGFzc2VkJyA9PiAnbm8nXSktPmZpcnN0KCk7CgogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPmlzX3Bhc3NlZCA9ICd5ZXMnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5wYXNzZWRfYnkgPSBcYXV0aCgpLT51c2VyKCktPmlkOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgLy9TZXQgTm90aWZpY2F0aW9uCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucmVxdWlzaXRpb24ubGlzdC52aWV3LnNob3cnLCAkcmVxdWlzaXRpb24tPmlkKSAuICciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnLiBXYXR0aW5nIGZvciBhcHByb3ZhbC48L3NwYW4+JzsKCiAgICAgICAgICAgICAgICAkcmVjZWl2ZXJzID0gW107CiAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlY2VpdmVycyA9IGdldE1hbmFnZXJJbmZvKCdNYW5hZ2VtZW50JywgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgJHJlY2VpdmVyX3NsdWcgPSAnc2VuZC10by1tYW5hZ2VtZW50JzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb24tPmlkLCAnZGhfc2VuZF90b19tbmcnLCAnRGVwYXJ0bWVudCBIZWFkIFNlbmQgdG8gTWFuYWdlbWVudCcpOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsICRyZWNlaXZlcnMsICRyZWNlaXZlcl9zbHVnKTsKICAgICAgICAgICAgICAgIC8vQ29tbWl0IGRhdGEKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IFNlbmQgdG8gTWFuYWdlbWVudCEhJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnRGF0YSBub3QgZm91bmQuISEnOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgLy9JZiBwcm9jZXNzIGhhcyBhbnkgcHJvYmxlbSB0aGVuIHJvbGxiYWNrIHRoZSBkYXRhCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAkdGgtPmdldE1lc3NhZ2UoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBhc3NlZFJlcXVpc2l0aW9ucygpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdVc2VyIFBhc3NlZCBSZXF1aXNpdGlvbiBMaXN0JzsKICAgICAgICAgICAgJHN0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdzdGF0dXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSA6IC0xOwogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogZGF0ZSgnWS1tLTAxJyk7CiAgICAgICAgICAgICR0byA9IHJlcXVlc3QoKS0+aGFzKCd0bycpID8gcmVxdWVzdCgpLT5nZXQoJ3RvJykgOiBkYXRlKCdZLW0tdCcpOwogICAgICAgICAgICAkY2F0ZWdvcnlfaWQgPSByZXF1ZXN0KCktPmhhcygnY2F0ZWdvcnlfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjYXRlZ29yeV9pZCcpIDogMDsKICAgICAgICAgICAgJGF1dGhvcl9pZCA9IHJlcXVlc3QoKS0+aGFzKCdhdXRob3JfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdhdXRob3JfaWQnKSA6IDA7CgogICAgICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdkZXBhcnRtZW50c0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICRyZXF1aXNpdGlvblVzZXJMaXN0cyA9IFJlcXVpc2l0aW9uOjp3aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5qb2luKCd1c2VycycsICd1c2Vycy5pZCcsICc9JywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgIC0+Z2V0KFsndXNlcnMuaWQnLCAndXNlcnMubmFtZSddKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnUmVxdWlzaXRpb24nLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uVXNlckxpc3RzJyA9PiAkcmVxdWlzaXRpb25Vc2VyTGlzdHMsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICRzdGF0dXMsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdhdXRob3JfaWQnID0+ICRhdXRob3JfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnVzZXJIZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2l0aChbJ2l0ZW1zJywgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCAncmVsVXNlcnNMaXN0JywgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0J10pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJGZyb20pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCR0bykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRzdGF0dXMgPj0gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICRzdGF0dXMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkYXV0aG9yX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYXV0aG9yX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsICRhdXRob3JfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY2F0ZWdvcnlfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdzdGF0dXMnLCBbM10pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19wYXNzZWQnLCAneWVzJyk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmxpc3Qudmlldy5zaG93JywgJHJlcXVpc2l0aW9uLT5pZCkgLiAnIiBjbGFzcz0iYnRuIGJ0bi1saW5rIHJlcXVpc2l0aW9uIG0tMSByb3VuZGVkIHNob3dSZXF1aXN0aW9uRGV0YWlscyIgb25jbGljaz0icmVxdWlzdGlvbkRldGFpbHMoJCh0aGlzKSkiPicgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZXF1aXNpdGlvbl9kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKSA/ICRyZXF1aXNpdGlvbi0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3JkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW06OnNlbGVjdCgnbWFpbl9jYXRlZ29yeS5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIHN1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnkuaWQnLCAnPScsICdwcm9kdWN0cy5jYXRlZ29yeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIG1haW5fY2F0ZWdvcnknLCAnbWFpbl9jYXRlZ29yeS5pZCcsICc9JywgJ3N1Yl9jYXRlZ29yeS5wYXJlbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+bmFtZSkgPyAkcmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlcjo6c2VsZWN0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUpID8gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXEFwcFxVc2VyOjpzZWxlY3QoJ2hyX3VuaXQuaHJfdW5pdF9zaG9ydF9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfdW5pdCcsICdocl91bml0LmhyX3VuaXRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhdHRhY2htZW50ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1B1cmNoYXNlLURlcGFydG1lbnQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVxdWlzaXRpb24tPmF0dGFjaG1lbnQpICYmIGZpbGVfZXhpc3RzKHB1YmxpY19wYXRoKCRyZXF1aXNpdGlvbi0+YXR0YWNobWVudCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dGFjaG1lbnQgLj0gJzxhIGhyZWY9IicgLiB1cmwoJHJlcXVpc2l0aW9uLT5hdHRhY2htZW50KSAuICciIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSI+PGkgY2xhc3M9ImxhcyBsYS1wYXBlcmNsaXAiPjwvaT5BdHRhY2htZW50PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhdHRhY2htZW50OwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdzdGF0dXMnLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49ICc8c3BhbiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyI+UGVuZGluZzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzxzcGFuIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIj5BY2tub3dsZWRnZTwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5zdGF0dXMgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSAnPHNwYW4gY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciI+SGFsdDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0gJzwvcD4nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXR1czsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4gaWQ9InN0YXR1c05hbWUnIC4gJHZhbHVlcy0+aWQgLiAnIj48aSBjbGFzcz0ibGEgbGEtZWxsaXBzaXMtdiI+PC9pPjwvc3Bhbj48L2J1dHRvbj48dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+aXNfc2VuZF90b19yZnAgPT0gJ25vJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnN0YXR1cyAhPSAwICYmIGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3BlbmRpbmcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBQZW5kaW5nIiBjbGFzcz0icmVxdWlzaXRpb25BcHByb3ZlZEJ0biIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgb25jbGljaz0icmVxdWlzaXRpb25BcHByb3ZlZEJ0bigkKHRoaXMpKSIgIGRhdGEtZGF0YT0icGVuZGluZyIgZGF0YS1zdGF0dXM9IjAiPjxpIGNsYXNzPSJsYSBsYS1wYXVzZSI+PC9pPlBlbmRpbmc8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbi5lZGl0JywgJHZhbHVlcy0+aWQpIC4gJz9yZWRpcmVjdD1wYXNzZWQtcmVxdWlzaXRpb24tYXBwcm92YWwmZWRpdG9yPW1hbmFnZW1lbnQiIHRpdGxlPSJDbGljayBIZXJlIFRvIEVkaXQiPjxpIGNsYXNzPSJsYSBsYS1lZGl0Ij48L2k+RWRpdDwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnN0YXR1cyAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3JlcXVpc2l0aW9uLWFja25vd2xlZGdlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJDbGljayBIZXJlIFRvIEFja25vd2xlZGdlIiBjbGFzcz0icmVxdWlzaXRpb25BcHByb3ZlZEJ0biIgb25jbGljaz0icmVxdWlzaXRpb25BcHByb3ZlZEJ0bigkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgZGF0YS1kYXRhPSJhY2tub3dsZWRnZWQiIGRhdGEtc3RhdHVzPSIxIj48aSBjbGFzcz0ibGEgbGEtY2hlY2siPjwvaT5BY2tub3dsZWRnZTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdoYWx0JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+c3RhdHVzICE9IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJDbGljayBIZXJlIFRvIEhhbHQiIGNsYXNzPSJyZXF1aXNpdGlvbkFwcHJvdmVkQnRuIiBvbmNsaWNrPSJyZXF1aXNpdGlvbkFwcHJvdmVkQnRuKCQodGhpcykpIiBkYXRhLWRhdGE9ImhhbHQiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIGRhdGEtc3RhdHVzPSIyIj48aSBjbGFzcz0ibGEgbGEtYmFuIj48L2k+SGFsdDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNraW5nIFJlcXVpc2l0aW9uIiBjbGFzcz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzIiBvbmNsaWNrPSJ0cmFja1JlcXVpc2l0aW9uUHJvZ3Jlc3MoJyAuICR2YWx1ZXMtPmlkIC4gJykiID48aSBjbGFzcz0ibGEgbGEtbWFwIj48L2k+VHJhY2sgUHJvZ3Jlc3M8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmhpc3RvcnknLCAkdmFsdWVzLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtaGlzdG9yeSIgdGl0bGU9IlJlcXVpc2l0aW9uIEhpc3RvcnkiPjwvaT5SZXF1aXNpdGlvbiBIaXN0b3J5PC9hPjwvbGk8L2E+PC9saT4nOwoKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsICdzdGF0dXMnLCAnYXR0YWNobWVudCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLnBhc3NlZC1yZXF1aXNpdGlvbi1pbmRleCcsICRkYXRhKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiB0b2dnbGVSZXF1aXNpdGlvblN0YXR1cyhSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7ICAvLyBTdGFydCB0cmFuc2FjdGlvbgoKICAgICAgICB0cnkgewogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmlkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgIGlmICghJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnRGF0YSBub3QgZm91bmQhJwogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRuZXdTdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwogICAgICAgICAgICAkbmV3VGV4dCA9ICRuZXdTdGF0dXMgPT0gMSA/ICdBY2tub3dsZWRnZScgOiAoKCRuZXdTdGF0dXMgPT0gMikgPyAnSGFsdCcgOiAnUGVuZGluZycpOwogICAgICAgICAgICAkbmV3QXBwcm92ZWQgPSAkbmV3U3RhdHVzID09IDEgPyAxIDogKCgkbmV3U3RhdHVzID09IDIpID8gMSA6IG51bGwpOwogICAgICAgICAgICAkbmV3TWVzc2FnZSA9ICR0aGlzLT5nZXRSZXF1aXNpdGlvbk1lc3NhZ2UoJG5ld1N0YXR1cywgJHJlcXVpc2l0aW9uKTsKCiAgICAgICAgICAgIC8vIFdoZW4gcmVzZW5kIHJlcXVpc2l0aW9uCiAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPnN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbigpLT5nZXQoJ3N5c3RlbS1pbmZvcm1hdGlvbicpWydyZXNlbmRfbGltaXQnXSA+ICRyZXF1aXNpdGlvbi0+cmVzZW5kX2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHJlc2VuZCBjb3VudAogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aW5jcmVtZW50KCdyZXNlbmRfY291bnQnKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVzZW5kUmVxdWlzaXRpb25Mb2dTdG9yZSgkcmVxdWlzaXRpb24pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdTb3JyeSEuWW91ciByZXNlbmQgbGltaXQgaXMgb3Zlci4gUGxlYXNlIGdlbmVyYXRlIGEgbmV3IHJlcXVpc2l0aW9uJwogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBVcGRhdGUgcmVxdWlzaXRpb24gc3RhdHVzCiAgICAgICAgICAgICR1cGRhdGUgPSAkcmVxdWlzaXRpb24tPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAkbmV3U3RhdHVzLAogICAgICAgICAgICAgICAgJ2lzX2ZpbmFuY2VfYXBwcm92YWwnID0+ICdwZW5kaW5nJywKICAgICAgICAgICAgICAgICdpc19wYXNzZWQnID0+ICdubycsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+ICRuZXdBcHByb3ZlZCwKICAgICAgICAgICAgICAgICdhZG1pbl9yZW1hcmsnID0+ICRyZXF1ZXN0LT5hZG1pbl9yZW1hcmssCiAgICAgICAgICAgICAgICAnYXBwcm92ZXJfZGF0ZScgPT4gbm93KCksCiAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gbm93KCksCiAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZiAoISR1cGRhdGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBcRXhjZXB0aW9uKCdGYWlsZWQgdG8gdXBkYXRlIHJlcXVpc2l0aW9uLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkc3RhZ2UgPSAnJzsKICAgICAgICAgICAgJG5vdGUgPSAnJzsKCiAgICAgICAgICAgICR1c2VyID0gYXV0aCgpLT51c2VyKCk7CiAgICAgICAgICAgICRyb2xlID0gJHVzZXItPnJvbGVzLT5maXJzdCgpLT5uYW1lID8/ICdTeXN0ZW0nOwoKICAgICAgICAgICAgaWYgKCRuZXdTdGF0dXMgPT0gMCkgewogICAgICAgICAgICAgICAgLy8gU2VuZGluZyBmb3J3YXJkCiAgICAgICAgICAgICAgICBpZiAoJHJvbGUgPT0gJ0RlcGFydG1lbnQtSGVhZCcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnc2VudF90b19zYnVfaGVhZCc7CiAgICAgICAgICAgICAgICAgICAgJG5vdGUgPSAnU2VudCB0byBTQlUgSGVhZCBmb3IgYXBwcm92YWwnOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRyb2xlID09ICdNYW5hZ2VtZW50JykgewogICAgICAgICAgICAgICAgICAgICRzdGFnZSA9ICdzZW50X3RvX21hbmFnZW1lbnQnOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gJ1NlbnQgdG8gTWFuYWdlbWVudCBmb3IgYXBwcm92YWwnOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRyb2xlID09ICdBY2NvdW50cycpIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnc2VudF90b19zdG9yZSc7CiAgICAgICAgICAgICAgICAgICAgJG5vdGUgPSAnU2VudCB0byBTdG9yZSBmb3IgcHJvY2Vzc2luZyc7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJvbGUgPT0gJ1N0b3JlLU1hbmFnZXInKSB7CiAgICAgICAgICAgICAgICAgICAgJHN0YWdlID0gJ3NlbnRfdG9fcHVyY2hhc2UnOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gJ1NlbnQgdG8gUHVyY2hhc2UgRGVwYXJ0bWVudCc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRzdGFnZSA9ICdzZW50X3RvX2RlcGFydG1lbnRfaGVhZCc7CiAgICAgICAgICAgICAgICAgICAgJG5vdGUgPSAnU2VudCB0byBEZXBhcnRtZW50IEhlYWQgZm9yIGFwcHJvdmFsJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKCRuZXdTdGF0dXMgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gQXBwcm92YWwgbG9naWMKICAgICAgICAgICAgICAgIGlmICgkcm9sZSA9PSAnQWNjb3VudHMnKSB7CiAgICAgICAgICAgICAgICAgICAgJHN0YWdlID0gJ2FwcHJvdmVkX2J5X2ZpbmFuY2UnOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gJ0FwcHJvdmVkIGJ5IEZpbmFuY2UgYW5kIFNlbmQgdG8gU3RvcmUgRGVwYXJ0bWVudCc7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJvbGUgPT0gJ0RlcGFydG1lbnQtSGVhZCcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnYXBwcm92ZWRfYnlfZGVwYXJ0bWVudF9oZWFkJzsKICAgICAgICAgICAgICAgICAgICAkbm90ZSA9ICdBcHByb3ZlZCBieSBEZXBhcnRtZW50IEhlYWQnOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRyb2xlID09ICdNYW5hZ2VtZW50JykgewogICAgICAgICAgICAgICAgICAgICRzdGFnZSA9ICdhcHByb3ZlZF9ieV9tYW5hZ2VtZW50JzsKICAgICAgICAgICAgICAgICAgICAkbm90ZSA9ICdBcHByb3ZlZCBieSBNYW5hZ2VtZW50JzsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcm9sZSA9PSAnU3RvcmUtTWFuYWdlcicpIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnYXBwcm92ZWRfYnlfc3RvcmUnOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gJ0FwcHJvdmVkIGJ5IFN0b3JlJzsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcm9sZSA9PSAnUHVyY2hhc2UtRGVwYXJ0bWVudCcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnYXBwcm92ZWRfYnlfcHVyY2hhc2UnOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gJ0FwcHJvdmVkIGJ5IFB1cmNoYXNlIERlcGFydG1lbnQnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnYXBwcm92ZWRfYnlfJyAuIHN0cnRvbG93ZXIoc3RyX3JlcGxhY2UoWycgJywgJy0nXSwgJ18nLCAkcm9sZSkpOwogICAgICAgICAgICAgICAgICAgICRub3RlID0gIkFwcHJvdmVkIGJ5IHskcm9sZX0iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJG5ld1N0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICAkc3RhZ2UgPSAnaGFsdGVkJzsKICAgICAgICAgICAgICAgICRub3RlID0gJ1JlcXVpc2l0aW9uIGhhcyBiZWVuIGhhbHRlZCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlcXVpc2l0aW9uVHJhY2tpbmdIaXN0b3J5KAogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5pZCwKICAgICAgICAgICAgICAgICRzdGFnZSwKICAgICAgICAgICAgICAgICRub3RlCiAgICAgICAgICAgICk7CgoKICAgICAgICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIHN0YXR1cyBjYXNlcwogICAgICAgICAgICAkdGhpcy0+aGFuZGxlU3RhdHVzQ2hhbmdlKCRuZXdTdGF0dXMsICRyZXF1aXNpdGlvbiwgJG5ld1RleHQpOwoKICAgICAgICAgICAgLy8gQ29tbWl0IHRoZSB0cmFuc2FjdGlvbiBpZiBldmVyeXRoaW5nIHdlbnQgd2VsbAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkbmV3TWVzc2FnZSwKICAgICAgICAgICAgICAgICduZXdfdGV4dCcgPT4gJG5ld1RleHQKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICBEQjo6cm9sbEJhY2soKTsgIC8vIFJvbGxiYWNrIHRyYW5zYWN0aW9uIGlmIHNvbWV0aGluZyBnb2VzIHdyb25nCgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1NvbWV0aGluZyB3ZW50IHdyb25nISAnIC4gJGUtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBtZXNzYWdlIGJhc2VkIG9uIHJlcXVpc2l0aW9uIHN0YXR1cy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICRzdGF0dXMKICAgICAqIEBwYXJhbSBSZXF1aXNpdGlvbiAkcmVxdWlzaXRpb24KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0UmVxdWlzaXRpb25NZXNzYWdlKCRzdGF0dXMsICRyZXF1aXNpdGlvbikKICAgIHsKICAgICAgICBpZiAoJHN0YXR1cyA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgVG8gQWNrbm93bGVkZ2VtZW50JzsKICAgICAgICB9IGVsc2VpZiAoJHN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgIHJldHVybiAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgVG8gSGFsdCc7CiAgICAgICAgfSBlbHNlaWYgKCRzdGF0dXMgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gJ1N1Y2Nlc3NmdWxseSBTZW5kIHRvICcgLiAkdGhpcy0+Z2V0UmVxdWlzaXRpb25TZW5kVG8oJHJlcXVpc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgVG8gUGVuZGluZyc7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFwcHJvcHJpYXRlIG1lc3NhZ2UgZm9yIHRoZSBzZW5kLXRvIGFjdGlvbiBiYXNlZCBvbiB0aGUgdXNlcidzIHJvbGUuCiAgICAgKgogICAgICogQHBhcmFtIFJlcXVpc2l0aW9uICRyZXF1aXNpdGlvbgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBnZXRSZXF1aXNpdGlvblNlbmRUbygkcmVxdWlzaXRpb24pCiAgICB7CiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSkgewogICAgICAgICAgICByZXR1cm4gJ1NCVSBoZWFkJzsKICAgICAgICB9CgogICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU0JVIEhlYWQnKSkgewogICAgICAgICAgICByZXR1cm4gJ01hbmFnZW1lbnQnOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICdEZXBhcnRtZW50IGhlYWQnOwogICAgfQoKICAgIC8qKgogICAgICogSGFuZGxlIHN0YXR1cyBjaGFuZ2Ugbm90aWZpY2F0aW9ucyBhbmQgYWN0aW9ucy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICRzdGF0dXMKICAgICAqIEBwYXJhbSBSZXF1aXNpdGlvbiAkcmVxdWlzaXRpb24KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5ld1RleHQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBoYW5kbGVTdGF0dXNDaGFuZ2UoJHN0YXR1cywgJHJlcXVpc2l0aW9uLCAkbmV3VGV4dCkKICAgIHsKICAgICAgICBpZiAoJHN0YXR1cyA9PSAxKSB7CiAgICAgICAgICAgIC8vIElmIGFwcHJvdmVkLCBzZW5kIHRvIGZpbmFuY2UgZm9yIGFwcHJvdmFsCiAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAnYXBwcm92ZWQnKTsKCiAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gZ2V0TW9kdWxlcygpWydmaW5hbmNlJ10tPnVybCAuICcvcG1zL3N0b3JlLW1hbmFnZS9zdG9yZS1pbnZlbnRvcnktY29tcGFyZS8nIC4gJHJlcXVpc2l0aW9uLT5pZCAuICciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnLiBXYWl0aW5nIGZvciBGaW5hbmNlIEFwcHJvdmFsLjwvc3Bhbj4nOwogICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBbJHJlcXVpc2l0aW9uLT5hc3NpZ25lZF9maW5hbmNlX2lkXSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICB9CgogICAgICAgIGlmICgkc3RhdHVzID09IDApIHsKICAgICAgICAgICAgLy8gSWYgcGVuZGluZywgc2VuZCB0byBhcHByb3ByaWF0ZSByb2xlIChEZXBhcnRtZW50IEhlYWQsIFNCVSBIZWFkLCBvciBNYW5hZ2VtZW50KQogICAgICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHJlcXVpc2l0aW9uLT5pZCwgJ3BlbmRpbmcnKTsKCiAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVxdWlzaXRpb24gUmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIGFwcHJvdmFsLjwvc3Bhbj4nOwoKICAgICAgICAgICAgJHJlY2VpdmVycyA9ICR0aGlzLT5nZXRSZXF1aXNpdGlvblJlY2VpdmVycygkcmVxdWlzaXRpb24pOwogICAgICAgICAgICAkcmVjZWl2ZXJTbHVnID0gJHRoaXMtPmdldFJlcXVpc2l0aW9uUmVjZWl2ZXJTbHVnKCk7CgogICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCAkcmVjZWl2ZXJzLCAkcmVjZWl2ZXJTbHVnKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcmVjZWl2ZXJzIGZvciB0aGUgcmVxdWlzaXRpb24gc3RhdHVzIGJhc2VkIG9uIHJvbGVzLgogICAgICoKICAgICAqIEBwYXJhbSBSZXF1aXNpdGlvbiAkcmVxdWlzaXRpb24KICAgICAqIEByZXR1cm4gaW50CiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0UmVxdWlzaXRpb25SZWNlaXZlcnMoJHJlcXVpc2l0aW9uKQogICAgewogICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykpIHsKICAgICAgICAgICAgcmV0dXJuIGdldE1hbmFnZXJJbmZvKCdTQlUgSGVhZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1NCVSBIZWFkJykpIHsKICAgICAgICAgICAgcmV0dXJuIGdldE1hbmFnZXJJbmZvKCdNYW5hZ2VtZW50JywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBbZ2V0RGVwYXJ0bWVudEhlYWQoJHJlcXVpc2l0aW9uLT5hdXRob3JfaWQpXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgcmVjZWl2ZXIgc2x1ZyBiYXNlZCBvbiB0aGUgdXNlcidzIHJvbGUuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBnZXRSZXF1aXNpdGlvblJlY2VpdmVyU2x1ZygpCiAgICB7CiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSkgewogICAgICAgICAgICByZXR1cm4gJ3NlbmQtdG8tc2J1LWhlYWQnOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdTQlUgSGVhZCcpKSB7CiAgICAgICAgICAgIHJldHVybiAnc2VuZC10by1tYW5hZ2VtZW50JzsKICAgICAgICB9CgogICAgICAgIHJldHVybiAnc2VuZC10by1kZXBhcnRtZW50LWhlYWQnOwogICAgfQoKLy8gICAgcHVibGljIGZ1bmN0aW9uIHNob3dTdGFnZUhpc3RvcnkoJHJlcXVpc2l0aW9uSWQpCi8vICAgIHsKLy8gICAgICAgICRoaXN0b3JpZXMgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25TdGFnZUhpc3Rvcnk6OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbklkKQovLyAgICAgICAgICAgIC0+d2l0aChbJ2NyZWF0ZWRCeSddKQovLyAgICAgICAgICAgIC0+b3JkZXJCeSgnc3RhZ2VfdXBkYXRlZF9hdCcsICdkZXNjJykKLy8gICAgICAgICAgICAtPmdldCgpOwovLwovLyAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy50cmFja2luZycsIGNvbXBhY3QoJ2hpc3RvcmllcycpKTsKLy8gICAgfQp9Cg==