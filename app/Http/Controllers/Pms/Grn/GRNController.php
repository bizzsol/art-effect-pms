<?php
bolt_decrypt( __FILE__ , 'r8JDSu'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEdybjsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUFjdGlvbkNvbnRyb2w7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR29vZHNSZWNlaXZlZEl0ZW1BdHRyaWJ1dGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VSZXR1cm47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVJldHVybkdhdGVPdXQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb247CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgWWFqcmFcRGF0YVRhYmxlc1xGYWNhZGVzXERhdGFUYWJsZXM7CgpjbGFzcyBHUk5Db250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICAkYXJyYXkgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX2RhdGUnLCAnZ2F0ZV9pbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9xdHknLCAnZ2F0ZV9pbl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JlY2VpdmVkX3N0YXR1cycsICdyZWNlaXZlZF9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwoKLy8gICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZScpKSB7Ci8vICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksIFsncXVhbGl0eV9lbnN1cmUnLCAncXVhbGl0eV9lbnN1cmUnXSk7Ci8vICAgICAgICB9CgogICAgICAgIHJldHVybiAkYXJyYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aXRsZSA9ICJHYXRlLUluIExpc3QiOwogICAgICAgICRmcm9tX2RhdGUgPSByZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkgPiAwID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpIDogJyc7CiAgICAgICAgJHRvX2RhdGUgPSByZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSA+IDAgPyByZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpIDogJyc7CiAgICAgICAgJHJlY2VpdmVkX3N0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdyZWNlaXZlZF9zdGF0dXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdyZWNlaXZlZF9zdGF0dXMnKSA6ICcnOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICRnYXRlSW5zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCduYW1lJywgaWdub3JlU3VwcGxpZXJzKCkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uSXRlbXMucHJvZHVjdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbnRfdG9fcmVxdWlzaXRvcicsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpICYmICFhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU3RvcmUtTWFuYWdlcicpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU3RvcmUtTWFuYWdlcicpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdHYXRlIFBlcm1pc3Npb24nKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJyksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGZyb21fZGF0ZSksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb21fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShEQjo6cmF3KCdzdWJzdHIoYHJlY2VpdmVkX2RhdGVgLCAxLCAxMCknKSwgJz49JywgJGZyb21fZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCR0b19kYXRlKSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG9fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShEQjo6cmF3KCdzdWJzdHIoYHJlY2VpdmVkX2RhdGVgLCAxLCAxMCknKSwgJzw9JywgJHRvX2RhdGUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkcmVjZWl2ZWRfc3RhdHVzKSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVjZWl2ZWRfc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZWNlaXZlZF9zdGF0dXMnLCAkcmVjZWl2ZWRfc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdjcmVhdGVkX2F0JywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJGdhdGVJbnMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIGJ0bi14cyIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCkgLiAnIiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj4nIC4gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnJlZmVyZW5jZV9ubycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucG9fZGF0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMtPnBsdWNrKCdyZXF1aXNpdGlvbi5yZWZlcmVuY2Vfbm8nKS0+aW1wbG9kZSgnLCAnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncmVxdWlzaXRpb25zLnJlZmVyZW5jZV9ubycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3JlcXVpc2l0aW9ucycsICdyZXF1aXNpdGlvbnMuaWQnLCAnPScsICdwdXJjaGFzZV9vcmRlcl9yZXF1aXNpdGlvbnMucmVxdWlzaXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwdXJjaGFzZV9vcmRlcl9yZXF1aXNpdGlvbnMnLCAncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zLnB1cmNoYXNlX29yZGVyX2lkJywgJz0nLCAncHVyY2hhc2Vfb3JkZXJzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBzdHlsZT0id2lkdGg6IDEwMCUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogOTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayBidG4teHMiIG9uY2xpY2s9InNob3dHYXRlSW5QT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsICRncm4tPmlkKSAuICciIGRhdGEtdGl0bGU9IkdhdGUgSW4gRGV0YWlscyI+JyAuICRncm4tPnJlZmVyZW5jZV9ubyAuICc8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInIC4gdXJsKCdwbXMvZ3JuL2dhdGUtaW4tc2xpcC8nIC4gJGdybi0+cHVyY2hhc2Vfb3JkZXJfaWQgLiAnP2dybj0nIC4gJGdybi0+aWQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJtYXJnaW4tdG9wOiA3LjVweCI+PGkgY2xhc3M9ImxhIGxhLXByaW50Ij48L2k+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWNlaXZlZF9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlY2VpdmVkX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVjZWl2ZWRfc3RhdHVzJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAncGFydGlhbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAnZnVsbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPicgLiB1Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdWFsaXR5X2Vuc3VyZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRidG5zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zKCktPndoZXJlSW4oJ3F1YWxpdHlfZW5zdXJlJywgWydwZW5kaW5nJ10pLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHFjID0gYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykgPyBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZScpIDogKCRncm4tPmlzX3NlbnRfdG9fcmVxdWlzaXRvciA9PSAnbm8nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnRucyAuPSAnPGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMucXVhbGl0eS5lbnN1cmUuY2hlY2snLCAkZ3JuLT5pZCkgLiAnIiB0aXRsZT0iUXVhbGl0eSBFbnN1cmUiIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrLWNpcmNsZSI+ICcgLiBfXygnUXVhbGl0eSBFbnN1cmUnKSAuICc8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRncm4tPmlzX3NlbnRfdG9fcmVxdWlzaXRvciA9PSAnbm8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ0bnMgLj0gJzxhIHRpdGxlPSJTZW5kIE1haWwiIG9uY2xpY2s9InNlbmRUb1JlcXVpc2l0b3IoJCh0aGlzKSkiIGRhdGEtYWN0aW9uPSInIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCdwbXMuZ3JuLnNlbmQudG8ucmVxdWlzaXRvcicsIFskZ3JuLT5wdXJjaGFzZV9vcmRlcl9pZCwgJGdybi0+aWRdKSAuICciIGNsYXNzPSJidG4gYnRuLWluZm8gYnRuLXhzIG10LTEiPjxpIGNsYXNzPSJsYXMgbGEtcGFwZXItcGxhbmUiPiZuYnNwOyZuYnNwO1NlbmQgdG8gUmVxdWlzaXRvcjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU3VwcGxpZXJSYXRpbmcoJ2dvb2RzX3JlY2VpdmVkX25vdGVzJywgJGdybi0+aWQsICdxYycpICYmIGluX2FycmF5KChpc3NldCgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnR5cGUpID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT50eXBlIDogJycpLCBbJ21hbnVhbCcsICdvbmxpbmUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiB1cmwoJ3Btcy9zdXBwbGllci9yYXRpbmcvJyAuICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQgLiAnLycgLiAkZ3JuLT5pZCkgLiAnP3RhYmxlPWdvb2RzX3JlY2VpdmVkX25vdGVzJmZpZWxkPScgLiAkZ3JuLT5pZCAuICcmdHlwZT1xYyIgY2xhc3M9ImJ0biBidG4taW5mbyBidG4teHMiPlJhdGluZ3M8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGJ0bnM7CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIHRpdGxlPSJTZW5kIE1haWwiIG9uY2xpY2s9InNlbmRNYWlsKCQodGhpcykpIiBkYXRhLWFjdGlvbj0iJyAuIHJvdXRlKCdwbXMuZ3JuLnNlbmQuZ2F0ZS5pbi5zbGlwJywgWyRncm4tPnB1cmNoYXNlX29yZGVyX2lkLCAkZ3JuLT5pZF0pIC4gJyIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj4mbmJzcDsmbmJzcDtTZW5kIE1haWw8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3F1YWxpdHlfZW5zdXJlJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLmluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiR2F0ZS1JbiBMaXN0IiwKICAgICAgICAgICAgICAgICdmcm9tX2RhdGUnID0+ICRmcm9tX2RhdGUsCiAgICAgICAgICAgICAgICAndG9fZGF0ZScgPT4gJHRvX2RhdGUsCiAgICAgICAgICAgICAgICAncmVjZWl2ZWRfc3RhdHVzJyA9PiAkcmVjZWl2ZWRfc3RhdHVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdyblByb2Nlc3NTZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgJGZyb21fZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5mcm9tX2RhdGUpKTsKICAgICAgICAkdG9fZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CiAgICAgICAgJHJlY2VpdmVkX3N0YXR1cyA9ICRyZXF1ZXN0LT5yZWNlaXZlZF9zdGF0dXM7CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywgJ3JlbEdvb2RSZWNlaXZlTm90ZScsICdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJykKICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnR2F0ZSBQZXJtaXNzaW9uJyksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZWNlaXZlZF9zdGF0dXMpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZWNlaXZlZF9zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZWNlaXZlZF9zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfc3RhdHVzJywgJHJlY2VpdmVkX3N0YXR1cyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCAkZnJvbV9kYXRlKQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncG9fZGF0ZScsICc8PScsICR0b19kYXRlKQogICAgICAgICAgICAtPm9yZGVyQnkoJ2lkJywgJ2Rlc2MnKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvdW50KCRwdXJjaGFzZU9yZGVyKSA+IDApIHsKICAgICAgICAgICAgICAgICRib2R5ID0gXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi5ncm4tbGlzdC1zZWFyY2gnLAogICAgICAgICAgICAgICAgICAgIFsncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIsICdyZWNlaXZlZF9zdGF0dXMnID0+ICRyZWNlaXZlZF9zdGF0dXNdKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkY29udGVudHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBvTGlzdEluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgLy8gJHRpdGxlPSIoR2F0ZS1JbikgUHVyY2hhc2UgT3JkZXIgTGlzdCI7CiAgICAgICAgICAgIC8vICRkYXRhID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywncmVsR29vZFJlY2VpdmVOb3RlJywncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycpCiAgICAgICAgICAgIC8vICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmIHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgIC8vICAgICB9KQogICAgICAgICAgICAvLyAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJyxhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAvLyAgICAgLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKQogICAgICAgICAgICAvLyAgICAgLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgICAgICAvLyBpZiAoY291bnQoJGRhdGEpPjApewogICAgICAgICAgICAvLyAgICAgY2FsY3VsYXRlR3JuUXR5QWdhaW5zdFB1cmNoYXNlT3JkZXIoJGRhdGEpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4ucG8taW5kZXgnLGNvbXBhY3QoJ3RpdGxlJywnZGF0YScpKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICJHYXRlIEluL091dCI7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLnNjYW4nLCBjb21wYWN0KCd0aXRsZScpKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2NhbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICd0eXBlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncG9fcmVmZXJlbmNlJyA9PiAncmVxdWlyZWQnCiAgICAgICAgXSk7CgogICAgICAgIGlmICgkcmVxdWVzdC0+dHlwZSA9PSAiaW4iKSB7CiAgICAgICAgICAgICRvcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uSXRlbXMucHJvZHVjdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoaXNzZXQoJG9yZGVyLT5pZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL2dybi9ncm4tbGlzdC9jcmVhdGUvJyAuICRvcmRlci0+aWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignUHVyY2hhc2Ugb3JkZXIgbm90IGZvdW5kIScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFB1cmNoYXNlT3JkZXJSZXR1cm5zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKTsKICAgICAgICAgICAgfSktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmIChpc3NldCgkb3JkZXItPmlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdwbXMvZ3JuL2dhdGUtb3V0LycgLiAkb3JkZXItPmlkIC4gJz9jb2RlPScgLiAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1JldHVybi9SZXBsYWNlIERhdGEgbm90IGZvdW5kIScpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCRpZCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdVbml0JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUmVjZWl2ZVByb2R1Y3QnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsUXVvdGF0aW9uSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaWQnID0+ICRpZCwKICAgICAgICAgICAgICAgICAgICAnaXNfc2VuZCcgPT4gJ3llcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVlc3RfcHJvcG9zYWxfaWQnLCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKCiAgICAgICAgICAgIGlmICghaXNzZXQoJHB1cmNoYXNlT3JkZXItPmlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoIk5vIEF2YWlsYWJsZSBEYXRhIEZvdW5kISIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY291bnQoJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZSkgPiAwKSB7CiAgICAgICAgICAgICAgICAkZ3JuUXR5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sICRpKSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGdybkl0ZW0sICRrKSB1c2UgKCRpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtWydncm5fcXR5J10gKz0gJGdybkl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3VpZCcsICRpdGVtLT51aWQpLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vcmV0dXJuICRwdXJjaGFzZU9yZGVyOwogICAgICAgICAgICAkZ2F0ZU91dHMgPSBQdXJjaGFzZVJldHVybjo6d2l0aChbCiAgICAgICAgICAgICAgICAnZ2F0ZU91dHMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZE5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGF2YWlsYWJsZSA9IDA7CiAgICAgICAgICAgIGlmIChpc3NldCgkZ2F0ZU91dHNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ2F0ZU91dHMgYXMgJGtleSA9PiAkZ2F0ZU91dCkgewogICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGUgKz0gKCRnYXRlT3V0LT5nYXRlT3V0cy0+c3VtKCdxdHknKSAtICRnYXRlT3V0LT5yZWNlaXZlZF9xdHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJGF2YWlsYWJsZSA8PSAwKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmNoZWNrT3JkZXJRdHlBbmRSZWNlaXZlUXR5KCRwdXJjaGFzZU9yZGVyKTsKICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1JlY2VpdmVkIHF0eSBjYW4gbm90IGJlIGdyZWF0ZXIgdGhhbiBwdXJjaGFzZSBvcmRlciBxdHknKTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVzdWx0ID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnVG90YWwgUHJvZHVjdCAocykgQWxyZWFkeSBSZWNlaXZlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGl0bGUgPSAiR2F0ZS1JbiBSZWNlaXZlIjsKICAgICAgICAgICAgJHByZWZpeCA9ICdHQVRFLUlOLScgLiBkYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKSAuICctJyAuICRwdXJjaGFzZU9yZGVyLT5Vbml0LT5ocl91bml0X3Nob3J0X25hbWUgLiAnLSc7CiAgICAgICAgICAgICRyZWZObyA9IHVuaXF1ZUNvZGUoMjAsICRwcmVmaXgsICdnb29kc19yZWNlaXZlZF9ub3RlcycsICdpZCcpOwogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLmNyZWF0ZScsIGNvbXBhY3QoJ3RpdGxlJywgJ3B1cmNoYXNlT3JkZXInLCAncmVmTm8nLCAnZ2F0ZU91dHMnLCAncmVxdWlzaXRpb25JdGVtcycpKTsKCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja09yZGVyUXR5QW5kUmVjZWl2ZVF0eSgkcHVyY2hhc2VPcmRlcikKICAgIHsKICAgICAgICAkdG90YWxSZWNlaXZlUXR5ID0gMDsKICAgICAgICBmb3JlYWNoICgkcHVyY2hhc2VPcmRlci0+cmVsR29vZFJlY2VpdmVOb3RlIGFzICRncm4pIHsKICAgICAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eSArPSAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgfQogICAgICAgICR0b3RhbE9yZGVyUXR5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICByZXR1cm4gKCR0b3RhbE9yZGVyUXR5IDw9PiAkdG90YWxSZWNlaXZlUXR5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+ICdyZXF1aXJlZHxkYXRlJywKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gInJlcXVpcmVkfHVuaXF1ZTpnb29kc19yZWNlaXZlZF9ub3Rlc3xtYXg6MTAwIiwKICAgICAgICAgICAgJ2NoYWxsYW4nID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2J5JyA9PiAibnVsbGFibGV8bWF4OjIwMCIsCiAgICAgICAgICAgICdub3RlJyA9PiAibnVsbGFibGV8bWF4OjUwMCIsCiAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gInJlcXVpcmVkIiwKICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAicmVxdWlyZWQiLAogICAgICAgICAgICAvLyAnY2hhbGxhbl9maWxlJyA9PiAnaW1hZ2V8bWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8bnVsbGFibGV8bWF4OjUwNDgnLAogICAgICAgIF0pOwoKICAgICAgICBpZiAoIWlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2lkWzBdKSkgewogICAgICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgICAgICdyZXBsYWNlX3F0eScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgICAgICdyZXBsYWNlX3F0eS4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICdyZWxRdW90YXRpb24nLAogICAgICAgICAgICAnVW5pdCcsCgogICAgICAgIF0pLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CgogICAgICAgICRyZXF1aXNpdGlvbkl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aXRoKFsKICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkY2hhbGxhbkZpbGUgPSAnJzsKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdjaGFsbGFuX2ZpbGUnKSkgewogICAgICAgICAgICAgICAgJGNoYWxsYW5GaWxlID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2NoYWxsYW5fZmlsZScpLCAndXBsb2FkL2dybi9jaGFsbGFuLWZpbGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHByZWZpeCA9ICdHUk4tJyAuIGRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpIC4gJy0nIC4gJHB1cmNoYXNlT3JkZXItPlVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSAuICctJzsKICAgICAgICAgICAgJGdyblJlZmVyZW5jZU5vID0gdW5pcXVlQ29kZSgxNiwgJHByZWZpeCwgJ2dvb2RzX3JlY2VpdmVkX25vdGVzJywgJ2lkJyk7CiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkTm90ZSA9IEdvb2RzUmVjZWl2ZWROb3RlOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAkcmVxdWVzdC0+cmVmZXJlbmNlX25vLAogICAgICAgICAgICAgICAgJ2dybl9yZWZlcmVuY2Vfbm8nID0+ICRncm5SZWZlcmVuY2VObywKICAgICAgICAgICAgICAgICdjaGFsbGFuJyA9PiAkcmVxdWVzdC0+Y2hhbGxhbiwKICAgICAgICAgICAgICAgICdjaGFsbGFuX2ZpbGUnID0+ICRjaGFsbGFuRmlsZSwKICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gJHJlcXVlc3QtPnRvdGFsX3ByaWNlLAogICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAkcmVxdWVzdC0+ZGlzY291bnQgPz8gMCwKICAgICAgICAgICAgICAgICd2YXQnID0+ICRyZXF1ZXN0LT52YXQgPz8gMCwKICAgICAgICAgICAgICAgICdncm9zc19wcmljZScgPT4gJHJlcXVlc3QtPmdyb3NzX3ByaWNlLAogICAgICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5yZWNlaXZlZF9kYXRlKSksCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfYnknID0+ICRyZXF1ZXN0LT5kZWxpdmVyeV9ieSwKICAgICAgICAgICAgICAgICdyZWNlaXZlX2J5JyA9PiBcQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICdub3RlICcgPT4gJHJlcXVlc3QtPm5vdGUsCiAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gXEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkZ29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsUmVxdWVzdFByb3Bvc2FsLT5yZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbgogICAgICAgICAgICAgICAgLT5maXJzdCgpLT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbklkKSB7CiAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ2dhdGVfaW4nLCAnUHJvZHVjdCBHYXRlIGluIFN1Y2Nlc3NmdWxseScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZ3JuQXR0cmlidXRlcyA9IFtdOwoKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2lkWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnByb2R1Y3RfaWQgYXMgJGtleSA9PiAkdWlkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5xdHlbJHVpZF0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJlcXVlc3QtPnZhdF90eXBlWyR1aWRdID09ICdpbmNsdXNpdmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfYW1vdW50ID0gKChpc3NldCgkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHVpZF0pID8gJHJlcXVlc3QtPnVuaXRfYW1vdW50WyR1aWRdIDogMCkgLSAoaXNzZXQoJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyR1aWRdKSA/ICRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskdWlkXSA6IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRyZXF1ZXN0LT52YXRfdHlwZVskdWlkXSA9PSAnZXhjbHVzaXZlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2Ftb3VudCA9ICgoaXNzZXQoJHJlcXVlc3QtPnVuaXRfYW1vdW50WyR1aWRdKSA/ICRyZXF1ZXN0LT51bml0X2Ftb3VudFskdWlkXSA6IDApIC0gKGlzc2V0KCRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskdWlkXSkgPyAkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHVpZF0gOiAwKSkgKyAoaXNzZXQoJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHVpZF0pID8gJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHVpZF0gOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9hbW91bnQgPSAoKGlzc2V0KCRyZXF1ZXN0LT51bml0X2Ftb3VudFskdWlkXSkgPyAkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHVpZF0gOiAwKSAtIChpc3NldCgkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHVpZF0pID8gJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyR1aWRdIDogMCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtID0gJHJlcXVpc2l0aW9uSXRlbXMtPndoZXJlKCd1aWQnLCAkdWlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtID0gR29vZHNSZWNlaXZlZEl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1aWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXRfYW1vdW50JyA9PiAkcmVxdWVzdC0+dW5pdF9wcmljZVskdWlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdxdHknID0+ICRyZXF1ZXN0LT5xdHlbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnRfcGVyY2VudGFnZScgPT4gJHJlcXVlc3QtPmRpc2NvdW50X3BlcmNlbnRhZ2VbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskdWlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXRfdHlwZScgPT4gJHJlcXVlc3QtPnZhdF90eXBlWyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdF9wZXJjZW50YWdlJyA9PiAkcmVxdWVzdC0+dmF0X3BlcmNlbnRhZ2VbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkcmVxdWVzdC0+c3ViX3RvdGFsX3ZhdF9wcmljZVskdWlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hbW91bnQnID0+ICR0b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGdvb2RzUmVjZWl2ZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+aWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPmF0dHJpYnV0ZXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uSXRlbS0+YXR0cmlidXRlcyBhcyAkYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGdybkF0dHJpYnV0ZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9pdGVtX2lkJyA9PiAkZ29vZHNSZWNlaXZlZEl0ZW0tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZV9vcHRpb25faWQnID0+ICRhdHRyaWJ1dGUtPmF0dHJpYnV0ZV9vcHRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSAmJiBjb3VudCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpID4gMCkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnJlcGxhY2VfcXR5IGFzICRwdXJjaGFzZV9yZXR1cm5faWQgPT4gJHJlcGxhY2VfcXR5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXBsYWNlX3F0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuID0gUHVyY2hhc2VSZXR1cm46OmZpbmQoJHB1cmNoYXNlX3JldHVybl9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSAkcmVxdWlzaXRpb25JdGVtcy0+d2hlcmUoJ3VpZCcsICR1aWQpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlZEl0ZW0gPSBHb29kc1JlY2VpdmVkSXRlbTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9ub3RlX2lkJyA9PiAkZ29vZHNSZWNlaXZlZE5vdGUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VpZCcgPT4gJHJlcXVpc2l0aW9uSXRlbS0+dWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9hbW91bnQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkcmVwbGFjZV9xdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50X3BlcmNlbnRhZ2UnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0X3BlcmNlbnRhZ2UnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX2Ftb3VudCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZ29vZHNSZWNlaXZlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWlzaXRpb25JdGVtLT5pZCkgJiYgJHJlcXVpc2l0aW9uSXRlbS0+YXR0cmlidXRlcy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb25JdGVtLT5hdHRyaWJ1dGVzIGFzICRhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZ3JuQXR0cmlidXRlcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnID0+ICRnb29kc1JlY2VpdmVkSXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlX29wdGlvbl9pZCcgPT4gJGF0dHJpYnV0ZS0+YXR0cmlidXRlX29wdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNzZXQoJGdybkF0dHJpYnV0ZXNbMF0pKSB7CiAgICAgICAgICAgICAgICBHb29kc1JlY2VpdmVkSXRlbUF0dHJpYnV0ZTo6aW5zZXJ0KCRncm5BdHRyaWJ1dGVzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSAmJiBjb3VudCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpID4gMCkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnJlcGxhY2VfcXR5IGFzICRwdXJjaGFzZV9yZXR1cm5faWQgPT4gJHJlcGxhY2VfcXR5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXBsYWNlX3F0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuID0gUHVyY2hhc2VSZXR1cm46OmZpbmQoJHB1cmNoYXNlX3JldHVybl9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybi0+cmVjZWl2ZWRfcXR5ID0gKCRwdXJjaGFzZVJldHVybi0+cmVjZWl2ZWRfcXR5ICsgJHJlcGxhY2VfcXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5jaGFuZ2VSZWNlaXZlU3RhdHVzKCRyZXF1ZXN0LCAkZ29vZHNSZWNlaXZlZE5vdGUpOwoKICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdSZWNlaXZlZCBxdHkgZ3JlYXRlciB0aGFuIHB1cmNoYXNlIG9yZGVyIHF0eScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCAkZ29vZHNSZWNlaXZlZE5vdGUtPmlkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86JyAuICRnb29kc1JlY2VpdmVkTm90ZS0+cmVmZXJlbmNlX25vIC4gJy4gV2FpdGluZyBmb3IgdGhlIFF1YWxpdHkgRW5zdXJlLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1N0b3JlLU1hbmFnZXInLCAkcHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCwgdHJ1ZSksICdzZW5kLXRvLXN0b3JlJyk7CgoKICAgICAgICAgICAgJGFwcHJvdmVkQnkgPSAkcHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy0+Zmlyc3QoKS0+cmVxdWlzaXRpb24tPmFwcHJvdmVkX2J5ID8/IG51bGw7CiAgICAgICAgICAgIGlmICgkYXBwcm92ZWRCeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCAkYXBwcm92ZWRCeSwgJ3NlbmQtdG8tZGVwYXJ0bWVudC1oZWFkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cmVkaXJlY3RCYWNrV2l0aFN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSBHYXRlIEluIEJ5IEdhdGUgTWFuYWdlci4nLCAncG1zLmdybi5wby5saXN0Jyk7CgogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGFuZ2VSZWNlaXZlU3RhdHVzKCRyZXF1ZXN0LCAkZ29vZHNSZWNlaXZlZE5vdGUpCiAgICB7CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJyktPmZpbmRPckZhaWwoJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkKTsKCiAgICAgICAgJHRvdGFsT3JkZXJRdHkgPSAkcHVyY2hhc2VPcmRlci0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpOwoKICAgICAgICAkZ3JucyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnKQogICAgICAgICAgICAtPndoZXJlSW4oJ3B1cmNoYXNlX29yZGVyX2lkJywgWyRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZF0pLT5nZXQoKTsKCiAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eSA9IDA7CiAgICAgICAgZm9yZWFjaCAoJGdybnMgYXMgJGdybikgewogICAgICAgICAgICAkdG90YWxSZWNlaXZlUXR5ICs9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICB9CgogICAgICAgIGlmICgkdG90YWxPcmRlclF0eSA8ICR0b3RhbFJlY2VpdmVRdHkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0b3RhbE9yZGVyUXR5ID09ICR0b3RhbFJlY2VpdmVRdHkpIHsKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWROb3RlLT51cGRhdGUoWydyZWNlaXZlZF9zdGF0dXMnID0+ICdmdWxsJ10pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtIGludCAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRtb2RhbCA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMuU3VwcGxpZXJSYXRpbmdzJywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgaWYgKCRtb2RhbCkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBcSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMuZ3JuLnNob3cnLAogICAgICAgICAgICAgICAgICAgIFsnZ3JuJyA9PiAkbW9kYWxdKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3ZpZXcnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY29udGVudHM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IEdlbmVyYXRlZCBQTyc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0dSTiBub3QgZm91bmQhISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm5IZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1BPX2RhdGUnLCAnUE9fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlJywgJ3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1BPX3F0eScsICdQT19xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcXR5JywgJ2dhdGVfaW5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlX3N0YXR1cycsICdyZWNlaXZlX3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ29wdGlvbnMnLCAnb3B0aW9ucycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHB1cmNoYXNlT3JkZXJMaXN0QWdhaW5zdEdybigpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXJzQWdhaW5zdEdybiA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVOb3RJbignbmFtZScsIGlnbm9yZVN1cHBsaWVycygpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywgJ3llcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcnNBZ2FpbnN0R3JuKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24gKCRwbykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHBvLT5wb19kYXRlKSA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRwby0+cG9fZGF0ZSkpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHBvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcG8tPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUgLiAnICgnIC4gJHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZSAuICcpJyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHBvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJzaG93UE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHBvLT5pZCkgLiAnIj4nIC4gJHBvLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX3F0eScsIGZ1bmN0aW9uICgkcG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwby0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24gKCRwbykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGVbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sICRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXSA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZWNlaXZlX3N0YXR1cycsIGZ1bmN0aW9uICgkcG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGVbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sICRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXSA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9ncm5fcXR5ID0gJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcG8tPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA9PSAkdG90YWxfZ3JuX3F0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi14cyI+UGFydGlhbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcHRpb25zJywgZnVuY3Rpb24gKCRwbykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiByb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5pbmRleCcpIC4gJycgLiAnP3BvX2lkPScgLiAkcG8tPmlkIC4gJyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIiBkYXRhLXRvZ2dsZT0idG9vbHRpcCIgdGl0bGU9IkNsaWNrIGhlcmUgdG8gR3JuIExpc3QiID4gR2F0ZS1JbignIC4gJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgLiAnKSA8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyIgaHJlZj0iJyAuIHVybCgncG1zL2dybi9nYXRlLWluLXNsaXAvJyAuICRwby0+aWQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlJywgJ3JlY2VpdmVfc3RhdHVzJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLnBvLWxpc3QtYWdhaW5zdC1ncm4nLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJQdXJjaGFzZSBPcmRlciBMaXN0IEFnYWluc3QgR1JOIiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cHVyY2hhc2VPcmRlckxpc3RBZ2FpbnN0R3JuSGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRUb1JlcXVpc2l0b3IoJHBvSWQsICRncm5JZCkKICAgIHsKICAgICAgICAkZ29vZFJlY2VpdmVkTm90ZSA9IEdvb2RzUmVjZWl2ZWROb3RlOjpmaW5kT3JGYWlsKCRncm5JZCk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmICgkZ29vZFJlY2VpdmVkTm90ZSkgewogICAgICAgICAgICAgICAgJGdvb2RSZWNlaXZlZE5vdGUtPmlzX3NlbnRfdG9fcmVxdWlzaXRvciA9ICd5ZXMnOwogICAgICAgICAgICAgICAgJGdvb2RSZWNlaXZlZE5vdGUtPnNhdmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkZ29vZFJlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxSZXF1ZXN0UHJvcG9zYWwtPnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLT5maXJzdCgpLT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbklkKSB7CiAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ3NlbmRfdG9fcmVxdWlzaXRvcicsICdTZW5kIHRvIFJlcXVpc2l0b3IgZm9yIFFDJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1FDIFBlcm1pc3Npb24gaGFzIGJlZW4gc2VuZCB0byByZXF1aXNpdG9yIHN1Y2Nlc3NmdWxseSEnCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbEJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRlLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQp9Cg==