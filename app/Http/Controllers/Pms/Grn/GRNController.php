<?php
bolt_decrypt( __FILE__ , 'RdlBf6'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEdybjsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUFjdGlvbkNvbnRyb2w7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlUmV0dXJuOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VSZXR1cm5HYXRlT3V0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlclJlcXVpc2l0aW9uOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQXV0aDsKdXNlIFlhanJhXERhdGFUYWJsZXNcRmFjYWRlc1xEYXRhVGFibGVzOwoKY2xhc3MgR1JOQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgICRhcnJheSA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnUE9fcmVmZXJlbmNlJywgJ1BPX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1BPX2RhdGUnLCAnUE9fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NoYWxsYW4nLCAnY2hhbGxhbicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9kYXRlJywgJ2dhdGVfaW5fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcXR5JywgJ2dhdGVfaW5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CgogICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3F1YWxpdHktZW5zdXJlJykpewogICAgICAgICAgICBhcnJheV9wdXNoKCRhcnJheSwgWydxdWFsaXR5X2Vuc3VyZScsICdxdWFsaXR5X2Vuc3VyZSddKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkYXJyYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aXRsZSA9ICJHYXRlLUluIExpc3QiOwogICAgICAgICRmcm9tX2RhdGUgPSByZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkgPiAwID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpIDogJyc7CiAgICAgICAgJHRvX2RhdGUgPSByZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSA+IDAgPyByZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpIDogJyc7CiAgICAgICAgJHJlY2VpdmVkX3N0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdyZWNlaXZlZF9zdGF0dXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdyZWNlaXZlZF9zdGF0dXMnKSA6ICcnOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICRnYXRlSW5zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24ucmVxdWlzaXRpb25JdGVtcy5wcm9kdWN0JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VydmljZScsIDApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpICYmICFhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU3RvcmUtTWFuYWdlcicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU3RvcmUtTWFuYWdlcicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnR2F0ZSBQZXJtaXNzaW9uJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkZnJvbV9kYXRlKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGZyb21fZGF0ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoREI6OnJhdygnc3Vic3RyKGByZWNlaXZlZF9kYXRlYCwgMSwgMTApJyksICc+PScsICRmcm9tX2RhdGUpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJHRvX2RhdGUpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdG9fZGF0ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoREI6OnJhdygnc3Vic3RyKGByZWNlaXZlZF9kYXRlYCwgMSwgMTApJyksICc8PScsICR0b19kYXRlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRyZWNlaXZlZF9zdGF0dXMpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVjZWl2ZWRfc3RhdHVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfc3RhdHVzJywgJHJlY2VpdmVkX3N0YXR1cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2NyZWF0ZWRfYXQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRnYXRlSW5zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCkuJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+Jy4kZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucG9fZGF0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwJSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA5MCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIGJ0bi14cyIgb25jbGljaz0ic2hvd0dhdGVJblBPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsJGdybi0+aWQpLiciIGRhdGEtdGl0bGU9IkdhdGUgSW4gRGV0YWlscyI+Jy4kZ3JuLT5yZWZlcmVuY2Vfbm8uJzwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiAxMCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImJ0biBidG4tcHJpbWFyeSBidG4teHMiIGhyZWY9IicuIHVybCgncG1zL2dybi9nYXRlLWluLXNsaXAvJy4kZ3JuLT5wdXJjaGFzZV9vcmRlcl9pZC4nP2dybj0nLiRncm4tPmlkKSAuJyIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJtYXJnaW4tdG9wOiA3LjVweCI+PGkgY2xhc3M9ImxhIGxhLXByaW50Ij48L2k+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlZmVyZW5jZV9ubycsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWNlaXZlZF9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVjZWl2ZWRfZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVjZWl2ZWRfc3RhdHVzJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAncGFydGlhbCcpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi14cyI+UGFydGlhbCBSZWNlaXZlZDwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZWlmKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAnZnVsbCcpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+RnVsbCBSZWNlaXZlZDwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPicudWN3b3JkcygkZ3JuLT5yZWNlaXZlZF9zdGF0dXMpLic8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3F1YWxpdHlfZW5zdXJlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZUluKCdxdWFsaXR5X2Vuc3VyZScsWydwZW5kaW5nJ10pLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZScpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LmVuc3VyZS5jaGVjaycsJGdybi0+aWQpLiciIHRpdGxlPSJRdWFsaXR5IEVuc3VyZSIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj4gJy4gX18oJ1F1YWxpdHkgRW5zdXJlJykuJzwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighaXNTdXBwbGllclJhdGluZygnZ29vZHNfcmVjZWl2ZWRfbm90ZXMnLCRncm4tPmlkLCAncWMnKSAmJiBpbl9hcnJheSgoaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT50eXBlKSA/ICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+dHlwZSA6ICcnKSwgWydtYW51YWwnLCdvbmxpbmUnXSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy51cmwoJ3Btcy9zdXBwbGllci9yYXRpbmcvJy4kZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLicvJy4kZ3JuLT5pZCkuJz90YWJsZT1nb29kc19yZWNlaXZlZF9ub3RlcyZmaWVsZD0nLiRncm4tPmlkLicmdHlwZT1xYyIgY2xhc3M9ImJ0biBidG4taW5mbyBidG4teHMiPlJhdGluZ3M8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0aXRsZT0iU2VuZCBNYWlsIiBvbmNsaWNrPSJzZW5kTWFpbCgkKHRoaXMpKSIgZGF0YS1hY3Rpb249Iicucm91dGUoJ3Btcy5ncm4uc2VuZC5nYXRlLmluLnNsaXAnLFskZ3JuLT5wdXJjaGFzZV9vcmRlcl9pZCwgJGdybi0+aWRdKS4nIiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjay1jaXJjbGUiPiZuYnNwOyZuYnNwO1NlbmQgTWFpbDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ1BPX3JlZmVyZW5jZScsICdnYXRlX2luX3JlZmVyZW5jZScsICdyZWNlaXZlZF9zdGF0dXMnLCAncXVhbGl0eV9lbnN1cmUnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+dG9Kc29uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4uaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJHYXRlLUluIExpc3QiLAogICAgICAgICAgICAgICAgJ2Zyb21fZGF0ZScgPT4gJGZyb21fZGF0ZSwKICAgICAgICAgICAgICAgICd0b19kYXRlJyA9PiAkdG9fZGF0ZSwKICAgICAgICAgICAgICAgICdyZWNlaXZlZF9zdGF0dXMnID0+ICRyZWNlaXZlZF9zdGF0dXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIC8vICRtb2RlbCA9IFB1cmNoYXNlT3JkZXI6OndpdGgoJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsJ3JlbEdvb2RSZWNlaXZlTm90ZScsJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnKQogICAgICAgIC8vICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdHYXRlIFBlcm1pc3Npb24nKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAvLyAgICAgICAgIHJldHVybiAkcXVlcnktPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgIC8vICAgICAgICAgICAgIH0pOwogICAgICAgIC8vICAgICAgICAgfSkKICAgICAgICAvLyAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAvLyAgICAgICAgICAgICB9KTsKICAgICAgICAvLyAgICAgICAgIH0pOwogICAgICAgIC8vICAgICB9KQogICAgICAgIC8vICAgICAtPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgLy8gICAgIH0pCiAgICAgICAgLy8gICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgIC8vICAgICAtPm9yZGVyQnkoJ2lkJywnZGVzYycpCiAgICAgICAgLy8gICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgLy8gICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgIC8vICBpZiAoaXNzZXQoJHJlcXVlc3QtPnBvX2lkKSl7CiAgICAgICAgLy8gICAgICAkc2luZ2xlPSRtb2RlbC0+d2hlcmUoJ2lkJywkcmVxdWVzdC0+cG9faWQpLT5maXJzdCgpOwogICAgICAgIC8vICAgICAgJHRpdGxlLj0iIGZvciBQLk8uIFJlZmVyZW5jZTogJHNpbmdsZS0+cmVmZXJlbmNlX25vIjsKCiAgICAgICAgLy8gICAgICAkbW9kZWwtPndoZXJlKCdpZCcsJHJlcXVlc3QtPnBvX2lkKTsKICAgICAgICAvLyAgfQogICAgICAgIAogICAgICAgIC8vICAkcHVyY2hhc2VPcmRlcj0kbW9kZWwtPnBhZ2luYXRlKDMwKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuUHJvY2Vzc1NlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgCiAgICAgICAgJGZyb21fZGF0ZT1kYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvX2RhdGU9ZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnRvX2RhdGUpKTsKICAgICAgICAkcmVjZWl2ZWRfc3RhdHVzPSRyZXF1ZXN0LT5yZWNlaXZlZF9zdGF0dXM7CgogICAgICAgICRwdXJjaGFzZU9yZGVyPVB1cmNoYXNlT3JkZXI6OndpdGgoJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsJ3JlbEdvb2RSZWNlaXZlTm90ZScsJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnKQogICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywneWVzJykKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZFJlY2VpdmVOb3RlJyxmdW5jdGlvbiAoJHF1ZXJ5KXsKICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVSYXcoJ3B1cmNoYXNlX29yZGVycy5pZD1nb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdHYXRlIFBlcm1pc3Npb24nKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihpc3NldCgkcmVjZWl2ZWRfc3RhdHVzKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlY2VpdmVkX3N0YXR1cyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZWNlaXZlZF9zdGF0dXMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfc3RhdHVzJywgJHJlY2VpdmVkX3N0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVEYXRlKCdwb19kYXRlJywgJz49JywgJGZyb21fZGF0ZSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPD0nLCAkdG9fZGF0ZSkKICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYoY291bnQoJHB1cmNoYXNlT3JkZXIpPjApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRib2R5ID0gXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi5ncm4tbGlzdC1zZWFyY2gnLAogICAgICAgICAgICAgICAgICAgIFsncHVyY2hhc2VPcmRlcic9PiAkcHVyY2hhc2VPcmRlciwncmVjZWl2ZWRfc3RhdHVzJz0+JHJlY2VpdmVkX3N0YXR1c10pOwogICAgICAgICAgICAgICAgJGNvbnRlbnRzID0gJGJvZHktPnJlbmRlcigpOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2JvZHknXSA9ICRjb250ZW50czsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwb0xpc3RJbmRleCgpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgLy8gJHRpdGxlPSIoR2F0ZS1JbikgUHVyY2hhc2UgT3JkZXIgTGlzdCI7CiAgICAgICAgICAgIC8vICRkYXRhID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywncmVsR29vZFJlY2VpdmVOb3RlJywncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycpCiAgICAgICAgICAgIC8vICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmIHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgIC8vICAgICB9KQogICAgICAgICAgICAvLyAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJyxhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAvLyAgICAgLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKQogICAgICAgICAgICAvLyAgICAgLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgICAgICAvLyBpZiAoY291bnQoJGRhdGEpPjApewogICAgICAgICAgICAvLyAgICAgY2FsY3VsYXRlR3JuUXR5QWdhaW5zdFB1cmNoYXNlT3JkZXIoJGRhdGEpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4ucG8taW5kZXgnLGNvbXBhY3QoJ3RpdGxlJywnZGF0YScpKTsKCiAgICAgICAgICAgICR0aXRsZT0iR2F0ZSBJbi9PdXQiOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi5zY2FuJyxjb21wYWN0KCd0aXRsZScpKTsKCiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2NhbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICd0eXBlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncG9fcmVmZXJlbmNlJyA9PiAncmVxdWlyZWQnCiAgICAgICAgXSk7CgogICAgICAgIGlmKCRyZXF1ZXN0LT50eXBlID09ICJpbiIpewogICAgICAgICAgICAkb3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAwKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgncmVmZXJlbmNlX25vJywgJHJlcXVlc3QtPnBvX3JlZmVyZW5jZSkKICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICBpZihpc3NldCgkb3JkZXItPmlkKSl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVkaXJlY3QoJ3Btcy9ncm4vZ3JuLWxpc3QvY3JlYXRlLycuJG9yZGVyLT5pZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdQdXJjaGFzZSBvcmRlciBub3QgZm91bmQhJyk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRvcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFB1cmNoYXNlT3JkZXJSZXR1cm5zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKTsKICAgICAgICAgICAgfSktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRvcmRlci0+aWQpKXsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL2dybi9nYXRlLW91dC8nLiRvcmRlci0+aWQuJz9jb2RlPScuJHJlcXVlc3QtPnBvX3JlZmVyZW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdSZXR1cm4vUmVwbGFjZSBEYXRhIG5vdCBmb3VuZCEnKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoJGlkKQogICAgewogICAgICAgIHRyeXsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAnVW5pdCcsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFJlY2VpdmVQcm9kdWN0JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAwKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAnaWQnID0+ICRpZCwKICAgICAgICAgICAgICAgICdpc19zZW5kJyA9PiAneWVzJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgIAoKICAgICAgICAgICAgaWYoIWlzc2V0KCRwdXJjaGFzZU9yZGVyLT5pZCkpewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoIk5vIEF2YWlsYWJsZSBEYXRhIEZvdW5kISIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY291bnQoJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZSk+MCl7CiAgICAgICAgICAgICAgICAgICAgJGdyblF0eSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPmVhY2goZnVuY3Rpb24gKCRpdGVtLCRpKXVzZSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRncm5JdGVtLCAkayl1c2UoJGl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXSs9JGdybkl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCRpdGVtLT5wcm9kdWN0X2lkKS0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vcmV0dXJuICRwdXJjaGFzZU9yZGVyOwogICAgICAgICAgICAkZ2F0ZU91dHMgPSBQdXJjaGFzZVJldHVybjo6d2l0aChbCiAgICAgICAgICAgICAgICAnZ2F0ZU91dHMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwdXJjaGFzZU9yZGVyKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwdXJjaGFzZU9yZGVyLT5pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4tY2hhbmdlJykKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRhdmFpbGFibGUgPSAwOwogICAgICAgICAgICBpZihpc3NldCgkZ2F0ZU91dHNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGdhdGVPdXRzIGFzICRrZXkgPT4gJGdhdGVPdXQpewogICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGUgKz0gKCRnYXRlT3V0LT5nYXRlT3V0cy0+c3VtKCdxdHknKS0kZ2F0ZU91dC0+cmVjZWl2ZWRfcXR5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJGF2YWlsYWJsZSA8PSAwKXsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+Y2hlY2tPcmRlclF0eUFuZFJlY2VpdmVRdHkoJHB1cmNoYXNlT3JkZXIpOwogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQ9PS0xKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUmVjZWl2ZWQgcXR5IGNhbiBub3QgYmUgZ3JlYXRlciB0aGFuIHB1cmNoYXNlIG9yZGVyIHF0eScpOwogICAgICAgICAgICAgICAgfWVsc2VpZiAoJHJlc3VsdD09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1RvdGFsIFByb2R1Y3QgKHMpIEFscmVhZHkgUmVjZWl2ZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRpdGxlID0gIkdhdGUtSW4gUmVjZWl2ZSI7CiAgICAgICAgICAgICRwcmVmaXggPSAnR0FURS1JTi0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpLictJy4kcHVyY2hhc2VPcmRlci0+VW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lLictJzsKICAgICAgICAgICAgJHJlZk5vID0gdW5pcXVlQ29kZSgyMCwkcHJlZml4LCdnb29kc19yZWNlaXZlZF9ub3RlcycsJ2lkJyk7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4uY3JlYXRlJyxjb21wYWN0KCd0aXRsZScsJ3B1cmNoYXNlT3JkZXInLCdyZWZObycsICdnYXRlT3V0cycpKTsKCiAgICAgICAgfWNhdGNoKFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja09yZGVyUXR5QW5kUmVjZWl2ZVF0eSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eT0wOwogICAgICAgIGZvcmVhY2ggKCRwdXJjaGFzZU9yZGVyLT5yZWxHb29kUmVjZWl2ZU5vdGUgYXMgJGdybil7CiAgICAgICAgICAgICR0b3RhbFJlY2VpdmVRdHkrPSRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICB9CiAgICAgICAgJHRvdGFsT3JkZXJRdHk9JHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICByZXR1cm4gKCR0b3RhbE9yZGVyUXR5PD0+JHRvdGFsUmVjZWl2ZVF0eSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsgICAKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+ICdyZXF1aXJlZHxkYXRlJywKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgID0+ICJyZXF1aXJlZHx1bmlxdWU6Z29vZHNfcmVjZWl2ZWRfbm90ZXN8bWF4OjEwMCIsCiAgICAgICAgICAgICdjaGFsbGFuJyAgPT4gInJlcXVpcmVkfG1heDoxMDAiLAogICAgICAgICAgICAnZGVsaXZlcnlfYnknICA9PiAibnVsbGFibGV8bWF4OjIwMCIsCiAgICAgICAgICAgICdub3RlJyAgPT4gIm51bGxhYmxlfG1heDo1MDAiLAogICAgICAgICAgICAndG90YWxfcHJpY2UnICA9PiAicmVxdWlyZWQiLAogICAgICAgICAgICAnZ3Jvc3NfcHJpY2UnICA9PiAicmVxdWlyZWQiLAogICAgICAgICAgICAvLyAnY2hhbGxhbl9maWxlJyA9PiAnaW1hZ2V8bWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8bnVsbGFibGV8bWF4OjUwNDgnLAogICAgICAgIF0pOwoKICAgICAgICBpZighaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RfaWRbMF0pKXsKICAgICAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICAgICAncmVwbGFjZV9xdHknID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICAncmVwbGFjZV9xdHkuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICAkcHVyY2hhc2VPcmRlcj1QdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CgogICAgICAgICAgICAkY2hhbGxhbkZpbGU9Jyc7CiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnY2hhbGxhbl9maWxlJykpewogICAgICAgICAgICAgICAgJGNoYWxsYW5GaWxlPSR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdjaGFsbGFuX2ZpbGUnKSwndXBsb2FkL2dybi9jaGFsbGFuLWZpbGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHByZWZpeD0nR1JOLScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy1NQk0tJzsKICAgICAgICAgICAgJGdyblJlZmVyZW5jZU5vPXVuaXF1ZUNvZGUoMTYsJHByZWZpeCwnZ29vZHNfcmVjZWl2ZWRfbm90ZXMnLCdpZCcpOwogICAgICAgICAgICAkZ29vZHNSZWNlaXZlZE5vdGU9R29vZHNSZWNlaXZlZE5vdGU6OmNyZWF0ZSgKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnPT4kcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubyc9PiRyZXF1ZXN0LT5yZWZlcmVuY2Vfbm8sCiAgICAgICAgICAgICAgICAgICAgJ2dybl9yZWZlcmVuY2Vfbm8nPT4kZ3JuUmVmZXJlbmNlTm8sCiAgICAgICAgICAgICAgICAgICAgJ2NoYWxsYW4nPT4kcmVxdWVzdC0+Y2hhbGxhbiwKICAgICAgICAgICAgICAgICAgICAnY2hhbGxhbl9maWxlJz0+JGNoYWxsYW5GaWxlLAogICAgICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZSc9PiRyZXF1ZXN0LT50b3RhbF9wcmljZSwKICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnPT4kcmVxdWVzdC0+ZGlzY291bnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgJ3ZhdCc9PiRyZXF1ZXN0LT52YXQ/PzAsCiAgICAgICAgICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJz0+JHJlcXVlc3QtPmdyb3NzX3ByaWNlLAogICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9kYXRlJz0+ZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkcmVxdWVzdC0+cmVjZWl2ZWRfZGF0ZSkpLAogICAgICAgICAgICAgICAgICAgICdkZWxpdmVyeV9ieSc9PiRyZXF1ZXN0LT5kZWxpdmVyeV9ieSwKICAgICAgICAgICAgICAgICAgICAncmVjZWl2ZV9ieSc9PlxBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgICAgICdub3RlICc9PiRyZXF1ZXN0LT5ub3RlLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5Jz0+XEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+cHJvZHVjdF9pZFswXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnByb2R1Y3RfaWQgYXMgJGtleT0+JHByb2R1Y3RJZCl7CgogICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+cXR5WyRwcm9kdWN0SWRdIT0wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT52YXRfdHlwZVskcHJvZHVjdElkXSA9PSAnaW5jbHVzaXZlJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfYW1vdW50ID0gKChpc3NldCgkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHByb2R1Y3RJZF0pID8gJHJlcXVlc3QtPnVuaXRfYW1vdW50WyRwcm9kdWN0SWRdIDogMCktKGlzc2V0KCRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskcHJvZHVjdElkXSkgPyAkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHByb2R1Y3RJZF0gOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJHJlcXVlc3QtPnZhdF90eXBlWyRwcm9kdWN0SWRdID09ICdleGNsdXNpdmUnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9hbW91bnQgPSAoKGlzc2V0KCRyZXF1ZXN0LT51bml0X2Ftb3VudFskcHJvZHVjdElkXSkgPyAkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHByb2R1Y3RJZF0gOiAwKS0oaXNzZXQoJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyRwcm9kdWN0SWRdKSA/ICRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskcHJvZHVjdElkXSA6IDApKSsoaXNzZXQoJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHByb2R1Y3RJZF0pID8gJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHByb2R1Y3RJZF0gOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXRfYW1vdW50JyA9PiAkcmVxdWVzdC0+dW5pdF9wcmljZVskcHJvZHVjdElkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdxdHknID0+ICRyZXF1ZXN0LT5xdHlbJHByb2R1Y3RJZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ViX3RvdGFsJyA9PiAkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHByb2R1Y3RJZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnRfcGVyY2VudGFnZScgPT4gJHJlcXVlc3QtPmRpc2NvdW50X3BlcmNlbnRhZ2VbJHByb2R1Y3RJZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnQnID0+ICRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskcHJvZHVjdElkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXRfdHlwZScgPT4gJHJlcXVlc3QtPnZhdF90eXBlWyRwcm9kdWN0SWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdF9wZXJjZW50YWdlJyA9PiAkcmVxdWVzdC0+dmF0X3BlcmNlbnRhZ2VbJHByb2R1Y3RJZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0JyA9PiAkcmVxdWVzdC0+c3ViX3RvdGFsX3ZhdF9wcmljZVskcHJvZHVjdElkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hbW91bnQnID0+ICR0b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgJiYgY291bnQoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkgYXMgJHB1cmNoYXNlX3JldHVybl9pZCA9PiAkcmVwbGFjZV9xdHkpewogICAgICAgICAgICAgICAgICAgIGlmKCRyZXBsYWNlX3F0eSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm4gPSBQdXJjaGFzZVJldHVybjo6ZmluZCgkcHVyY2hhc2VfcmV0dXJuX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHVyY2hhc2VSZXR1cm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2Ftb3VudCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdxdHknID0+ICRyZXBsYWNlX3F0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdWJfdG90YWwnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGlzY291bnRfcGVyY2VudGFnZScgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNjb3VudCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXRfcGVyY2VudGFnZScgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxfYW1vdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgR29vZHNSZWNlaXZlZEl0ZW06Omluc2VydCgkZ29vZHNSZWNlaXZlSXRlbXMpOwoKICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSAmJiBpc19hcnJheSgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpICYmIGNvdW50KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPnJlcGxhY2VfcXR5IGFzICRwdXJjaGFzZV9yZXR1cm5faWQgPT4gJHJlcGxhY2VfcXR5KXsKICAgICAgICAgICAgICAgICAgICBpZigkcmVwbGFjZV9xdHkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuID0gUHVyY2hhc2VSZXR1cm46OmZpbmQoJHB1cmNoYXNlX3JldHVybl9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybi0+cmVjZWl2ZWRfcXR5ID0gKCRwdXJjaGFzZVJldHVybi0+cmVjZWl2ZWRfcXR5KyRyZXBsYWNlX3F0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmNoYW5nZVJlY2VpdmVTdGF0dXMoJHJlcXVlc3QsICRnb29kc1JlY2VpdmVkTm90ZSk7CgogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQgPT09IGZhbHNlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUmVjZWl2ZWQgcXR5IGdyZWF0ZXIgdGhhbiBwdXJjaGFzZSBvcmRlciBxdHknKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJHYXRlLUluIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRnb29kc1JlY2VpdmVkTm90ZS0+cmVmZXJlbmNlX25vLicuIFdhaXRpbmcgZm9yIHRoZSBRdWFsaXR5IEVuc3VyZS48L3NwYW4+JzsKCiAgICAgICAgICAgICRzdG9yZU1hbmFnZXIgPSBnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsJHB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQpOwogICAgICAgICAgICBpZigkc3RvcmVNYW5hZ2VyID4gMCl7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwndW5yZWFkJywnJywkc3RvcmVNYW5hZ2VyLCAnc2VuZC10by1zdG9yZScsJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGVwYXJ0bWVudEhlYWQgPSBnZXREZXBhcnRtZW50SGVhZEluZm8oJHB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQsICRwdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zWzBdLT5ocl9kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgaWYoJGRlcGFydG1lbnRIZWFkID4gMCl7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwndW5yZWFkJywnJywkZGVwYXJ0bWVudEhlYWQsICdzZW5kLXRvLWRlcGFydG1lbnQtaGVhZCcsJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJlZGlyZWN0QmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgR2F0ZSBJbiBCeSBHYXRlIE1hbmFnZXIuJywncG1zLmdybi5wby5saXN0Jyk7CgogICAgICAgIH1jYXRjaCAoRXhjZXB0aW9uICRlKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGFuZ2VSZWNlaXZlU3RhdHVzKCRyZXF1ZXN0LCRnb29kc1JlY2VpdmVkTm90ZSl7CgogICAgICAgICRwdXJjaGFzZU9yZGVyPVB1cmNoYXNlT3JkZXI6OndpdGgoJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycpLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CgogICAgICAgICR0b3RhbE9yZGVyUXR5PSRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5Jyk7CgogICAgICAgICRncm5zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycpCiAgICAgICAgICAgIC0+d2hlcmVJbigncHVyY2hhc2Vfb3JkZXJfaWQnLFskcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWRdKS0+Z2V0KCk7CgogICAgICAgICR0b3RhbFJlY2VpdmVRdHk9MDsKICAgICAgICBmb3JlYWNoICgkZ3JucyBhcyAkZ3JuKXsKICAgICAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eSs9JGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0b3RhbE9yZGVyUXR5PCR0b3RhbFJlY2VpdmVRdHkpewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRvdGFsT3JkZXJRdHk9PSR0b3RhbFJlY2VpdmVRdHkpewogICAgICAgICAgICAkZ29vZHNSZWNlaXZlZE5vdGUtPnVwZGF0ZShbJ3JlY2VpdmVkX3N0YXR1cyc9PidmdWxsJ10pOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRpZCkKICAgIHsKICAgICAgICAkcmVzcG9uc2U9W107CgogICAgICAgIHRyeXsKICAgICAgICAgICAgJG1vZGFsID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycy5TdXBwbGllclJhdGluZ3MnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICBpZiAoJG1vZGFsKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFxJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5ncm4uc2hvdycsCiAgICAgICAgICAgICAgICAgICAgWydncm4nPT4gJG1vZGFsXSk7CiAgICAgICAgICAgICAgICAkY29udGVudHMgPSAkYm9keS0+cmVuZGVyKCk7CgogICAgICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3ZpZXcnKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRjb250ZW50czsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkY29udGVudHM7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgR2VuZXJhdGVkIFBPJzsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0dSTiBub3QgZm91bmQhISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm5IZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdXBwbGllcicsICdzdXBwbGllcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZScsICdyZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19xdHknLCAnUE9fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmVjZWl2ZV9zdGF0dXMnLCAncmVjZWl2ZV9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydvcHRpb25zJywgJ29wdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm4oKXsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyc0FnYWluc3RHcm4gPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLGZ1bmN0aW9uICgkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcnNBZ2FpbnN0R3JuKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRwby0+cG9fZGF0ZSkgPyBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcG8tPnBvX2RhdGUpKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSk/JHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZS4nICgnLiRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknOicnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVmZXJlbmNlJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InNob3dQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkcG8tPmlkKS4nIj4nLiRwby0+cmVmZXJlbmNlX25vLic8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19xdHknLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBvLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9xdHknLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGVbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwkaSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXT0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlY2VpdmVfc3RhdHVzJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGVbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwkaSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXT0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBvLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5JykgPT0gJHRvdGFsX2dybl9xdHkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxidXR0b24gY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5pbmRleCcpLicnLic/cG9faWQ9Jy4kcG8tPmlkLiciIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyIgZGF0YS10b2dnbGU9InRvb2x0aXAiIHRpdGxlPSJDbGljayBoZXJlIHRvIEdybiBMaXN0IiA+IEdhdGUtSW4oJy4kcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKS4nKSA8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyIgaHJlZj0iJy4gdXJsKCdwbXMvZ3JuL2dhdGUtaW4tc2xpcC8nLiRwby0+aWQpIC4nIiB0YXJnZXQ9Il9ibGFuayI+PGkgY2xhc3M9ImxhIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2UnLCdyZWNlaXZlX3N0YXR1cycsJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLnBvLWxpc3QtYWdhaW5zdC1ncm4nLFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIlB1cmNoYXNlIE9yZGVyIExpc3QgQWdhaW5zdCBHUk4iLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5wdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm5IZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KfQo=