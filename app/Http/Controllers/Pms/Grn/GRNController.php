<?php
bolt_decrypt( __FILE__ , '8OmWcR'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEdybjsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUFjdGlvbkNvbnRyb2w7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR29vZHNSZWNlaXZlZEl0ZW1BdHRyaWJ1dGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VSZXR1cm47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVJldHVybkdhdGVPdXQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb247CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgWWFqcmFcRGF0YVRhYmxlc1xGYWNhZGVzXERhdGFUYWJsZXM7CgpjbGFzcyBHUk5Db250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICAkYXJyYXkgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX2RhdGUnLCAnZ2F0ZV9pbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9xdHknLCAnZ2F0ZV9pbl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JlY2VpdmVkX3N0YXR1cycsICdyZWNlaXZlZF9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwoKLy8gICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZScpKSB7Ci8vICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksIFsncXVhbGl0eV9lbnN1cmUnLCAncXVhbGl0eV9lbnN1cmUnXSk7Ci8vICAgICAgICB9CgogICAgICAgIHJldHVybiAkYXJyYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aXRsZSA9ICJHYXRlLUluIExpc3QiOwogICAgICAgICRmcm9tX2RhdGUgPSByZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkgPiAwID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpIDogJyc7CiAgICAgICAgJHRvX2RhdGUgPSByZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSA+IDAgPyByZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpIDogJyc7CiAgICAgICAgJHJlY2VpdmVkX3N0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdyZWNlaXZlZF9zdGF0dXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdyZWNlaXZlZF9zdGF0dXMnKSA6ICcnOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICRnYXRlSW5zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ25hbWUnLCBpZ25vcmVTdXBwbGllcnMoKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdHYXRlIFBlcm1pc3Npb24nKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW50X3RvX3JlcXVpc2l0b3InLCAneWVzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSAmJiAhYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1N0b3JlLU1hbmFnZXInKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX2RlcGFydG1lbnRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1N0b3JlLU1hbmFnZXInKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnR2F0ZSBQZXJtaXNzaW9uJyksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXV0aG9yX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRmcm9tX2RhdGUpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoREI6OnJhdygnc3Vic3RyKGByZWNlaXZlZF9kYXRlYCwgMSwgMTApJyksICc+PScsICRmcm9tX2RhdGUpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkdG9fZGF0ZSksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoREI6OnJhdygnc3Vic3RyKGByZWNlaXZlZF9kYXRlYCwgMSwgMTApJyksICc8PScsICR0b19kYXRlKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJHJlY2VpdmVkX3N0YXR1cyksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlY2VpdmVkX3N0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfc3RhdHVzJywgJHJlY2VpdmVkX3N0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnY3JlYXRlZF9hdCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRnYXRlSW5zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayBidG4teHMiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpIC4gJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+JyAuICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnBvX2RhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLT5wbHVjaygncmVxdWlzaXRpb24ucmVmZXJlbmNlX25vJyktPmltcGxvZGUoJywgJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3JlcXVpc2l0aW9ucy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zLmlkJywgJz0nLCAncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zJywgJ3B1cmNoYXNlX29yZGVyX3JlcXVpc2l0aW9ucy5wdXJjaGFzZV9vcmRlcl9pZCcsICc9JywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgc3R5bGU9IndpZHRoOiAxMDAlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6IDkwJTtmbG9hdDogbGVmdDtjbGVhcjpyaWdodCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiBvbmNsaWNrPSJzaG93R2F0ZUluUE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCAkZ3JuLT5pZCkgLiAnIiBkYXRhLXRpdGxlPSJHYXRlIEluIERldGFpbHMiPicgLiAkZ3JuLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6IDEwJTtmbG9hdDogbGVmdDtjbGVhcjpyaWdodCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyIgaHJlZj0iJyAuIHVybCgncG1zL2dybi9nYXRlLWluLXNsaXAvJyAuICRncm4tPnB1cmNoYXNlX29yZGVyX2lkIC4gJz9ncm49JyAuICRncm4tPmlkKSAuICciIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNy41cHgiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVmZXJlbmNlX25vJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX2RhdGUnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVjZWl2ZWRfZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlY2VpdmVkX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWNlaXZlZF9kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX3F0eScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlY2VpdmVkX3N0YXR1cycsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ3BhcnRpYWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ2Z1bGwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj4nIC4gdWN3b3JkcygkZ3JuLT5yZWNlaXZlZF9zdGF0dXMpIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncXVhbGl0eV9lbnN1cmUnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICAkYnRucyA9ICcnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZUluKCdxdWFsaXR5X2Vuc3VyZScsIFsncGVuZGluZyddKS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxYyA9IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpID8gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygncXVhbGl0eS1lbnN1cmUnKSA6ICgkZ3JuLT5pc19zZW50X3RvX3JlcXVpc2l0b3IgPT0gJ25vJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHFjKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnRucyAuPSAnPGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMucXVhbGl0eS5lbnN1cmUuY2hlY2snLCAkZ3JuLT5pZCkgLiAnIiB0aXRsZT0iUXVhbGl0eSBFbnN1cmUiIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrLWNpcmNsZSI+ICcgLiBfXygnUXVhbGl0eSBFbnN1cmUnKSAuICc8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRncm4tPmlzX3NlbnRfdG9fcmVxdWlzaXRvciA9PSAnbm8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ0bnMgLj0gJzxhIHRpdGxlPSJTZW5kIE1haWwiIG9uY2xpY2s9InNlbmRUb1JlcXVpc2l0b3IoJCh0aGlzKSkiIGRhdGEtYWN0aW9uPSInIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCdwbXMuZ3JuLnNlbmQudG8ucmVxdWlzaXRvcicsIFskZ3JuLT5wdXJjaGFzZV9vcmRlcl9pZCwgJGdybi0+aWRdKSAuICciIGNsYXNzPSJidG4gYnRuLWluZm8gYnRuLXhzIG10LTEiPjxpIGNsYXNzPSJsYXMgbGEtcGFwZXItcGxhbmUiPiZuYnNwOyZuYnNwO1NlbmQgdG8gUmVxdWlzaXRvcjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU3VwcGxpZXJSYXRpbmcoJ2dvb2RzX3JlY2VpdmVkX25vdGVzJywgJGdybi0+aWQsICdxYycpICYmIGluX2FycmF5KChpc3NldCgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnR5cGUpID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT50eXBlIDogJycpLCBbJ21hbnVhbCcsICdvbmxpbmUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiB1cmwoJ3Btcy9zdXBwbGllci9yYXRpbmcvJyAuICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQgLiAnLycgLiAkZ3JuLT5pZCkgLiAnP3RhYmxlPWdvb2RzX3JlY2VpdmVkX25vdGVzJmZpZWxkPScgLiAkZ3JuLT5pZCAuICcmdHlwZT1xYyIgY2xhc3M9ImJ0biBidG4taW5mbyBidG4teHMiPlJhdGluZ3M8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGJ0bnM7CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIHRpdGxlPSJTZW5kIE1haWwiIG9uY2xpY2s9InNlbmRNYWlsKCQodGhpcykpIiBkYXRhLWFjdGlvbj0iJyAuIHJvdXRlKCdwbXMuZ3JuLnNlbmQuZ2F0ZS5pbi5zbGlwJywgWyRncm4tPnB1cmNoYXNlX29yZGVyX2lkLCAkZ3JuLT5pZF0pIC4gJyIgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj4mbmJzcDsmbmJzcDtTZW5kIE1haWw8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3F1YWxpdHlfZW5zdXJlJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLmluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiR2F0ZS1JbiBMaXN0IiwKICAgICAgICAgICAgICAgICdmcm9tX2RhdGUnID0+ICRmcm9tX2RhdGUsCiAgICAgICAgICAgICAgICAndG9fZGF0ZScgPT4gJHRvX2RhdGUsCiAgICAgICAgICAgICAgICAncmVjZWl2ZWRfc3RhdHVzJyA9PiAkcmVjZWl2ZWRfc3RhdHVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdyblByb2Nlc3NTZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgJGZyb21fZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5mcm9tX2RhdGUpKTsKICAgICAgICAkdG9fZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CiAgICAgICAgJHJlY2VpdmVkX3N0YXR1cyA9ICRyZXF1ZXN0LT5yZWNlaXZlZF9zdGF0dXM7CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywgJ3JlbEdvb2RSZWNlaXZlTm90ZScsICdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJykKICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0dhdGUgUGVybWlzc2lvbicpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnR2F0ZSBQZXJtaXNzaW9uJyksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZWNlaXZlZF9zdGF0dXMpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZWNlaXZlZF9zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZWNlaXZlZF9zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfc3RhdHVzJywgJHJlY2VpdmVkX3N0YXR1cyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3BvX2RhdGUnLCAnPj0nLCAkZnJvbV9kYXRlKQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncG9fZGF0ZScsICc8PScsICR0b19kYXRlKQogICAgICAgICAgICAtPm9yZGVyQnkoJ2lkJywgJ2Rlc2MnKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvdW50KCRwdXJjaGFzZU9yZGVyKSA+IDApIHsKICAgICAgICAgICAgICAgICRib2R5ID0gXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi5ncm4tbGlzdC1zZWFyY2gnLAogICAgICAgICAgICAgICAgICAgIFsncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIsICdyZWNlaXZlZF9zdGF0dXMnID0+ICRyZWNlaXZlZF9zdGF0dXNdKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkY29udGVudHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBvTGlzdEluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgLy8gJHRpdGxlPSIoR2F0ZS1JbikgUHVyY2hhc2UgT3JkZXIgTGlzdCI7CiAgICAgICAgICAgIC8vICRkYXRhID0gUHVyY2hhc2VPcmRlcjo6d2l0aCgncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywncmVsR29vZFJlY2VpdmVOb3RlJywncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycpCiAgICAgICAgICAgIC8vICAgICAtPndoZW4ocmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpICYmIHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPj0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykpKSk7CiAgICAgICAgICAgIC8vICAgICB9KQogICAgICAgICAgICAvLyAgICAgLT53aGVuKHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJyksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoJ3N1YnN0cihgcG9fZGF0ZWAsIDEsIDEwKScpLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSkpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJyxhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAvLyAgICAgfSkKICAgICAgICAgICAgLy8gICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAvLyAgICAgLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKQogICAgICAgICAgICAvLyAgICAgLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgICAgICAvLyBpZiAoY291bnQoJGRhdGEpPjApewogICAgICAgICAgICAvLyAgICAgY2FsY3VsYXRlR3JuUXR5QWdhaW5zdFB1cmNoYXNlT3JkZXIoJGRhdGEpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4ucG8taW5kZXgnLGNvbXBhY3QoJ3RpdGxlJywnZGF0YScpKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICJHYXRlIEluL091dCI7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLnNjYW4nLCBjb21wYWN0KCd0aXRsZScpKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2NhbihSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICd0eXBlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncG9fcmVmZXJlbmNlJyA9PiAncmVxdWlyZWQnCiAgICAgICAgXSk7CgogICAgICAgIGlmICgkcmVxdWVzdC0+dHlwZSA9PSAiaW4iKSB7CiAgICAgICAgICAgICRvcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uLnJlcXVpc2l0aW9uSXRlbXMucHJvZHVjdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoaXNzZXQoJG9yZGVyLT5pZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL2dybi9ncm4tbGlzdC9jcmVhdGUvJyAuICRvcmRlci0+aWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignUHVyY2hhc2Ugb3JkZXIgbm90IGZvdW5kIScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFB1cmNoYXNlT3JkZXJSZXR1cm5zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKTsKICAgICAgICAgICAgfSktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmIChpc3NldCgkb3JkZXItPmlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdwbXMvZ3JuL2dhdGUtb3V0LycgLiAkb3JkZXItPmlkIC4gJz9jb2RlPScgLiAkcmVxdWVzdC0+cG9fcmVmZXJlbmNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1JldHVybi9SZXBsYWNlIERhdGEgbm90IGZvdW5kIScpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCRpZCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdVbml0JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUmVjZWl2ZVByb2R1Y3QnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsUXVvdGF0aW9uSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlcnZpY2UnLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaWQnID0+ICRpZCwKICAgICAgICAgICAgICAgICAgICAnaXNfc2VuZCcgPT4gJ3llcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVlc3RfcHJvcG9zYWxfaWQnLCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKCiAgICAgICAgICAgIGlmICghaXNzZXQoJHB1cmNoYXNlT3JkZXItPmlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoIk5vIEF2YWlsYWJsZSBEYXRhIEZvdW5kISIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY291bnQoJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZSkgPiAwKSB7CiAgICAgICAgICAgICAgICAkZ3JuUXR5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sICRpKSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGdybkl0ZW0sICRrKSB1c2UgKCRpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtWydncm5fcXR5J10gKz0gJGdybkl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3VpZCcsICRpdGVtLT51aWQpLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vcmV0dXJuICRwdXJjaGFzZU9yZGVyOwogICAgICAgICAgICAkZ2F0ZU91dHMgPSBQdXJjaGFzZVJldHVybjo6d2l0aChbCiAgICAgICAgICAgICAgICAnZ2F0ZU91dHMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZE5vdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGF2YWlsYWJsZSA9IDA7CiAgICAgICAgICAgIGlmIChpc3NldCgkZ2F0ZU91dHNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ2F0ZU91dHMgYXMgJGtleSA9PiAkZ2F0ZU91dCkgewogICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGUgKz0gKCRnYXRlT3V0LT5nYXRlT3V0cy0+c3VtKCdxdHknKSAtICRnYXRlT3V0LT5yZWNlaXZlZF9xdHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJGF2YWlsYWJsZSA8PSAwKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmNoZWNrT3JkZXJRdHlBbmRSZWNlaXZlUXR5KCRwdXJjaGFzZU9yZGVyKTsKICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1JlY2VpdmVkIHF0eSBjYW4gbm90IGJlIGdyZWF0ZXIgdGhhbiBwdXJjaGFzZSBvcmRlciBxdHknKTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVzdWx0ID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnVG90YWwgUHJvZHVjdCAocykgQWxyZWFkeSBSZWNlaXZlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGl0bGUgPSAiR2F0ZS1JbiBSZWNlaXZlIjsKICAgICAgICAgICAgJHByZWZpeCA9ICdHQVRFLUlOLScgLiBkYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKSAuICctJyAuICRwdXJjaGFzZU9yZGVyLT5Vbml0LT5ocl91bml0X3Nob3J0X25hbWUgLiAnLSc7CiAgICAgICAgICAgICRyZWZObyA9IHVuaXF1ZUNvZGUoMjAsICRwcmVmaXgsICdnb29kc19yZWNlaXZlZF9ub3RlcycsICdpZCcpOwogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLmNyZWF0ZScsIGNvbXBhY3QoJ3RpdGxlJywgJ3B1cmNoYXNlT3JkZXInLCAncmVmTm8nLCAnZ2F0ZU91dHMnLCAncmVxdWlzaXRpb25JdGVtcycpKTsKCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja09yZGVyUXR5QW5kUmVjZWl2ZVF0eSgkcHVyY2hhc2VPcmRlcikKICAgIHsKICAgICAgICAkdG90YWxSZWNlaXZlUXR5ID0gMDsKICAgICAgICBmb3JlYWNoICgkcHVyY2hhc2VPcmRlci0+cmVsR29vZFJlY2VpdmVOb3RlIGFzICRncm4pIHsKICAgICAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eSArPSAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgfQogICAgICAgICR0b3RhbE9yZGVyUXR5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICByZXR1cm4gKCR0b3RhbE9yZGVyUXR5IDw9PiAkdG90YWxSZWNlaXZlUXR5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+ICdyZXF1aXJlZHxkYXRlJywKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gInJlcXVpcmVkfHVuaXF1ZTpnb29kc19yZWNlaXZlZF9ub3Rlc3xtYXg6MTAwIiwKICAgICAgICAgICAgJ2NoYWxsYW4nID0+ICJyZXF1aXJlZHxtYXg6MTAwIiwKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2J5JyA9PiAibnVsbGFibGV8bWF4OjIwMCIsCiAgICAgICAgICAgICdub3RlJyA9PiAibnVsbGFibGV8bWF4OjUwMCIsCiAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gInJlcXVpcmVkIiwKICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAicmVxdWlyZWQiLAogICAgICAgICAgICAvLyAnY2hhbGxhbl9maWxlJyA9PiAnaW1hZ2V8bWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8bnVsbGFibGV8bWF4OjUwNDgnLAogICAgICAgIF0pOwoKICAgICAgICBpZiAoIWlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2lkWzBdKSkgewogICAgICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgICAgICdyZXBsYWNlX3F0eScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgICAgICdyZXBsYWNlX3F0eS4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICdyZWxRdW90YXRpb24nLAogICAgICAgICAgICAnVW5pdCcsCgogICAgICAgIF0pLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CiAgICAgICAgCiAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAnYXR0cmlidXRlcycKICAgICAgICBdKQogICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uLnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcHVyY2hhc2VPcmRlcikgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQpOwogICAgICAgIH0pCiAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGNoYWxsYW5GaWxlID0gJyc7CiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnY2hhbGxhbl9maWxlJykpIHsKICAgICAgICAgICAgICAgICRjaGFsbGFuRmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdjaGFsbGFuX2ZpbGUnKSwgJ3VwbG9hZC9ncm4vY2hhbGxhbi1maWxlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRwcmVmaXggPSAnR1JOLScgLiBkYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKSAuICctJy4kcHVyY2hhc2VPcmRlci0+VW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lLictJzsKICAgICAgICAgICAgJGdyblJlZmVyZW5jZU5vID0gdW5pcXVlQ29kZSgxNiwgJHByZWZpeCwgJ2dvb2RzX3JlY2VpdmVkX25vdGVzJywgJ2lkJyk7CiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkTm90ZSA9IEdvb2RzUmVjZWl2ZWROb3RlOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsCiAgICAgICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAkcmVxdWVzdC0+cmVmZXJlbmNlX25vLAogICAgICAgICAgICAgICAgJ2dybl9yZWZlcmVuY2Vfbm8nID0+ICRncm5SZWZlcmVuY2VObywKICAgICAgICAgICAgICAgICdjaGFsbGFuJyA9PiAkcmVxdWVzdC0+Y2hhbGxhbiwKICAgICAgICAgICAgICAgICdjaGFsbGFuX2ZpbGUnID0+ICRjaGFsbGFuRmlsZSwKICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gJHJlcXVlc3QtPnRvdGFsX3ByaWNlLAogICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAkcmVxdWVzdC0+ZGlzY291bnQgPz8gMCwKICAgICAgICAgICAgICAgICd2YXQnID0+ICRyZXF1ZXN0LT52YXQgPz8gMCwKICAgICAgICAgICAgICAgICdncm9zc19wcmljZScgPT4gJHJlcXVlc3QtPmdyb3NzX3ByaWNlLAogICAgICAgICAgICAgICAgJ3JlY2VpdmVkX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5yZWNlaXZlZF9kYXRlKSksCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfYnknID0+ICRyZXF1ZXN0LT5kZWxpdmVyeV9ieSwKICAgICAgICAgICAgICAgICdyZWNlaXZlX2J5JyA9PiBcQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICdub3RlICcgPT4gJHJlcXVlc3QtPm5vdGUsCiAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gXEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkZ29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsUmVxdWVzdFByb3Bvc2FsLT5yZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbgogICAgICAgICAgICAgICAgLT5maXJzdCgpLT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgaWYoJHJlcXVpc2l0aW9uSWQpewogICAgICAgICAgICAgICAgcmVxdWlzaXRpb25UcmFja2luZ0hpc3RvcnkoJHJlcXVpc2l0aW9uSWQsICdnYXRlX2luJywgJ1Byb2R1Y3QgR2F0ZSBpbiBTdWNjZXNzZnVsbHknKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGdybkF0dHJpYnV0ZXMgPSBbXTsKCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+cHJvZHVjdF9pZFswXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5wcm9kdWN0X2lkIGFzICRrZXkgPT4gJHVpZCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+cXR5WyR1aWRdICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT52YXRfdHlwZVskdWlkXSA9PSAnaW5jbHVzaXZlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2Ftb3VudCA9ICgoaXNzZXQoJHJlcXVlc3QtPnVuaXRfYW1vdW50WyR1aWRdKSA/ICRyZXF1ZXN0LT51bml0X2Ftb3VudFskdWlkXSA6IDApIC0gKGlzc2V0KCRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskdWlkXSkgPyAkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHVpZF0gOiAwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+dmF0X3R5cGVbJHVpZF0gPT0gJ2V4Y2x1c2l2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9hbW91bnQgPSAoKGlzc2V0KCRyZXF1ZXN0LT51bml0X2Ftb3VudFskdWlkXSkgPyAkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHVpZF0gOiAwKSAtIChpc3NldCgkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHVpZF0pID8gJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyR1aWRdIDogMCkpICsgKGlzc2V0KCRyZXF1ZXN0LT5zdWJfdG90YWxfdmF0X3ByaWNlWyR1aWRdKSA/ICRyZXF1ZXN0LT5zdWJfdG90YWxfdmF0X3ByaWNlWyR1aWRdIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfYW1vdW50ID0gKChpc3NldCgkcmVxdWVzdC0+dW5pdF9hbW91bnRbJHVpZF0pID8gJHJlcXVlc3QtPnVuaXRfYW1vdW50WyR1aWRdIDogMCkgLSAoaXNzZXQoJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyR1aWRdKSA/ICRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X2Ftb3VudFskdWlkXSA6IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9ICRyZXF1aXNpdGlvbkl0ZW1zLT53aGVyZSgndWlkJywgJHVpZCktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbSA9IEdvb2RzUmVjZWl2ZWRJdGVtOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnID0+ICRnb29kc1JlY2VpdmVkTm90ZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndWlkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT51aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2Ftb3VudCcgPT4gJHJlcXVlc3QtPnVuaXRfcHJpY2VbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkcmVxdWVzdC0+cXR5WyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl90b3RhbCcgPT4gJHJlcXVlc3QtPnVuaXRfYW1vdW50WyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50X3BlcmNlbnRhZ2UnID0+ICRyZXF1ZXN0LT5kaXNjb3VudF9wZXJjZW50YWdlWyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAkcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmF0X3R5cGUnID0+ICRyZXF1ZXN0LT52YXRfdHlwZVskdWlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YXRfcGVyY2VudGFnZScgPT4gJHJlcXVlc3QtPnZhdF9wZXJjZW50YWdlWyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxfYW1vdW50JyA9PiAkdG90YWxfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRnb29kc1JlY2VpdmVkSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1aXNpdGlvbkl0ZW0tPmlkKSAmJiAkcmVxdWlzaXRpb25JdGVtLT5hdHRyaWJ1dGVzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1aXNpdGlvbkl0ZW0tPmF0dHJpYnV0ZXMgYXMgJGF0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRncm5BdHRyaWJ1dGVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWRJdGVtLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVfb3B0aW9uX2lkJyA9PiAkYXR0cmlidXRlLT5hdHRyaWJ1dGVfb3B0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgJiYgY291bnQoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSA+IDApIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSBhcyAkcHVyY2hhc2VfcmV0dXJuX2lkID0+ICRyZXBsYWNlX3F0eSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkcmVwbGFjZV9xdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybiA9IFB1cmNoYXNlUmV0dXJuOjpmaW5kKCRwdXJjaGFzZV9yZXR1cm5faWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtID0gJHJlcXVpc2l0aW9uSXRlbXMtPndoZXJlKCd1aWQnLCAkdWlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtID0gR29vZHNSZWNlaXZlZEl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcgPT4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1aWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXRfYW1vdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3F0eScgPT4gJHJlcGxhY2VfcXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl90b3RhbCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkaXNjb3VudF9wZXJjZW50YWdlJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdF9wZXJjZW50YWdlJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hbW91bnQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGdvb2RzUmVjZWl2ZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+aWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPmF0dHJpYnV0ZXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uSXRlbS0+YXR0cmlidXRlcyBhcyAkYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGdybkF0dHJpYnV0ZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9pdGVtX2lkJyA9PiAkZ29vZHNSZWNlaXZlZEl0ZW0tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZV9vcHRpb25faWQnID0+ICRhdHRyaWJ1dGUtPmF0dHJpYnV0ZV9vcHRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRncm5BdHRyaWJ1dGVzWzBdKSkgewogICAgICAgICAgICAgICAgR29vZHNSZWNlaXZlZEl0ZW1BdHRyaWJ1dGU6Omluc2VydCgkZ3JuQXR0cmlidXRlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+cmVwbGFjZV9xdHkpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSkgJiYgY291bnQoJHJlcXVlc3QtPnJlcGxhY2VfcXR5KSA+IDApIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5yZXBsYWNlX3F0eSBhcyAkcHVyY2hhc2VfcmV0dXJuX2lkID0+ICRyZXBsYWNlX3F0eSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkcmVwbGFjZV9xdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybiA9IFB1cmNoYXNlUmV0dXJuOjpmaW5kKCRwdXJjaGFzZV9yZXR1cm5faWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm4tPnJlY2VpdmVkX3F0eSA9ICgkcHVyY2hhc2VSZXR1cm4tPnJlY2VpdmVkX3F0eSArICRyZXBsYWNlX3F0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+Y2hhbmdlUmVjZWl2ZVN0YXR1cygkcmVxdWVzdCwgJGdvb2RzUmVjZWl2ZWROb3RlKTsKCiAgICAgICAgICAgICAgICBpZiAoJHJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUmVjZWl2ZWQgcXR5IGdyZWF0ZXIgdGhhbiBwdXJjaGFzZSBvcmRlciBxdHknKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywgJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IkdhdGUtSW4gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkZ29vZHNSZWNlaXZlZE5vdGUtPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIHRoZSBRdWFsaXR5IEVuc3VyZS48L3NwYW4+JzsKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1N0b3JlLU1hbmFnZXInLCAkcHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCwgdHJ1ZSksICdzZW5kLXRvLXN0b3JlJyk7CiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldERlcGFydG1lbnRIZWFkSW5mbygkcHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCwgJHB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnNbMF0tPmhyX2RlcGFydG1lbnRfaWQsIHRydWUpLCAnc2VuZC10by1kZXBhcnRtZW50LWhlYWQnKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IEdhdGUgSW4gQnkgR2F0ZSBNYW5hZ2VyLicsICdwbXMuZ3JuLnBvLmxpc3QnKTsKCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJGUtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY2hhbmdlUmVjZWl2ZVN0YXR1cygkcmVxdWVzdCwgJGdvb2RzUmVjZWl2ZWROb3RlKQogICAgewoKICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycpLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CgogICAgICAgICR0b3RhbE9yZGVyUXR5ID0gJHB1cmNoYXNlT3JkZXItPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKTsKCiAgICAgICAgJGdybnMgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aCgncmVsR29vZHNSZWNlaXZlZEl0ZW1zJykKICAgICAgICAgICAgLT53aGVyZUluKCdwdXJjaGFzZV9vcmRlcl9pZCcsIFskcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWRdKS0+Z2V0KCk7CgogICAgICAgICR0b3RhbFJlY2VpdmVRdHkgPSAwOwogICAgICAgIGZvcmVhY2ggKCRncm5zIGFzICRncm4pIHsKICAgICAgICAgICAgJHRvdGFsUmVjZWl2ZVF0eSArPSAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRvdGFsT3JkZXJRdHkgPCAkdG90YWxSZWNlaXZlUXR5KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmICgkdG90YWxPcmRlclF0eSA9PSAkdG90YWxSZWNlaXZlUXR5KSB7CiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkTm90ZS0+dXBkYXRlKFsncmVjZWl2ZWRfc3RhdHVzJyA9PiAnZnVsbCddKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkbW9kYWwgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzLlN1cHBsaWVyUmF0aW5ncycsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgIGlmICgkbW9kYWwpIHsKICAgICAgICAgICAgICAgICRib2R5ID0gXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi5zaG93JywKICAgICAgICAgICAgICAgICAgICBbJ2dybicgPT4gJG1vZGFsXSk7CiAgICAgICAgICAgICAgICAkY29udGVudHMgPSAkYm9keS0+cmVuZGVyKCk7CgogICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCd2aWV3JykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNvbnRlbnRzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2JvZHknXSA9ICRjb250ZW50czsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBHZW5lcmF0ZWQgUE8nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdHUk4gbm90IGZvdW5kISEnOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcHVyY2hhc2VPcmRlckxpc3RBZ2FpbnN0R3JuSGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdXBwbGllcicsICdzdXBwbGllcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZScsICdyZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19xdHknLCAnUE9fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmVjZWl2ZV9zdGF0dXMnLCAncmVjZWl2ZV9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydvcHRpb25zJywgJ29wdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm4oKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyc0FnYWluc3RHcm4gPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVOb3RJbignbmFtZScsIGlnbm9yZVN1cHBsaWVycygpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9Z29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRwdXJjaGFzZU9yZGVyc0FnYWluc3RHcm4pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHBvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcG8tPnBvX2RhdGUpID8gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHBvLT5wb19kYXRlKSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSAuICcgKCcgLiAkcG8tPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5jb2RlIC4gJyknIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InNob3dQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkcG8tPmlkKSAuICciPicgLiAkcG8tPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fcXR5JywgZnVuY3Rpb24gKCRwbykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBvLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9xdHknLCBmdW5jdGlvbiAoJHBvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZVswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwgJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbVsnZ3JuX3F0eSddID0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlY2VpdmVfc3RhdHVzJywgZnVuY3Rpb24gKCRwbykgewogICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZVswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwgJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbVsnZ3JuX3F0eSddID0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2dybl9xdHkgPSAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwby0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpID09ICR0b3RhbF9ncm5fcXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxidXR0b24gY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ29wdGlvbnMnLCBmdW5jdGlvbiAoJHBvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLmluZGV4JykgLiAnJyAuICc/cG9faWQ9JyAuICRwby0+aWQgLiAnIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiB0aXRsZT0iQ2xpY2sgaGVyZSB0byBHcm4gTGlzdCIgPiBHYXRlLUluKCcgLiAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+Y291bnQoKSAuICcpIDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInIC4gdXJsKCdwbXMvZ3JuL2dhdGUtaW4tc2xpcC8nIC4gJHBvLT5pZCkgLiAnIiB0YXJnZXQ9Il9ibGFuayI+PGkgY2xhc3M9ImxhIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2UnLCAncmVjZWl2ZV9zdGF0dXMnLCAnb3B0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+dG9Kc29uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4ucG8tbGlzdC1hZ2FpbnN0LWdybicsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIlB1cmNoYXNlIE9yZGVyIExpc3QgQWdhaW5zdCBHUk4iLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5wdXJjaGFzZU9yZGVyTGlzdEFnYWluc3RHcm5IZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZFRvUmVxdWlzaXRvcigkcG9JZCwgJGdybklkKQogICAgewogICAgICAgICRnb29kUmVjZWl2ZWROb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGdybklkKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgaWYgKCRnb29kUmVjZWl2ZWROb3RlKSB7CiAgICAgICAgICAgICAgICAkZ29vZFJlY2VpdmVkTm90ZS0+aXNfc2VudF90b19yZXF1aXNpdG9yID0gJ3llcyc7CiAgICAgICAgICAgICAgICAkZ29vZFJlY2VpdmVkTm90ZS0+c2F2ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZCA9ICRnb29kUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFJlcXVlc3RQcm9wb3NhbC0+cmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24tPmZpcnN0KCktPnJlcXVpc2l0aW9uX2lkOwogICAgICAgICAgICBpZigkcmVxdWlzaXRpb25JZCl7CiAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ3NlbmRfdG9fcmVxdWlzaXRvcicsJ1NlbmQgdG8gUmVxdWlzaXRvciBmb3IgUUMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnUUMgUGVybWlzc2lvbiBoYXMgYmVlbiBzZW5kIHRvIHJlcXVpc2l0b3Igc3VjY2Vzc2Z1bGx5IScKICAgICAgICAgICAgXSk7CgogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsQmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJGUtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9Cn0K