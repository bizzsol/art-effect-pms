<?php
bolt_decrypt( __FILE__ , 'i1iyS1'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEdybjsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUFjdGlvbkNvbnRyb2w7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldExvY2F0aW9uOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2g7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaEl0ZW07CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREIsIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGgsIFlhanJhXERhdGFUYWJsZXNcRmFjYWRlc1xEYXRhVGFibGVzOwoKY2xhc3MgR1JOU3RvY2tJbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9kYXRlJywgJ2dhdGVfaW5fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcXR5JywgJ2dhdGVfaW5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9xdHknLCAnYXBwcm92ZWRfcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZXR1cm5fcXR5JywgJ3JldHVybl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JlcGxhY2VfcXR5JywgJ3JlcGxhY2VfcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnR1JOJywgJ0dSTicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlcicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVzZXJVbml0cykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVzZXJVbml0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfdW5pdF9pZCcsICR1c2VyVW5pdHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAnbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncmVjZWl2ZWRfcXR5JywgJz4nLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCd1cGRhdGVkX2F0JywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICAgICAnZ3JuLXN0b2NrLWluLWxpc3QnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2dybi1zdG9jay1pbi1saXN0JyksCiAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkaXRlbXMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIGJ0bi14cyIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAoaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQgOiAwKSkgLiAnIiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj4nIC4gKGlzc2V0KCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubykgPyAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8gOiAnJykgLiAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIGJ0bi14cyIgb25jbGljaz0ic2hvd1FDRVBPRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywgJGdybi0+aWQpIC4gJyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj4nIC4gJGdybi0+cmVmZXJlbmNlX25vIC4gJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlZmVyZW5jZV9ubycsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRncm4tPnJlY2VpdmVkX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWNlaXZlZF9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVjZWl2ZWRfZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9xdHknLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmVkX3F0eScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsICdhcHByb3ZlZCcpLT5zdW0oJ3JlY2VpdmVkX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JldHVybl9xdHknLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCAncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3F0eScpIC0gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCAncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3JlY2VpdmVkX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcGxhY2VfcXR5JywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdxdHknKSAtICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVjZWl2ZWRfc3RhdHVzJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAncGFydGlhbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRncm4tPnJlY2VpdmVkX3N0YXR1cyA9PSAnZnVsbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPicgLiB1Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdHUk4nLCBmdW5jdGlvbiAoJGdybikgdXNlICgkb3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zKCktPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICdubycpLT53aGVyZSgncmVjZWl2ZWRfcXR5JywgJz4nLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInIC4gcm91dGUoJ3Btcy5ncm4uc3RvY2suaW4ubGlzdCcsICRncm4tPmlkKSAuICciIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5HUk48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnUE9fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3JlY2VpdmVkX3N0YXR1cycsICdHUk4nXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4ucWNlLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJHUk4gV2FpdGluZyBMaXN0IiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuSGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydQT19yZWZlcmVuY2UnLCAnUE9fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnR1JOX3JlZmVyZW5jZScsICdHUk5fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX2RhdGUnLCAnZ2F0ZV9pbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9xdHknLCAnZ2F0ZV9pbl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2FwcHJvdmVkX3F0eScsICdhcHByb3ZlZF9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JldHVybl9xdHknLCAncmV0dXJuX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmVwbGFjZV9xdHknLCAncmVwbGFjZV9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JlY2VpdmVkX3N0YXR1cycsICdyZWNlaXZlZF9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzbGlwJywgJ3NsaXAnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBncm5MaXN0KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJGl0ZW1zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyJywKICAgICAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdocl91bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgndXBkYXRlZF9hdCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgKGlzc2V0KCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPmlkKSA/ICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPmlkIDogMCkpIC4gJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+JyAuIChpc3NldCgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8pID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vIDogJycpIC4gJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignR1JOX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9InRleHQtc3VjY2VzcyIgaHJlZj0iJyAuIHVybCgncG1zL2dybi1zbGlwLycgLiAkZ3JuLT5pZCkgLiAnIiB0YXJnZXQ9Il9ibGFuayI+JyAuICRncm4tPmdybl9yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignR1JOX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdncm5fcmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdHUk5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2dybl9yZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InNob3dHUk5QT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsICRncm4tPmlkKSAuICciIGRhdGEtdGl0bGU9IkdhdGUtSW4gRGV0YWlscyI+JyAuICRncm4tPnJlZmVyZW5jZV9ubyAuICcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWNlaXZlZF9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlY2VpdmVkX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9xdHknLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCAnYXBwcm92ZWQnKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXR1cm5fcXR5JywgZnVuY3Rpb24gKCRncm4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdxdHknKSAtICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXBsYWNlX3F0eScsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsICdyZXR1cm4tY2hhbmdlJyktPnN1bSgncXR5JykgLSAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsICdyZXR1cm4tY2hhbmdlJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlY2VpdmVkX3N0YXR1cycsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ3BhcnRpYWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ2Z1bGwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj4nIC4gdWN3b3JkcygkZ3JuLT5yZWNlaXZlZF9zdGF0dXMpIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2xpcCcsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIGhyZWY9IicgLiB1cmwoJ3Btcy9ncm4tc2xpcC8nIC4gJGdybi0+aWQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnUE9fcmVmZXJlbmNlJywgJ0dSTl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3NsaXAnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4uZ3JuLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJHUk4gTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmdybkhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGdyblN0b2NrSW5MaXN0KCRpZCkKICAgIHsKICAgICAgICAkdGl0bGUgPSAiR1JOIFN0b2NrIEluIExpc3QiOwoKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGdybiA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgICAgIF0pLT5maW5kKCRpZCk7CiAgICAgICAgICAgICRnb29kc1JlY2VpdmVJdGVtcyA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRpZCkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2lkJykKICAgICAgICAgICAgICAgIC0+YWxsKCk7CgogICAgICAgICAgICAkZ3JuX3N0b2NrX2luX2xpc3RzID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZE5vdGUnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCcsICRnb29kc1JlY2VpdmVJdGVtcykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICdubycpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdyZWNlaXZlZF9xdHknLCAnPicsIDApCiAgICAgICAgICAgICAgICAtPm9yZGVyYnkoJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAnZGVzYycpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHdhcmVob3VzZV9pZHMgPSBBdXRoOjp1c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICBpZiAoY291bnQoJHdhcmVob3VzZV9pZHMpID4gMCkgewogICAgICAgICAgICAgICAgJHdhcmVob3VzZXMgPSBXYXJlaG91c2VzOjp3aGVyZUluKCdpZCcsICR3YXJlaG91c2VfaWRzKS0+c2VsZWN0KCduYW1lJywgJ2lkJyktPmdldCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHdhcmVob3VzZXMgPSBXYXJlaG91c2VzOjpzZWxlY3QoJ25hbWUnLCAnaWQnKS0+Z2V0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4uZ3JuLXN0b2NrLWluLWxpc3QnLCBjb21wYWN0KCdncm5fc3RvY2tfaW5fbGlzdHMnLCAndGl0bGUnLCAnd2FyZWhvdXNlcycsICdpZCcsICdncm4nKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdjaGFsbGFuX2ZpbGUnID0+ICdpbWFnZXxtaW1lczpqcGVnLGpwZyxwbmcsZ2lmLHBkZnxudWxsYWJsZXxtYXg6NTA0OCcsCiAgICAgICAgXSk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgJGdybiA9IEdvb2RzUmVjZWl2ZWROb3RlOjpmaW5kKCRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcHVyY2hhc2Vfb3JkZXJfaWQgPSBbXTsKICAgICAgICAgICAgJHN0b2NrSW5zID0gW107CiAgICAgICAgICAgICRjcmVkaXQgPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+aWQgYXMgJGtleSA9PiAkdmFsdWUpIHsKCiAgICAgICAgICAgICAgICBpZiAoJHJlcXVlc3QtPndhcmVob3VzZV9pZFska2V5XSkgewogICAgICAgICAgICAgICAgICAgICR3YXJlSG91c2UgPSBXYXJlaG91c2VzOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJGtleV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRtb2RlbCA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ2lkJywgJGtleSktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAnbm8nKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICBpZiAoY291bnQoKGFycmF5KSRtb2RlbCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3QgPSBQcm9kdWN0OjpmaW5kT3JGYWlsKCRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5wcm9kdWN0X2lkKTsKICAgICAgICAgICAgICAgICAgICBuZXcgSW52ZW50b3J5QWN0aW9uQ29udHJvbCgkcHJvZHVjdCwgJHdhcmVIb3VzZSwgJG1vZGVsLT50b3RhbF9hbW91bnQsICRtb2RlbC0+cmVjZWl2ZWRfcXR5LCAnYWN0aXZlJywgJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vLCAkbW9kZWwtPmlkKTsKCiAgICAgICAgICAgICAgICAgICAgJG1vZGVsLT5pc19ncm5fY29tcGxldGUgPSAneWVzJzsKICAgICAgICAgICAgICAgICAgICAkbW9kZWwtPndhcmVob3VzZV9pZCA9ICR3YXJlSG91c2UtPmlkOwoKICAgICAgICAgICAgICAgICAgICAkcHJvamVjdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zWzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zIGFzICRrZXkgPT4gJHBvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwb3ItPnJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbkl0ZW1zLT53aGVyZSgncHJvZHVjdF9pZCcsICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5wcm9kdWN0X2lkKS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvci0+cmVxdWlzaXRpb24tPnByb2plY3RUYXNrLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2plY3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc19maXhlZF9hc3NldCA9PSAxIHx8ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc19jd2lwID09IDEgfHwgJHByb2plY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpeGVkQXNzZXRMb2NhdGlvbiA9IFxBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRMb2NhdGlvbjo6d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXRfaWQnID0+ICRtb2RlbC0+cmVsUHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNhdGVnb3J5LT5wYXJlbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkbW9kZWwtPmZpeGVkX2Fzc2V0X2xvY2F0aW9uX2lkID0gKGlzc2V0KCRmaXhlZEFzc2V0TG9jYXRpb24tPmlkKSA/ICRmaXhlZEFzc2V0TG9jYXRpb24tPmlkIDogMCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkbW9kZWwtPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgJGNyZWRpdCArPSAkbW9kZWwtPnRvdGFsX2Ftb3VudDsKCiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkc3RvY2tJbnMsICRtb2RlbC0+aWQpOwogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHB1cmNoYXNlX29yZGVyX2lkLCAkbW9kZWwtPnB1cmNoYXNlX29yZGVyX2lkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdEYXRhIG5vdCBmb3VuZC4hIScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkZ29vZHNSZWNlaXZlZE5vdGUgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoJHJlcXVlc3QtPmhhc0ZpbGUoJ2NoYWxsYW5fZmlsZScpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRnb29kc1JlY2VpdmVkTm90ZS0+Y2hhbGxhbl9maWxlKSkgewogICAgICAgICAgICAgICAgICAgIHVubGluayhwdWJsaWNfcGF0aCgkZ29vZHNSZWNlaXZlZE5vdGUtPmNoYWxsYW5fZmlsZSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVkTm90ZS0+Y2hhbGxhbl9maWxlID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2NoYWxsYW5fZmlsZScpLCAndXBsb2FkL2dybi9jaGFsbGFuLWZpbGUnKTsKICAgICAgICAgICAgICAgICRnb29kc1JlY2VpdmVkTm90ZS0+c2F2ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZW50cnkgPSAkdGhpcy0+cnVuTGVkZ2VyUXVlcmllcygkc3RvY2tJbnMsICRncm4pOwogICAgICAgICAgICBpZiAoaXNzZXQoJHB1cmNoYXNlX29yZGVyX2lkWzBdKSAmJiBpc3NldCgkZW50cnlbJ3N1Y2Nlc3MnXSkgJiYgJGVudHJ5WydzdWNjZXNzJ10pIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRwdXJjaGFzZV9vcmRlcl9pZCBhcyAka2V5ID0+ICRwb19pZCkgewogICAgICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwb19pZCktPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2dybicsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddWydpZCddLAogICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRzdG9ja0luc1swXSkpIHsKICAgICAgICAgICAgICAgICRwcm9qZWN0ID0gaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9uc1swXS0+cmVxdWlzaXRpb24tPnByb2plY3RUYXNrLT5pZCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3RvY2tJbnMgYXMgJGtleSA9PiAkc3RvY2tfaW5faWQpIHsKICAgICAgICAgICAgICAgICAgICAkc3RvY2tJbiA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmUoJ2lkJywgJHN0b2NrX2luX2lkKS0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAkY2FwaXRhbGl6ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRwcm9qZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc19jd2lwID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXBpdGFsaXplID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfZml4ZWRfYXNzZXQgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcGl0YWxpemUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjYXBpdGFsaXplICYmICRzdG9ja0luLT5yZWNlaXZlZF9xdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRiYXRjaCA9IEZpeGVkQXNzZXRCYXRjaDo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCcgPT4gJHN0b2NrSW4tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JhdGNoJyA9PiB1bmlxdWVDb2RlV2l0aG91dFByZWZpeCg4LCAnZml4ZWRfYXNzZXRfYmF0Y2hlcycsICdiYXRjaCcpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fbWV0aG9kX2lkJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5kZXByZWNpYXRpb25fbWV0aG9kX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Jhc2VfcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+YmFzZV9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JhdGVfbXVsdGlwbGllcicgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+cmF0ZV9tdWx0aXBsaWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9yYXRlJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5kZXByZWNpYXRpb25fcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc195ZWFybHknID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3llYXJseSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5ZWFycycgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+eWVhcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNfb25ldGltZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfb25ldGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fc3RhcnRfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHN0b2NrSW4tPnVwZGF0ZWRfYXQpKSwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYmF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAxOyAkaSA8PSAkc3RvY2tJbi0+cmVjZWl2ZWRfcXR5OyAkaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRml4ZWRBc3NldEJhdGNoSXRlbTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2JhdGNoX2lkJyA9PiAkYmF0Y2gtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzZXRfY29kZScgPT4gJGJhdGNoLT5iYXRjaCAuICctJyAuICRpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9tZXRob2RfaWQnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmRlcHJlY2lhdGlvbl9tZXRob2RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYXNlX3JhdGUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmJhc2VfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JhdGVfbXVsdGlwbGllcicgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+cmF0ZV9tdWx0aXBsaWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX3JhdGUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmRlcHJlY2lhdGlvbl9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNfeWVhcmx5JyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc195ZWFybHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5ZWFycycgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+eWVhcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc19vbmV0aW1lJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc19vbmV0aW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX3N0YXJ0X2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRzdG9ja0luLT51cGRhdGVkX2F0KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uCiAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkZ29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkZ29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIHRoZSBCaWxsaW5nLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1B1cmNoYXNlLURlcGFydG1lbnQnKSwgJ3NlbmQtdG8tYmlsbGluZycsICcnKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL3N1cHBsaWVyL3JhdGluZy8nIC4gJGdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkIC4gJy8nIC4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCAuICc/dGFibGU9Z29vZHNfcmVjZWl2ZWRfbm90ZXMmZmllbGQ9JyAuICRnb29kc1JlY2VpdmVkTm90ZS0+aWQgLiAnJnR5cGU9Z3JuJyktPndpdGgoWydtZXNzYWdlJyA9PiAnR1JOIFN1Y2Nlc3NmdWwnLCAnYWxlcnQtdHlwZScgPT4gJ3N1Y2Nlc3MnXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBydW5MZWRnZXJRdWVyaWVzKCRpZHMsICRncm4pCiAgICB7CiAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyk7CiAgICAgICAgJHN0b2NrSW5zID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUluKCdpZCcsICRpZHMpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpLT5nZXQoKTsKICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICBpZiAoaXNzZXQoJHN0b2NrSW5zWzBdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkc3RvY2tJbnMgYXMgJGtleSA9PiAkaXRlbSkgewogICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkOwoKICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J107CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3NlcnZpY2UgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjb2dzX2FjY291bnQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y29nc19hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkZGViaXRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRpdGVtLT50b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnR1JOIDo6IEludmVudG9yeSBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdncm4nLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRpdGVtLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAvLyAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydncmlyX2FjY291bnQnXSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGl0ZW0tPnRvdGFsX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnR1JOIDo6IEdSL0lSIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdncm4nLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRpdGVtLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgLy8gYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgIC8vICAgICAnY29zdF9jZW50cmVfaWQnID0+IDIsCiAgICAgICAgICAgICAgICAvLyAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfZGlzY291bnRfaWQpICYmICRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9kaXNjb3VudF9pZCA+IDAgPyAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfZGlzY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfcGF5YWJsZV9kaXNjb3VudF9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgLy8gICAgICdkZWJpdCcgPT4gJGl0ZW0tPmRpc2NvdW50LAogICAgICAgICAgICAgICAgLy8gICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAvLyAgICAgJ25hcnJhdGlvbicgPT4gJ0dSTiA6OiBTdXBwbGllciBEaXNjb3VudCBQYXlhYmxlIERlYml0JywKICAgICAgICAgICAgICAgIC8vIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICdHUk4nLCAkaXRlbXMsICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQpLCBmYWxzZSwgJ2pzb24nKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuU2xpcCgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gIkdSTiBTbGlwIjsKICAgICAgICAgICAgJG5vdGUgPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkaXRlbXMgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkbm90ZS0+aWQpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyk7CiAgICAgICAgICAgIH0pLT5nZXQoKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnbm90ZScgPT4gJG5vdGUsCiAgICAgICAgICAgICAgICAnaXRlbXMnID0+ICRpdGVtcwogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4uZ3JuLXNsaXAtcGRmJywgJGRhdGEsICR0aXRsZSwgJHRpdGxlKTsKCiAgICAgICAgICAgIC8vcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi1zdG9jay1pbi5ncm4tc2xpcCcsICRkYXRhKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KfQ==