<?php
bolt_decrypt( __FILE__ , 'XUbJAf'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcTWFpbFxQbXNcUmVxdWVzdEZvclByb3Bvc2FsVG9TdXBwbGllck1haWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbUF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJmcFxSZXF1ZXN0UHJvcG9zYWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsRGVmaW5lU3VwcGxpZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsRGV0YWlsczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFF1b3RhdGlvbnM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xRdW90YXRpb25zSXRlbXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllcnM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclBheW1lbnRUZXJtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWVzdFByb3Bvc2FsVHJhY2tpbmc7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbnM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xIclxEZXBhcnRtZW50Owp1c2UgQXBwXFVzZXI7Cgp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3lUeXBlOwoKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXEh0dHBcUmVxdWVzdHM7CnVzZSBEQiwgVmFsaWRhdG9yLCBBdXRoLCBWaWV3Owp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIFBERiwgVVJMLCBEYXRhVGFibGVzOwoKY2xhc3MgUmVBc3Nlc3NSZXF1aXNpdGlvbnNDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICAkcm93ID0gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnLCAnJywgJ3dpZHRoOjUlJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoyMCUnXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9ieScsICdyZXF1aXNpdGlvbl9ieScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2F0dGFjaG1lbnQnLCAnYXR0YWNobWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NhbGVhYmxlJywgJ3NhbGVhYmxlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKCiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpKSB7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVuc2V0KCRyb3dbN10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyb3c7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JZHMgPSBnZXRNZXJnZWRSZXF1aXNpc2lvbklEKFsKICAgICAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnID0+ICdubycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncmZwJywKICAgICAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnID0+ICdubycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgICAgICdhcHByb3ZlZF9pZCcgPT4gMSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgICAgICdyZXF1ZXN0X3N0YXR1cycgPT4gJ3NlbmRfcmZwJywKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigKICAgICAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb246OndoZXJlSW4oJ2lkJywgJHJlcXVpc2l0aW9uSWRzKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdBdWRpdCcsICdCaWxsaW5nJywgJ01hbmFnZW1lbnQnLCAnQWNjb3VudHMnXSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNzaWduZWRfdXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtcycgPT4gZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCByZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpKTsgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICdubycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uSXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtcy5wcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxEZWxpdmVyeUl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLT53aGVyZUhhcygncmVxdWlzaXRpb25JdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VuZCcsICdubycpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPmRvZXNudEhhdmUoJ3JlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLnJlbFJlcXVlc3RQcm9wb3NhbC5yZWxRdW90YXRpb25zJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCd1cGRhdGVkX2F0JywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ib3Blbk1vZGFsKCcgLiAkdmFsdWVzLT5pZCAuICcpIiAgY2xhc3M9ImJ0biBidG4tbGluayI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5yZXF1aXNpdGlvbl9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVxdWlzaXRpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKSA/ICR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBSZXF1aXNpdGlvbkl0ZW06OnNlbGVjdCgnbWFpbl9jYXRlZ29yeS5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZHVjdHMnLCAncHJvZHVjdHMuaWQnLCAnPScsICdyZXF1aXNpdGlvbl9pdGVtcy5wcm9kdWN0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIG1haW5fY2F0ZWdvcnknLCAnbWFpbl9jYXRlZ29yeS5pZCcsICc9JywgJ3N1Yl9jYXRlZ29yeS5wYXJlbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncmVxdWlzaXRpb25faXRlbXMucmVxdWlzaXRpb25faWQnLCAncmVxdWlzaXRpb25zLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfc2hvcnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdocl91bml0LmhyX3VuaXRfaWQnLCAncmVxdWlzaXRpb25zLmhyX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+bmFtZSkgPyAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhdHRhY2htZW50ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1B1cmNoYXNlLURlcGFydG1lbnQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdmFsdWVzLT5hdHRhY2htZW50KSAmJiBmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkdmFsdWVzLT5hdHRhY2htZW50KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0YWNobWVudCAuPSAnPGEgaHJlZj0iJyAuIHVybCgkdmFsdWVzLT5hdHRhY2htZW50KSAuICciIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSI+PGkgY2xhc3M9ImxhcyBsYS1wYXBlcmNsaXAiPjwvaT5BdHRhY2htZW50PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXR0YWNobWVudDsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInLnVybCgncG1zL3JmcC9yZS1hc3Nlc3MtcmVxdWlzaXRpb25zLycuJHZhbHVlcy0+aWQpLiciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIHRleHQtd2hpdGUiPjxpIGNsYXNzPSJsYXMgbGEtcmV0d2VldCI+PC9pPiZuYnNwO1JlLUFzc2VzczwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ2F0dGFjaG1lbnQnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdSZS1Bc3Nlc3MgUmVxdWlzaXRpb25zJywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJmcC5yZS1hc3Nlc3MuaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAnaXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJmcC5yZS1hc3Nlc3MuZWRpdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIlJlLUFzc2VzcyBSZXF1aXNpdGlvbiIsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb24nID0+ICRyZXF1aXNpdGlvbiwKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zdGF0dXMgPSAzOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPmlzX2ZpbmFuY2VfYXBwcm92YWwgPSAncGVuZGluZyc7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aXNfc2VuZF90b19yZnAgPSAnbm8nOwogICAgICAgICAgICAkcmVxdWlzaXRpb24tPmFzc2Vzc21lbnQgPSAneWVzJzsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5hc3Nlc3NtZW50X29wdGlvbiA9ICRyZXF1ZXN0LT5hc3Nlc3NtZW50X29wdGlvbjsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5hc3Nlc3NtZW50X3N0YXR1cyA9ICdwZW5kaW5nJzsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICAkaXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ3Byb2R1Y3QnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uLT5pZCkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSBbXTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRpdGVtc1swXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAkaXRlbV9rZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRpdGVtX2tleSsxXSkgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRpdGVtX2tleSsxXSkgJiYgY291bnQoJHJlcXVlc3QtPmF0dHJpYnV0ZV9vcHRpb25zWyRpdGVtX2tleSsxXSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5hdHRyaWJ1dGVfb3B0aW9uc1skaXRlbV9rZXkrMV0gYXMgJGF0dHJpYnV0ZV9pZCA9PiAkYXR0cmlidXRlX29wdGlvbl9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2F0dHJpYnV0ZXNbJGl0ZW1fa2V5KzFdKSAmJiBpbl9hcnJheSgkYXR0cmlidXRlX2lkLCAkcmVxdWVzdC0+cHJvZHVjdF9hdHRyaWJ1dGVzWyRpdGVtX2tleSsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhdHRyaWJ1dGVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pdGVtX2lkJyA9PiAkaXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVfb3B0aW9uX2lkJyA9PiBnZXRBdHRyaWJ1dGVPcHRpb24oJGl0ZW0tPnByb2R1Y3QtPmNhdGVnb3J5X2lkLCAkYXR0cmlidXRlX2lkLCAkYXR0cmlidXRlX29wdGlvbl9pZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiAkcmVxdWlzaXRpb24tPmF1dGhvcl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRhdHRyaWJ1dGVzWzBdKSkgewogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtQXR0cmlidXRlOjp3aGVyZUluKCdyZXF1aXNpdGlvbl9pdGVtX2lkJywgJHJlcXVpc2l0aW9uLT5pdGVtcy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSktPmRlbGV0ZSgpOwogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtQXR0cmlidXRlOjppbnNlcnQoJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgJ1JlcXVpc2l0aW9uIGhhcyBiZWVuIHNlbnQgRW1wbG95ZWUgZm9yIFJlLUFzc2Vzc21lbnQuJyk7CiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL3JmcC9yZS1hc3Nlc3MtcmVxdWlzaXRpb25zJyk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==