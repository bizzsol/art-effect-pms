<?php
bolt_decrypt( __FILE__ , 'G2lWQs'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7Cgp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UcmFja2luZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3RVbml0Q29udmVyc2lvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5U3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEludmVudG9yeU1vZGVsc1xJbnZlbnRvcnlEZXRhaWxzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUxvZ3M7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXEhyXEFjY291bnRzXFVuaXQ7CnVzZSBcQXBwXFVzZXI7Cgp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcVmlldzsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCLCBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWYWxpZGF0b3IsIElsbHVtaW5hdGVcU3VwcG9ydFxTdHI7CnVzZSBZYWpyYVxEYXRhVGFibGVzXEZhY2FkZXNcRGF0YVRhYmxlczsKCmNsYXNzIFN0b3JlQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9ieScsICdhcHByb3ZlZF9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9ieScsICdyZXF1aXNpdGlvbl9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydkZWxpdmVyeScsICdkZWxpdmVyeScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgkZGVsaXZlcnlTdGF0dXMgPSBudWxsKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRoZWFkZXJDb2x1bW5zID0gJHRoaXMtPmhlYWRlckNvbHVtbnMoKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICghZW1wdHkoJGRlbGl2ZXJ5U3RhdHVzKSA/ICdDb21wbGV0ZScgOiAnUGVuZGluZycpIC4gJyBEZWxpdmVyeSBsaXN0IGZvciBSZXF1aXNpdGlvbic7CiAgICAgICAgICAgICRkZWxpdmVyeVN0YXR1cyA9ICRkZWxpdmVyeVN0YXR1cyA/PyAncGFydGlhbC1kZWxpdmVyZWQnOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKCdyZWxVc2Vyc0xpc3QnLCAncmVxdWlzaXRpb25JdGVtcycsICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsRGVsaXZlcnlJdGVtcycpCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAxKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdyZWZlcmVuY2Vfbm8nLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdjb25maXJtLWRlbGl2ZXJ5JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjb25maXJtLWRlbGl2ZXJ5JyksCiAgICAgICAgICAgICAgICAnc2VuZC10by1yZnAnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3NlbmQtdG8tcmZwJykKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRyZXF1aXNpdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ib3Blbk1vZGFsKCcgLiAkdmFsdWVzLT5pZCAuICcpIiAgY2xhc3M9ImJ0biBidG4tbGluayI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5yZXF1aXNpdGlvbl9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVxdWlzaXRpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkdmFsdWVzLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lKSA/ICR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhcHByb3ZlZEJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyeScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnJlcXVpc2l0aW9uLWRlbGl2ZXJlZC1saXN0JywgJHZhbHVlcy0+aWQpIC4gJyIgZGF0YS10b2dnbGU9InRvb2x0aXAiIHRpdGxlPSJDbGljayBoZXJlIHRvIHZpZXcgZGV0YWlscyIgdGFyZ2V0PSJfYmxhbmsiPiBUb3RhbCAoJyAuIGNvdW50KCR2YWx1ZXMtPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnkpIC4gJyk8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHVzZSAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+ZGVsaXZlcnlfc3RhdHVzID09ICdkZWxpdmVyZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPHNwYW4+RnVsbCBEZWxpdmVyZWQ8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4gaWQ9InN0YXR1c05hbWUnIC4gJHZhbHVlcy0+aWQgLiAnIj5BY3Rpb248L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1snY29uZmlybS1kZWxpdmVyeSddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpc2l0aW9uSGFzU3RvY2soJHZhbHVlcy0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnN0b3JlLXJlcXVpc2l0aW9uLmRlbGl2ZXJ5JywgJHZhbHVlcy0+aWQpIC4gJyIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gQ29uZmlybSBEZWxpdmVyeSI+Q29uZmlybSBEZWxpdmVyeTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1snc2VuZC10by1yZnAnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5yZXF1ZXN0X3N0YXR1cyA9PSBOVUxMICYmICR2YWx1ZXMtPmlzX3BvX2dlbmVyYXRlID09ICdubycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaSBpZD0iaGlkZUZyb21MaXN0JyAuICR2YWx1ZXMtPmlkIC4gJyI+PGEgY2xhc3M9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCIgb25jbGljaz0ic2VuZFRvUHVyY2hhc2VEZXBhcnRtZW50KCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLmNoYW5nZS5hY3Rpb24udG8ucmZwJykgLiAnIiBkYXRhLWlkPSInIC4gJHZhbHVlcy0+aWQgLiAnIiAgdGl0bGU9IlNlbmQgVG8gUHJvY3VyZW1lbnQgIj5TZW5kIFRvIFByb2N1cmVtZW50PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iVHJhY2tpbmcgUmVxdWlzaXRpb24iIGNsYXNzPSJ0cmFja2luZ1JlcXVpc3Rpb25TdGF0dXMiIG9uY2xpY2s9InRyYWNrUmVxdWlzaXRpb25Qcm9ncmVzcygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyI+PGkgY2xhc3M9ImxhIGxhLW1hcCI+PC9pPiZuYnNwO1RyYWNrIFByb2dyZXNzPC9hPjwvbGk+JzsKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2Vfbm8nLCAnZGVsaXZlcnknLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9uLWRlbGl2ZXJ5LmluZGV4JywgY29tcGFjdCgndGl0bGUnLCAnaGVhZGVyQ29sdW1ucycpKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlSGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICAkcm93ID0gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWyd1bml0JywgJ3VuaXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZWZlcmVuY2Vfbm8nLCAncmVmZXJlbmNlX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fZGF0ZScsICdyZXF1aXNpdGlvbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGVwYXJ0bWVudCcsICdkZXBhcnRtZW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncHJvZHVjdF9jYXRlZ29yeScsICdwcm9kdWN0X2NhdGVnb3J5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc2FsZWFibGUnLCAnc2FsZWFibGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9ieScsICdhcHByb3ZlZF9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZVJlcXVpc2l0aW9uTGlzdFZpZXcoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aXRsZSA9ICdTdG9yZSBSZXF1aXNpdGlvbiBMaXN0IFZpZXcnOwogICAgICAgICAgICAkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgJHVzZXJEZXBhcnRtZW50cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICR1c2VyU2VjdGlvbnMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3NlY3Rpb25faWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAgICAgJGZyb20gPSByZXF1ZXN0KCktPmhhcygnZnJvbScpID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSA6IG51bGw7CiAgICAgICAgICAgICR0byA9IHJlcXVlc3QoKS0+aGFzKCd0bycpID8gcmVxdWVzdCgpLT5nZXQoJ3RvJykgOiBudWxsOwogICAgICAgICAgICAkY2F0ZWdvcnlfaWQgPSByZXF1ZXN0KCktPmhhcygnY2F0ZWdvcnlfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjYXRlZ29yeV9pZCcpIDogMDsKICAgICAgICAgICAgJGRlcGFydG1lbnRfaWQgPSByZXF1ZXN0KCktPmhhcygnZGVwYXJ0bWVudF9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2RlcGFydG1lbnRfaWQnKSA6IDA7CiAgICAgICAgICAgICRhcHByb3ZlZF9ieSA9IHJlcXVlc3QoKS0+aGFzKCdhcHByb3ZlZF9ieScpID8gcmVxdWVzdCgpLT5nZXQoJ2FwcHJvdmVkX2J5JykgOiAwOwoKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IERlcGFydG1lbnQ6OndoZXJlSW4oJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKS0+Z2V0KCk7CgogICAgICAgICAgICAkYXBwcm92ZXJzID0gUmVxdWlzaXRpb246OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3Byb2Nlc3NpbmcnLCAnaXNfc2VuZF90b19yZnAnID0+ICdubycsICdpc19maW5hbmNlX2FwcHJvdmFsJyA9PiAnYXBwcm92ZWQnXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVycycgPT4gJGFwcHJvdmVycywKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gJGRlcGFydG1lbnRzLAogICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG8sCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9ieScgPT4gJGFwcHJvdmVkX2J5LAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRfaWQnID0+ICRkZXBhcnRtZW50X2lkLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5zdG9yZUhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAndW5pdCcsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRCeScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVzZXJVbml0cywgJHVzZXJEZXBhcnRtZW50cywgJHVzZXJTZWN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgICAgICAgICAvLyAtPndoZXJlSW4oJ2FzX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCRmcm9tKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb20pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPj0nLCAkZnJvbSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkdG8pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG8pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG8pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkZGVwYXJ0bWVudF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudF9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGFwcHJvdmVkX2J5ID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYXBwcm92ZWRfYnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXBwcm92ZWRfYnknLCAkYXBwcm92ZWRfYnkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY2F0ZWdvcnlfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwcm9jZXNzaW5nJywKICAgICAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICdubycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX2ZpbmFuY2VfYXBwcm92YWwnID0+ICdhcHByb3ZlZCcKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcmVkJywKICAgICAgICAgICAgICAgICAgICAncGFydGlhbC1kZWxpdmVyZWQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdjb25maXJtLWRlbGl2ZXJ5JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjb25maXJtLWRlbGl2ZXJ5JyksCiAgICAgICAgICAgICAgICAnc2VuZC10by1yZnAnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3NlbmQtdG8tcmZwJykKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRyZXF1aXNpdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ib3Blbk1vZGFsKCcgLiAkdmFsdWVzLT5pZCAuICcpIiAgY2xhc3M9ImJ0biBidG4tbGluayI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5yZXF1aXNpdGlvbl9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVxdWlzaXRpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdmFsdWVzLT5Vbml0LT5ocl91bml0X3Nob3J0X25hbWU7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVbml0OjpzZWxlY3QoJ2hyX3VuaXQuaHJfdW5pdF9zaG9ydF9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2hyX3VuaXQuaHJfdW5pdF9pZCcsICdyZXF1aXNpdGlvbnMuaHJfdW5pdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSkgPyAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS5kZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfYXNfYmFzaWNfaW5mbycsICdocl9hc19iYXNpY19pbmZvLmFzc29jaWF0ZV9pZCcsICc9JywgJ3VzZXJzLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2RlcGFydG1lbnQnLCAnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X2lkJywgJz0nLCAnaHJfYXNfYmFzaWNfaW5mby5hc19kZXBhcnRtZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcmVxdWlzaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRyZXF1aXNpdGlvbi0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBSZXF1aXNpdGlvbkl0ZW06OnNlbGVjdCgnbWFpbl9jYXRlZ29yeS5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZHVjdHMnLCAncHJvZHVjdHMuaWQnLCAnPScsICdyZXF1aXNpdGlvbl9pdGVtcy5wcm9kdWN0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIG1haW5fY2F0ZWdvcnknLCAnbWFpbl9jYXRlZ29yeS5pZCcsICc9JywgJ3N1Yl9jYXRlZ29yeS5wYXJlbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncmVxdWlzaXRpb25faXRlbXMucmVxdWlzaXRpb25faWQnLCAncmVxdWlzaXRpb25zLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUpID8gJHZhbHVlcy0+YXBwcm92ZWRCeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2FwcHJvdmVkQnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hcHByb3ZlZF9ieScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHVzZSAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOS41IDEzYTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHoiLz48L3N2Zz48L2J1dHRvbj48dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ2NvbmZpcm0tZGVsaXZlcnknXSAmJiAkdmFsdWVzLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmlzX3NlcnZpY2UgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpc2l0aW9uSGFzU3RvY2soJHZhbHVlcy0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUtcmVxdWlzaXRpb24uZGVsaXZlcnknLCAkdmFsdWVzLT5pZCkgLiAnIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBDb25maXJtIERlbGl2ZXJ5Ij5Db25maXJtIERlbGl2ZXJ5PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydzZW5kLXRvLXJmcCddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+aXNfc2VuZF90b19yZnAgPT0gJ25vJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgY2xhc3M9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCIgb25jbGljaz0ic2VuZFRvUHVyY2hhc2VEZXBhcnRtZW50KCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnNlbmQudG8ucHVyY2hhc2UuZGVwYXJ0bWVudCcpIC4gJyIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgdGl0bGU9IlNlbmQgVG8gUHJvY3VyZW1lbnQiPlNlbmQgVG8gUHJvY3VyZW1lbnQ8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiB0aXRsZT0iVHJhY2tpbmcgUmVxdWlzaXRpb24iIGNsYXNzPSJ0cmFja1JlcXVpc2l0aW9uUHJvZ3Jlc3MiIG9uY2xpY2s9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cygnIC4gJHZhbHVlcy0+aWQgLiAnKSIgPjxpIGNsYXNzPSIiPjwvaT4mbmJzcDtUcmFjayBQcm9ncmVzczwvYT48L2xpPic7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2Vfbm8nLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLXJlcXVpc2l0aW9uLWxpc3QtdmlldycsICRkYXRhKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZVJlcXVpc2l0aW9uTGlzdFZpZXdTZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgJGZyb21EYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmZyb21fZGF0ZSkpOwogICAgICAgICR0b0RhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+dG9fZGF0ZSkpOwoKICAgICAgICAkcmVxdWlzaXRpb25CeSA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9ieTsKICAgICAgICAkcmVxdWlzaXRpb25TdGF0dXMgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25fc3RhdHVzOwoKICAgICAgICAkcmVxdWlzdGlvbkRhdGEgPSBSZXF1aXNpdGlvbjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tRGF0ZSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG9EYXRlKQogICAgICAgICAgICAtPndoZW4oJHJlcXVpc2l0aW9uQnksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uQnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCAkcmVxdWlzaXRpb25CeSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+ICRyZXF1aXNpdGlvblN0YXR1cywgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3Byb2Nlc3NpbmcnLCAnaXNfc2VuZF90b19yZnAnID0+ICdubyddKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvdW50KCRyZXF1aXN0aW9uRGF0YSkgPiAwKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLXNlYXJjaC1yZXN1bHQtdmlldycsCiAgICAgICAgICAgICAgICAgICAgWydyZXF1aXN0aW9uRGF0YScgPT4gJHJlcXVpc3Rpb25EYXRhXSk7CiAgICAgICAgICAgICAgICAkY29udGVudHMgPSAkYm9keS0+cmVuZGVyKCk7CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdEYXRhIG5vdCBmb3VuZC4hISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXBhcnRtZW50V2lzZUVtcGxveWVlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gPSAnJzsKCiAgICAgICAgJGRlcGFydG1lbnRJZCA9ICRyZXF1ZXN0LT5kZXBhcnRtZW50X2lkOwoKICAgICAgICAkZW1wbG95ZWUgPSBSZXF1aXNpdGlvbjo6d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRJZCkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50SWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc191bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICB9KQogICAgICAgICAgICAtPmdyb3VwQnkoJ2F1dGhvcl9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+IDEsICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwcm9jZXNzaW5nJywgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nXSkKICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ2RlbGl2ZXJlZCcsICdwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLVNlbGVjdCBPbmUtLTwvb3B0aW9uPic7CiAgICAgICAgaWYgKCFlbXB0eSgkZW1wbG95ZWUpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRlbXBsb3llZSBhcyAkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAnPG9wdGlvbiB2YWx1ZT0iJyAuICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+aWQgLiAnIj4nIC4gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5uYW1lIC4gJzwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAiPG9wdGlvbiB2YWx1ZT0nJz5ObyBFbXBsb3llZSBGb3VuZCEhPC9vcHRpb24+IjsKICAgICAgICB9CgogICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJmcFJlcXVpc2l0aW9uTGlzdChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkdGl0bGUgPSAnUkZQIFJlcXVpc2l0aW9uIExpc3QnOwogICAgICAgICAgICAvLyAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogZGF0ZSgnWS1tLTAxJyk7CiAgICAgICAgICAgIC8vICR0byA9IHJlcXVlc3QoKS0+aGFzKCd0bycpID8gcmVxdWVzdCgpLT5nZXQoJ3RvJykgOiBkYXRlKCdZLW0tdCcpOwogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogbnVsbDsKICAgICAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IG51bGw7CiAgICAgICAgICAgICRjYXRlZ29yeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjYXRlZ29yeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NhdGVnb3J5X2lkJykgOiAwOwogICAgICAgICAgICAkZGVwYXJ0bWVudF9pZCA9IHJlcXVlc3QoKS0+aGFzKCdkZXBhcnRtZW50X2lkJykgPyByZXF1ZXN0KCktPmdldCgnZGVwYXJ0bWVudF9pZCcpIDogMDsKICAgICAgICAgICAgJGFwcHJvdmVkX2J5ID0gcmVxdWVzdCgpLT5oYXMoJ2FwcHJvdmVkX2J5JykgPyByZXF1ZXN0KCktPmdldCgnYXBwcm92ZWRfYnknKSA6IDA7CgogICAgICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpLT5nZXQoKTsKCiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IFJlcXVpc2l0aW9uOjp3aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX2RlcGFydG1lbnQuaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5qb2luKCd1c2VycycsICd1c2Vycy5pZCcsICc9JywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywgJz0nLCAndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignaHJfZGVwYXJ0bWVudCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgICAgICAtPmdldChbJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZSddKTsKCiAgICAgICAgICAgICRhcHByb3ZlcnMgPSBSZXF1aXNpdGlvbjo6d2l0aCgnYXBwcm92ZWRCeScpCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2FwcHJvdmVkX2J5JykKICAgICAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+IDEsICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcyddKQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ2RlbGl2ZXJlZCcsICdwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5yZWxJbnZlbnRvcnlEZXRhaWxzJywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkQnknLAogICAgICAgICAgICAgICAgJ1VuaXQnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCRmcm9tKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb20pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPj0nLCAkZnJvbSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkdG8pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG8pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG8pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkZGVwYXJ0bWVudF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudF9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGFwcHJvdmVkX2J5ID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYXBwcm92ZWRfYnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXBwcm92ZWRfYnknLCAkYXBwcm92ZWRfYnkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY2F0ZWdvcnlfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGNhdGVnb3J5X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcmVkJywKICAgICAgICAgICAgICAgICAgICAncGFydGlhbC1kZWxpdmVyZWQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVmZXJlbmNlX25vJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlybS1kZWxpdmVyeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29uZmlybS1kZWxpdmVyeScpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJHJlcXVpc2l0aW9ucykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJvcGVuTW9kYWwoJyAuICR2YWx1ZXMtPmlkIC4gJykiICBjbGFzcz0iYnRuIGJ0bi1saW5rIj4nIC4gJHZhbHVlcy0+cmVmZXJlbmNlX25vIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2YWx1ZXMtPnJlcXVpc2l0aW9uX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZXF1aXNpdGlvbl9kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2YWx1ZXMtPlVuaXQtPmhyX3VuaXRfbmFtZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ1VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl91bml0X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVuaXQ6OnNlbGVjdCgnaHJfdW5pdC5ocl91bml0X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignaHJfdW5pdC5ocl91bml0X2lkJywgJ3JlcXVpc2l0aW9ucy5ocl91bml0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lKSA/ICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywgJz0nLCAndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfZGVwYXJ0bWVudCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKSA/ICRyZXF1aXNpdGlvbi0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFJlcXVpc2l0aW9uSXRlbTo6c2VsZWN0KCdtYWluX2NhdGVnb3J5Lm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwcm9kdWN0cycsICdwcm9kdWN0cy5pZCcsICc9JywgJ3JlcXVpc2l0aW9uX2l0ZW1zLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIHN1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnkuaWQnLCAnPScsICdwcm9kdWN0cy5jYXRlZ29yeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgbWFpbl9jYXRlZ29yeScsICdtYWluX2NhdGVnb3J5LmlkJywgJz0nLCAnc3ViX2NhdGVnb3J5LnBhcmVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtcy5yZXF1aXNpdGlvbl9pZCcsICdyZXF1aXNpdGlvbnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+YXBwcm92ZWRCeS0+bmFtZSkgPyAkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYXBwcm92ZWRCeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmFwcHJvdmVkX2J5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgdXNlICgkb3B0aW9ucykgewoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJjdXJyZW50Q29sb3IiIGNsYXNzPSJiaSBiaS10aHJlZS1kb3RzLXZlcnRpY2FsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPjxwYXRoIGQ9Ik05LjUgMTNhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAweiIvPjwvc3ZnPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRzdG9ja1F0eSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdmFsdWVzLT5pdGVtcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR2YWx1ZXMtPml0ZW1zIGFzICRpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUXR5ICs9IGlzc2V0KCRpdGVtLT5wcm9kdWN0LT5yZWxJbnZlbnRvcnlEZXRhaWxzKSA/IGNvbGxlY3QoJGl0ZW0tPnByb2R1Y3QtPnJlbEludmVudG9yeURldGFpbHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLT5zdW0oJ3F0eScpIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdG9ja1F0eSA+IDAgJiYgcmVxdWlzaXRpb25IYXNTdG9jaygkdmFsdWVzLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1snY29uZmlybS1kZWxpdmVyeSddICYmICR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+aXNfc2VydmljZSA9PSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRub25Ob3RpZmllZCA9ICR2YWx1ZXMtPml0ZW1zKCktPmRvZXNudEhhdmUoJ25vdGlmaWNhdGlvbicpLT5jb3VudCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG5vbk5vdGlmaWVkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5yZXF1aXNpdGlvbi5pdGVtcy5saXN0JywgJHZhbHVlcy0+aWQpIC4gJyI+U2hvdyBOb3RpZmljYXRpb248L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUtcmVxdWlzaXRpb24uZGVsaXZlcnknLCAkdmFsdWVzLT5pZCkgLiAnIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBDb25maXJtIERlbGl2ZXJ5Ij5Db25maXJtIERlbGl2ZXJ5PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJUcmFjayBQcm9ncmVzcyIKICAgICAgICAgICAgICAgIGNsYXNzPSJ0cmFja2luZ1JlcXVpc3Rpb25TdGF0dXMiIG9uY2xpY2s9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyI+PGkgY2xhc3M9ImxhIGxhLW1hcCI+PC9pPlRyYWNrIFByb2dyZXNzPC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5oaXN0b3J5JywgJHZhbHVlcy0+aWQpIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWhpc3RvcnkiIHRpdGxlPSJSZXF1aXNpdGlvbiBIaXN0b3J5Ij48L2k+UmVxdWlzaXRpb24gSGlzdG9yeTwvYT48L2xpPC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVycycgPT4gJGFwcHJvdmVycywKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gJGRlcGFydG1lbnRzLAogICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG8sCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9ieScgPT4gJGFwcHJvdmVkX2J5LAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRfaWQnID0+ICRkZXBhcnRtZW50X2lkLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5zdG9yZUhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1yZnAtcmVxdWlzaXRpb24tbGlzdCcsICRkYXRhKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlcmFyY2guCiAgICAgKiBTZWFyY2ggYmV0d2VlbiBmcm9tIGFuZCB0byBkYXRlIGFuZCBhbHNvIHVzZXIgY2FuIHNlYXJjaCBieSBlbXBsb3llZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmZwRGVwYXJ0bWVudFdpc2VFbXBsb3llZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRyZXNwb25zZVsnZGF0YSddID0gJyc7CgogICAgICAgICRkZXBhcnRtZW50SWQgPSAkcmVxdWVzdC0+ZGVwYXJ0bWVudF9pZDsKCiAgICAgICAgJGVtcGxveWVlID0gUmVxdWlzaXRpb246OndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50SWQpIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudElkKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnXSkKICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ2RlbGl2ZXJlZCcsICdwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2F1dGhvcl9pZCcpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSIiPi0tU2VsZWN0IE9uZS0tPC9vcHRpb24+JzsKICAgICAgICBpZiAoIWVtcHR5KCRlbXBsb3llZSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGVtcGxveWVlIGFzICR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSInIC4gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5pZCAuICciPicgLiAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgLiAnPC9vcHRpb24+JzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICI8b3B0aW9uIHZhbHVlPScnPk5vIEVtcGxveWVlIEZvdW5kISE8L29wdGlvbj4iOwogICAgICAgIH0KCiAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcgc2VyYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiByZnBSZXF1aXNpdGlvblNlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRmcm9tRGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5mcm9tX2RhdGUpKTsKICAgICAgICAkdG9EYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnRvX2RhdGUpKTsKICAgICAgICAkZGVwYXJ0bWVudElkID0gJHJlcXVlc3QtPmRlcGFydG1lbnRfaWQ7CgogICAgICAgICRyZXF1aXNpdGlvbkJ5ID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2J5OwogICAgICAgICRyZXF1aXNpdGlvblN0YXR1cyA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9zdGF0dXM7CgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPj0nLCAkZnJvbURhdGUpCiAgICAgICAgICAgIC0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJzw9JywgJHRvRGF0ZSkKICAgICAgICAgICAgLT53aGVuKCRyZXF1aXNpdGlvbkJ5LCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXV0aG9yX2lkJywgJHJlcXVpc2l0aW9uQnkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oJGRlcGFydG1lbnRJZCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudElkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudElkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudElkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAkcmVxdWlzaXRpb25TdGF0dXMsICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcyddKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+cGFnaW5hdGUoMzApOwoKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1aXNpdGlvblswXSkpIHsKICAgICAgICAgICAgICAgICRib2R5ID0gVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUucmZwLXNlYXJjaC1yZXN1bHQtdmlldycsCiAgICAgICAgICAgICAgICAgICAgWydyZXF1aXNpdGlvbicgPT4gJHJlcXVpc2l0aW9uXSk7CiAgICAgICAgICAgICAgICAkY29udGVudHMgPSAkYm9keS0+cmVuZGVyKCk7CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdEYXRhIG5vdCBmb3VuZC4hISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXF1aXN0aW9uIGl0ZW0gbGlzdC4KICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHJlcXVpc2l0aW9uSXRlbXNMaXN0KCRpZCkKICAgIHsKCiAgICAgICAgJHRpdGxlID0gIlJlcXVpc2l0aW9uIEl0ZW1zIExpc3QiOwoKICAgICAgICAvL0ZpbmQgcmVxdWlzdGlvbgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZSgnaWQnLCAkaWQpCiAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+IDEsICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcyddKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5yZXF1aXNpdGlvbi1pdGVtcy1saXN0JywgY29tcGFjdCgndGl0bGUnLCAncmVxdWlzaXRpb24nKSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbm90aWZpY2F0aW9uIHRvIHVzZXJzLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZE5vdGlmaWNhdGlvblRvVXNlcnMoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKCiAgICAgICAgLy9WYWxpZGF0ZSBpbnB1dGUgcmVxdWVzdAogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnaXRlbXNfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICBdKTsKCiAgICAgICAgLy9EYiB0cmFuc2FjdGlvbiBzdGFydAogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAvL0NyYXRlIGluc3RhbmNlIG9mIGl0ZW1zX2lkCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5pdGVtc19pZCBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAvL0NoZWNrIHJlcXVpc2l0aW9uIGl0ZW0KICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpZCcsICRpdGVtKQogICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRyZXF1aXNpdGlvbkl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT51c2VyX2lkID0gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPmF1dGhvcl9pZDsKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5yZXF1aXNpdGlvbl9pdGVtX2lkID0gJGl0ZW07CgogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcgQW5kIEl0ZW0gTmFtZTogJyAuICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPm5hbWUgLiAnLiBQbGVhc2UgQ29sbGVjdCBZb3VyIHByb2R1Y3QgZnJvbSBzdG9yZTwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5tZXNzYWdlcyA9ICRtZXNzYWdlOwoKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5zdGF0dXMgPSAncmVxdWlzaXRpb24nOwogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdObyBkYXRhIGZvdW5kJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHNlbmQgdG8gdXNlcnMnKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYmFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgaW52ZW50b3J5IGNvbXBhcmUgZGF0YS4KICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlSW52ZW50b3J5Q29tcGFyZSgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gJ1N0b3JlIEludmVudG9yeSBDb21wYXJlJzsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsRGVsaXZlcnlJdGVtcycsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5yZWxJbnZlbnRvcnlEZXRhaWxzJywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAnaXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS5sb2NhdGlvbicsCiAgICAgICAgICAgICAgICAncHJvamVjdFRhc2suc3ViRGVsaXZlcmFibGUuZGVsaXZlcmFibGUucHJvamVjdCcsCiAgICAgICAgICAgICAgICAnYXR0YWNobWVudHMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAvLyAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAtPmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICRyZXF1aXNpdGlvblsncmVxdWlzaXRpb25fcXR5J10gPSAkcmVxdWlzaXRpb24tPml0ZW1zLT5zdW0oJ3F0eScpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwgJGkpIHsKICAgICAgICAgICAgICAgICRpdGVtWydkZWxpdmVyeV9xdHknXSA9ICRpdGVtLT5yZWxEZWxpdmVyeUl0ZW1zLT5zdW0oJ2RlbGl2ZXJ5X3F0eScpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uWyd0b3RhbF9kZWxpdmVyeV9xdHknXSA9ICRyZXF1aXNpdGlvbi0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+c3VtKCdkZWxpdmVyeV9xdHknKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1pbnZlbnRvcnktY29tcGFyZScsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uJykpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpcm0gZGVsaXZlcnkgZGF0YSByZXR1cm4gdG8gc3RvcmUgaW52ZW50b3J5IGNvbXBhcmUgZGVsaXZlcnkgLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gY29uZmlybURlbGl2ZXJ5KCRpZCkKICAgIHsKCiAgICAgICAgLy9NYWtlIHByZWZpeCBmb3IgY29uZmlybSBkZWxpdmVyeS4KICAgICAgICAkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAkdXNlclNlY3Rpb25zID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9zZWN0aW9uX2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgLy9GaW5kIHJlcXVpc3Rpb24uCiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAncmVsVXNlcnNMaXN0JywKICAgICAgICAgICAgJ1VuaXQnCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzLCAkdXNlckRlcGFydG1lbnRzLCAkdXNlclNlY3Rpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2FzX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgICRwcmVmaXggPSAnQ0QtJyAuIGRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpIC4gJy0nIC4gJHJlcXVpc2l0aW9uLT5Vbml0LT5ocl91bml0X3Nob3J0X25hbWUgLiAnLSc7CiAgICAgICAgJHJlZk5vID0gdW5pcXVlQ29kZSgxNCwgJHByZWZpeCwgJ3JlcXVpc2l0aW9uX2RlbGl2ZXJpZXMnLCAnaWQnKTsKCiAgICAgICAgLy9NYWtlIHRpdGxlLgogICAgICAgICR0aXRsZSA9ICdTdG9yZSBJbnZlbnRvcnkgQ29uZmlybSBEZWxpdmVyeSB0bzogJyAuICRyZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5uYW1lOwoKICAgICAgICB0cnkgewoKICAgICAgICAgICAgLy9SZXF1aXNpdGlvbiBpdGVtcyBjb2xsZWN0IHVzaW5nIHJlcXVpc3Rpb25JZC4KICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ3Byb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QucmVsSW52ZW50b3J5U3VtbWFyeScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5yZWxJbnZlbnRvcnlEZXRhaWxzLnJlbFdhcmVob3VzZScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdENvbnZlcnNpb25zLnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdwcm9kdWN0LnByb2R1Y3RVbml0Q29udmVyc2lvbnMuY29udmVyc2lvblVuaXQnLAoKICAgICAgICAgICAgICAgICdwcm9kdWN0LmludmVudG9yeUxvZ3Muc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignZGVsaXZlcnlfc3RhdHVzJywgWydwcm9jZXNzaW5nJywgJ3BhcnRpYWwtZGVsaXZlcmVkJywgJ3JmcCddKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXJEZXBhcnRtZW50cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkaWQpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHdhcmVob3VzZXMgPSBXYXJlaG91c2VzOjp3aGVyZUluKCdpZCcsIGF1dGgoKS0+dXNlcigpLT5yZWxVc2Vyc1dhcmVob3VzZS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSktPmdldCgpOwogICAgICAgICAgICAkc3RvY2tzID0gW107CiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1aXNpdGlvbkl0ZW1zIGFzICRrZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgICRzdG9ja3NbJGl0ZW0tPmlkXSA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRpdGVtLT5wcm9kdWN0LT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlcyA9ICRpdGVtLT5hdHRyaWJ1dGVzLT5wbHVjaygnYXR0cmlidXRlX29wdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRpdGVtLT5xdHkgIT0gJGl0ZW0tPmRlbGl2ZXJ5X3F0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2tzWyRpdGVtLT5pZF0gPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUluKCd3YXJlaG91c2VfaWQnLCBhdXRoKCktPnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdzdG9ja0luLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy5hdHRyaWJ1dGVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+c2VsZWN0KFxEQjo6cmF3KCdjb3VudChkaXN0aW5jdCBpZCknKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJywgJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgJz0nLCBjb3VudCgkYXR0cmlidXRlcykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRpdGVtLT5wcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJGl0ZW0tPnByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IChpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpID8gYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkIDogMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ3dhcmVob3VzZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGBhdmFpbGFibGVgKSBhcyBhdmFpbGFibGUnKSwgJ3dhcmVob3VzZV9pZCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdhdmFpbGFibGUnLCAnd2FyZWhvdXNlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICRjb3N0Q2VudHJlcyA9IGdldENvc3RDZW50cmVzKHRydWUpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWludmVudG9yeS1kZWxpdmVyeScsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uSXRlbXMnLCAncmVxdWlzaXRpb24nLCAncmVmTm8nLCAnY29zdENlbnRyZXMnLCAnd2FyZWhvdXNlcycsICdzdG9ja3MnKSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlybSBkZWxpdmVyeSBzdWJtaXQvc3RvcmUuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVkaXJlY3RSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGNvbmZpcm1EZWxpdmVyeVN1Ym1pdChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAicmVxdWlyZWR8YXJyYXl8bWluOjEiLAogICAgICAgICAgICAnZGVsaXZlcnlfZGF0ZScgPT4gJ3JlcXVpcmVkfGRhdGUnLAogICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAicmVxdWlyZWR8dW5pcXVlOnJlcXVpc2l0aW9uX2RlbGl2ZXJpZXN8bWF4OjEwMCIsCiAgICAgICAgXSk7CiAgICAgICAgJGNvdW50RGVsaXZlcnlJdGVtcyA9IGNvdW50KGFycmF5X2ZpbHRlcigkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5LCBmdW5jdGlvbiAoJGRlbGl2ZXJ5UXR5KSB7CiAgICAgICAgICAgIHJldHVybiAhaXNfbnVsbCgkZGVsaXZlcnlRdHkpOwogICAgICAgIH0pKTsKCiAgICAgICAgaWYgKCRjb3VudERlbGl2ZXJ5SXRlbXMgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgcHJvZHVjdCBmb3IgZGVsaXZlcnkuJyk7CiAgICAgICAgfQoKICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICdwcm9kdWN0LnByb2R1Y3RVbml0Q29udmVyc2lvbnMnLAogICAgICAgICAgICAnYXR0cmlidXRlcycKICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmRlbGl2ZXJ5X3F0eSkgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPmRlbGl2ZXJ5X3F0eSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmRlbGl2ZXJ5X3F0eSBhcyAkdWlkID0+ICRxdHkpIHsKICAgICAgICAgICAgICAgIGlmICgkcXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gJHJlcXVpc2l0aW9uSXRlbXMtPndoZXJlKCd1aWQnLCAkdWlkKS0+Zmlyc3QoKS0+cHJvZHVjdDsKICAgICAgICAgICAgICAgICAgICBpZiAoISgkcHJvZHVjdC0+aXNfZml4ZWRfYXNzZXQgPT0gMSB8fCAkcHJvZHVjdC0+aXNfY3dpcCA9PSAxKSAmJiAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWRbJHVpZF0gPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUGxlYXNlIHNlbGVjdCBDb3N0IENlbnRyZSBmb3IgSXRlbSBEZWxpdmVyeScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGxlZGdlckl0ZW1zID0gW107CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZCA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uSWQpOwoKICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbi0+cHVyY2hhc2VPcmRlcnMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkcmVxdWlzaXRpb24tPnB1cmNoYXNlT3JkZXJzWzBdLT5wdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRjb3N0X2NlbnRyZV9pZCA9IENvc3RDZW50cmU6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5hc191bml0X2lkLAogICAgICAgICAgICAgICAgICAgICdocl9kZXBhcnRtZW50X2lkJyA9PiAkcmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQsCiAgICAgICAgICAgICAgICBdKS0+Zmlyc3QoKS0+aWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRwcm9qZWN0ID0gaXNzZXQoJHJlcXVpc2l0aW9uLT5wcm9qZWN0VGFzay0+aWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWlzaXRpb25JZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uSWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAkcmVxdWlzaXRpb25EZWxpdmVyeSA9ICR0aGlzLT5zdG9yZVJlcXVpc2l0aW9uRGVsaXZlcnkoJHJlcXVlc3QpOwoKICAgICAgICAgICAgJGl0ZW1Ub3RhbERlbGl2ZXJ5UXR5ID0gMDsKICAgICAgICAgICAgJHRvdGFsRGVsaXZlcnlRdHkgPSAwOwogICAgICAgICAgICAvLyAkcmVxdWlzaXRpb25EZWxpdmVyeUl0ZW1JbnB1dCA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5IGFzICR1aWQgPT4gJGRlbGl2ZXJ5UXR5KSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtID0gJHJlcXVpc2l0aW9uSXRlbXMtPndoZXJlKCd1aWQnLCAkdWlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdDsKICAgICAgICAgICAgICAgICRkZWxpdmVyeVF0eSA9ICRkZWxpdmVyeVF0eSAvICgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5wcm9kdWN0VW5pdENvbnZlcnNpb25zLT53aGVyZSgnY29udmVyc2lvbl91bml0X2lkJywgJHJlcXVlc3QtPnByb2R1Y3RfdW5pdF9pZFskdWlkXSktPmNvdW50KCkgPiAwID8gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+cHJvZHVjdFVuaXRDb252ZXJzaW9ucy0+d2hlcmUoJ2NvbnZlcnNpb25fdW5pdF9pZCcsICRyZXF1ZXN0LT5wcm9kdWN0X3VuaXRfaWRbJHVpZF0pLT5maXJzdCgpLT5jb252ZXJzaW9uX3JhdGUgOiAxKTsKCiAgICAgICAgICAgICAgICBpZiAoJGRlbGl2ZXJ5UXR5ID4gMCAmJiBpc3NldCgkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyR1aWRdKSAmJiAkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyR1aWRdID4gMCkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyR1aWRdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWRbJHVpZF07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvL1ByZXBhcmUgcHJlLXJlcXVpc2l0ZSBkYXRhLgogICAgICAgICAgICAgICAgICAgICRhdHRyaWJ1dGVzID0gJHJlcXVpc2l0aW9uSXRlbS0+YXR0cmlidXRlcy0+cGx1Y2soJ2F0dHJpYnV0ZV9vcHRpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgICAgICRzdG9jayA9IEludmVudG9yeUxvZ3M6OndoZXJlSGFzKCdzdG9ja0luLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy5hdHRyaWJ1dGVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPnNlbGVjdChcREI6OnJhdygnY291bnQoZGlzdGluY3QgaWQpJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2F0dHJpYnV0ZV9vcHRpb25faWQnLCAkYXR0cmlidXRlcyk7CiAgICAgICAgICAgICAgICAgICAgfSwgJz0nLCBjb3VudCgkYXR0cmlidXRlcykpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAoaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IDApCiAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhdmFpbGFibGUnKTsKICAgICAgICAgICAgICAgICAgICAkbGVmdCA9IGZsb29yKCgkcmVxdWlzaXRpb25JdGVtLT5wdXJjaGFzZV9xdHkgPiAwID8gJHJlcXVpc2l0aW9uSXRlbS0+cWNfcXR5IDogJHJlcXVpc2l0aW9uSXRlbS0+cXR5KSA8ICRzdG9jayA/ICgkcmVxdWlzaXRpb25JdGVtLT5wdXJjaGFzZV9xdHkgPiAwID8gJHJlcXVpc2l0aW9uSXRlbS0+cWNfcXR5IDogJHJlcXVpc2l0aW9uSXRlbS0+cXR5KSAtICRyZXF1aXNpdGlvbkl0ZW0tPmRlbGl2ZXJ5X3F0eSA6ICRzdG9jayk7CgogICAgICAgICAgICAgICAgICAgIGlmICgkZGVsaXZlcnlRdHkgPiAkbGVmdCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnRGVsaXZlcnkgcXR5IGlzIGdyZWF0ZXIgdGhlbiByZXF1aXNpdGlvbiBxdHkuIFBsZWFzZSBBZGp1c3QgSXQgZm9yIHByb2R1Y3QgJyAuICRwcm9kdWN0LT5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vKEN1cnJlbnQgZGVsaXZlcnkgcXR5ICsgcHJldmlvdXMgZGVsaXZlcnkgcXR5KQogICAgICAgICAgICAgICAgICAgICRpdGVtVG90YWxEZWxpdmVyeVF0eSA9ICgkZGVsaXZlcnlRdHkgKyAkcmVxdWlzaXRpb25JdGVtLT5kZWxpdmVyeV9xdHkpOwogICAgICAgICAgICAgICAgICAgICR0b3RhbERlbGl2ZXJ5UXR5ICs9ICRpdGVtVG90YWxEZWxpdmVyeVF0eTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGl0ZW0gd2lzZSB0b3RhbCBkZWxpdmVyeSBRdHkgKGN1cnJlbnQgZGVsaXZlcnkgcXR5ICsgcHJldmlvdXMgZGVsaXZlcnkgcXR5KQogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnVwZGF0ZShbJ2RlbGl2ZXJ5X3F0eScgPT4gJGl0ZW1Ub3RhbERlbGl2ZXJ5UXR5XSk7CgogICAgICAgICAgICAgICAgICAgICR1bml0UHJpY2UgPSAwOwogICAgICAgICAgICAgICAgICAgICRzdG9ja1ByaWNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb25faWQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VpZCcsICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRzdG9ja1ByaWNlLT51bml0X2Ftb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUHJpY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VpZCcsICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdpbnZlbnRvcnlMb2dzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdmFpbGFibGUnLCAnPicsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkc3RvY2tQcmljZS0+dW5pdF9hbW91bnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1bml0UHJpY2UgPSAkc3RvY2tQcmljZS0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25EZWxpdmVyeUl0ZW0gPSBSZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2RlbGl2ZXJ5X2lkJyA9PiAkcmVxdWlzaXRpb25EZWxpdmVyeS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICd3YXJlaG91c2VfaWQnID0+ICRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICd1aWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWxpdmVyeV9xdHknID0+ICRkZWxpdmVyeVF0eSwKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmlzX2ZpeGVkX2Fzc2V0ID09IDAgJiYgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+aXNfY3dpcCA9PSAwICYmICEkcHJvamVjdCAmJiAkZGVsaXZlcnlRdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygnanNvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAkbGVkZ2VySXRlbXNbXSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCA+IDAgPyAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY29nc19hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkZGVsaXZlcnlRdHkgKiAkdW5pdFByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IENPR1MgRGViaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgJGxlZGdlckl0ZW1zW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGRlbGl2ZXJ5UXR5ICogJHVuaXRQcmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IEludmVudG9yeSBDcmVkaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGRlbGl2ZXJ5IHF0eSBhbmQgd2FyZWhvdXNlIHdpc2UgcHJvZHVjdCBxdHkKICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT51cGRhdGVJbnZlbnRvcnlBbmRMb2coJHJlcXVlc3QsICRwcm9kdWN0LCAkZGVsaXZlcnlRdHksICRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJHVpZF0sICRyZXF1aXNpdGlvbkl0ZW0sICRyZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWZlcmVuY2Vfbm8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdEZWxpdmVyeSBxdHkgbWF5IG5vdCBncmF0ZXIgdGhhbiBzdG9yZSBxdHkgZm9yIHByb2R1Y3QgJyAuICRwcm9kdWN0LT5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbk1vZGVsID0gUmVxdWlzaXRpb246OmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uSWQpOwoKICAgICAgICAgICAgICAgICAgICAkdG90YWxSZXF1aXNpdGlvblF0eSA9ICRyZXF1aXNpdGlvbk1vZGVsLT5yZXF1aXNpdGlvbkl0ZW1zLT5zdW0oJ3FjX3F0eScpOwoKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JZCA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6ZmluZE9yRmFpbCgkcmVxdWlzaXRpb25JZCk7CiAgICAgICAgICAgICAgICAgICAgcmVxdWlzaXRpb25UcmFja2luZ0hpc3RvcnkoJHJlcXVpc2l0aW9uLT5pZCwgJ2NvbmZpcm1fZGVsaXZlcnknLCAnRGVsaXZlcnkgQ29uZmlybWVkIGJ5IFN0b3JlJyk7CgogICAgICAgICAgICAgICAgICAgIC8vUmVxdWlzaXRpb24gdHJhY2tpbmcKICAgICAgICAgICAgICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHJlcXVpc2l0aW9uTW9kZWwtPmlkLCAnZGVsaXZlcmVkJyk7CgogICAgICAgICAgICAgICAgICAgIC8vVXBkYXRlIHJlcXVpc2l0aW9uIHN0YXR1cyAoY3VycmVudCBkZWxpdmVyeSBxdHkgKyBwcmV2aW91cyBkZWxpdmVyeSBxdHkpCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0b3RhbERlbGl2ZXJ5UXR5ID09ICR0b3RhbFJlcXVpc2l0aW9uUXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbk1vZGVsLT51cGRhdGUoWydkZWxpdmVyeV9zdGF0dXMnID0+ICdkZWxpdmVyZWQnXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uTW9kZWwtPnVwZGF0ZShbJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3BhcnRpYWwtZGVsaXZlcmVkJ10pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy9Ob3RpZmljYXRpb24KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVxdWlzaXRpb25JdGVtKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uID0gbmV3IE5vdGlmaWNhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT51c2VyX2lkID0gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPmF1dGhvcl9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+cmVxdWlzaXRpb25faXRlbV9pZCA9ICRyZXF1aXNpdGlvbkl0ZW0tPmlkOwoKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmxpc3Qudmlldy5zaG93JywgJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPmlkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb25JdGVtLT5yZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIC4gJyBBbmQgSXRlbSBOYW1lOiAnIC4gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+bmFtZSAuICcuIFN1Y2Nlc3NmdWxseSBkZWxpdmVyZWQgeW91ciBwcm9kdWN0LlBsZWFzZSBhY2tub3dsZWRnZSBpdDwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+bWVzc2FnZXMgPSAkbWVzc2FnZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkbGVkZ2VySXRlbXNbMF0pKSB7CiAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGVsaXZlcnlfZGF0ZSAuICcgJyAuIGRhdGUoJ0g6aTpzJykpKSwgMSwgJycsICdQcm9kdWN0IERlbGl2ZXJ5JywgJGxlZGdlckl0ZW1zLCAoaXNzZXQoJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCkgPyAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkIDogZ2V0RXhjaGFuZ2VSYXRlcyhzeXN0ZW1DdXJyZW5jeSgpLT5pZCkpLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkY29zdF9jZW50cmVfaWQpLCBmYWxzZSwgJ2pzb24nKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZW50cnlbJ2VudHJ5J10tPmlkKSAmJiBpc3NldCgkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCkpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlUE9FbnRyeSgkZW50cnksICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLCAkcHVyY2hhc2VPcmRlci0+aWQsICdwcm9kdWN0LWRlbGl2ZXJ5Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdSZXF1aXNpdGlvbiBEZWxpdmVyeSBTdWNjZXNzZnVsbHknKTsKCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBSZXF1aXN0aW9uIGRlbGl2ZXJ5IGRhdGEuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZVJlcXVpc2l0aW9uRGVsaXZlcnkoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgcmV0dXJuIFJlcXVpc2l0aW9uRGVsaXZlcnk6OmNyZWF0ZShbCiAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkLAogICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAkcmVxdWVzdC0+cmVmZXJlbmNlX25vLAogICAgICAgICAgICAnZGVsaXZlcnlfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRlbGl2ZXJ5X2RhdGUpKSwKICAgICAgICAgICAgJ25vdGUnID0+ICRyZXF1ZXN0LT5ub3RlLAogICAgICAgICAgICAnZGVsaXZlcnlfYnknID0+IEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgIF0pOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIGludmVudG9yeSAmIGxvZy4KICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZUludmVudG9yeUFuZExvZygkcmVxdWVzdCwgJHByb2R1Y3QsICRkZWxpdmVyeVF0eSwgJHdhcmVob3VzZUlkLCAkcmVxdWlzaXRpb25JdGVtLCAkcmVmZXJlbmNlX25vID0gJycpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy9VcGRhdGUgSW52ZW50b3J5IFN1bW1hcnkKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnkgPSBJbnZlbnRvcnlTdW1tYXJ5Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkCiAgICAgICAgICAgIF0pLT5maXJzdCgpOwoKICAgICAgICAgICAgJHRvdGFsUHJpY2UgPSAoKCRJbnZlbnRvcnlTdW1tYXJ5LT5xdHkpIC0gKCRkZWxpdmVyeVF0eSkpICogJEludmVudG9yeVN1bW1hcnktPnVuaXRfcHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT5xdHkgPSAoJEludmVudG9yeVN1bW1hcnktPnF0eSkgLSAoJGRlbGl2ZXJ5UXR5KTsKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnktPnRvdGFsX3ByaWNlID0gJHRvdGFsUHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT5zdGF0dXMgPSAnYWN0aXZlJzsKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnktPnNhdmUoKTsKCiAgICAgICAgICAgIC8vVXBkYXRlIEludmVudG9yeSBkZXRhaWxzCiAgICAgICAgICAgICRJbnZlbnRvcnlEZXRhaWxzID0gSW52ZW50b3J5RGV0YWlsczo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkcHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkLAogICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHdhcmVob3VzZUlkLAogICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCwKICAgICAgICAgICAgXSktPmZpcnN0KCk7CgogICAgICAgICAgICBpZiAoJGRlbGl2ZXJ5UXR5ID4gKGlzc2V0KCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpID8gaW50dmFsKCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpIDogMCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRvdGFsUHJpY2VPZkludmVudG9yeURldGFpbHMgPSAoKCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpIC0gKCRkZWxpdmVyeVF0eSkpICogJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlEZXRhaWxzLT5xdHkgPSAkSW52ZW50b3J5RGV0YWlscy0+cXR5IC0gJGRlbGl2ZXJ5UXR5OwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscy0+dG90YWxfcHJpY2UgPSAkdG90YWxQcmljZU9mSW52ZW50b3J5RGV0YWlsczsKICAgICAgICAgICAgJEludmVudG9yeURldGFpbHMtPnN0YXR1cyA9ICdhY3RpdmUnOwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscy0+c2F2ZSgpOwoKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSAkcmVxdWlzaXRpb25JdGVtLT5hdHRyaWJ1dGVzLT5wbHVjaygnYXR0cmlidXRlX29wdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICRzdG9ja3MgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+c2VsZWN0KFxEQjo6cmF3KCdjb3VudChkaXN0aW5jdCBpZCknKSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2F0dHJpYnV0ZV9vcHRpb25faWQnLCAkYXR0cmlidXRlcyk7CiAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHdhcmVob3VzZUlkLAogICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJHByb2R1Y3QtPmNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdC0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkgPyBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQgOiBudWxsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXZhaWxhYmxlJywgJz4nLCAwKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRhdmFpbGFibGVRdHkgPSAkZGVsaXZlcnlRdHk7CiAgICAgICAgICAgICRsb2dzID0gW107CiAgICAgICAgICAgIGlmIChpc3NldCgkc3RvY2tzWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN0b2NrcyBhcyAkc3RvY2spIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGF2YWlsYWJsZVF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcXR5ID0gKCRzdG9jay0+YXZhaWxhYmxlID4gJGF2YWlsYWJsZVF0eSA/ICRhdmFpbGFibGVRdHkgOiAkc3RvY2stPmF2YWlsYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGVRdHkgLT0gJHRoaXNfcXR5OwoKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrLT5hdmFpbGFibGUgPSAoJHN0b2NrLT5hdmFpbGFibGUgLSAkdGhpc19xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2stPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRsb2dzW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRwcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiAkd2FyZWhvdXNlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9wcmljZScgPT4gJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkdGhpc19xdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXZhaWxhYmxlJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX3ByaWNlJyA9PiAoJHRoaXNfcXR5ICogJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2UpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmVyZW5jZScgPT4gJHJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICdhY3RpdmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdvdXQnLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNzZXQoJGxvZ3NbMF0pKSB7CiAgICAgICAgICAgICAgICBJbnZlbnRvcnlMb2dzOjppbnNlcnQoJGxvZ3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHB1cmNoYXNlRGVwYXJ0bWVudChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZShbCiAgICAgICAgICAgICdpZCcgPT4gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkLAogICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ25vJywKICAgICAgICAgICAgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3Byb2Nlc3NpbmcnCiAgICAgICAgXSktPmZpcnN0KCk7CgogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWlzaXRpb24tPmlkKSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5pc19zZW5kX3RvX3JmcCA9ICd5ZXMnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zdG9yZV9tZXNzYWdlID0gJHJlcXVlc3QtPm1lc3NhZ2U7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb24tPmlkLCAnc2VudF90b19wdXJjaGFzZScsICdSZXF1aXNpdGlvbiBzZW5kIHRvIHB1cmNoYXNlIGRlcGFydG1lbnQnKTsKCgogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbi0+aWQsICdwcm9jZXNzaW5nJyk7CgogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS5pbnZlbnRvcnkuY29tcGFyZScsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcuV2F0dGluZyBmb3IgUHJvY3VyZW1lbnQvUHVyY2hhc2UuPC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcsIG51bGwsIHRydWUpLCAnc2VudC10by1wdXJjaGFzZScpOwoKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgU2VuZCB0byBQdXJjaGFzZSBEZXBhcnRtZW50ISEnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdEYXRhIG5vdCBmb3VuZC4hISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2hhbmdlQWN0aW9uVG9SRlAoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndoZXJlKFsnaWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwgJ3N0YXR1cycgPT4gMSwgJ2FwcHJvdmVkX2lkJyA9PiAxLCAnaXNfc2VuZF90b19yZnAnID0+ICdubycsICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwYXJ0aWFsLWRlbGl2ZXJlZCddKS0+Zmlyc3QoKTsKCiAgICAgICAgLy9TdGFydCB0cmFuc2FjdGlvbgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChjb3VudCgoYXJyYXkpJHJlcXVpc2l0aW9uKSA+IDApIHsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aXNfc2VuZF90b19yZnAgPSAneWVzJzsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+cmVxdWVzdF9zdGF0dXMgPSAncmZwJzsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgLy9UcmFja2luZwogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbi0+aWQsICdwcm9jZXNzaW5nJyk7CgogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS5pbnZlbnRvcnkuY29tcGFyZScsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcuV2F0dGluZyBmb3IgUHJvY3VyZW1lbnQvUHVyY2hhc2UuPC9zcGFuPic7CgoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JywgbnVsbCwgdHJ1ZSksICdzZW5kLXRvLXB1cmNoYXNlJyk7CiAgICAgICAgICAgICAgICAvL0NvbW1pdCBkYXRhCiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBTZW5kIHRvIFB1cmNoYXNlIERlcGFydG1lbnQhISc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0FsbHJlYWR5IGdlbmVyYXRlZCBvbmNlISEnOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIC8vSWYgcHJvY2VzcyBoYXMgYW55IHByb2JsZW0gdGhlbiByb2xsYmFjayB0aGUgZGF0YQogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkTGlzdEhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGVwYXJ0bWVudCcsICdkZXBhcnRtZW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fZGF0ZScsICdyZXF1aXNpdGlvbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGVsaXZlcmVkX2RhdGUnLCAnZGVsaXZlcmVkX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9yZWZlcmVuY2UnLCAncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGVsaXZlcmVkX3JlZmVyZW5jZScsICdkZWxpdmVyZWRfcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2F0ZWdvcnknLCAnY2F0ZWdvcnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydwcm9kdWN0JywgJ3Byb2R1Y3QnLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncXR5JywgJ3F0eScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydvcHRpb25zJywgJ29wdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxpdmVyZWRMaXN0KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZnJvbV9kYXRlID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb21fZGF0ZScpID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpIDogZGF0ZSgnWS1tLTAxJyk7CiAgICAgICAgICAgICR0b19kYXRlID0gcmVxdWVzdCgpLT5oYXMoJ3RvX2RhdGUnKSA/IHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykgOiBkYXRlKCdZLW0tZCcpOwoKICAgICAgICAgICAgJGRlbGl2ZXJlZFJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOjpvcmRlckJ5KCdpZCcsICdkZXNjJykKICAgICAgICAgICAgICAgIC0+d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLAogICAgICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZS5kZXBhcnRtZW50JywKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ3dhcmVob3VzZV9pZCcsIEF1dGg6OnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT5hbGwoKSkKICAgICAgICAgICAgICAgIC0+d2hlbigkZnJvbV9kYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb21fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPj0nLCAkZnJvbV9kYXRlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJHRvX2RhdGUsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdkZWxpdmVyeV9kYXRlJywgJzw9JywgJHRvX2RhdGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkZGVsaXZlcmVkUmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKSA/ICRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lKSA/ICRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25fZGF0ZSkgPyBkYXRlKCdkLW0tWScsIHN0cnRvdGltZSgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbl9kYXRlKSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlbGl2ZXJlZF9kYXRlJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5kZWxpdmVyeV9kYXRlKSA/IGRhdGUoJ2QtbS1ZJywgc3RydG90aW1lKCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+ZGVsaXZlcnlfZGF0ZSkpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVsaXZlcmVkX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2RlbGl2ZXJ5X2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1pZD0iJyAuICRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPmlkIC4gJyIgY2xhc3M9ImJ0biBidG4tbGluayBtLTEgcm91bmRlZCIgb25jbGljaz0icmVxdWlzaXRpb252aWV3KCQodGhpcykpIj4nIC4gKGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubykgPyAkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gOiAnJykgLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcmVkX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVmZXJlbmNlX25vKSA/ICRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVsaXZlcmVkX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHZhbHVlcy0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVsaXZlcmVkX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJGRlbGl2ZXJ5LT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdWJfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnByb2R1Y3QtPmNhdGVnb3J5LT5uYW1lKSA/ICRkZWxpdmVyeS0+cHJvZHVjdC0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdWJfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJvZHVjdC5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdCcsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cHJvZHVjdC0+bmFtZSkgPyAkZGVsaXZlcnktPnByb2R1Y3QtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9kdWN0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3Byb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3F0eScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcl9mb3JtYXQoJGRlbGl2ZXJ5LT5kZWxpdmVyeV9xdHksIDApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3F0eScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2RlbGl2ZXJ5X3F0eScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ29wdGlvbnMnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZGVsaXZlcnktPnN0YXR1cyA9PSAncGVuZGluZycgfHwgJGRlbGl2ZXJ5LT5zdGF0dXMgPT0gJ2Fja25vd2xlZGdlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3RhdHVzTmFtZScgLiAkZGVsaXZlcnktPmlkIC4gJyI+JyAuIHVjZmlyc3QoJGRlbGl2ZXJ5LT5zdGF0dXMpIC4gJzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0iaGlkZUJ0bicgLiAkZGVsaXZlcnktPmlkIC4gJyI+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJzdG9yZWRlbGl2ZXJlZEFja25vd2xlZGdlKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJGRlbGl2ZXJ5LT5pZCAuICciIHRpdGxlPSJEZWxpdmVyZWQiPjxpIGNsYXNzPSJsYSBsYS1jaGVjayI+PC9pPiZuYnNwO0RlbGl2ZXJlZDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnRGVsaXZlcmVkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtZGVsaXZlcmVkLXJlcXVpc2l0aW9uLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJEZWxpdmVyZCBPcmRlciBMaXN0IiwKICAgICAgICAgICAgICAgICdmcm9tX2RhdGUnID0+ICRmcm9tX2RhdGUsCiAgICAgICAgICAgICAgICAndG9fZGF0ZScgPT4gJHRvX2RhdGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmRlbGl2ZXJlZExpc3RIZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGVsaXZlcmVkIHJlcXVpc3Rpb24gYWNrbm93bGVkZ2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkUmVxdWlzaXRpb25BY2soUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKCiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgJHdhcmVob3VzZUlkcyA9IEF1dGg6OnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT5hbGwoKTsKCiAgICAgICAgJGRlbGl2ZXJlZFJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06OndoZXJlSW4oJ3dhcmVob3VzZV9pZCcsICR3YXJlaG91c2VJZHMpCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignc3RhdHVzJywgWydkZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmIChpc3NldCgkZGVsaXZlcmVkUmVxdWlzaXRpb24pKSB7CgogICAgICAgICAgICAgICAgJGRlbGl2ZXJlZFJlcXVpc2l0aW9uLT5zdGF0dXMgPSAnZGVsaXZlcmVkJzsKICAgICAgICAgICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbi0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgVXBkYXRlZCBUbyBEZWxpdmVyZWQuJzsKCiAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdObyBEYXRhIEZvdW5kJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewoKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxpdmVyZWRSZXF1aXNpdGlvblNlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICAkZnJvbURhdGUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvRGF0ZSA9IGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CgogICAgICAgICRzdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzOwoKICAgICAgICAkd2FyZWhvdXNlSWRzID0gQXV0aDo6dXNlcigpLT5yZWxVc2Vyc1dhcmVob3VzZS0+cGx1Y2soJ2lkJyktPmFsbCgpOwoKICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbTo6d2hlcmVJbignd2FyZWhvdXNlX2lkJywgJHdhcmVob3VzZUlkcykKICAgICAgICAgICAgLT53aGVuKCRzdGF0dXMsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHN0YXR1cykgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICRzdGF0dXMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oJGZyb21EYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tRGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgnZGVsaXZlcnlfZGF0ZScsICc+PScsICRmcm9tRGF0ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCR0b0RhdGUsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b0RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPD0nLCAkdG9EYXRlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQnkoJ2lkJywgJ0RFU0MnKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmIChjb3VudCgkZGVsaXZlcmVkUmVxdWlzaXRpb24pID4gMCkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1kZWxpdmVyZWQtcmVxdWlzaXRpb24tc2VhcmNoJywKICAgICAgICAgICAgICAgICAgICBbJ2RlbGl2ZXJlZFJlcXVpc2l0aW9uJyA9PiAkZGVsaXZlcmVkUmVxdWlzaXRpb25dKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkYm9keS0+cmVuZGVyKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ05vIERhdGEgRm91bmQhISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogUmVxdWlzaXRpb24gZGVsaXZlcnkgdmlldy4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiByZXF1aXNpdGlvbkRlbGl2ZXJ5VmlldyhSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aXRoKCdpdGVtcycsICdpdGVtcy5wcm9kdWN0JywgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnknKQogICAgICAgICAgICAtPmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1aXNpdGlvbikpIHsKICAgICAgICAgICAgICAgICRib2R5ID0gVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMucmVxdWlzaXRpb25zLnNob3cnLAogICAgICAgICAgICAgICAgICAgIFsncmVxdWlzaXRpb24nID0+ICRyZXF1aXNpdGlvbl0pOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2JvZHknXSA9ICRib2R5LT5yZW5kZXIoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnTm8gRGF0YSBGb3VuZCEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAkdGgtPmdldE1lc3NhZ2UoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9Cn0KCg==