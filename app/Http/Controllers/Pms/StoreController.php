<?php
bolt_decrypt( __FILE__ , 'PCegGZ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7Cgp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UcmFja2luZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3RVbml0Q29udmVyc2lvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5U3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEludmVudG9yeU1vZGVsc1xJbnZlbnRvcnlEZXRhaWxzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUxvZ3M7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXEhyXEFjY291bnRzXFVuaXQ7CnVzZSBcQXBwXFVzZXI7Cgp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcVmlldzsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCLCBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWYWxpZGF0b3IsIElsbHVtaW5hdGVcU3VwcG9ydFxTdHI7CnVzZSBZYWpyYVxEYXRhVGFibGVzXEZhY2FkZXNcRGF0YVRhYmxlczsKCmNsYXNzIFN0b3JlQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9ieScsICdhcHByb3ZlZF9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9ieScsICdyZXF1aXNpdGlvbl9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydkZWxpdmVyeScsICdkZWxpdmVyeScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgkZGVsaXZlcnlTdGF0dXMgPSBudWxsKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRoZWFkZXJDb2x1bW5zID0gJHRoaXMtPmhlYWRlckNvbHVtbnMoKTsKCiAgICAgICAgICAgICR0aXRsZSA9ICghZW1wdHkoJGRlbGl2ZXJ5U3RhdHVzKSA/ICdDb21wbGV0ZScgOiAnUGVuZGluZycpIC4gJyBEZWxpdmVyeSBsaXN0IGZvciBSZXF1aXNpdGlvbic7CiAgICAgICAgICAgICRkZWxpdmVyeVN0YXR1cyA9ICRkZWxpdmVyeVN0YXR1cyA/PyAncGFydGlhbC1kZWxpdmVyZWQnOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKCdyZWxVc2Vyc0xpc3QnLCAncmVxdWlzaXRpb25JdGVtcycsICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsRGVsaXZlcnlJdGVtcycpCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAkZGVsaXZlcnlTdGF0dXNdKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVmZXJlbmNlX25vJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlybS1kZWxpdmVyeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29uZmlybS1kZWxpdmVyeScpLAogICAgICAgICAgICAgICAgJ3NlbmQtdG8tcmZwJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzZW5kLXRvLXJmcCcpCiAgICAgICAgICAgIF07CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lKSA/ICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywgJz0nLCAndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfZGVwYXJ0bWVudCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFJlcXVpc2l0aW9uSXRlbTo6c2VsZWN0KCdtYWluX2NhdGVnb3J5Lm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwcm9kdWN0cycsICdwcm9kdWN0cy5pZCcsICc9JywgJ3JlcXVpc2l0aW9uX2l0ZW1zLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIHN1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnkuaWQnLCAnPScsICdwcm9kdWN0cy5jYXRlZ29yeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgbWFpbl9jYXRlZ29yeScsICdtYWluX2NhdGVnb3J5LmlkJywgJz0nLCAnc3ViX2NhdGVnb3J5LnBhcmVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtcy5yZXF1aXNpdGlvbl9pZCcsICdyZXF1aXNpdGlvbnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+YXBwcm92ZWRCeS0+bmFtZSkgPyAkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYXBwcm92ZWRCeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmFwcHJvdmVkX2J5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+bmFtZSkgPyAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5yZXF1aXNpdGlvbi1kZWxpdmVyZWQtbGlzdCcsICR2YWx1ZXMtPmlkKSAuICciIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiB0aXRsZT0iQ2xpY2sgaGVyZSB0byB2aWV3IGRldGFpbHMiIHRhcmdldD0iX2JsYW5rIj4gVG90YWwgKCcgLiBjb3VudCgkdmFsdWVzLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5KSAuICcpPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPmRlbGl2ZXJ5X3N0YXR1cyA9PSAnZGVsaXZlcmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxzcGFuPkZ1bGwgRGVsaXZlcmVkPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuIGlkPSJzdGF0dXNOYW1lJyAuICR2YWx1ZXMtPmlkIC4gJyI+QWN0aW9uPC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ2NvbmZpcm0tZGVsaXZlcnknXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1aXNpdGlvbkhhc1N0b2NrKCR2YWx1ZXMtPmlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS1yZXF1aXNpdGlvbi5kZWxpdmVyeScsICR2YWx1ZXMtPmlkKSAuICciIHRpdGxlPSJDbGljayBIZXJlIFRvIENvbmZpcm0gRGVsaXZlcnkiPkNvbmZpcm0gRGVsaXZlcnk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ3NlbmQtdG8tcmZwJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVxdWVzdF9zdGF0dXMgPT0gTlVMTCAmJiAkdmFsdWVzLT5pc19wb19nZW5lcmF0ZSA9PSAnbm8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGkgaWQ9ImhpZGVGcm9tTGlzdCcgLiAkdmFsdWVzLT5pZCAuICciPjxhIGNsYXNzPSJzZW5kVG9QdXJjaGFzZURlcGFydG1lbnQiIG9uY2xpY2s9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCgkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5jaGFuZ2UuYWN0aW9uLnRvLnJmcCcpIC4gJyIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgIHRpdGxlPSJTZW5kIFRvIFByb2N1cmVtZW50ICI+U2VuZCBUbyBQcm9jdXJlbWVudDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNraW5nIFJlcXVpc2l0aW9uIiBjbGFzcz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzIiBvbmNsaWNrPSJ0cmFja1JlcXVpc2l0aW9uUHJvZ3Jlc3MoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1tYXAiPjwvaT4mbmJzcDtUcmFjayBQcm9ncmVzczwvYT48L2xpPic7CgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ2RlbGl2ZXJ5JywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZXF1aXNpdGlvbi1kZWxpdmVyeS5pbmRleCcsIGNvbXBhY3QoJ3RpdGxlJywgJ2hlYWRlckNvbHVtbnMnKSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZUhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgJHJvdyA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9uX2RhdGUnLCAncmVxdWlzaXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlcGFydG1lbnQnLCAnZGVwYXJ0bWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2R1Y3RfY2F0ZWdvcnknLCAncHJvZHVjdF9jYXRlZ29yeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NhbGVhYmxlJywgJ3NhbGVhYmxlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXBwcm92ZWRfYnknLCAnYXBwcm92ZWRfYnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJHJvdzsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmVSZXF1aXNpdGlvbkxpc3RWaWV3KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnU3RvcmUgUmVxdWlzaXRpb24gTGlzdCBWaWV3JzsKICAgICAgICAgICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICR1c2VyRGVwYXJ0bWVudHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkdXNlclNlY3Rpb25zID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9zZWN0aW9uX2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBudWxsOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogbnVsbDsKICAgICAgICAgICAgJGNhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CiAgICAgICAgICAgICRkZXBhcnRtZW50X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2RlcGFydG1lbnRfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdkZXBhcnRtZW50X2lkJykgOiAwOwogICAgICAgICAgICAkYXBwcm92ZWRfYnkgPSByZXF1ZXN0KCktPmhhcygnYXBwcm92ZWRfYnknKSA/IHJlcXVlc3QoKS0+Z2V0KCdhcHByb3ZlZF9ieScpIDogMDsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkZGVwYXJ0bWVudHMgPSBEZXBhcnRtZW50Ojp3aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywgJHVzZXJEZXBhcnRtZW50cyktPmdldCgpOwoKICAgICAgICAgICAgJGFwcHJvdmVycyA9IFJlcXVpc2l0aW9uOjp3aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2FwcHJvdmVkX2J5JykKICAgICAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+IDEsICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwcm9jZXNzaW5nJywgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nLCAnaXNfZmluYW5jZV9hcHByb3ZhbCcgPT4gJ2FwcHJvdmVkJ10pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdhcHByb3ZlcnMnID0+ICRhcHByb3ZlcnMsCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHMnID0+ICRkZXBhcnRtZW50cywKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkY2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfYnknID0+ICRhcHByb3ZlZF9ieSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50X2lkJyA9PiAkZGVwYXJ0bWVudF9pZCwKICAgICAgICAgICAgICAgICdjYXRlZ29yaWVzJyA9PiAkY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+c3RvcmVIZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgIF07CgogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkQnknCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICAgICAgLy8gLT53aGVyZUluKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXJEZXBhcnRtZW50cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkZnJvbSkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJz49JywgJGZyb20pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJHRvKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGRlcGFydG1lbnRfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRhcHByb3ZlZF9ieSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGFwcHJvdmVkX2J5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FwcHJvdmVkX2J5JywgJGFwcHJvdmVkX2J5KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGNhdGVnb3J5X2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRjYXRlZ29yeV9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgICAgICdpc19maW5hbmNlX2FwcHJvdmFsJyA9PiAnYXBwcm92ZWQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbCiAgICAgICAgICAgICAgICAgICAgJ2RlbGl2ZXJlZCcsCiAgICAgICAgICAgICAgICAgICAgJ3BhcnRpYWwtZGVsaXZlcmVkJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlybS1kZWxpdmVyeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29uZmlybS1kZWxpdmVyeScpLAogICAgICAgICAgICAgICAgJ3NlbmQtdG8tcmZwJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzZW5kLXRvLXJmcCcpCiAgICAgICAgICAgIF07CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+VW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVW5pdDo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfc2hvcnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdocl91bml0LmhyX3VuaXRfaWQnLCAncmVxdWlzaXRpb25zLmhyX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lKSA/ICR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhcHByb3ZlZEJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIHRpdGxlPSJUcmFja2luZyBSZXF1aXNpdGlvbiIgY2xhc3M9InRyYWNrUmVxdWlzaXRpb25Qcm9ncmVzcyIgb25jbGljaz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzKCcgLiAkdmFsdWVzLT5pZCAuICcpIiA+PGkgY2xhc3M9ImxhIGxhLW1hcCI+PC9pPiZuYnNwO1RyYWNrIFByb2dyZXNzPC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1snY29uZmlybS1kZWxpdmVyeSddICYmICR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+aXNfc2VydmljZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlzaXRpb25IYXNTdG9jaygkdmFsdWVzLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS1yZXF1aXNpdGlvbi5kZWxpdmVyeScsICR2YWx1ZXMtPmlkKSAuICciIHRpdGxlPSJDbGljayBIZXJlIFRvIENvbmZpcm0gRGVsaXZlcnkiPkNvbmZpcm0gRGVsaXZlcnk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ3NlbmQtdG8tcmZwJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5pc19zZW5kX3RvX3JmcCA9PSAnbm8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBjbGFzcz0ic2VuZFRvUHVyY2hhc2VEZXBhcnRtZW50IiBvbmNsaWNrPSJzZW5kVG9QdXJjaGFzZURlcGFydG1lbnQoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc2VuZC50by5wdXJjaGFzZS5kZXBhcnRtZW50JykgLiAnIiBkYXRhLWlkPSInIC4gJHZhbHVlcy0+aWQgLiAnIiB0aXRsZT0iU2VuZCBUbyBQcm9jdXJlbWVudCI+U2VuZCBUbyBQcm9jdXJlbWVudDwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtcmVxdWlzaXRpb24tbGlzdC12aWV3JywgJGRhdGEpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcgc2VhcmNoLgogICAgICogU2VhcmNoIGJldHdlZW4gZnJvbSBhbmQgdG8gZGF0ZSBhbmQgYWxzbyB1c2VyIGNhbiBzZWFyY2ggYnkgZW1wbG95ZWUKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlUmVxdWlzaXRpb25MaXN0Vmlld1NlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICAkZnJvbURhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvRGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CgogICAgICAgICRyZXF1aXNpdGlvbkJ5ID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2J5OwogICAgICAgICRyZXF1aXNpdGlvblN0YXR1cyA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9zdGF0dXM7CgogICAgICAgICRyZXF1aXN0aW9uRGF0YSA9IFJlcXVpc2l0aW9uOjp3aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJz49JywgJGZyb21EYXRlKQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0b0RhdGUpCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWlzaXRpb25CeSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWlzaXRpb25CeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsICRyZXF1aXNpdGlvbkJ5KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gJHJlcXVpc2l0aW9uU3RhdHVzLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsICdpc19zZW5kX3RvX3JmcCcgPT4gJ25vJ10pCiAgICAgICAgICAgIC0+cGFnaW5hdGUoMzApOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQoJHJlcXVpc3Rpb25EYXRhKSA+IDApIHsKICAgICAgICAgICAgICAgICRib2R5ID0gVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtc2VhcmNoLXJlc3VsdC12aWV3JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc3Rpb25EYXRhJyA9PiAkcmVxdWlzdGlvbkRhdGFdKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkY29udGVudHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcgc2VhcmNoLgogICAgICogU2VhcmNoIGJldHdlZW4gZnJvbSBhbmQgdG8gZGF0ZSBhbmQgYWxzbyB1c2VyIGNhbiBzZWFyY2ggYnkgZW1wbG95ZWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRlcGFydG1lbnRXaXNlRW1wbG95ZWUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSA9ICcnOwoKICAgICAgICAkZGVwYXJ0bWVudElkID0gJHJlcXVlc3QtPmRlcGFydG1lbnRfaWQ7CgogICAgICAgICRlbXBsb3llZSA9IFJlcXVpc2l0aW9uOjp3aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudElkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJGRlcGFydG1lbnRJZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgIH0pCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXV0aG9yX2lkJykKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3Byb2Nlc3NpbmcnLCAnaXNfc2VuZF90b19yZnAnID0+ICdubyddKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSIiPi0tU2VsZWN0IE9uZS0tPC9vcHRpb24+JzsKICAgICAgICBpZiAoIWVtcHR5KCRlbXBsb3llZSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGVtcGxveWVlIGFzICR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSInIC4gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5pZCAuICciPicgLiAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgLiAnPC9vcHRpb24+JzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICI8b3B0aW9uIHZhbHVlPScnPk5vIEVtcGxveWVlIEZvdW5kISE8L29wdGlvbj4iOwogICAgICAgIH0KCiAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmZwUmVxdWlzaXRpb25MaXN0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdSRlAgUmVxdWlzaXRpb24gTGlzdCc7CiAgICAgICAgICAgIC8vICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBkYXRlKCdZLW0tMDEnKTsKICAgICAgICAgICAgLy8gJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IGRhdGUoJ1ktbS10Jyk7CiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBudWxsOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogbnVsbDsKICAgICAgICAgICAgJGNhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CiAgICAgICAgICAgICRkZXBhcnRtZW50X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2RlcGFydG1lbnRfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdkZXBhcnRtZW50X2lkJykgOiAwOwogICAgICAgICAgICAkYXBwcm92ZWRfYnkgPSByZXF1ZXN0KCktPmhhcygnYXBwcm92ZWRfYnknKSA/IHJlcXVlc3QoKS0+Z2V0KCdhcHByb3ZlZF9ieScpIDogMDsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JyktPmdldCgpOwoKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gUmVxdWlzaXRpb246OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfZGVwYXJ0bWVudC5ocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3VzZXJzJywgJ3VzZXJzLmlkJywgJz0nLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgICAgIC0+Z2V0KFsnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X2lkJywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9uYW1lJ10pOwoKICAgICAgICAgICAgJGFwcHJvdmVycyA9IFJlcXVpc2l0aW9uOjp3aXRoKCdhcHByb3ZlZEJ5JykKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnJlbEludmVudG9yeURldGFpbHMnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRCeScsCiAgICAgICAgICAgICAgICAnVW5pdCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJGZyb20pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCR0bykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRkZXBhcnRtZW50X2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudF9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJGRlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkYXBwcm92ZWRfYnkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRhcHByb3ZlZF9ieSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhcHByb3ZlZF9ieScsICRhcHByb3ZlZF9ieSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRjYXRlZ29yeV9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkY2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWwogICAgICAgICAgICAgICAgICAgICdkZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgICAgICdwYXJ0aWFsLWRlbGl2ZXJlZCcKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdyZWZlcmVuY2Vfbm8nLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdjb25maXJtLWRlbGl2ZXJ5JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjb25maXJtLWRlbGl2ZXJ5JyksCiAgICAgICAgICAgIF07CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+VW5pdC0+aHJfdW5pdF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnVW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVW5pdDo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdocl91bml0LmhyX3VuaXRfaWQnLCAncmVxdWlzaXRpb25zLmhyX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lKSA/ICR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhcHByb3ZlZEJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUXR5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWx1ZXMtPml0ZW1zKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHZhbHVlcy0+aXRlbXMgYXMgJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2tRdHkgKz0gaXNzZXQoJGl0ZW0tPnByb2R1Y3QtPnJlbEludmVudG9yeURldGFpbHMpID8gY29sbGVjdCgkaXRlbS0+cHJvZHVjdC0+cmVsSW52ZW50b3J5RGV0YWlscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSktPnN1bSgncXR5JykgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrUXR5ID4gMCAmJiByZXF1aXNpdGlvbkhhc1N0b2NrKCR2YWx1ZXMtPmlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydjb25maXJtLWRlbGl2ZXJ5J10gJiYgJHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5pc19zZXJ2aWNlID09IDApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5vbk5vdGlmaWVkID0gJHZhbHVlcy0+aXRlbXMoKS0+ZG9lc250SGF2ZSgnbm90aWZpY2F0aW9uJyktPmNvdW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbm9uTm90aWZpZWQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnJlcXVpc2l0aW9uLml0ZW1zLmxpc3QnLCAkdmFsdWVzLT5pZCkgLiAnIj5TaG93IE5vdGlmaWNhdGlvbjwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS1yZXF1aXNpdGlvbi5kZWxpdmVyeScsICR2YWx1ZXMtPmlkKSAuICciIHRpdGxlPSJDbGljayBIZXJlIFRvIENvbmZpcm0gRGVsaXZlcnkiPkNvbmZpcm0gRGVsaXZlcnk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNrIFByb2dyZXNzIgogICAgICAgICAgICAgICAgY2xhc3M9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cyIgb25jbGljaz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHZhbHVlcy0+aWQgLiAnIj48aSBjbGFzcz0ibGEgbGEtbWFwIj48L2k+VHJhY2sgUHJvZ3Jlc3M8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmhpc3RvcnknLCAkdmFsdWVzLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtaGlzdG9yeSIgdGl0bGU9IlJlcXVpc2l0aW9uIEhpc3RvcnkiPjwvaT5SZXF1aXNpdGlvbiBIaXN0b3J5PC9hPjwvbGk8L2E+PC9saT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnYXBwcm92ZXJzJyA9PiAkYXBwcm92ZXJzLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiAkZGVwYXJ0bWVudHMsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJGNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2J5JyA9PiAkYXBwcm92ZWRfYnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudF9pZCcgPT4gJGRlcGFydG1lbnRfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnN0b3JlSGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLXJmcC1yZXF1aXNpdGlvbi1saXN0JywgJGRhdGEpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcgc2VyYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZnBEZXBhcnRtZW50V2lzZUVtcGxveWVlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gPSAnJzsKCiAgICAgICAgJGRlcGFydG1lbnRJZCA9ICRyZXF1ZXN0LT5kZXBhcnRtZW50X2lkOwoKICAgICAgICAkZW1wbG95ZWUgPSBSZXF1aXNpdGlvbjo6d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRJZCkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50SWQpCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+IDEsICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcyddKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXV0aG9yX2lkJykKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gLj0gJzxvcHRpb24gdmFsdWU9IiI+LS1TZWxlY3QgT25lLS08L29wdGlvbj4nOwogICAgICAgIGlmICghZW1wdHkoJGVtcGxveWVlKSkgewogICAgICAgICAgICBmb3JlYWNoICgkZW1wbG95ZWUgYXMgJHZhbHVlcykgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gLj0gJzxvcHRpb24gdmFsdWU9IicgLiAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmlkIC4gJyI+JyAuICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+bmFtZSAuICc8L29wdGlvbj4nOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gLj0gIjxvcHRpb24gdmFsdWU9Jyc+Tm8gRW1wbG95ZWUgRm91bmQhITwvb3B0aW9uPiI7CiAgICAgICAgfQoKICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogUmZwIGxpc3QgdmlldyBzZXJhcmNoLgogICAgICogU2VhcmNoIGJldHdlZW4gZnJvbSBhbmQgdG8gZGF0ZSBhbmQgYWxzbyB1c2VyIGNhbiBzZWFyY2ggYnkgZW1wbG95ZWUKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHJmcFJlcXVpc2l0aW9uU2VhcmNoKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgJGZyb21EYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmZyb21fZGF0ZSkpOwogICAgICAgICR0b0RhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+dG9fZGF0ZSkpOwogICAgICAgICRkZXBhcnRtZW50SWQgPSAkcmVxdWVzdC0+ZGVwYXJ0bWVudF9pZDsKCiAgICAgICAgJHJlcXVpc2l0aW9uQnkgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25fYnk7CiAgICAgICAgJHJlcXVpc2l0aW9uU3RhdHVzID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX3N0YXR1czsKCiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tRGF0ZSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG9EYXRlKQogICAgICAgICAgICAtPndoZW4oJHJlcXVpc2l0aW9uQnksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uQnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCAkcmVxdWlzaXRpb25CeSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkZGVwYXJ0bWVudElkLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50SWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50SWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50SWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+ICRyZXF1aXNpdGlvblN0YXR1cywgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT5wYWdpbmF0ZSgzMCk7CgoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uWzBdKSkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5yZnAtc2VhcmNoLXJlc3VsdC12aWV3JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc2l0aW9uJyA9PiAkcmVxdWlzaXRpb25dKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkY29udGVudHM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcXVpc3Rpb24gaXRlbSBsaXN0LgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxdWlzaXRpb25JdGVtc0xpc3QoJGlkKQogICAgewoKICAgICAgICAkdGl0bGUgPSAiUmVxdWlzaXRpb24gSXRlbXMgTGlzdCI7CgogICAgICAgIC8vRmluZCByZXF1aXN0aW9uCiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndoZXJlKCdpZCcsICRpZCkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICB0cnkgewoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnJlcXVpc2l0aW9uLWl0ZW1zLWxpc3QnLCBjb21wYWN0KCd0aXRsZScsICdyZXF1aXNpdGlvbicpKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBub3RpZmljYXRpb24gdG8gdXNlcnMuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kTm90aWZpY2F0aW9uVG9Vc2VycyhSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewoKICAgICAgICAvL1ZhbGlkYXRlIGlucHV0ZSByZXF1ZXN0CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdpdGVtc19pZCcgPT4gWydyZXF1aXJlZCddLAogICAgICAgIF0pOwoKICAgICAgICAvL0RiIHRyYW5zYWN0aW9uIHN0YXJ0CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIC8vQ3JhdGUgaW5zdGFuY2Ugb2YgaXRlbXNfaWQKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPml0ZW1zX2lkIGFzICRrZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgIC8vQ2hlY2sgcmVxdWlzaXRpb24gaXRlbQogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJGl0ZW0pCiAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVpc2l0aW9uSXRlbSkpIHsKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uID0gbmV3IE5vdGlmaWNhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnVzZXJfaWQgPSAkcmVxdWlzaXRpb25JdGVtLT5yZXF1aXNpdGlvbi0+YXV0aG9yX2lkOwogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnJlcXVpc2l0aW9uX2l0ZW1faWQgPSAkaXRlbTsKCiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmxpc3Qudmlldy5zaG93JywgJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPmlkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb25JdGVtLT5yZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIC4gJyBBbmQgSXRlbSBOYW1lOiAnIC4gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+bmFtZSAuICcuIFBsZWFzZSBDb2xsZWN0IFlvdXIgcHJvZHVjdCBmcm9tIHN0b3JlPC9zcGFuPic7CgogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPm1lc3NhZ2VzID0gJG1lc3NhZ2U7CgogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnN0YXR1cyA9ICdyZXF1aXNpdGlvbic7CiAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ05vIGRhdGEgZm91bmQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgc2VuZCB0byB1c2VycycpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBiYWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSBpbnZlbnRvcnkgY29tcGFyZSBkYXRhLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmVJbnZlbnRvcnlDb21wYXJlKCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnU3RvcmUgSW52ZW50b3J5IENvbXBhcmUnOwogICAgICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAndW5pdCcsCiAgICAgICAgICAgICAgICAncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxEZWxpdmVyeUl0ZW1zJywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnJlbEludmVudG9yeURldGFpbHMnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdpdGVtcy5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLmxvY2F0aW9uJywKICAgICAgICAgICAgICAgICdwcm9qZWN0VGFzay5zdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZS5wcm9qZWN0JywKICAgICAgICAgICAgICAgICdhdHRhY2htZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC8vIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJyxhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIC0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uWydyZXF1aXNpdGlvbl9xdHknXSA9ICRyZXF1aXNpdGlvbi0+aXRlbXMtPnN1bSgncXR5Jyk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb24tPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPmVhY2goZnVuY3Rpb24gKCRpdGVtLCAkaSkgewogICAgICAgICAgICAgICAgJGl0ZW1bJ2RlbGl2ZXJ5X3F0eSddID0gJGl0ZW0tPnJlbERlbGl2ZXJ5SXRlbXMtPnN1bSgnZGVsaXZlcnlfcXR5Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkcmVxdWlzaXRpb25bJ3RvdGFsX2RlbGl2ZXJ5X3F0eSddID0gJHJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5zdW0oJ2RlbGl2ZXJ5X3F0eScpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWludmVudG9yeS1jb21wYXJlJywgY29tcGFjdCgndGl0bGUnLCAncmVxdWlzaXRpb24nKSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlybSBkZWxpdmVyeSBkYXRhIHJldHVybiB0byBzdG9yZSBpbnZlbnRvcnkgY29tcGFyZSBkZWxpdmVyeSAuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBjb25maXJtRGVsaXZlcnkoJGlkKQogICAgewoKICAgICAgICAvL01ha2UgcHJlZml4IGZvciBjb25maXJtIGRlbGl2ZXJ5LgogICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICR1c2VyRGVwYXJ0bWVudHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICR1c2VyU2VjdGlvbnMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3NlY3Rpb25faWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAvL0ZpbmQgcmVxdWlzdGlvbi4KICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aChbCiAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QnLAogICAgICAgICAgICAnVW5pdCcKICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgJHByZWZpeCA9ICdDRC0nIC4gZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkgLiAnLScgLiAkcmVxdWlzaXRpb24tPlVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSAuICctJzsKICAgICAgICAkcmVmTm8gPSB1bmlxdWVDb2RlKDE0LCAkcHJlZml4LCAncmVxdWlzaXRpb25fZGVsaXZlcmllcycsICdpZCcpOwoKICAgICAgICAvL01ha2UgdGl0bGUuCiAgICAgICAgJHRpdGxlID0gJ1N0b3JlIEludmVudG9yeSBDb25maXJtIERlbGl2ZXJ5IHRvOiAnIC4gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPm5hbWU7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAvL1JlcXVpc3Rpb24gaXRlbXMgY29sbGVjdCB1c2luZyByZXF1aXN0aW9uSWQuCiAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdwcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdwcm9kdWN0LnJlbEludmVudG9yeVN1bW1hcnknLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QucmVsSW52ZW50b3J5RGV0YWlscy5yZWxXYXJlaG91c2UnLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QucHJvZHVjdFVuaXRDb252ZXJzaW9ucy5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdENvbnZlcnNpb25zLmNvbnZlcnNpb25Vbml0JywKCiAgICAgICAgICAgICAgICAncHJvZHVjdC5pbnZlbnRvcnlMb2dzLnN0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsncHJvY2Vzc2luZycsICdwYXJ0aWFsLWRlbGl2ZXJlZCcsICdyZnAnXSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlclVuaXRzLCAkdXNlckRlcGFydG1lbnRzLCAkdXNlclNlY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsICR1c2VyVW5pdHMpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICR3YXJlaG91c2VzID0gV2FyZWhvdXNlczo6d2hlcmVJbignaWQnLCBhdXRoKCktPnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpLT5nZXQoKTsKICAgICAgICAgICAgJHN0b2NrcyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAkc3RvY2tzWyRpdGVtLT5pZF0gPSBbXTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkaXRlbS0+cHJvZHVjdC0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSAkaXRlbS0+YXR0cmlidXRlcy0+cGx1Y2soJ2F0dHJpYnV0ZV9vcHRpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgICAgIGlmICgkaXRlbS0+cXR5ICE9ICRpdGVtLT5kZWxpdmVyeV9xdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2Nrc1skaXRlbS0+aWRdID0gSW52ZW50b3J5TG9nczo6d2hlcmVJbignd2FyZWhvdXNlX2lkJywgYXV0aCgpLT51c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPnNlbGVjdChcREI6OnJhdygnY291bnQoZGlzdGluY3QgaWQpJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXR0cmlidXRlX29wdGlvbl9pZCcsICRhdHRyaWJ1dGVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkaXRlbS0+cHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRpdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAoaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5ncm91cEJ5KCd3YXJlaG91c2VfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShgYXZhaWxhYmxlYCkgYXMgYXZhaWxhYmxlJyksICd3YXJlaG91c2VfaWQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5wbHVjaygnYXZhaWxhYmxlJywgJ3dhcmVob3VzZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAkY29zdENlbnRyZXMgPSBnZXRDb3N0Q2VudHJlcyh0cnVlKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1pbnZlbnRvcnktZGVsaXZlcnknLCBjb21wYWN0KCd0aXRsZScsICdyZXF1aXNpdGlvbkl0ZW1zJywgJ3JlcXVpc2l0aW9uJywgJ3JlZk5vJywgJ2Nvc3RDZW50cmVzJywgJ3dhcmVob3VzZXMnLCAnc3RvY2tzJykpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpcm0gZGVsaXZlcnkgc3VibWl0L3N0b3JlLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlZGlyZWN0UmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBjb25maXJtRGVsaXZlcnlTdWJtaXQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ2RlbGl2ZXJ5X3F0eScgPT4gInJlcXVpcmVkfGFycmF5fG1pbjoxIiwKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2RhdGUnID0+ICdyZXF1aXJlZHxkYXRlJywKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gInJlcXVpcmVkfHVuaXF1ZTpyZXF1aXNpdGlvbl9kZWxpdmVyaWVzfG1heDoxMDAiLAogICAgICAgIF0pOwogICAgICAgICRjb3VudERlbGl2ZXJ5SXRlbXMgPSBjb3VudChhcnJheV9maWx0ZXIoJHJlcXVlc3QtPmRlbGl2ZXJ5X3F0eSwgZnVuY3Rpb24gKCRkZWxpdmVyeVF0eSkgewogICAgICAgICAgICByZXR1cm4gIWlzX251bGwoJGRlbGl2ZXJ5UXR5KTsKICAgICAgICB9KSk7CgogICAgICAgIGlmICgkY291bnREZWxpdmVyeUl0ZW1zIDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1BsZWFzZSBzZWxlY3QgYXQgbGVhc3Qgb25lIHByb2R1Y3QgZm9yIGRlbGl2ZXJ5LicpOwogICAgICAgIH0KCiAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdENvbnZlcnNpb25zJywKICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5kZWxpdmVyeV9xdHkpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5kZWxpdmVyeV9xdHkpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5kZWxpdmVyeV9xdHkgYXMgJHVpZCA9PiAkcXR5KSB7CiAgICAgICAgICAgICAgICBpZiAoJHF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdCA9ICRyZXF1aXNpdGlvbkl0ZW1zLT53aGVyZSgndWlkJywgJHVpZCktPmZpcnN0KCktPnByb2R1Y3Q7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoJHByb2R1Y3QtPmlzX2ZpeGVkX2Fzc2V0ID09IDEgfHwgJHByb2R1Y3QtPmlzX2N3aXAgPT0gMSkgJiYgJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyR1aWRdIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1BsZWFzZSBzZWxlY3QgQ29zdCBDZW50cmUgZm9yIEl0ZW0gRGVsaXZlcnknKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRsZWRnZXJJdGVtcyA9IFtdOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQ7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1aXNpdGlvbklkKTsKCiAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb24tPnB1cmNoYXNlT3JkZXJzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gJHJlcXVpc2l0aW9uLT5wdXJjaGFzZU9yZGVyc1swXS0+cHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSBDb3N0Q2VudHJlOjp3aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+ICRyZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+YXNfdW5pdF9pZCwKICAgICAgICAgICAgICAgICAgICAnaHJfZGVwYXJ0bWVudF9pZCcgPT4gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkLAogICAgICAgICAgICAgICAgXSktPmZpcnN0KCktPmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcHJvamVjdCA9IGlzc2V0KCRyZXF1aXNpdGlvbi0+cHJvamVjdFRhc2stPmlkKTsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjp3aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbklkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uRGVsaXZlcnkgPSAkdGhpcy0+c3RvcmVSZXF1aXNpdGlvbkRlbGl2ZXJ5KCRyZXF1ZXN0KTsKCiAgICAgICAgICAgICRpdGVtVG90YWxEZWxpdmVyeVF0eSA9IDA7CiAgICAgICAgICAgICR0b3RhbERlbGl2ZXJ5UXR5ID0gMDsKICAgICAgICAgICAgLy8gJHJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtSW5wdXQgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmRlbGl2ZXJ5X3F0eSBhcyAkdWlkID0+ICRkZWxpdmVyeVF0eSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9ICRyZXF1aXNpdGlvbkl0ZW1zLT53aGVyZSgndWlkJywgJHVpZCktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAkcHJvZHVjdCA9ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3Q7CiAgICAgICAgICAgICAgICAkZGVsaXZlcnlRdHkgPSAkZGVsaXZlcnlRdHkgLyAoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+cHJvZHVjdFVuaXRDb252ZXJzaW9ucy0+d2hlcmUoJ2NvbnZlcnNpb25fdW5pdF9pZCcsICRyZXF1ZXN0LT5wcm9kdWN0X3VuaXRfaWRbJHVpZF0pLT5jb3VudCgpID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPnByb2R1Y3RVbml0Q29udmVyc2lvbnMtPndoZXJlKCdjb252ZXJzaW9uX3VuaXRfaWQnLCAkcmVxdWVzdC0+cHJvZHVjdF91bml0X2lkWyR1aWRdKS0+Zmlyc3QoKS0+Y29udmVyc2lvbl9yYXRlIDogMSk7CgogICAgICAgICAgICAgICAgaWYgKCRkZWxpdmVyeVF0eSA+IDAgJiYgaXNzZXQoJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSkgJiYgJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSA+IDApIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZFskdWlkXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyR1aWRdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy9QcmVwYXJlIHByZS1yZXF1aXNpdGUgZGF0YS4KICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlcyA9ICRyZXF1aXNpdGlvbkl0ZW0tPmF0dHJpYnV0ZXMtPnBsdWNrKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAkc3RvY2sgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT5zZWxlY3QoXERCOjpyYXcoJ2NvdW50KGRpc3RpbmN0IGlkKScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJywgJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3YXJlaG91c2VfaWQnID0+ICRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkgPyBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQgOiAwKQogICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYXZhaWxhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgJGxlZnQgPSBmbG9vcigoJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA6ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSkgPCAkc3RvY2sgPyAoJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA6ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSkgLSAkcmVxdWlzaXRpb25JdGVtLT5kZWxpdmVyeV9xdHkgOiAkc3RvY2spOwoKICAgICAgICAgICAgICAgICAgICBpZiAoJGRlbGl2ZXJ5UXR5ID4gJGxlZnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ0RlbGl2ZXJ5IHF0eSBpcyBncmVhdGVyIHRoZW4gcmVxdWlzaXRpb24gcXR5LiBQbGVhc2UgQWRqdXN0IEl0IGZvciBwcm9kdWN0ICcgLiAkcHJvZHVjdC0+bmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyhDdXJyZW50IGRlbGl2ZXJ5IHF0eSArIHByZXZpb3VzIGRlbGl2ZXJ5IHF0eSkKICAgICAgICAgICAgICAgICAgICAkaXRlbVRvdGFsRGVsaXZlcnlRdHkgPSAoJGRlbGl2ZXJ5UXR5ICsgJHJlcXVpc2l0aW9uSXRlbS0+ZGVsaXZlcnlfcXR5KTsKICAgICAgICAgICAgICAgICAgICAkdG90YWxEZWxpdmVyeVF0eSArPSAkaXRlbVRvdGFsRGVsaXZlcnlRdHk7CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBpdGVtIHdpc2UgdG90YWwgZGVsaXZlcnkgUXR5IChjdXJyZW50IGRlbGl2ZXJ5IHF0eSArIHByZXZpb3VzIGRlbGl2ZXJ5IHF0eSkKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT51cGRhdGUoWydkZWxpdmVyeV9xdHknID0+ICRpdGVtVG90YWxEZWxpdmVyeVF0eV0pOwoKICAgICAgICAgICAgICAgICAgICAkdW5pdFByaWNlID0gMDsKICAgICAgICAgICAgICAgICAgICAkc3RvY2tQcmljZSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWlzaXRpb25JdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uX2lkKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwcm9kdWN0X2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCd1aWQnLCAkcmVxdWlzaXRpb25JdGVtLT51aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkc3RvY2tQcmljZS0+dW5pdF9hbW91bnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdG9ja1ByaWNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwcm9kdWN0X2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCd1aWQnLCAkcmVxdWlzaXRpb25JdGVtLT51aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnaW52ZW50b3J5TG9ncycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXZhaWxhYmxlJywgJz4nLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHN0b2NrUHJpY2UtPnVuaXRfYW1vdW50KSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdW5pdFByaWNlID0gJHN0b2NrUHJpY2UtPnVuaXRfYW1vdW50OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9kZWxpdmVyeV9pZCcgPT4gJHJlcXVpc2l0aW9uRGVsaXZlcnktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiAkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAndWlkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT51aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAkZGVsaXZlcnlRdHksCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgIGlmICgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5pc19maXhlZF9hc3NldCA9PSAwICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmlzX2N3aXAgPT0gMCAmJiAhJHByb2plY3QgJiYgJGRlbGl2ZXJ5UXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoJ2pzb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGxlZGdlckl0ZW1zW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+Y29nc19hY2NvdW50X2lkKSAmJiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQgPiAwID8gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+Y29nc19hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2NvZ3NfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGRlbGl2ZXJ5UXR5ICogJHVuaXRQcmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAiUHJvZHVjdCBEZWxpdmVyeSA6OiBDT0dTIERlYml0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAncHJvZHVjdC1kZWxpdmVyeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcmVxdWlzaXRpb25EZWxpdmVyeUl0ZW0tPmlkCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgICRsZWRnZXJJdGVtc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkKSAmJiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA+IDAgPyAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydpbnZlbnRvcnlfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRkZWxpdmVyeVF0eSAqICR1bml0UHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAiUHJvZHVjdCBEZWxpdmVyeSA6OiBJbnZlbnRvcnkgQ3JlZGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAncHJvZHVjdC1kZWxpdmVyeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcmVxdWlzaXRpb25EZWxpdmVyeUl0ZW0tPmlkCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBkZWxpdmVyeSBxdHkgYW5kIHdhcmVob3VzZSB3aXNlIHByb2R1Y3QgcXR5CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dXBkYXRlSW52ZW50b3J5QW5kTG9nKCRyZXF1ZXN0LCAkcHJvZHVjdCwgJGRlbGl2ZXJ5UXR5LCAkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyR1aWRdLCAkcmVxdWlzaXRpb25JdGVtLCAkcmVxdWlzaXRpb25EZWxpdmVyeS0+cmVmZXJlbmNlX25vKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnRGVsaXZlcnkgcXR5IG1heSBub3QgZ3JhdGVyIHRoYW4gc3RvcmUgcXR5IGZvciBwcm9kdWN0ICcgLiAkcHJvZHVjdC0+bmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25Nb2RlbCA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1aXNpdGlvbklkKTsKCiAgICAgICAgICAgICAgICAgICAgJHRvdGFsUmVxdWlzaXRpb25RdHkgPSAkcmVxdWlzaXRpb25Nb2RlbC0+cmVxdWlzaXRpb25JdGVtcy0+c3VtKCdxY19xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQ7CiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uSWQpOwogICAgICAgICAgICAgICAgICAgIHJlcXVpc2l0aW9uVHJhY2tpbmdIaXN0b3J5KCRyZXF1aXNpdGlvbi0+aWQsICdjb25maXJtX2RlbGl2ZXJ5JywgJ0RlbGl2ZXJ5IENvbmZpcm1lZCBieSBTdG9yZScpOwoKICAgICAgICAgICAgICAgICAgICAvL1JlcXVpc2l0aW9uIHRyYWNraW5nCiAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbk1vZGVsLT5pZCwgJ2RlbGl2ZXJlZCcpOwoKICAgICAgICAgICAgICAgICAgICAvL1VwZGF0ZSByZXF1aXNpdGlvbiBzdGF0dXMgKGN1cnJlbnQgZGVsaXZlcnkgcXR5ICsgcHJldmlvdXMgZGVsaXZlcnkgcXR5KQogICAgICAgICAgICAgICAgICAgIGlmICgkdG90YWxEZWxpdmVyeVF0eSA9PSAkdG90YWxSZXF1aXNpdGlvblF0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25Nb2RlbC0+dXBkYXRlKFsnZGVsaXZlcnlfc3RhdHVzJyA9PiAnZGVsaXZlcmVkJ10pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbk1vZGVsLT51cGRhdGUoWydkZWxpdmVyeV9zdGF0dXMnID0+ICdwYXJ0aWFsLWRlbGl2ZXJlZCddKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uCgogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVpc2l0aW9uSXRlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+dXNlcl9pZCA9ICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5hdXRob3JfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnJlcXVpc2l0aW9uX2l0ZW1faWQgPSAkcmVxdWlzaXRpb25JdGVtLT5pZDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcgQW5kIEl0ZW0gTmFtZTogJyAuICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPm5hbWUgLiAnLiBTdWNjZXNzZnVsbHkgZGVsaXZlcmVkIHlvdXIgcHJvZHVjdC5QbGVhc2UgYWNrbm93bGVkZ2UgaXQ8L3NwYW4+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPm1lc3NhZ2VzID0gJG1lc3NhZ2U7CgogICAgICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNzZXQoJGxlZGdlckl0ZW1zWzBdKSkgewogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRlbGl2ZXJ5X2RhdGUgLiAnICcgLiBkYXRlKCdIOmk6cycpKSksIDEsICcnLCAnUHJvZHVjdCBEZWxpdmVyeScsICRsZWRnZXJJdGVtcywgKGlzc2V0KCRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQpID8gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCA6IGdldEV4Y2hhbmdlUmF0ZXMoc3lzdGVtQ3VycmVuY3koKS0+aWQpKSwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGVudHJ5WydlbnRyeSddLT5pZCkgJiYgaXNzZXQoJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVBPRW50cnkoJGVudHJ5LCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCwgJHB1cmNoYXNlT3JkZXItPmlkLCAncHJvZHVjdC1kZWxpdmVyeScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnUmVxdWlzaXRpb24gRGVsaXZlcnkgU3VjY2Vzc2Z1bGx5Jyk7CgogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgUmVxdWlzdGlvbiBkZWxpdmVyeSBkYXRhLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmVSZXF1aXNpdGlvbkRlbGl2ZXJ5KCRyZXF1ZXN0KQogICAgewogICAgICAgIHJldHVybiBSZXF1aXNpdGlvbkRlbGl2ZXJ5OjpjcmVhdGUoWwogICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gJHJlcXVlc3QtPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kZWxpdmVyeV9kYXRlKSksCiAgICAgICAgICAgICdub3RlJyA9PiAkcmVxdWVzdC0+bm90ZSwKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICBdKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBpbnZlbnRvcnkgJiBsb2cuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGVJbnZlbnRvcnlBbmRMb2coJHJlcXVlc3QsICRwcm9kdWN0LCAkZGVsaXZlcnlRdHksICR3YXJlaG91c2VJZCwgJHJlcXVpc2l0aW9uSXRlbSwgJHJlZmVyZW5jZV9ubyA9ICcnKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vVXBkYXRlIEludmVudG9yeSBTdW1tYXJ5CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5ID0gSW52ZW50b3J5U3VtbWFyeTo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRwcm9kdWN0LT5pZAogICAgICAgICAgICBdKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICR0b3RhbFByaWNlID0gKCgkSW52ZW50b3J5U3VtbWFyeS0+cXR5KSAtICgkZGVsaXZlcnlRdHkpKSAqICRJbnZlbnRvcnlTdW1tYXJ5LT51bml0X3ByaWNlOwogICAgICAgICAgICAkSW52ZW50b3J5U3VtbWFyeS0+cXR5ID0gKCRJbnZlbnRvcnlTdW1tYXJ5LT5xdHkpIC0gKCRkZWxpdmVyeVF0eSk7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT50b3RhbF9wcmljZSA9ICR0b3RhbFByaWNlOwogICAgICAgICAgICAkSW52ZW50b3J5U3VtbWFyeS0+c3RhdHVzID0gJ2FjdGl2ZSc7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT5zYXZlKCk7CgogICAgICAgICAgICAvL1VwZGF0ZSBJbnZlbnRvcnkgZGV0YWlscwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscyA9IEludmVudG9yeURldGFpbHM6OndoZXJlKFsKICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJHByb2R1Y3QtPmNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRwcm9kdWN0LT5pZCwKICAgICAgICAgICAgICAgICd3YXJlaG91c2VfaWQnID0+ICR3YXJlaG91c2VJZCwKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQsCiAgICAgICAgICAgIF0pLT5maXJzdCgpOwoKICAgICAgICAgICAgaWYgKCRkZWxpdmVyeVF0eSA+IChpc3NldCgkSW52ZW50b3J5RGV0YWlscy0+cXR5KSA/IGludHZhbCgkSW52ZW50b3J5RGV0YWlscy0+cXR5KSA6IDApKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0b3RhbFByaWNlT2ZJbnZlbnRvcnlEZXRhaWxzID0gKCgkSW52ZW50b3J5RGV0YWlscy0+cXR5KSAtICgkZGVsaXZlcnlRdHkpKSAqICRJbnZlbnRvcnlEZXRhaWxzLT51bml0X3ByaWNlOwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscy0+cXR5ID0gJEludmVudG9yeURldGFpbHMtPnF0eSAtICRkZWxpdmVyeVF0eTsKICAgICAgICAgICAgJEludmVudG9yeURldGFpbHMtPnRvdGFsX3ByaWNlID0gJHRvdGFsUHJpY2VPZkludmVudG9yeURldGFpbHM7CiAgICAgICAgICAgICRJbnZlbnRvcnlEZXRhaWxzLT5zdGF0dXMgPSAnYWN0aXZlJzsKICAgICAgICAgICAgJEludmVudG9yeURldGFpbHMtPnNhdmUoKTsKCiAgICAgICAgICAgICRhdHRyaWJ1dGVzID0gJHJlcXVpc2l0aW9uSXRlbS0+YXR0cmlidXRlcy0+cGx1Y2soJ2F0dHJpYnV0ZV9vcHRpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkc3RvY2tzID0gSW52ZW50b3J5TG9nczo6d2hlcmVIYXMoJ3N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLmF0dHJpYnV0ZXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRhdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPnNlbGVjdChcREI6OnJhdygnY291bnQoZGlzdGluY3QgaWQpJykpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJywgJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICB9LCAnPScsIGNvdW50KCRhdHRyaWJ1dGVzKSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICd3YXJlaG91c2VfaWQnID0+ICR3YXJlaG91c2VJZCwKICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRwcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkLAogICAgICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiBpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpID8gYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkIDogbnVsbAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2F2YWlsYWJsZScsICc+JywgMCkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkYXZhaWxhYmxlUXR5ID0gJGRlbGl2ZXJ5UXR5OwogICAgICAgICAgICAkbG9ncyA9IFtdOwogICAgICAgICAgICBpZiAoaXNzZXQoJHN0b2Nrc1swXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzdG9ja3MgYXMgJHN0b2NrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhdmFpbGFibGVRdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzX3F0eSA9ICgkc3RvY2stPmF2YWlsYWJsZSA+ICRhdmFpbGFibGVRdHkgPyAkYXZhaWxhYmxlUXR5IDogJHN0b2NrLT5hdmFpbGFibGUpOwogICAgICAgICAgICAgICAgICAgICAgICAkYXZhaWxhYmxlUXR5IC09ICR0aGlzX3F0eTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRzdG9jay0+YXZhaWxhYmxlID0gKCRzdG9jay0+YXZhaWxhYmxlIC0gJHRoaXNfcXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkbG9nc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkcHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHdhcmVob3VzZUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkgPyBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaXRfcHJpY2UnID0+ICRJbnZlbnRvcnlEZXRhaWxzLT51bml0X3ByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3F0eScgPT4gJHRoaXNfcXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F2YWlsYWJsZScgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZScgPT4gKCR0aGlzX3F0eSAqICRJbnZlbnRvcnlEZXRhaWxzLT51bml0X3ByaWNlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZlcmVuY2UnID0+ICRyZWZlcmVuY2Vfbm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAnYWN0aXZlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnb3V0JywKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzc2V0KCRsb2dzWzBdKSkgewogICAgICAgICAgICAgICAgSW52ZW50b3J5TG9nczo6aW5zZXJ0KCRsb2dzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZURlcGFydG1lbnQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2hlcmUoWwogICAgICAgICAgICAnaWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICdubycsCiAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwcm9jZXNzaW5nJwogICAgICAgIF0pLT5maXJzdCgpOwoKICAgICAgICAvL1N0YXJ0IHRyYW5zYWN0aW9uCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uLT5pZCkpIHsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+aXNfc2VuZF90b19yZnAgPSAneWVzJzsKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+c3RvcmVfbWVzc2FnZSA9ICRyZXF1ZXN0LT5tZXNzYWdlOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgcmVxdWlzaXRpb25UcmFja2luZ0hpc3RvcnkoJHJlcXVpc2l0aW9uLT5pZCwgJ3NlbnRfdG9fcHVyY2hhc2UnLCAnUmVxdWlzaXRpb24gc2VuZCB0byBwdXJjaGFzZSBkZXBhcnRtZW50Jyk7CgoKICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAncHJvY2Vzc2luZycpOwoKICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUuaW52ZW50b3J5LmNvbXBhcmUnLCAkcmVxdWlzaXRpb24tPmlkKSAuICciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnLldhdHRpbmcgZm9yIFByb2N1cmVtZW50L1B1cmNoYXNlLjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1B1cmNoYXNlLURlcGFydG1lbnQnLCBudWxsLCB0cnVlKSwgJ3NlbnQtdG8tcHVyY2hhc2UnKTsKCiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IFNlbmQgdG8gUHVyY2hhc2UgRGVwYXJ0bWVudCEhJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnRGF0YSBub3QgZm91bmQuISEnOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAkdGgtPmdldE1lc3NhZ2UoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNoYW5nZUFjdGlvblRvUkZQKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZShbJ2lkJyA9PiAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQsICdzdGF0dXMnID0+IDEsICdhcHByb3ZlZF9pZCcgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnXSktPmZpcnN0KCk7CgogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQoKGFycmF5KSRyZXF1aXNpdGlvbikgPiAwKSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPmlzX3NlbmRfdG9fcmZwID0gJ3llcyc7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPnJlcXVlc3Rfc3RhdHVzID0gJ3JmcCc7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPnNhdmUoKTsKICAgICAgICAgICAgICAgIC8vVHJhY2tpbmcKICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb24tPmlkLCAncHJvY2Vzc2luZycpOwoKICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUuaW52ZW50b3J5LmNvbXBhcmUnLCAkcmVxdWlzaXRpb24tPmlkKSAuICciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnLldhdHRpbmcgZm9yIFByb2N1cmVtZW50L1B1cmNoYXNlLjwvc3Bhbj4nOwoKCiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcsIG51bGwsIHRydWUpLCAnc2VuZC10by1wdXJjaGFzZScpOwogICAgICAgICAgICAgICAgLy9Db21taXQgZGF0YQogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgU2VuZCB0byBQdXJjaGFzZSBEZXBhcnRtZW50ISEnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdBbGxyZWFkeSBnZW5lcmF0ZWQgb25jZSEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICAvL0lmIHByb2Nlc3MgaGFzIGFueSBwcm9ibGVtIHRoZW4gcm9sbGJhY2sgdGhlIGRhdGEKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGRlbGl2ZXJlZExpc3RIZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3VuaXQnLCAndW5pdCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlcGFydG1lbnQnLCAnZGVwYXJ0bWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9uX2RhdGUnLCAncmVxdWlzaXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlbGl2ZXJlZF9kYXRlJywgJ2RlbGl2ZXJlZF9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgJ3JlcXVpc2l0aW9uX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCAnZGVsaXZlcmVkX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NhdGVnb3J5JywgJ2NhdGVnb3J5JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3N1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncHJvZHVjdCcsICdwcm9kdWN0JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3F0eScsICdxdHknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZyb21fZGF0ZSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tX2RhdGUnKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSA6IGRhdGUoJ1ktbS0wMScpOwogICAgICAgICAgICAkdG9fZGF0ZSA9IHJlcXVlc3QoKS0+aGFzKCd0b19kYXRlJykgPyByZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpIDogZGF0ZSgnWS1tLWQnKTsKCiAgICAgICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbTo6b3JkZXJCeSgnaWQnLCAnZGVzYycpCiAgICAgICAgICAgICAgICAtPndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywKICAgICAgICAgICAgICAgICAgICAncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsCiAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCd3YXJlaG91c2VfaWQnLCBBdXRoOjp1c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+YWxsKCkpCiAgICAgICAgICAgICAgICAtPndoZW4oJGZyb21fZGF0ZSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbV9kYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tX2RhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdkZWxpdmVyeV9kYXRlJywgJz49JywgJGZyb21fZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCR0b19kYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b19kYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b19kYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgnZGVsaXZlcnlfZGF0ZScsICc8PScsICR0b19kYXRlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJGRlbGl2ZXJlZFJlcXVpc2l0aW9ucykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSkgPyAkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd1bml0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl91bml0X3Nob3J0X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSkgPyAkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpID8gZGF0ZSgnZC1tLVknLCBzdHJ0b3RpbWUoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25fZGF0ZSkpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyZWRfZGF0ZScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+ZGVsaXZlcnlfZGF0ZSkgPyBkYXRlKCdkLW0tWScsIHN0cnRvdGltZSgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPmRlbGl2ZXJ5X2RhdGUpKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlbGl2ZXJlZF9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdkZWxpdmVyeV9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGRhdGEtaWQ9IicgLiAkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5pZCAuICciIGNsYXNzPSJidG4gYnRuLWxpbmsgbS0xIHJvdW5kZWQiIG9uY2xpY2s9InJlcXVpc2l0aW9udmlldygkKHRoaXMpKSI+JyAuIChpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8pID8gJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIDogJycpIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlZmVyZW5jZV9ubykgPyAkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlZmVyZW5jZV9ubyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyZWRfcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKSA/ICR2YWx1ZXMtPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjYXRlZ29yeScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKSA/ICRkZWxpdmVyeS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3ViX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5wcm9kdWN0LT5jYXRlZ29yeS0+bmFtZSkgPyAkZGVsaXZlcnktPnByb2R1Y3QtPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3ViX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3Byb2R1Y3QuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3QnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnByb2R1Y3QtPm5hbWUpID8gJGRlbGl2ZXJ5LT5wcm9kdWN0LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcm9kdWN0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdHknLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXJfZm9ybWF0KCRkZWxpdmVyeS0+ZGVsaXZlcnlfcXR5LCAwKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdxdHknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdkZWxpdmVyeV9xdHknLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcHRpb25zJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGRlbGl2ZXJ5LT5zdGF0dXMgPT0gJ3BlbmRpbmcnIHx8ICRkZWxpdmVyeS0+c3RhdHVzID09ICdhY2tub3dsZWRnZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InN0YXR1c05hbWUnIC4gJGRlbGl2ZXJ5LT5pZCAuICciPicgLiB1Y2ZpcnN0KCRkZWxpdmVyeS0+c3RhdHVzKSAuICc8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9ImhpZGVCdG4nIC4gJGRlbGl2ZXJ5LT5pZCAuICciPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ic3RvcmVkZWxpdmVyZWRBY2tub3dsZWRnZSgkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICRkZWxpdmVyeS0+aWQgLiAnIiB0aXRsZT0iRGVsaXZlcmVkIj48aSBjbGFzcz0ibGEgbGEtY2hlY2siPjwvaT4mbmJzcDtEZWxpdmVyZWQ8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0RlbGl2ZXJlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlcXVpc2l0aW9uX3JlZmVyZW5jZScsICdvcHRpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT50b0pzb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWRlbGl2ZXJlZC1yZXF1aXNpdGlvbi1saXN0JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiRGVsaXZlcmQgT3JkZXIgTGlzdCIsCiAgICAgICAgICAgICAgICAnZnJvbV9kYXRlJyA9PiAkZnJvbV9kYXRlLAogICAgICAgICAgICAgICAgJ3RvX2RhdGUnID0+ICR0b19kYXRlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5kZWxpdmVyZWRMaXN0SGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlbGl2ZXJlZCByZXF1aXN0aW9uIGFja25vd2xlZGdlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGRlbGl2ZXJlZFJlcXVpc2l0aW9uQWNrKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CgogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICR3YXJlaG91c2VJZHMgPSBBdXRoOjp1c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOjp3aGVyZUluKCd3YXJlaG91c2VfaWQnLCAkd2FyZWhvdXNlSWRzKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ3N0YXR1cycsIFsnZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmlkKQogICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICBpZiAoaXNzZXQoJGRlbGl2ZXJlZFJlcXVpc2l0aW9uKSkgewoKICAgICAgICAgICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbi0+c3RhdHVzID0gJ2RlbGl2ZXJlZCc7CiAgICAgICAgICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgVG8gRGVsaXZlcmVkLic7CgogICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnTm8gRGF0YSBGb3VuZCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKCiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkUmVxdWlzaXRpb25TZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgJGZyb21EYXRlID0gZGF0ZSgnWS1tLWQgSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmZyb21fZGF0ZSkpOwogICAgICAgICR0b0RhdGUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+dG9fZGF0ZSkpOwoKICAgICAgICAkc3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKCiAgICAgICAgJHdhcmVob3VzZUlkcyA9IEF1dGg6OnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT5hbGwoKTsKCiAgICAgICAgJGRlbGl2ZXJlZFJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06OndoZXJlSW4oJ3dhcmVob3VzZV9pZCcsICR3YXJlaG91c2VJZHMpCiAgICAgICAgICAgIC0+d2hlbigkc3RhdHVzLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRzdGF0dXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdGF0dXMnLCAkc3RhdHVzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRmcm9tRGF0ZSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbURhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbURhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPj0nLCAkZnJvbURhdGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkdG9EYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b0RhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG9EYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdkZWxpdmVyeV9kYXRlJywgJzw9JywgJHRvRGF0ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsICdERVNDJykKICAgICAgICAgICAgLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICBpZiAoY291bnQoJGRlbGl2ZXJlZFJlcXVpc2l0aW9uKSA+IDApIHsKICAgICAgICAgICAgICAgICRib2R5ID0gVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtZGVsaXZlcmVkLXJlcXVpc2l0aW9uLXNlYXJjaCcsCiAgICAgICAgICAgICAgICAgICAgWydkZWxpdmVyZWRSZXF1aXNpdGlvbicgPT4gJGRlbGl2ZXJlZFJlcXVpc2l0aW9uXSk7CgogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGJvZHktPnJlbmRlcigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdObyBEYXRhIEZvdW5kISEnOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcXVpc2l0aW9uIGRlbGl2ZXJ5IHZpZXcuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxdWlzaXRpb25EZWxpdmVyeVZpZXcoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aCgnaXRlbXMnLCAnaXRlbXMucHJvZHVjdCcsICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5JykKICAgICAgICAgICAgLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWlzaXRpb24pKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5zaG93JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc2l0aW9uJyA9PiAkcmVxdWlzaXRpb25dKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkYm9keS0+cmVuZGVyKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ05vIERhdGEgRm91bmQhISc7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQp9Cgo=