<?php
bolt_decrypt( __FILE__ , 'rPj29i'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7Cgp1c2UgQXBwXE1vZGVsc1xIclxVbml0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UcmFja2luZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3RVbml0Q29udmVyc2lvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5U3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEludmVudG9yeU1vZGVsc1xJbnZlbnRvcnlEZXRhaWxzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUxvZ3M7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBcQXBwXFVzZXI7Cgp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcVmlldzsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCLCBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWYWxpZGF0b3IsIElsbHVtaW5hdGVcU3VwcG9ydFxTdHI7CnVzZSBZYWpyYVxEYXRhVGFibGVzXEZhY2FkZXNcRGF0YVRhYmxlczsKCmNsYXNzIFN0b3JlQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgICRyb3cgPSBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0X2NhdGVnb3J5JywgJ3Byb2R1Y3RfY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9ieScsICdhcHByb3ZlZF9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9ieScsICdyZXF1aXNpdGlvbl9ieScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydkZWxpdmVyeScsICdkZWxpdmVyeScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCAnd2lkdGg6MTUlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93OwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoJGRlbGl2ZXJ5U3RhdHVzID0gbnVsbCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkaGVhZGVyQ29sdW1ucyA9ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkdGl0bGUgPSAoIWVtcHR5KCRkZWxpdmVyeVN0YXR1cykgPyAnQ29tcGxldGUnIDogJ1BlbmRpbmcnKSAuICcgRGVsaXZlcnkgbGlzdCBmb3IgUmVxdWlzaXRpb24nOwogICAgICAgICAgICAkZGVsaXZlcnlTdGF0dXMgPSAkZGVsaXZlcnlTdGF0dXMgPz8gJ3BhcnRpYWwtZGVsaXZlcmVkJzsKICAgICAgICAgICAgCiAgICAgICAgICAgICRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2l0aCgncmVsVXNlcnNMaXN0JywgJ3JlcXVpc2l0aW9uSXRlbXMnLCAncmVsUmVxdWlzaXRpb25EZWxpdmVyeScsICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbERlbGl2ZXJ5SXRlbXMnKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgnc3RhdHVzJywgMSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignZGVsaXZlcnlfc3RhdHVzJywgWydwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVmZXJlbmNlX25vJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlybS1kZWxpdmVyeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29uZmlybS1kZWxpdmVyeScpLAogICAgICAgICAgICAgICAgJ3NlbmQtdG8tcmZwJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzZW5kLXRvLXJmcCcpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lKSA/ICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywgJz0nLCAndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfZGVwYXJ0bWVudCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0X2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFJlcXVpc2l0aW9uSXRlbTo6c2VsZWN0KCdtYWluX2NhdGVnb3J5Lm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdwcm9kdWN0cycsICdwcm9kdWN0cy5pZCcsICc9JywgJ3JlcXVpc2l0aW9uX2l0ZW1zLnByb2R1Y3RfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjYXRlZ29yaWVzIGFzIHN1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnkuaWQnLCAnPScsICdwcm9kdWN0cy5jYXRlZ29yeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgbWFpbl9jYXRlZ29yeScsICdtYWluX2NhdGVnb3J5LmlkJywgJz0nLCAnc3ViX2NhdGVnb3J5LnBhcmVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdyZXF1aXNpdGlvbl9pdGVtcy5yZXF1aXNpdGlvbl9pZCcsICdyZXF1aXNpdGlvbnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+YXBwcm92ZWRCeS0+bmFtZSkgPyAkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYXBwcm92ZWRCeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigndXNlcnMuaWQnLCAncmVxdWlzaXRpb25zLmFwcHJvdmVkX2J5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2J5JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+bmFtZSkgPyAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5yZXF1aXNpdGlvbi1kZWxpdmVyZWQtbGlzdCcsICR2YWx1ZXMtPmlkKSAuICciIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiB0aXRsZT0iQ2xpY2sgaGVyZSB0byB2aWV3IGRldGFpbHMiIHRhcmdldD0iX2JsYW5rIj4gVG90YWwgKCcgLiBjb3VudCgkdmFsdWVzLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5KSAuICcpPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPmRlbGl2ZXJ5X3N0YXR1cyA9PSAnZGVsaXZlcmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxzcGFuPkZ1bGwgRGVsaXZlcmVkPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzcGFuIGlkPSJzdGF0dXNOYW1lJyAuICR2YWx1ZXMtPmlkIC4gJyI+QWN0aW9uPC9zcGFuPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydjb25maXJtLWRlbGl2ZXJ5J10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlzaXRpb25IYXNTdG9jaygkdmFsdWVzLT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUtcmVxdWlzaXRpb24uZGVsaXZlcnknLCAkdmFsdWVzLT5pZCkgLiAnIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyBDb25maXJtIERlbGl2ZXJ5Ij48aSBjbGFzcz0ibGEgbGEtdHJ1Y2stbW92aW5nIj48L2k+IENvbmZpcm0gRGVsaXZlcnk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydzZW5kLXRvLXJmcCddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPnJlcXVlc3Rfc3RhdHVzID09IE5VTEwgJiYgJHZhbHVlcy0+aXNfcG9fZ2VuZXJhdGUgPT0gJ25vJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpIGlkPSJoaWRlRnJvbUxpc3QnIC4gJHZhbHVlcy0+aWQgLiAnIj48YSBjbGFzcz0ic2VuZFRvUHVyY2hhc2VEZXBhcnRtZW50IiBvbmNsaWNrPSJzZW5kVG9QdXJjaGFzZURlcGFydG1lbnQoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2UuY2hhbmdlLmFjdGlvbi50by5yZnAnKSAuICciIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciIHRpdGxlPSJTZW5kIFRvIFByb2N1cmVtZW50Ij4gPGkgY2xhc3M9ImxhIGxhLXBhcGVyLXBsYW5lIj48L2k+IFNlbmQgVG8gUHJvY3VyZW1lbnQ8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNraW5nIFJlcXVpc2l0aW9uIiBjbGFzcz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzIiBvbmNsaWNrPSJ0cmFja1JlcXVpc2l0aW9uUHJvZ3Jlc3MoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkdmFsdWVzLT5pZCAuICciPjxpIGNsYXNzPSJsYSBsYS1tYXAiPjwvaT4mbmJzcDtUcmFjayBQcm9ncmVzczwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2Vfbm8nLCAnZGVsaXZlcnknLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9uLWRlbGl2ZXJ5LmluZGV4JywgY29tcGFjdCgndGl0bGUnLCAnaGVhZGVyQ29sdW1ucycpKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZUhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgJHJvdyA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsndW5pdCcsICd1bml0JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9uX2RhdGUnLCAncmVxdWlzaXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlcGFydG1lbnQnLCAnZGVwYXJ0bWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2R1Y3RfY2F0ZWdvcnknLCAncHJvZHVjdF9jYXRlZ29yeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NhbGVhYmxlJywgJ3NhbGVhYmxlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXBwcm92ZWRfYnknLCAnYXBwcm92ZWRfYnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnZGVsaXZlcnknLCAnZGVsaXZlcnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJHJvdzsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlUmVxdWlzaXRpb25MaXN0VmlldygpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gJ1N0b3JlIFJlcXVpc2l0aW9uIExpc3QgVmlldyc7CiAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgJHVzZXJTZWN0aW9ucyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfc2VjdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogbnVsbDsKICAgICAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IG51bGw7CiAgICAgICAgICAgICRjYXRlZ29yeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjYXRlZ29yeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NhdGVnb3J5X2lkJykgOiAwOwogICAgICAgICAgICAkZGVwYXJ0bWVudF9pZCA9IHJlcXVlc3QoKS0+aGFzKCdkZXBhcnRtZW50X2lkJykgPyByZXF1ZXN0KCktPmdldCgnZGVwYXJ0bWVudF9pZCcpIDogMDsKICAgICAgICAgICAgJGFwcHJvdmVkX2J5ID0gcmVxdWVzdCgpLT5oYXMoJ2FwcHJvdmVkX2J5JykgPyByZXF1ZXN0KCktPmdldCgnYXBwcm92ZWRfYnknKSA6IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRhcHByb3ZlcnMgPSBSZXF1aXNpdGlvbjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdhcHByb3ZlZF9ieScpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsICdpc19zZW5kX3RvX3JmcCcgPT4gJ25vJywgJ2lzX2ZpbmFuY2VfYXBwcm92YWwnID0+ICdhcHByb3ZlZCddKQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ2RlbGl2ZXJlZCcsICdwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3VuaXQnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdCcsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkQnknCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICAgICAgLy8gLT53aGVyZUluKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXJEZXBhcnRtZW50cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHN0cnRvdGltZSgkZnJvbSkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJz49JywgJGZyb20pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJHRvKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGRlcGFydG1lbnRfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRhcHByb3ZlZF9ieSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGFwcHJvdmVkX2J5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FwcHJvdmVkX2J5JywgJGFwcHJvdmVkX2J5KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGNhdGVnb3J5X2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY2F0ZWdvcnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRjYXRlZ29yeV9pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgICAgICdpc19maW5hbmNlX2FwcHJvdmFsJyA9PiAnYXBwcm92ZWQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbCiAgICAgICAgICAgICAgICAgICAgJ2RlbGl2ZXJlZCcsCiAgICAgICAgICAgICAgICAgICAgJ3BhcnRpYWwtZGVsaXZlcmVkJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAnY29uZmlybS1kZWxpdmVyeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29uZmlybS1kZWxpdmVyeScpLAogICAgICAgICAgICAgICAgJ3NlbmQtdG8tcmZwJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzZW5kLXRvLXJmcCcpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+VW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVW5pdDo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfc2hvcnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdocl91bml0LmhyX3VuaXRfaWQnLCAncmVxdWlzaXRpb25zLmhyX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lKSA/ICR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhcHByb3ZlZEJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2tRdHkgPSB2ZXJpZnlBdmFpbGFibGVTdG9jaygkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrUXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0idGV4dC1zdWNjZXNzIj5JbiBTdG9jayAoJyAuICRzdG9ja1F0eSAuICcpPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJ0ZXh0LWRhbmdlciI+T3V0IE9mIFN0b2NrPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHVzZSAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUXR5ID0gdmVyaWZ5QXZhaWxhYmxlU3RvY2soJHZhbHVlcy0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJjdXJyZW50Q29sb3IiIGNsYXNzPSJiaSBiaS10aHJlZS1kb3RzLXZlcnRpY2FsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPjxwYXRoIGQ9Ik05LjUgMTNhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAweiIvPjwvc3ZnPjwvYnV0dG9uPjx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1snY29uZmlybS1kZWxpdmVyeSddICYmICR2YWx1ZXMtPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+aXNfc2VydmljZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrUXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgaHJlZj0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnN0b3JlLXJlcXVpc2l0aW9uLmRlbGl2ZXJ5JywgJHZhbHVlcy0+aWQpIC4gJyIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gQ29uZmlybSBEZWxpdmVyeSI+PGkgY2xhc3M9ImxhIGxhLXRydWNrLW1vdmluZyI+PC9pPiBDb25maXJtIERlbGl2ZXJ5PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydzZW5kLXRvLXJmcCddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+aXNfc2VuZF90b19yZnAgPT0gJ25vJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8bGk+PGEgY2xhc3M9InNlbmRUb1B1cmNoYXNlRGVwYXJ0bWVudCIgb25jbGljaz0ic2VuZFRvUHVyY2hhc2VEZXBhcnRtZW50KCQodGhpcykpIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMuc3RvcmUtbWFuYWdlLnNlbmQudG8ucHVyY2hhc2UuZGVwYXJ0bWVudCcpIC4gJyIgZGF0YS1pZD0iJyAuICR2YWx1ZXMtPmlkIC4gJyIgdGl0bGU9IlNlbmQgVG8gUHJvY3VyZW1lbnQiPjxpIGNsYXNzPSJsYSBsYS1wYXBlci1wbGFuZSI+PC9pPiBTZW5kIFRvIFByb2N1cmVtZW50PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNraW5nIFJlcXVpc2l0aW9uIiBjbGFzcz0idHJhY2tSZXF1aXNpdGlvblByb2dyZXNzIiBvbmNsaWNrPSJ0cmFja2luZ1JlcXVpc3Rpb25TdGF0dXMoJyAuICR2YWx1ZXMtPmlkIC4gJykiID48aSBjbGFzcz0ibGEgbGEtbWFwIj48L2k+Jm5ic3A7IFRyYWNrIFByb2dyZXNzPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsICdhY3Rpb25zJywgJ2RlbGl2ZXJ5J10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVycycgPT4gJGFwcHJvdmVycywKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gJGRlcGFydG1lbnRzLAogICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG8sCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9ieScgPT4gJGFwcHJvdmVkX2J5LAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRfaWQnID0+ICRkZXBhcnRtZW50X2lkLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5zdG9yZUhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1yZXF1aXNpdGlvbi1saXN0LXZpZXcnLCAkZGF0YSk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFJmcCBsaXN0IHZpZXcgc2VhcmNoLgogICAgICogU2VhcmNoIGJldHdlZW4gZnJvbSBhbmQgdG8gZGF0ZSBhbmQgYWxzbyB1c2VyIGNhbiBzZWFyY2ggYnkgZW1wbG95ZWUKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZVJlcXVpc2l0aW9uTGlzdFZpZXdTZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAKICAgICAgICAkZnJvbURhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvRGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CiAgICAgICAgCiAgICAgICAgJHJlcXVpc2l0aW9uQnkgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25fYnk7CiAgICAgICAgJHJlcXVpc2l0aW9uU3RhdHVzID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX3N0YXR1czsKICAgICAgICAKICAgICAgICAkcmVxdWlzdGlvbkRhdGEgPSBSZXF1aXNpdGlvbjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tRGF0ZSkKICAgICAgICAgICAgLT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPD0nLCAkdG9EYXRlKQogICAgICAgICAgICAtPndoZW4oJHJlcXVpc2l0aW9uQnksIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uQnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCAkcmVxdWlzaXRpb25CeSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoWydzdGF0dXMnID0+ICRyZXF1aXNpdGlvblN0YXR1cywgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3Byb2Nlc3NpbmcnLCAnaXNfc2VuZF90b19yZnAnID0+ICdubyddKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY291bnQoJHJlcXVpc3Rpb25EYXRhKSA+IDApIHsKICAgICAgICAgICAgICAgICRib2R5ID0gVmlldzo6bWFrZSgncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtc2VhcmNoLXJlc3VsdC12aWV3JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc3Rpb25EYXRhJyA9PiAkcmVxdWlzdGlvbkRhdGFdKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdEYXRhIG5vdCBmb3VuZC4hISc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlYXJjaC4KICAgICAqIFNlYXJjaCBiZXR3ZWVuIGZyb20gYW5kIHRvIGRhdGUgYW5kIGFsc28gdXNlciBjYW4gc2VhcmNoIGJ5IGVtcGxveWVlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXBhcnRtZW50V2lzZUVtcGxveWVlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CiAgICAgICAgJHJlc3BvbnNlWydkYXRhJ10gPSAnJzsKICAgICAgICAKICAgICAgICAkZGVwYXJ0bWVudElkID0gJHJlcXVlc3QtPmRlcGFydG1lbnRfaWQ7CiAgICAgICAgCiAgICAgICAgJGVtcGxveWVlID0gUmVxdWlzaXRpb246OndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50SWQpIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudElkKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgfSkKICAgICAgICAgICAgLT5ncm91cEJ5KCdhdXRob3JfaWQnKQogICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsICdpc19zZW5kX3RvX3JmcCcgPT4gJ25vJ10pCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAKICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLVNlbGVjdCBPbmUtLTwvb3B0aW9uPic7CiAgICAgICAgaWYgKCFlbXB0eSgkZW1wbG95ZWUpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRlbXBsb3llZSBhcyAkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAnPG9wdGlvbiB2YWx1ZT0iJyAuICR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+aWQgLiAnIj4nIC4gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5uYW1lIC4gJzwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzcG9uc2VbJ2RhdGEnXSAuPSAiPG9wdGlvbiB2YWx1ZT0nJz5ObyBFbXBsb3llZSBGb3VuZCEhPC9vcHRpb24+IjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gcmZwUmVxdWlzaXRpb25MaXN0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgCiAgICAgICAgICAgICR0aXRsZSA9ICdSRlAgUmVxdWlzaXRpb24gTGlzdCc7CiAgICAgICAgICAgIC8vICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBkYXRlKCdZLW0tMDEnKTsKICAgICAgICAgICAgLy8gJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IGRhdGUoJ1ktbS10Jyk7CiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSA/IHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykgOiBudWxsOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogbnVsbDsKICAgICAgICAgICAgJGNhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CiAgICAgICAgICAgICRkZXBhcnRtZW50X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2RlcGFydG1lbnRfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdkZXBhcnRtZW50X2lkJykgOiAwOwogICAgICAgICAgICAkYXBwcm92ZWRfYnkgPSByZXF1ZXN0KCktPmhhcygnYXBwcm92ZWRfYnknKSA/IHJlcXVlc3QoKS0+Z2V0KCdhcHByb3ZlZF9ieScpIDogMDsKICAgICAgICAgICAgCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmRvZXNudEhhdmUoJ2NhdGVnb3J5JyktPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gUmVxdWlzaXRpb246OndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfZGVwYXJ0bWVudC5ocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3VzZXJzJywgJ3VzZXJzLmlkJywgJz0nLCAncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlKFsnc3RhdHVzJyA9PiAxLCAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgICAgIC0+Z2V0KFsnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X2lkJywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9uYW1lJ10pOwogICAgICAgICAgICAKICAgICAgICAgICAgJGFwcHJvdmVycyA9IFJlcXVpc2l0aW9uOjp3aXRoKCdhcHByb3ZlZEJ5JykKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgICAgICAtPndoZXJlTm90SW4oJ2RlbGl2ZXJ5X3N0YXR1cycsIFsnZGVsaXZlcmVkJywgJ3BhcnRpYWwtZGVsaXZlcmVkJ10pCiAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdpdGVtcy5wcm9kdWN0LnJlbEludmVudG9yeURldGFpbHMnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRCeScsCiAgICAgICAgICAgICAgICAnVW5pdCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJGZyb20pID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCR0bykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRkZXBhcnRtZW50X2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudF9pZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRkZXBhcnRtZW50X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJGRlcGFydG1lbnRfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkYXBwcm92ZWRfYnkgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRhcHByb3ZlZF9ieSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhcHByb3ZlZF9ieScsICRhcHByb3ZlZF9ieSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRjYXRlZ29yeV9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNhdGVnb3J5X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjYXRlZ29yeV9pZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkY2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWwogICAgICAgICAgICAgICAgICAgICdkZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgICAgICdwYXJ0aWFsLWRlbGl2ZXJlZCcKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdyZWZlcmVuY2Vfbm8nLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdjb25maXJtLWRlbGl2ZXJ5JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjb25maXJtLWRlbGl2ZXJ5JyksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9Im9wZW5Nb2RhbCgnIC4gJHZhbHVlcy0+aWQgLiAnKSIgIGNsYXNzPSJidG4gYnRuLWxpbmsiPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVpc2l0aW9uX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZhbHVlcy0+VW5pdC0+aHJfdW5pdF9uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnVW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVW5pdDo6c2VsZWN0KCdocl91bml0LmhyX3VuaXRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdocl91bml0LmhyX3VuaXRfaWQnLCAncmVxdWlzaXRpb25zLmhyX3VuaXRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8nLCAnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCAnPScsICd1c2Vycy5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9kZXBhcnRtZW50JywgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkcmVxdWlzaXRpb24tPml0ZW1zWzBdLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUpID8gJHJlcXVpc2l0aW9uLT5pdGVtc1swXS0+cHJvZHVjdC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUmVxdWlzaXRpb25JdGVtOjpzZWxlY3QoJ21haW5fY2F0ZWdvcnkubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeS5pZCcsICc9JywgJ3Byb2R1Y3RzLmNhdGVnb3J5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnkuaWQnLCAnPScsICdzdWJfY2F0ZWdvcnkucGFyZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5hcHByb3ZlZEJ5LT5uYW1lKSA/ICR2YWx1ZXMtPmFwcHJvdmVkQnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhcHByb3ZlZEJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcnknLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2tRdHkgPSB2ZXJpZnlBdmFpbGFibGVTdG9jaygkdmFsdWVzLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrUXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0idGV4dC1zdWNjZXNzIj5SZWFkeSBUbyBEZWxpdmVyeSAoJyAuICRzdG9ja1F0eSAuICcpPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJ0ZXh0LWRhbmdlciI+UHJvY2Vzc2luZzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLXRocmVlLWRvdHMtdmVydGljYWwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZD0iTTkuNSAxM2ExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHptMC01YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6Ii8+PC9zdmc+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUXR5ID0gdmVyaWZ5QXZhaWxhYmxlU3RvY2soJHZhbHVlcy0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdG9ja1F0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaXJzdEl0ZW0gPSAkdmFsdWVzLT5pdGVtcy0+Zmlyc3QoKSA/PyBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlzU2VydmljZSA9ICRmaXJzdEl0ZW0tPnByb2R1Y3QtPmNhdGVnb3J5LT5pc19zZXJ2aWNlID8/IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJG9wdGlvbnNbJ2NvbmZpcm0tZGVsaXZlcnknXSkgJiYgISRpc1NlcnZpY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbm9uTm90aWZpZWQgPSAkdmFsdWVzLT5pdGVtcygpLT5kb2VzbnRIYXZlKCdub3RpZmljYXRpb24nKS0+Y291bnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG5vbk5vdGlmaWVkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsaT48YSBocmVmPSIlcyIgdGl0bGU9Ik5vdGlmeSBVc2VyIHRvIGNvbGxlY3QgZ29vZHMiPjxpIGNsYXNzPSJsYSBsYS1iZWxsLW8iPjwvaT4gTm90aWZ5IFVzZXI8L2E+PC9saT4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2UucmVxdWlzaXRpb24uaXRlbXMubGlzdCcsICR2YWx1ZXMtPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsaT48YSBocmVmPSIlcyIgdGl0bGU9IkNsaWNrIEhlcmUgVG8gQ29uZmlybSBEZWxpdmVyeSI+PGkgY2xhc3M9ImxhIGxhLXRydWNrLW1vdmluZyI+PC9pPiBDb25maXJtIERlbGl2ZXJ5PC9hPjwvbGk+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUtcmVxdWlzaXRpb24uZGVsaXZlcnknLCAkdmFsdWVzLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgdGl0bGU9IlRyYWNrIFByb2dyZXNzIgogICAgICAgICAgICAgICAgY2xhc3M9InRyYWNraW5nUmVxdWlzdGlvblN0YXR1cyIgb25jbGljaz0idHJhY2tpbmdSZXF1aXN0aW9uU3RhdHVzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gJHZhbHVlcy0+aWQgLiAnIj48aSBjbGFzcz0ibGEgbGEtbWFwIj48L2k+VHJhY2sgUHJvZ3Jlc3M8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLnJlcXVpc2l0aW9uLmhpc3RvcnknLCAkdmFsdWVzLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtaGlzdG9yeSIgdGl0bGU9IlJlcXVpc2l0aW9uIEhpc3RvcnkiPjwvaT5SZXF1aXNpdGlvbiBIaXN0b3J5PC9hPjwvbGk8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzwvdWw+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ2FjdGlvbnMnLCAnZGVsaXZlcnknXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnYXBwcm92ZXJzJyA9PiAkYXBwcm92ZXJzLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiAkZGVwYXJ0bWVudHMsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJGNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2J5JyA9PiAkYXBwcm92ZWRfYnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudF9pZCcgPT4gJGRlcGFydG1lbnRfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnN0b3JlSGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLXJmcC1yZXF1aXNpdGlvbi1saXN0JywgJGRhdGEpOwogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZnAgbGlzdCB2aWV3IHNlcmFyY2guCiAgICAgKiBTZWFyY2ggYmV0d2VlbiBmcm9tIGFuZCB0byBkYXRlIGFuZCBhbHNvIHVzZXIgY2FuIHNlYXJjaCBieSBlbXBsb3llZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmZwRGVwYXJ0bWVudFdpc2VFbXBsb3llZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRyZXNwb25zZVsnZGF0YSddID0gJyc7CiAgICAgICAgCiAgICAgICAgJGRlcGFydG1lbnRJZCA9ICRyZXF1ZXN0LT5kZXBhcnRtZW50X2lkOwogICAgICAgIAogICAgICAgICRlbXBsb3llZSA9IFJlcXVpc2l0aW9uOjp3aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZGVwYXJ0bWVudElkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJGRlcGFydG1lbnRJZCkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT5ncm91cEJ5KCdhdXRob3JfaWQnKQogICAgICAgICAgICAtPmdldCgpOwogICAgICAgIAogICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSIiPi0tU2VsZWN0IE9uZS0tPC9vcHRpb24+JzsKICAgICAgICBpZiAoIWVtcHR5KCRlbXBsb3llZSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGVtcGxveWVlIGFzICR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICc8b3B0aW9uIHZhbHVlPSInIC4gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5pZCAuICciPicgLiAkdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPm5hbWUgLiAnPC9vcHRpb24+JzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXNwb25zZVsnZGF0YSddIC49ICI8b3B0aW9uIHZhbHVlPScnPk5vIEVtcGxveWVlIEZvdW5kISE8L29wdGlvbj4iOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgIAogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmZwIGxpc3QgdmlldyBzZXJhcmNoLgogICAgICogU2VhcmNoIGJldHdlZW4gZnJvbSBhbmQgdG8gZGF0ZSBhbmQgYWxzbyB1c2VyIGNhbiBzZWFyY2ggYnkgZW1wbG95ZWUKICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiByZnBSZXF1aXNpdGlvblNlYXJjaChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgICRmcm9tRGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5mcm9tX2RhdGUpKTsKICAgICAgICAkdG9EYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnRvX2RhdGUpKTsKICAgICAgICAkZGVwYXJ0bWVudElkID0gJHJlcXVlc3QtPmRlcGFydG1lbnRfaWQ7CiAgICAgICAgCiAgICAgICAgJHJlcXVpc2l0aW9uQnkgPSAkcmVxdWVzdC0+cmVxdWlzaXRpb25fYnk7CiAgICAgICAgJHJlcXVpc2l0aW9uU3RhdHVzID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX3N0YXR1czsKICAgICAgICAKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJz49JywgJGZyb21EYXRlKQogICAgICAgICAgICAtPndoZXJlRGF0ZSgncmVxdWlzaXRpb25fZGF0ZScsICc8PScsICR0b0RhdGUpCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWlzaXRpb25CeSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWlzaXRpb25CeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsICRyZXF1aXNpdGlvbkJ5KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRkZXBhcnRtZW50SWQsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRJZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGRlcGFydG1lbnRJZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJGRlcGFydG1lbnRJZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gJHJlcXVpc2l0aW9uU3RhdHVzLCAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnXSkKICAgICAgICAgICAgLT53aGVyZU5vdEluKCdkZWxpdmVyeV9zdGF0dXMnLCBbJ2RlbGl2ZXJlZCcsICdwYXJ0aWFsLWRlbGl2ZXJlZCddKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKICAgICAgICAKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uWzBdKSkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5yZnAtc2VhcmNoLXJlc3VsdC12aWV3JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc2l0aW9uJyA9PiAkcmVxdWlzaXRpb25dKTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9ICRib2R5LT5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGNvbnRlbnRzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdEYXRhIG5vdCBmb3VuZC4hISc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXF1aXN0aW9uIGl0ZW0gbGlzdC4KICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiByZXF1aXNpdGlvbkl0ZW1zTGlzdCgkaWQpCiAgICB7CiAgICAgICAgCiAgICAgICAgJHRpdGxlID0gIlJlcXVpc2l0aW9uIEl0ZW1zIExpc3QiOwogICAgICAgIAogICAgICAgIC8vRmluZCByZXF1aXN0aW9uCiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndoZXJlKCdpZCcsICRpZCkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShbJ3N0YXR1cycgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJ10pCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignZGVsaXZlcnlfc3RhdHVzJywgWydkZWxpdmVyZWQnLCAncGFydGlhbC1kZWxpdmVyZWQnXSkKICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUucmVxdWlzaXRpb24taXRlbXMtbGlzdCcsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uJykpOwogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2VuZCBub3RpZmljYXRpb24gdG8gdXNlcnMuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZE5vdGlmaWNhdGlvblRvVXNlcnMoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAKICAgICAgICAvL1ZhbGlkYXRlIGlucHV0ZSByZXF1ZXN0CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdpdGVtc19pZCcgPT4gWydyZXF1aXJlZCddLAogICAgICAgIF0pOwogICAgICAgIAogICAgICAgIC8vRGIgdHJhbnNhY3Rpb24gc3RhcnQKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL0NyYXRlIGluc3RhbmNlIG9mIGl0ZW1zX2lkCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5pdGVtc19pZCBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAvL0NoZWNrIHJlcXVpc2l0aW9uIGl0ZW0KICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpZCcsICRpdGVtKQogICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkcmVxdWlzaXRpb25JdGVtKSkgewogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+dXNlcl9pZCA9ICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5hdXRob3JfaWQ7CiAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+cmVxdWlzaXRpb25faXRlbV9pZCA9ICRpdGVtOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcgQW5kIEl0ZW0gTmFtZTogJyAuICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPm5hbWUgLiAnLiBQbGVhc2UgQ29sbGVjdCBZb3VyIHByb2R1Y3QgZnJvbSBzdG9yZTwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPm1lc3NhZ2VzID0gJG1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+c3RhdHVzID0gJ3JlcXVpc2l0aW9uJzsKICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdObyBkYXRhIGZvdW5kJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHNlbmQgdG8gdXNlcnMnKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBiYWNrKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU3RvcmUgaW52ZW50b3J5IGNvbXBhcmUgZGF0YS4KICAgICAqIEBwYXJhbSBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZUludmVudG9yeUNvbXBhcmUoJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aXRsZSA9ICdTdG9yZSBJbnZlbnRvcnkgQ29tcGFyZSc7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgICAgICd1bml0JywKICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbERlbGl2ZXJ5SXRlbXMnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QucmVsSW52ZW50b3J5RGV0YWlscycsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAnaXRlbXMucHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsVXNlcnNMaXN0LmVtcGxveWVlLnVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS5kZXBhcnRtZW50JywKICAgICAgICAgICAgICAgICdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUubG9jYXRpb24nLAogICAgICAgICAgICAgICAgJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlLnByb2plY3QnLAogICAgICAgICAgICAgICAgJ2F0dGFjaG1lbnRzJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLy8gLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkcmVxdWlzaXRpb25bJ3JlcXVpc2l0aW9uX3F0eSddID0gJHJlcXVpc2l0aW9uLT5pdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sICRpKSB7CiAgICAgICAgICAgICAgICAkaXRlbVsnZGVsaXZlcnlfcXR5J10gPSAkaXRlbS0+cmVsRGVsaXZlcnlJdGVtcy0+c3VtKCdkZWxpdmVyeV9xdHknKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRyZXF1aXNpdGlvblsndG90YWxfZGVsaXZlcnlfcXR5J10gPSAkcmVxdWlzaXRpb24tPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnN1bSgnZGVsaXZlcnlfcXR5Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3RvcmUuc3RvcmUtaW52ZW50b3J5LWNvbXBhcmUnLCBjb21wYWN0KCd0aXRsZScsICdyZXF1aXNpdGlvbicpKTsKICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGNvbmZpcm1EZWxpdmVyeSgkaWQpCiAgICB7CiAgICAgICAgCiAgICAgICAgLy9NYWtlIHByZWZpeCBmb3IgY29uZmlybSBkZWxpdmVyeS4KICAgICAgICAkdXNlclVuaXRzID0gYXJyYXlfdW5pcXVlKGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICR1c2VyRGVwYXJ0bWVudHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICR1c2VyU2VjdGlvbnMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3NlY3Rpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vRmluZCByZXF1aXN0aW9uLgogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUluKCdocl91bml0X2lkJywgJHVzZXJVbml0cykKICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkaWQpLT5maXJzdCgpOwogICAgICAgIAogICAgICAgIGlmIChlbXB0eSgkcmVxdWlzaXRpb24pKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyByZXF1aXNpdGlvbi4nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJHByZWZpeCA9ICdDRC0nIC4gZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkgLiAnLScgLiAkcmVxdWlzaXRpb24tPlVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSAuICctJzsKICAgICAgICAkcmVmTm8gPSB1bmlxdWVDb2RlKDE0LCAkcHJlZml4LCAncmVxdWlzaXRpb25fZGVsaXZlcmllcycsICdpZCcpOwogICAgICAgIAogICAgICAgIC8vTWFrZSB0aXRsZS4KICAgICAgICAkdGl0bGUgPSAnU3RvcmUgSW52ZW50b3J5IENvbmZpcm0gRGVsaXZlcnkgdG86ICcgLiAkcmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+bmFtZTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAKICAgICAgICAgICAgLy9SZXF1aXNpdGlvbiBpdGVtcyBjb2xsZWN0IHVzaW5nIHJlcXVpc3Rpb25JZC4KICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ3Byb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3QucmVsSW52ZW50b3J5U3VtbWFyeScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5yZWxJbnZlbnRvcnlEZXRhaWxzLnJlbFdhcmVob3VzZScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdENvbnZlcnNpb25zLnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdwcm9kdWN0LnByb2R1Y3RVbml0Q29udmVyc2lvbnMuY29udmVyc2lvblVuaXQnLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICdwcm9kdWN0LmludmVudG9yeUxvZ3Muc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignZGVsaXZlcnlfc3RhdHVzJywgWydwcm9jZXNzaW5nJywgJ3BhcnRpYWwtZGVsaXZlcmVkJywgJ3JmcCddKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb24tPmlkKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICR3YXJlaG91c2VzID0gV2FyZWhvdXNlczo6d2hlcmVJbignaWQnLCBhdXRoKCktPnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpLT5nZXQoKTsKICAgICAgICAgICAgJHN0b2NrcyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAkc3RvY2tzWyRpdGVtLT5pZF0gPSBbXTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkaXRlbS0+cHJvZHVjdC0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSAkaXRlbS0+YXR0cmlidXRlcy0+cGx1Y2soJ2F0dHJpYnV0ZV9vcHRpb25faWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgICAgIGlmICgkaXRlbS0+cXR5ICE9ICRpdGVtLT5kZWxpdmVyeV9xdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2Nrc1skaXRlbS0+aWRdID0gSW52ZW50b3J5TG9nczo6d2hlcmVJbignd2FyZWhvdXNlX2lkJywgYXV0aCgpLT51c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPnNlbGVjdChcREI6OnJhdygnY291bnQoZGlzdGluY3QgaWQpJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXR0cmlidXRlX29wdGlvbl9pZCcsICRhdHRyaWJ1dGVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkaXRlbS0+cHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRpdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAoaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5ncm91cEJ5KCd3YXJlaG91c2VfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShgYXZhaWxhYmxlYCkgYXMgYXZhaWxhYmxlJyksICd3YXJlaG91c2VfaWQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5wbHVjaygnYXZhaWxhYmxlJywgJ3dhcmVob3VzZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRjb3N0Q2VudHJlcyA9IGdldENvc3RDZW50cmVzKHRydWUpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWludmVudG9yeS1kZWxpdmVyeScsIGNvbXBhY3QoJ3RpdGxlJywgJ3JlcXVpc2l0aW9uSXRlbXMnLCAncmVxdWlzaXRpb24nLCAncmVmTm8nLCAnY29zdENlbnRyZXMnLCAnd2FyZWhvdXNlcycsICdzdG9ja3MnKSk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIENvbmZpcm0gZGVsaXZlcnkgc3VibWl0L3N0b3JlLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlZGlyZWN0UmVzcG9uc2UKICAgICAqLwogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gY29uZmlybURlbGl2ZXJ5U3VibWl0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgLy9kZCgkcmVxdWVzdC0+YWxsKCkpOwogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAicmVxdWlyZWR8YXJyYXl8bWluOjEiLAogICAgICAgICAgICAnZGVsaXZlcnlfZGF0ZScgPT4gJ3JlcXVpcmVkfGRhdGUnLAogICAgICAgICAgICAncmVmZXJlbmNlX25vJyA9PiAicmVxdWlyZWR8dW5pcXVlOnJlcXVpc2l0aW9uX2RlbGl2ZXJpZXN8bWF4OjEwMCIsCiAgICAgICAgXSk7CiAgICAgICAgJGNvdW50RGVsaXZlcnlJdGVtcyA9IGNvdW50KGFycmF5X2ZpbHRlcigkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5LCBmdW5jdGlvbiAoJGRlbGl2ZXJ5UXR5KSB7CiAgICAgICAgICAgIHJldHVybiAhaXNfbnVsbCgkZGVsaXZlcnlRdHkpOwogICAgICAgIH0pKTsKICAgICAgICAKICAgICAgICBpZiAoJGNvdW50RGVsaXZlcnlJdGVtcyA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdQbGVhc2Ugc2VsZWN0IGF0IGxlYXN0IG9uZSBwcm9kdWN0IGZvciBkZWxpdmVyeS4nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndpdGgoWwogICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdENvbnZlcnNpb25zJywKICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgoKLy8gICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5KSAmJiBpc19hcnJheSgkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5KSkgewovLyAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5kZWxpdmVyeV9xdHkgYXMgJHVpZCA9PiAkcXR5KSB7Ci8vICAgICAgICAgICAgICAgIGlmICgkcXR5ID4gMCkgewovLyAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3QgPSAkcmVxdWlzaXRpb25JdGVtcy0+d2hlcmUoJ3VpZCcsICR1aWQpLT5maXJzdCgpLT5wcm9kdWN0OwovLyAgICAgICAgICAgICAgICAgICAgaWYgKCEoJHByb2R1Y3QtPmlzX2ZpeGVkX2Fzc2V0ID09IDEgfHwgJHByb2R1Y3QtPmlzX2N3aXAgPT0gMSkgJiYgJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyR1aWRdIDw9IDApIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnUGxlYXNlIHNlbGVjdCBDb3N0IENlbnRyZSBmb3IgSXRlbSBEZWxpdmVyeScpOwovLyAgICAgICAgICAgICAgICAgICAgfQovLyAgICAgICAgICAgICAgICB9Ci8vICAgICAgICAgICAgfQovLyAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGxlZGdlckl0ZW1zID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICAkcmVxdWlzaXRpb25JZCA9ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZDsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uSWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgJHBvX2NoZWNrID0gJHJlcXVpc2l0aW9uLT5wdXJjaGFzZU9yZGVycy0+Zmlyc3QoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkcG9fY2hlY2sgJiYgJHBvX2NoZWNrLT5wdXJjaGFzZU9yZGVyKSB7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkcG9fY2hlY2stPnB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkOwogICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVpc2l0aW9uLT5jb3N0X2NlbnRyZV9pZCkgewogICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gJHJlcXVpc2l0aW9uLT5jb3N0X2NlbnRyZV9pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRjb3N0X2NlbnRyZV9pZCA9IG9wdGlvbmFsKAogICAgICAgICAgICAgICAgICAgIENvc3RDZW50cmU6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+ICRyZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+YXNfdW5pdF9pZCA/PyBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfZGVwYXJ0bWVudF9pZCcgPT4gJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkID8/IG51bGwsCiAgICAgICAgICAgICAgICAgICAgXSktPmZpcnN0KCkKICAgICAgICAgICAgICAgICktPmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vZGQoJGNvc3RfY2VudHJlX2lkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRwcm9qZWN0ID0gaXNzZXQoJHJlcXVpc2l0aW9uLT5wcm9qZWN0VGFzay0+aWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWlzaXRpb25JZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uSWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAkcmVxdWlzaXRpb25EZWxpdmVyeSA9ICR0aGlzLT5zdG9yZVJlcXVpc2l0aW9uRGVsaXZlcnkoJHJlcXVlc3QpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGl0ZW1Ub3RhbERlbGl2ZXJ5UXR5ID0gMDsKICAgICAgICAgICAgJHRvdGFsRGVsaXZlcnlRdHkgPSAwOwogICAgICAgICAgICAvLyAkcmVxdWlzaXRpb25EZWxpdmVyeUl0ZW1JbnB1dCA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+ZGVsaXZlcnlfcXR5IGFzICR1aWQgPT4gJGRlbGl2ZXJ5UXR5KSB7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtID0gJHJlcXVpc2l0aW9uSXRlbXMtPndoZXJlKCd1aWQnLCAkdWlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdDsKICAgICAgICAgICAgICAgICRkZWxpdmVyeVF0eSA9ICRkZWxpdmVyeVF0eSAvICgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5wcm9kdWN0VW5pdENvbnZlcnNpb25zLT53aGVyZSgnY29udmVyc2lvbl91bml0X2lkJywgJHJlcXVlc3QtPnByb2R1Y3RfdW5pdF9pZFskdWlkXSktPmNvdW50KCkgPiAwID8gJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+cHJvZHVjdFVuaXRDb252ZXJzaW9ucy0+d2hlcmUoJ2NvbnZlcnNpb25fdW5pdF9pZCcsICRyZXF1ZXN0LT5wcm9kdWN0X3VuaXRfaWRbJHVpZF0pLT5maXJzdCgpLT5jb252ZXJzaW9uX3JhdGUgOiAxKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCRkZWxpdmVyeVF0eSA+IDAgJiYgaXNzZXQoJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSkgJiYgJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoaXNzZXQoJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyR1aWRdKSkgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAkY29zdF9jZW50cmVfaWQgPSAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWRbJHVpZF07CiAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgICAvL2RkKCRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy9QcmVwYXJlIHByZS1yZXF1aXNpdGUgZGF0YS4KICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlcyA9ICRyZXF1aXNpdGlvbkl0ZW0tPmF0dHJpYnV0ZXMtPnBsdWNrKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAkc3RvY2sgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT5zZWxlY3QoXERCOjpyYXcoJ2NvdW50KGRpc3RpbmN0IGlkKScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhdHRyaWJ1dGVfb3B0aW9uX2lkJywgJGF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3YXJlaG91c2VfaWQnID0+ICRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJHVpZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkgPyBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQgOiAwKQogICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYXZhaWxhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgJGxlZnQgPSBmbG9vcigoJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA6ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSkgPCAkc3RvY2sgPyAoJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA6ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSkgLSAkcmVxdWlzaXRpb25JdGVtLT5kZWxpdmVyeV9xdHkgOiAkc3RvY2spOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICgkZGVsaXZlcnlRdHkgPiAkbGVmdCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnRGVsaXZlcnkgcXR5IGlzIGdyZWF0ZXIgdGhlbiByZXF1aXNpdGlvbiBxdHkuIFBsZWFzZSBBZGp1c3QgSXQgZm9yIHByb2R1Y3QgJyAuICRwcm9kdWN0LT5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8oQ3VycmVudCBkZWxpdmVyeSBxdHkgKyBwcmV2aW91cyBkZWxpdmVyeSBxdHkpCiAgICAgICAgICAgICAgICAgICAgJGl0ZW1Ub3RhbERlbGl2ZXJ5UXR5ID0gKCRkZWxpdmVyeVF0eSArICRyZXF1aXNpdGlvbkl0ZW0tPmRlbGl2ZXJ5X3F0eSk7CiAgICAgICAgICAgICAgICAgICAgJHRvdGFsRGVsaXZlcnlRdHkgKz0gJGl0ZW1Ub3RhbERlbGl2ZXJ5UXR5OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBpdGVtIHdpc2UgdG90YWwgZGVsaXZlcnkgUXR5IChjdXJyZW50IGRlbGl2ZXJ5IHF0eSArIHByZXZpb3VzIGRlbGl2ZXJ5IHF0eSkKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT51cGRhdGUoWydkZWxpdmVyeV9xdHknID0+ICRpdGVtVG90YWxEZWxpdmVyeVF0eV0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICR1bml0UHJpY2UgPSAwOwogICAgICAgICAgICAgICAgICAgICRzdG9ja1ByaWNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb25faWQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VpZCcsICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRzdG9ja1ByaWNlLT51bml0X2Ftb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrUHJpY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VpZCcsICRyZXF1aXNpdGlvbkl0ZW0tPnVpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdpbnZlbnRvcnlMb2dzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdmFpbGFibGUnLCAnPicsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRzdG9ja1ByaWNlLT51bml0X2Ftb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVuaXRQcmljZSA9ICRzdG9ja1ByaWNlLT51bml0X2Ftb3VudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9kZWxpdmVyeV9pZCcgPT4gJHJlcXVpc2l0aW9uRGVsaXZlcnktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiAkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyR1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAndWlkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT51aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAkZGVsaXZlcnlRdHksCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmlzX2ZpeGVkX2Fzc2V0ID09IDAgJiYgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+aXNfY3dpcCA9PSAwICYmICEkcHJvamVjdCAmJiAkZGVsaXZlcnlRdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygnanNvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAkbGVkZ2VySXRlbXNbXSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCA+IDAgPyAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY29nc19hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkZGVsaXZlcnlRdHkgKiAkdW5pdFByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IENPR1MgRGViaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgJGxlZGdlckl0ZW1zW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGRlbGl2ZXJ5UXR5ICogJHVuaXRQcmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IEludmVudG9yeSBDcmVkaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZGVsaXZlcnkgcXR5IGFuZCB3YXJlaG91c2Ugd2lzZSBwcm9kdWN0IHF0eQogICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnVwZGF0ZUludmVudG9yeUFuZExvZygkcmVxdWVzdCwgJHByb2R1Y3QsICRkZWxpdmVyeVF0eSwgJHJlcXVlc3QtPndhcmVob3VzZV9pZFskdWlkXSwgJHJlcXVpc2l0aW9uSXRlbSwgJHJlcXVpc2l0aW9uRGVsaXZlcnktPnJlZmVyZW5jZV9ubykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ0RlbGl2ZXJ5IHF0eSBtYXkgbm90IGdyYXRlciB0aGFuIHN0b3JlIHF0eSBmb3IgcHJvZHVjdCAnIC4gJHByb2R1Y3QtPm5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25Nb2RlbCA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1aXNpdGlvbklkKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkdG90YWxSZXF1aXNpdGlvblF0eSA9ICRyZXF1aXNpdGlvbk1vZGVsLT5yZXF1aXNpdGlvbkl0ZW1zLT5zdW0oJ3FjX3F0eScpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbklkID0gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkOwogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1aXNpdGlvbklkKTsKICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb24tPmlkLCAnY29uZmlybV9kZWxpdmVyeScsICdEZWxpdmVyeSBDb25maXJtZWQgYnkgU3RvcmUnKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvL1JlcXVpc2l0aW9uIHRyYWNraW5nCiAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbk1vZGVsLT5pZCwgJ2RlbGl2ZXJlZCcpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vVXBkYXRlIHJlcXVpc2l0aW9uIHN0YXR1cyAoY3VycmVudCBkZWxpdmVyeSBxdHkgKyBwcmV2aW91cyBkZWxpdmVyeSBxdHkpCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0b3RhbERlbGl2ZXJ5UXR5ID09ICR0b3RhbFJlcXVpc2l0aW9uUXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbk1vZGVsLT51cGRhdGUoWydkZWxpdmVyeV9zdGF0dXMnID0+ICdkZWxpdmVyZWQnXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uTW9kZWwtPnVwZGF0ZShbJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3BhcnRpYWwtZGVsaXZlcmVkJ10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVpc2l0aW9uSXRlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGlmaWNhdGlvbi0+dXNlcl9pZCA9ICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5hdXRob3JfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPnJlcXVpc2l0aW9uX2l0ZW1faWQgPSAkcmVxdWlzaXRpb25JdGVtLT5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsICRyZXF1aXNpdGlvbkl0ZW0tPnJlcXVpc2l0aW9uLT5pZCkgLiAnP3ZpZXciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uSXRlbS0+cmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcgQW5kIEl0ZW0gTmFtZTogJyAuICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPm5hbWUgLiAnLiBTdWNjZXNzZnVsbHkgZGVsaXZlcmVkIHlvdXIgcHJvZHVjdC5QbGVhc2UgYWNrbm93bGVkZ2UgaXQ8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpZmljYXRpb24tPm1lc3NhZ2VzID0gJG1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkbm90aWZpY2F0aW9uLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoaXNzZXQoJGxlZGdlckl0ZW1zWzBdKSkgewogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRlbGl2ZXJ5X2RhdGUgLiAnICcgLiBkYXRlKCdIOmk6cycpKSksIDEsICcnLCAnUHJvZHVjdCBEZWxpdmVyeScsICRsZWRnZXJJdGVtcywgKGlzc2V0KCRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQpID8gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCA6IGdldEV4Y2hhbmdlUmF0ZXMoc3lzdGVtQ3VycmVuY3koKS0+aWQpKSwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGVudHJ5WydlbnRyeSddLT5pZCkgJiYgaXNzZXQoJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZVBPRW50cnkoJGVudHJ5LCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCwgJHB1cmNoYXNlT3JkZXItPmlkLCAncHJvZHVjdC1kZWxpdmVyeScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnUmVxdWlzaXRpb24gRGVsaXZlcnkgU3VjY2Vzc2Z1bGx5Jyk7CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTdG9yZSBSZXF1aXN0aW9uIGRlbGl2ZXJ5IGRhdGEuCiAgICAgKiBAcGFyYW0gXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmVSZXF1aXNpdGlvbkRlbGl2ZXJ5KCRyZXF1ZXN0KQogICAgewogICAgICAgIHJldHVybiBSZXF1aXNpdGlvbkRlbGl2ZXJ5OjpjcmVhdGUoWwogICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gJHJlcXVlc3QtPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kZWxpdmVyeV9kYXRlKSksCiAgICAgICAgICAgICdub3RlJyA9PiAkcmVxdWVzdC0+bm90ZSwKICAgICAgICAgICAgJ2RlbGl2ZXJ5X2J5JyA9PiBBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICBdKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBVcGRhdGUgaW52ZW50b3J5ICYgbG9nLgogICAgICogQHBhcmFtIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZUludmVudG9yeUFuZExvZygkcmVxdWVzdCwgJHByb2R1Y3QsICRkZWxpdmVyeVF0eSwgJHdhcmVob3VzZUlkLCAkcmVxdWlzaXRpb25JdGVtLCAkcmVmZXJlbmNlX25vID0gJycpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy9VcGRhdGUgSW52ZW50b3J5IFN1bW1hcnkKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnkgPSBJbnZlbnRvcnlTdW1tYXJ5Ojp3aGVyZShbCiAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkCiAgICAgICAgICAgIF0pLT5maXJzdCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJHRvdGFsUHJpY2UgPSAoKCRJbnZlbnRvcnlTdW1tYXJ5LT5xdHkpIC0gKCRkZWxpdmVyeVF0eSkpICogJEludmVudG9yeVN1bW1hcnktPnVuaXRfcHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT5xdHkgPSAoJEludmVudG9yeVN1bW1hcnktPnF0eSkgLSAoJGRlbGl2ZXJ5UXR5KTsKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnktPnRvdGFsX3ByaWNlID0gJHRvdGFsUHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlTdW1tYXJ5LT5zdGF0dXMgPSAnYWN0aXZlJzsKICAgICAgICAgICAgJEludmVudG9yeVN1bW1hcnktPnNhdmUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vVXBkYXRlIEludmVudG9yeSBkZXRhaWxzCiAgICAgICAgICAgICRJbnZlbnRvcnlEZXRhaWxzID0gSW52ZW50b3J5RGV0YWlsczo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkcHJvZHVjdC0+Y2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3QtPmlkLAogICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHdhcmVob3VzZUlkLAogICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCwKICAgICAgICAgICAgXSktPmZpcnN0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoJGRlbGl2ZXJ5UXR5ID4gKGlzc2V0KCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpID8gaW50dmFsKCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpIDogMCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJHRvdGFsUHJpY2VPZkludmVudG9yeURldGFpbHMgPSAoKCRJbnZlbnRvcnlEZXRhaWxzLT5xdHkpIC0gKCRkZWxpdmVyeVF0eSkpICogJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2U7CiAgICAgICAgICAgICRJbnZlbnRvcnlEZXRhaWxzLT5xdHkgPSAkSW52ZW50b3J5RGV0YWlscy0+cXR5IC0gJGRlbGl2ZXJ5UXR5OwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscy0+dG90YWxfcHJpY2UgPSAkdG90YWxQcmljZU9mSW52ZW50b3J5RGV0YWlsczsKICAgICAgICAgICAgJEludmVudG9yeURldGFpbHMtPnN0YXR1cyA9ICdhY3RpdmUnOwogICAgICAgICAgICAkSW52ZW50b3J5RGV0YWlscy0+c2F2ZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSAkcmVxdWlzaXRpb25JdGVtLT5hdHRyaWJ1dGVzLT5wbHVjaygnYXR0cmlidXRlX29wdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICRzdG9ja3MgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUhhcygnc3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+c2VsZWN0KFxEQjo6cmF3KCdjb3VudChkaXN0aW5jdCBpZCknKSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2F0dHJpYnV0ZV9vcHRpb25faWQnLCAkYXR0cmlidXRlcyk7CiAgICAgICAgICAgIH0sICc9JywgY291bnQoJGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3dhcmVob3VzZV9pZCcgPT4gJHdhcmVob3VzZUlkLAogICAgICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJHByb2R1Y3QtPmNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdC0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkgPyBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQgOiBudWxsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXZhaWxhYmxlJywgJz4nLCAwKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRhdmFpbGFibGVRdHkgPSAkZGVsaXZlcnlRdHk7CiAgICAgICAgICAgICRsb2dzID0gW107CiAgICAgICAgICAgIGlmIChpc3NldCgkc3RvY2tzWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN0b2NrcyBhcyAkc3RvY2spIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGF2YWlsYWJsZVF0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcXR5ID0gKCRzdG9jay0+YXZhaWxhYmxlID4gJGF2YWlsYWJsZVF0eSA/ICRhdmFpbGFibGVRdHkgOiAkc3RvY2stPmF2YWlsYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGVRdHkgLT0gJHRoaXNfcXR5OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJHN0b2NrLT5hdmFpbGFibGUgPSAoJHN0b2NrLT5hdmFpbGFibGUgLSAkdGhpc19xdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAkc3RvY2stPnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRsb2dzW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRwcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiAkd2FyZWhvdXNlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5pdF9wcmljZScgPT4gJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncXR5JyA9PiAkdGhpc19xdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXZhaWxhYmxlJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsX3ByaWNlJyA9PiAoJHRoaXNfcXR5ICogJEludmVudG9yeURldGFpbHMtPnVuaXRfcHJpY2UpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmVyZW5jZScgPT4gJHJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICdhY3RpdmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdvdXQnLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNzZXQoJGxvZ3NbMF0pKSB7CiAgICAgICAgICAgICAgICBJbnZlbnRvcnlMb2dzOjppbnNlcnQoJGxvZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwdXJjaGFzZURlcGFydG1lbnQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2hlcmUoWwogICAgICAgICAgICAnaWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICdubycsCiAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwcm9jZXNzaW5nJwogICAgICAgIF0pLT5maXJzdCgpOwogICAgICAgIAogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWlzaXRpb24tPmlkKSkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5pc19zZW5kX3RvX3JmcCA9ICd5ZXMnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zdG9yZV9tZXNzYWdlID0gJHJlcXVlc3QtPm1lc3NhZ2U7CiAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPnNhdmUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVxdWlzaXRpb25UcmFja2luZ0hpc3RvcnkoJHJlcXVpc2l0aW9uLT5pZCwgJ3NlbnRfdG9fcHVyY2hhc2UnLCAnUmVxdWlzaXRpb24gc2VuZCB0byBwdXJjaGFzZSBkZXBhcnRtZW50Jyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbi0+aWQsICdwcm9jZXNzaW5nJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5zdG9yZS1tYW5hZ2Uuc3RvcmUuaW52ZW50b3J5LmNvbXBhcmUnLCAkcmVxdWlzaXRpb24tPmlkKSAuICciIGRhdGEtdGl0bGU9IlJlcXVpc2l0aW9uIERldGFpbHMiPlJlZmVyZW5jZSBObzonIC4gJHJlcXVpc2l0aW9uLT5yZWZlcmVuY2Vfbm8gLiAnLldhdHRpbmcgZm9yIFByb2N1cmVtZW50L1B1cmNoYXNlLjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1B1cmNoYXNlLURlcGFydG1lbnQnLCBudWxsLCB0cnVlKSwgJ3NlbnQtdG8tcHVyY2hhc2UnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBTZW5kIHRvIFB1cmNoYXNlIERlcGFydG1lbnQhISc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjaGFuZ2VBY3Rpb25Ub1JGUChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwogICAgICAgIAogICAgICAgICRyZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uOjp3aGVyZShbJ2lkJyA9PiAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQsICdzdGF0dXMnID0+IDEsICdhcHByb3ZlZF9pZCcgPT4gMSwgJ2lzX3NlbmRfdG9fcmZwJyA9PiAnbm8nLCAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnXSktPmZpcnN0KCk7CiAgICAgICAgCiAgICAgICAgLy9TdGFydCB0cmFuc2FjdGlvbgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvdW50KChhcnJheSkkcmVxdWlzaXRpb24pID4gMCkgewogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5pc19zZW5kX3RvX3JmcCA9ICd5ZXMnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5yZXF1ZXN0X3N0YXR1cyA9ICdyZnAnOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAvL1RyYWNraW5nCiAgICAgICAgICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHJlcXVpc2l0aW9uLT5pZCwgJ3Byb2Nlc3NpbmcnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnN0b3JlLW1hbmFnZS5zdG9yZS5pbnZlbnRvcnkuY29tcGFyZScsICRyZXF1aXNpdGlvbi0+aWQpIC4gJyIgZGF0YS10aXRsZT0iUmVxdWlzaXRpb24gRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyAuICcuV2F0dGluZyBmb3IgUHJvY3VyZW1lbnQvUHVyY2hhc2UuPC9zcGFuPic7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgZ2V0TWFuYWdlckluZm8oJ1B1cmNoYXNlLURlcGFydG1lbnQnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tcHVyY2hhc2UnKTsKICAgICAgICAgICAgICAgIC8vQ29tbWl0IGRhdGEKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBTZW5kIHRvIFB1cmNoYXNlIERlcGFydG1lbnQhISc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0FsbHJlYWR5IGdlbmVyYXRlZCBvbmNlISEnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIC8vSWYgcHJvY2VzcyBoYXMgYW55IHByb2JsZW0gdGhlbiByb2xsYmFjayB0aGUgZGF0YQogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGRlbGl2ZXJlZExpc3RIZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3VuaXQnLCAndW5pdCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlcGFydG1lbnQnLCAnZGVwYXJ0bWVudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9uX2RhdGUnLCAncmVxdWlzaXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlbGl2ZXJlZF9kYXRlJywgJ2RlbGl2ZXJlZF9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVxdWlzaXRpb25fcmVmZXJlbmNlJywgJ3JlcXVpc2l0aW9uX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RlbGl2ZXJlZF9yZWZlcmVuY2UnLCAnZGVsaXZlcmVkX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NhdGVnb3J5JywgJ2NhdGVnb3J5JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3N1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsncHJvZHVjdCcsICdwcm9kdWN0JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3F0eScsICdxdHknLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGRlbGl2ZXJlZExpc3QoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRmcm9tX2RhdGUgPSByZXF1ZXN0KCktPmhhcygnZnJvbV9kYXRlJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbV9kYXRlJykgOiBkYXRlKCdZLW0tMDEnKTsKICAgICAgICAgICAgJHRvX2RhdGUgPSByZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpID8gcmVxdWVzdCgpLT5nZXQoJ3RvX2RhdGUnKSA6IGRhdGUoJ1ktbS1kJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06Om9yZGVyQnkoJ2lkJywgJ2Rlc2MnKQogICAgICAgICAgICAgICAgLT53aXRoKFsKICAgICAgICAgICAgICAgICAgICAncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbi5yZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24ucmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignd2FyZWhvdXNlX2lkJywgQXV0aDo6dXNlcigpLT5yZWxVc2Vyc1dhcmVob3VzZS0+cGx1Y2soJ2lkJyktPmFsbCgpKQogICAgICAgICAgICAgICAgLT53aGVuKCRmcm9tX2RhdGUsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb21fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkZnJvbV9kYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgnZGVsaXZlcnlfZGF0ZScsICc+PScsICRmcm9tX2RhdGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkdG9fZGF0ZSwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG9fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG9fZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPD0nLCAkdG9fZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRkZWxpdmVyZWRSZXF1aXNpdGlvbnMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUpID8gJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndW5pdCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9zaG9ydF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5kZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X25hbWUpID8gJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uLnJlbFVzZXJzTGlzdC5lbXBsb3llZS5kZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9uYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uLT5yZXF1aXNpdGlvbl9kYXRlKSA/IGRhdGUoJ2QtbS1ZJywgc3RydG90aW1lKCRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlcXVpc2l0aW9uX2RhdGUpKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcmVkX2RhdGUnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnktPmRlbGl2ZXJ5X2RhdGUpID8gZGF0ZSgnZC1tLVknLCBzdHJ0b3RpbWUoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5kZWxpdmVyeV9kYXRlKSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZWxpdmVyZWRfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnZGVsaXZlcnlfZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXF1aXNpdGlvbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBkYXRhLWlkPSInIC4gJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+aWQgLiAnIiBjbGFzcz0iYnRuIGJ0bi1saW5rIG0tMSByb3VuZGVkIiBvbmNsaWNrPSJyZXF1aXNpdGlvbnZpZXcoJCh0aGlzKSkiPicgLiAoaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vKSA/ICRkZWxpdmVyeS0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeS0+cmVsUmVxdWlzaXRpb24tPnJlZmVyZW5jZV9ubyA6ICcnKSAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUmVxdWlzaXRpb25EZWxpdmVyeS5yZWxSZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyZWRfcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWZlcmVuY2Vfbm8pID8gJGRlbGl2ZXJ5LT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LT5yZWZlcmVuY2Vfbm8gOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZWxpdmVyZWRfcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVsaXZlcmVkX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkdmFsdWVzLT5wcm9kdWN0LT5jYXRlZ29yeS0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZWxpdmVyZWRfcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY2F0ZWdvcnknLCBmdW5jdGlvbiAoJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkZGVsaXZlcnktPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkZGVsaXZlcnktPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3Byb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1Yl9jYXRlZ29yeScsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRkZWxpdmVyeS0+cHJvZHVjdC0+Y2F0ZWdvcnktPm5hbWUpID8gJGRlbGl2ZXJ5LT5wcm9kdWN0LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1Yl9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcm9kdWN0LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGRlbGl2ZXJ5LT5wcm9kdWN0LT5uYW1lKSA/ICRkZWxpdmVyeS0+cHJvZHVjdC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3Byb2R1Y3QnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJvZHVjdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncXR5JywgZnVuY3Rpb24gKCRkZWxpdmVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyX2Zvcm1hdCgkZGVsaXZlcnktPmRlbGl2ZXJ5X3F0eSwgMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXR5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnZGVsaXZlcnlfcXR5JywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uICgkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRkZWxpdmVyeS0+c3RhdHVzID09ICdwZW5kaW5nJyB8fCAkZGVsaXZlcnktPnN0YXR1cyA9PSAnYWNrbm93bGVkZ2UnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzdGF0dXNOYW1lJyAuICRkZWxpdmVyeS0+aWQgLiAnIj4nIC4gdWNmaXJzdCgkZGVsaXZlcnktPnN0YXR1cykgLiAnPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSJoaWRlQnRuJyAuICRkZWxpdmVyeS0+aWQgLiAnIj48YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InN0b3JlZGVsaXZlcmVkQWNrbm93bGVkZ2UoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAkZGVsaXZlcnktPmlkIC4gJyIgdGl0bGU9IkRlbGl2ZXJlZCI+PGkgY2xhc3M9ImxhIGxhLWNoZWNrIj48L2k+Jm5ic3A7RGVsaXZlcmVkPC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdEZWxpdmVyZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZXF1aXNpdGlvbl9yZWZlcmVuY2UnLCAnb3B0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+dG9Kc29uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdG9yZS5zdG9yZS1kZWxpdmVyZWQtcmVxdWlzaXRpb24tbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIkRlbGl2ZXJlZCBPcmRlciBMaXN0IiwKICAgICAgICAgICAgICAgICdmcm9tX2RhdGUnID0+ICRmcm9tX2RhdGUsCiAgICAgICAgICAgICAgICAndG9fZGF0ZScgPT4gJHRvX2RhdGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmRlbGl2ZXJlZExpc3RIZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIERlbGl2ZXJlZCByZXF1aXNpdGlvbiBhY2tub3dsZWRnZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkUmVxdWlzaXRpb25BY2soUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkd2FyZWhvdXNlSWRzID0gQXV0aDo6dXNlcigpLT5yZWxVc2Vyc1dhcmVob3VzZS0+cGx1Y2soJ2lkJyktPmFsbCgpOwogICAgICAgIAogICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbiA9IFJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtOjp3aGVyZUluKCd3YXJlaG91c2VfaWQnLCAkd2FyZWhvdXNlSWRzKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ3N0YXR1cycsIFsnZGVsaXZlcmVkJ10pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmlkKQogICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpc3NldCgkZGVsaXZlcmVkUmVxdWlzaXRpb24pKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRkZWxpdmVyZWRSZXF1aXNpdGlvbi0+c3RhdHVzID0gJ2RlbGl2ZXJlZCc7CiAgICAgICAgICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24tPnNhdmUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBVcGRhdGVkIFRvIERlbGl2ZXJlZC4nOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnTm8gRGF0YSBGb3VuZCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsaXZlcmVkUmVxdWlzaXRpb25TZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAKICAgICAgICAkZnJvbURhdGUgPSBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZnJvbV9kYXRlKSk7CiAgICAgICAgJHRvRGF0ZSA9IGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT50b19kYXRlKSk7CiAgICAgICAgCiAgICAgICAgJHN0YXR1cyA9ICRyZXF1ZXN0LT5zdGF0dXM7CiAgICAgICAgCiAgICAgICAgJHdhcmVob3VzZUlkcyA9IEF1dGg6OnVzZXIoKS0+cmVsVXNlcnNXYXJlaG91c2UtPnBsdWNrKCdpZCcpLT5hbGwoKTsKICAgICAgICAKICAgICAgICAkZGVsaXZlcmVkUmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbTo6d2hlcmVJbignd2FyZWhvdXNlX2lkJywgJHdhcmVob3VzZUlkcykKICAgICAgICAgICAgLT53aGVuKCRzdGF0dXMsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHN0YXR1cykgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICRzdGF0dXMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oJGZyb21EYXRlLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tRGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlRGF0ZSgnZGVsaXZlcnlfZGF0ZScsICc+PScsICRmcm9tRGF0ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCR0b0RhdGUsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvRGF0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFJlcXVpc2l0aW9uRGVsaXZlcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0b0RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPD0nLCAkdG9EYXRlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQnkoJ2lkJywgJ0RFU0MnKQogICAgICAgICAgICAtPnBhZ2luYXRlKDMwKTsKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGNvdW50KCRkZWxpdmVyZWRSZXF1aXNpdGlvbikgPiAwKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWRlbGl2ZXJlZC1yZXF1aXNpdGlvbi1zZWFyY2gnLAogICAgICAgICAgICAgICAgICAgIFsnZGVsaXZlcmVkUmVxdWlzaXRpb24nID0+ICRkZWxpdmVyZWRSZXF1aXNpdGlvbl0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkYm9keS0+cmVuZGVyKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ05vIERhdGEgRm91bmQhISc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAkcmVzcG9uc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmVxdWlzaXRpb24gZGVsaXZlcnkgdmlldy4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxdWlzaXRpb25EZWxpdmVyeVZpZXcoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSBbXTsKICAgICAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aCgnaXRlbXMnLCAnaXRlbXMucHJvZHVjdCcsICdpdGVtcy5wcm9kdWN0LmNhdGVnb3J5JykKICAgICAgICAgICAgLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWlzaXRpb24pKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJlcXVpc2l0aW9ucy5zaG93JywKICAgICAgICAgICAgICAgICAgICBbJ3JlcXVpc2l0aW9uJyA9PiAkcmVxdWlzaXRpb25dKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdzdWNjZXNzJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnYm9keSddID0gJGJvZHktPnJlbmRlcigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdObyBEYXRhIEZvdW5kISEnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQp9Cgo=