<?php
bolt_decrypt( __FILE__ , 'mLO1vQ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXFF1YWxpdHk7Cgp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIElsbHVtaW5hdGVcRGF0YWJhc2VcRWxvcXVlbnRcQnVpbGRlcjsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0OwoKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEludmVudG9yeU1vZGVsc1xJbnZlbnRvcnlBY3Rpb25Db250cm9sOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVJldHVybjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVySXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkU3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cRmFxOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXFJldHVybkNoYW5nZUZhcTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbTsKCnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbkRlbGl2ZXJ5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UcmFja2luZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW07Cgp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIERhdGFUYWJsZXM7CnVzZSBEQixBdXRoLFNlc3Npb24scmVkaXJlY3Q7CgoKY2xhc3MgUXVhbGl0eUVuc3VyZUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBhcHByb3ZlZEhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX2RhdGUnLCAnZ2F0ZV9pbl9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9xdHknLCAnZ2F0ZV9pbl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3JlY2VpdmVkX3N0YXR1cycsICdyZWNlaXZlZF9zdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhcHByb3ZlZF9xdHknLCAnYXBwcm92ZWRfcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydvcHRpb25zJywgJ29wdGlvbnMnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgYXBwcm92ZWQgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICR1c2VyRGVwYXJ0bWVudHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkaXRlbXMgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ25hbWUnLCBpZ25vcmVTdXBwbGllcnMoKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJVbml0cyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAvLyAtPndoZW4oYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgLy8gICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpOwogICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgIC0+d2hlbighYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbnRfdG9fcmVxdWlzaXRvcicsICd5ZXMnKS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdXRob3JfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdhcHByb3ZlZCcpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdyZWNlaXZlZF9kYXRlJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJGl0ZW1zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPmlkKS4nIiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj4nLiRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9uby4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnBvX2RhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLT5wbHVjaygncmVxdWlzaXRpb24ucmVmZXJlbmNlX25vJyktPmltcGxvZGUoJywgJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3JlcXVpc2l0aW9ucy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zLmlkJywgJz0nLCAncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zJywgJ3B1cmNoYXNlX29yZGVyX3JlcXVpc2l0aW9ucy5wdXJjaGFzZV9vcmRlcl9pZCcsICc9JywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwJSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA5MCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJzaG93UUVQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCRncm4tPmlkKS4nIiBkYXRhLXRpdGxlPSJHYXRlIEluIERldGFpbHMiPicuJGdybi0+cmVmZXJlbmNlX25vLic8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInLiB1cmwoJ3Btcy9ncm4vZ2F0ZS1pbi1zbGlwLycuJGdybi0+cHVyY2hhc2Vfb3JkZXJfaWQuJz9ncm49Jy4kZ3JuLT5pZCkgLiciIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNy41cHgiIHRpdGxlPSJHYXRlIEluIFNsaXAiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVjZWl2ZWRfZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlY2VpdmVkX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlY2VpdmVkX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlY2VpdmVkX3N0YXR1cycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICBpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ3BhcnRpYWwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2VpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ2Z1bGwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj4nLnVjd29yZHMoJGdybi0+cmVjZWl2ZWRfc3RhdHVzKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywnYXBwcm92ZWQnKS0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcHRpb25zJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudCA9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdhcHByb3ZlZCcpLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY291bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICc8YSBocmVmPSInLnJvdXRlKCdwbXMucXVhbGl0eS5lbnN1cmUuYXBwcm92ZWQuc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+SXRlbXMgKCcuJGNvdW50LicpPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJyZuYnNwOyZuYnNwOzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMucXVhbGl0eS5hcHByb3ZlZC5pdGVtLnByaW50JyxbJ2lkJz0+JGdybi0+aWQsJ3R5cGUnPT4nYXBwcm92ZWQnXSkuJyIgdGl0bGU9IlF1YWxpdHkgRW5zdXJlIEFwcHJvdmVkIFByaW50IFZpZXciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LmFwcHJvdmVkLWluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiUXVhbGl0eSBFbnN1cmUgQXBwcm92YWwgTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmFwcHJvdmVkSGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgLyoqCiAgICAgKiBTaG93IHRoZSBHcm4gV2lzZSBBcHByb3ZlZCBJdGVtIExpc3QuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5zdXJlQ2hlY2soJGlkKQogICAgewogICAgICAgIHRyeXsKICAgICAgICAgICAgJHRpdGxlID0gIlF1YWxpdHkgRW5zdXJlIENoZWNrIjsKCiAgICAgICAgICAgICRncm4gPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzLlN1cHBsaWVyUmF0aW5ncycsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbicsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQdXJjaGFzZU9yZGVyUmV0dXJucycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkZ3JuLT5yZWxfZ29vZHNfcmVjZWl2ZWRfaXRlbXMgPSAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlSW4oJ3F1YWxpdHlfZW5zdXJlJyxbJ3BlbmRpbmcnXSk7CiAgICAgICAgICAgICR3YXJlSG91c2VzID0gV2FyZWhvdXNlczo6c2VsZWN0KCduYW1lJywnaWQnKS0+Z2V0KCk7CiAgICAgICAgICAgICRmYXFzID0gRmFxOjp3aGVyZSgnc3RhdHVzJywnYWN0aXZlJyktPmdldCgpOwogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5wZW5kaW5nLWluZGV4Jyxjb21wYWN0KCd0aXRsZScsJ2dybicsJ3dhcmVIb3VzZXMnLCdmYXFzJykpOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRGYXFzKCRjYXRlZ29yeV9pZCkKICAgIHsKICAgICAgICAkcXVlc3Rpb25zID0gRmFxOjp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnlfaWQpLT53aGVyZSgnc3RhdHVzJywnYWN0aXZlJyktPmdldCgpOwogICAgICAgICRkYXRhID0gJyc7CiAgICAgICAgaWYoaXNzZXQoJHF1ZXN0aW9uc1swXSkpewogICAgICAgICAgICBmb3JlYWNoKCRxdWVzdGlvbnMgYXMgJGtleSA9PiAkcXVlc3Rpb24pewogICAgICAgICAgICAgICAgJGRhdGEgLj0nPGxpPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZm9ybS1jaGVjay1pbnB1dCIgdHlwZT0iY2hlY2tib3giIG5hbWU9ImZhcV9pZFtdIiBpZD0iZmFxXycuJHF1ZXN0aW9uLT5pZC4nIiB2YWx1ZT0iJy4kcXVlc3Rpb24tPmlkLiciIHJlcXVpcmVkPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZm9ybS1jaGVjay1sYWJlbCIgZm9yPSJmYXFfJy4kcXVlc3Rpb24tPmlkLiciPjxzdHJvbmc+Jy4kcXVlc3Rpb24tPm5hbWUuJzwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8L2xpPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNhdmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkbW9kZWwgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2l0aChbCiAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkTm90ZS5yZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nCiAgICAgICAgXSktPmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKICAgICAgICAkcHJvZHVjdCA9IFByb2R1Y3Q6OmZpbmRPckZhaWwoJG1vZGVsLT5wcm9kdWN0X2lkKTsKICAgICAgICBpZihpc3NldCgkbW9kZWwtPmlkKSAmJiAkcmVxdWVzdC0+cXVhbGl0eV9lbnN1cmUgPT09ICdhcHByb3ZlZCcpewoKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbmV3VGV4dCA9ICdBcHByb3ZlZCc7CiAgICAgICAgICAgICAgICAkdXBkYXRlPSRtb2RlbC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAncXVhbGl0eV9lbnN1cmUnID0+ICRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZSwKICAgICAgICAgICAgICAgICAgICAncmVjZWl2ZWRfcXR5JyA9PiAgJG1vZGVsLT5xdHksCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJyksCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IEF1dGg6OnVzZXIoKS0+aWQKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICRtb2RlbCA9IEdvb2RzUmVjZWl2ZWRJdGVtOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CgogICAgICAgICAgICAgICAgJHByZWZpeD0nUUUtQVAtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuKGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKS4nLSc7CiAgICAgICAgICAgICAgICAkcmVmTm89dW5pcXVlQ29kZSgxOCwkcHJlZml4LCdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbicsJ2lkJyk7CgogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luID0gbmV3IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbigpOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5nb29kc19yZWNlaXZlZF9pdGVtX2lkID0gJG1vZGVsLT5pZDsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVmZXJlbmNlX25vID0gJHJlZk5vOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT51bml0X2Ftb3VudCA9ICRtb2RlbC0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnJlY2VpdmVkX3F0eSA9ICRtb2RlbC0+cXR5OwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5zdWJfdG90YWwgPSAkbW9kZWwtPnN1Yl90b3RhbDsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+ZGlzY291bnRfcGVyY2VudGFnZSA9ICRtb2RlbC0+ZGlzY291bnRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+ZGlzY291bnQgPSAkbW9kZWwtPmRpc2NvdW50OwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT52YXRfcGVyY2VudGFnZSA9ICRtb2RlbC0+dmF0X3BlcmNlbnRhZ2U7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdCA9ICRtb2RlbC0+dmF0OwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT50b3RhbF9hbW91bnQgPSAkbW9kZWwtPnRvdGFsX2Ftb3VudDsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+aXNfZ3JuX2NvbXBsZXRlID0gJ25vJzsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIGlmKCRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMtPmZpcnN0KCktPnJlcXVpc2l0aW9uLT5hdXRob3JfaWQgPT0gYXV0aCgpLT51c2VyKCktPmlkKXsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJvY2Vzc1NlbGZHUk4oJEdSSXRlbXNTdG9ja0luKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJHYXRlLUluIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIGZvciB0aGUgR1JOLjwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdTdG9yZS1NYW5hZ2VyJywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwnc2VuZC10by1zdG9yZScpOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksJ3NlbnQtdG8tcHVyY2hhc2UnLCcnKTsKCiAgICAgICAgICAgICAgICAkdGhpcy0+dXBkYXRlUUNRdWFudGl0eSgkbW9kZWwtPmlkLCAkbW9kZWwtPnF0eSk7CgogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbmV3X3RleHQnID0+ICRuZXdUZXh0LAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgdGhpcyBJdGVtIFF1YWxpdHkgU3RhdHVzISEnCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICB9ZWxzZWlmKGlzc2V0KCRtb2RlbC0+aWQpICYmICRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZSA9PT0gJ3JldHVybi1jaGFuZ2UnIHx8ICRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZSA9PT0gJ3JldHVybicpewoKICAgICAgICAgICAgaWYgKCgkbW9kZWwtPnF0eSkgPCAkcmVxdWVzdC0+cmV0dXJuX3F0eSkgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ1lvdXIgcmV0dXJuIHF0eSBpcyBncmVhdGVyIHRoZW4gbWF4aW11bSBxdHknKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5yZXR1cm5fcXR5IDw9IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJ01pbmltdW0gT25lIGl0ZW0gaXMgcmVxdWlyZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNvZGU9KCRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZT09J3JldHVybi1jaGFuZ2UnPydRRS1SUC0nOidRRS1SVC0nKTsKCiAgICAgICAgICAgICRwcmVmaXg9JGNvZGUuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy0nLihhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSkuJy0nOwogICAgICAgICAgICAkcmVmTm89dW5pcXVlQ29kZSgxOCwkcHJlZml4LCdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbicsJ2lkJyk7CgogICAgICAgICAgICBpZigkcmVxdWVzdC0+cXVhbGl0eV9lbnN1cmU9PSdyZXR1cm4tY2hhbmdlJyl7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm5Db2RlUHJlZml4ID0gJ1JQLScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy0nLihhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSkuJy0nOwogICAgICAgICAgICAgICAgJHByZXYgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRtb2RlbCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJG1vZGVsLT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICAgICBpZihpc3NldCgkcHJldi0+aWQpKXsKICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm5Db2RlID0gJHByZXYtPmNvZGU7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm5Db2RlID0gdW5pcXVlQ29kZSgxNiwkcHVyY2hhc2VSZXR1cm5Db2RlUHJlZml4LCdwdXJjaGFzZV9yZXR1cm5zJywnaWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcHVyY2hhc2VSZXR1cm5Db2RlUHJlZml4ID0gJ1JULScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy0nLihhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZSkuJy0nOwogICAgICAgICAgICAgICAgJHByZXYgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRtb2RlbCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJG1vZGVsLT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuJykKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRwcmV2LT5pZCkpewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGUgPSAkcHJldi0+Y29kZTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGUgPSB1bmlxdWVDb2RlKDE2LCRwdXJjaGFzZVJldHVybkNvZGVQcmVmaXgsJ3B1cmNoYXNlX3JldHVybnMnLCdpZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAkdXBkYXRlID0gJG1vZGVsLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdxdWFsaXR5X2Vuc3VyZScgPT4gJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlLAogICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9xdHknID0+ICAkbW9kZWwtPnF0eS0kcmVxdWVzdC0+cmV0dXJuX3F0eSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gQXV0aDo6dXNlcigpLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgaWYgKCR1cGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZVJldHVybjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnPT4kbW9kZWwtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29kZScgPT4gJHB1cmNoYXNlUmV0dXJuQ29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3JldHVybl9ub3RlJyA9PiAkcmVxdWVzdC0+cmV0dXJuX25vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm5fcXR5JyA9PiAkcmVxdWVzdC0+cmV0dXJuX3F0eSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlLAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAvL3N1YnRvdGFsLHJlY2VpdmVkX3F0eSxkaXNjb3VudF9hbW91bnQsdmF0X2Ftb3VudAogICAgICAgICAgICAgICAgICAgICRyZWNlaXZlZFF0eT0kbW9kZWwtPnF0eS0kcmVxdWVzdC0+cmV0dXJuX3F0eTsKICAgICAgICAgICAgICAgICAgICBpZigkcmVjZWl2ZWRRdHkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YnRvdGFsPSRyZWNlaXZlZFF0eSokbW9kZWwtPnVuaXRfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZGlzY291bnRBbW91bnQ9ICgkbW9kZWwtPmRpc2NvdW50X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhdEFtb3VudD0gKCRtb2RlbC0+dmF0X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbiA9IG5ldyBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnJlZmVyZW5jZV9ubyA9ICRyZWZObzsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5nb29kc19yZWNlaXZlZF9pdGVtX2lkID0gJG1vZGVsLT5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT51bml0X2Ftb3VudCA9ICRtb2RlbC0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVjZWl2ZWRfcXR5ID0gJHJlY2VpdmVkUXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnN1Yl90b3RhbCA9ICRzdWJ0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudF9wZXJjZW50YWdlID0gJG1vZGVsLT5kaXNjb3VudF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmRpc2NvdW50ID0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdF9wZXJjZW50YWdlID0gJG1vZGVsLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT52YXQgPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnRvdGFsX2Ftb3VudCA9ICgkc3VidG90YWwtJGRpc2NvdW50QW1vdW50KSskdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmlzX2dybl9jb21wbGV0ZSA9ICdubyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy0+Zmlyc3QoKS0+cmVxdWlzaXRpb24tPmF1dGhvcl9pZCA9PSBhdXRoKCktPnVzZXIoKS0+aWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByb2Nlc3NTZWxmR1JOKCRHUkl0ZW1zU3RvY2tJbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVlc3QtPmZhcV9pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmZhcV9pZCBhcyAka2V5ID0+ICRmYXFfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJldHVybkNoYW5nZUZhcTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmFxX2lkJz0+JGZhcV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCc9PiRtb2RlbC0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJHYXRlLUluIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIGZvciB0aGUgR1JOLjwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdTdG9yZS1NYW5hZ2VyJywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwnc2VuZC10by1zdG9yZScpOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksJ3NlbnQtdG8tcHVyY2hhc2UnLCcnKTsKCiAgICAgICAgICAgICAgICAkdGhpcy0+dXBkYXRlUUNRdWFudGl0eSgkbW9kZWwtPmlkLCAkcmVjZWl2ZWRRdHkpOwogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgVXBkYXRlZCB0aGlzIEl0ZW0gUXVhbGl0eSBTdGF0dXMhIScpOwoKICAgICAgICAgICAgfWNhdGNoIChUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlUUNRdWFudGl0eSgkZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCwgJHFjX3F0eSkKICAgIHsKICAgICAgICBpZigkcWNfcXR5ID4gMCl7CiAgICAgICAgICAgICRhcnJheSA9IFtdOwoKICAgICAgICAgICAgLy9QTyBHZW5lcmF0ZSBFcXVhbGx5IGRpc3RyaWJ1dGUKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtID0gR29vZHNSZWNlaXZlZEl0ZW06OmZpbmQoJGdvb2RzX3JlY2VpdmVkX2l0ZW1faWQpOwogICAgICAgICAgICAkcmVxdWlzaXRpb25fcXR5ID0gUmVxdWlzaXRpb25JdGVtOjp3aGVyZSgncHJvZHVjdF9pZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgLT53aGVyZSgndWlkJywgJGdvb2RzUmVjZWl2ZWRJdGVtLT51aWQpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uLnB1cmNoYXNlT3JkZXJzLnB1cmNoYXNlT3JkZXIucmVsR29vZFJlY2VpdmVOb3RlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdvb2RzUmVjZWl2ZWRJdGVtKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+c3VtKCdxdHknKTsKICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSAoJHJlcXVpc2l0aW9uX3F0eSA+IDAgJiYgJHFjX3F0eSA+IDAgPyAoKCRxY19xdHkvJHJlcXVpc2l0aW9uX3F0eSkqMTAwKSA6IDApOwoKICAgICAgICAgICAgLy9hcnJheV9wdXNoKCRhcnJheSwgJHBlcmNlbnRhZ2UpOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9ucyA9ICRnb29kc1JlY2VpdmVkSXRlbS0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMtPnBsdWNrKCdyZXF1aXNpdGlvbl9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aGVyZUluKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbnMpCiAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkZ29vZHNSZWNlaXZlZEl0ZW0tPnByb2R1Y3RfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ3VpZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+dWlkKQogICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICBpZihpc3NldCgkcmVxdWlzaXRpb25JdGVtc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbkl0ZW0pewogICAgICAgICAgICAgICAgICAgIGlmKCRxY19xdHk+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzX3FjX3F0eSA9IHJvdW5kKCgkcGVyY2VudGFnZSA+IDAgPyAoJHJlcXVpc2l0aW9uSXRlbS0+cXR5KigkcGVyY2VudGFnZS8xMDApKSA6IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcWNfcXR5ID0gKCR0aGlzX3FjX3F0eSA+ICRxY19xdHkgPyAkcWNfcXR5IDogJHRoaXNfcWNfcXR5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFycmF5X3B1c2goJGFycmF5LCBbCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncGVyY2VudGFnZScgPT4gJHBlcmNlbnRhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncicgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cXR5LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3EnID0+ICR0aGlzX3FjX3F0eQogICAgICAgICAgICAgICAgICAgICAgICAvLyBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA9ICR0aGlzX3FjX3F0eTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHFjX3F0eSA9ICgkcWNfcXR5IC0gJHRoaXNfcWNfcXR5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkcWNfcXR5PjApewogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9ucyktPndoZXJlKCdwcm9kdWN0X2lkJywgJGdvb2RzUmVjZWl2ZWRJdGVtLT5wcm9kdWN0X2lkKS0+d2hlcmUoJ3VpZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+dWlkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5xY19xdHkgPSAoJHJlcXVpc2l0aW9uSXRlbS0+cWNfcXR5K3JvdW5kKCRxY19xdHkpKTsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIGFycmF5X3B1c2goJGFycmF5LCBbCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdwZXJjZW50YWdlJyA9PiAkcGVyY2VudGFnZSwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3InID0+ICRyZXF1aXNpdGlvbkl0ZW0tPnF0eSwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3EnID0+IHJvdW5kKCRxY19xdHkpLAogICAgICAgICAgICAgICAgICAgIC8vICAgICAnZScgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIC8vIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vUE8gR2VuZXJhdGUgRXF1YWxseSBkaXN0cmlidXRlCiAgICAgICAgICAgIC8vcmV0dXJuICRhcnJheTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBBcHByb3ZlZCBJdGVtIExpc3QuCiAgICAqCiAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuV2lzZUFwcHJvdmVkSXRlbUxpc3QoJGlkKQogICAgewogICAgICAgIHRyeXsKICAgICAgICAgICAgJHRpdGxlPSJRdWFsaXR5IEVuc3VyZSBBcHByb3ZhbCBMaXN0IjsKICAgICAgICAgICAgJGdybiA9IEdvb2RzUmVjZWl2ZWROb3RlOjpmaW5kKCRpZCk7CiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbUlkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkaWQpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdhcHByb3ZlZCcpLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICAkYXBwcm92YWxfbGlzdCA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgXSktPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCRnb29kc1JlY2VpdmVkSXRlbUlkKS0+b3JkZXJCeSgnaWQnLCdkZXNjJyktPnBhZ2luYXRlKDMwKTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkuYXBwcm92ZWQtbGlzdCcsY29tcGFjdCgndGl0bGUnLCdhcHByb3ZhbF9saXN0JywgJ2dybicpKTsKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuTGlzdEhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gTGlzdC4KICAgICoKICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybmxMaXN0KCkKICAgIHsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLAogICAgICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsICR1c2VyVW5pdHMpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJyksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyRGVwYXJ0bWVudHMpewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgIC8vICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbnRfdG9fcmVxdWlzaXRvcicsICd5ZXMnKS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4nKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVjZWl2ZWRfZGF0ZScsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJGl0ZW1zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPmlkKS4nIiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj4nLiRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9uby4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkZ3JuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLT5wbHVjaygncmVxdWlzaXRpb24ucmVmZXJlbmNlX25vJyktPmltcGxvZGUoJywgJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3JlcXVpc2l0aW9ucy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zLmlkJywgJz0nLCAncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHVyY2hhc2Vfb3JkZXJfcmVxdWlzaXRpb25zJywgJ3B1cmNoYXNlX29yZGVyX3JlcXVpc2l0aW9ucy5wdXJjaGFzZV9vcmRlcl9pZCcsICc9JywgJ3B1cmNoYXNlX29yZGVycy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwJSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA5MCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJzaG93UUVQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCRncm4tPmlkKS4nIiBkYXRhLXRpdGxlPSJHYXRlIEluIERldGFpbHMiPicuJGdybi0+cmVmZXJlbmNlX25vLic8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInLiB1cmwoJ3Btcy9ncm4vZ2F0ZS1pbi1zbGlwLycuJGdybi0+cHVyY2hhc2Vfb3JkZXJfaWQuJz9ncm49Jy4kZ3JuLT5pZCkgLiciIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNy41cHgiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmV0dXJuX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWNlaXZlZF9zdGF0dXMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdwYXJ0aWFsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdmdWxsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Jy51Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybicpLT5zdW0oJ3JldHVybl9xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5lZENvdW50ID0gUHVyY2hhc2VSZXR1cm46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4nKS0+Y291bnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlZCA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXR1cm5lZCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJzxhIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LmVuc3VyZS5yZXR1cm4uc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+SXRlbXMgKCcuJHJldHVybmVkQ291bnQuJyk8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5pdGVtLnByaW50JyxbJ2lkJz0+JGdybi0+aWQsJ3R5cGUnPT4ncmV0dXJuJ10pLiciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIiB0aXRsZT0iUmV0dXJuIExpc3QiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRhcHByb3ZlZCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJyZuYnNwOyZuYnNwOzxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLnF1YWxpdHkucmV0dXJuLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tYXBwcm92ZWQtbGlzdCddKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyIgdGl0bGU9IlJldHVybiBBcHByb3ZlZCBMaXN0Ij48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRvcHRpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnUE9fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3JlY2VpdmVkX3N0YXR1cycsICdvcHRpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4taW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnJldHVybkxpc3RIZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIFNob3cgdGhlIEdybiBXaXNlIFNpbmdsZSBSZXR1cm4gSXRlbSBMaXN0LgogICAgKgogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGdybldpc2VSZXR1cm5JdGVtTGlzdCgkaWQpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHRpdGxlPSJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gTGlzdCI7CiAgICAgICAgICAgICRncm4gPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZCgkaWQpOwogICAgICAgICAgICAkZ29vZHNSZWNlaXZlZEl0ZW1JZCA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsJGlkKS0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuJyktPnBsdWNrKCdpZCcpLT5hbGwoKTsKICAgICAgICAgICAgJHJldHVybkxpc3QgPSBQdXJjaGFzZVJldHVybjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pLT53aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlZEl0ZW1JZCktPm9yZGVyQnkoJ2lkJywnZGVzYycpLT5wYWdpbmF0ZSgzMCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tbGlzdCcsY29tcGFjdCgndGl0bGUnLCdyZXR1cm5MaXN0JywgJ2dybicpKTsKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuQ2hhbmdlTGlzdEhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19kYXRlJywgJ1BPX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbnMnLCAncmVxdWlzaXRpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gQ2hhbmdlIExpc3QuCiAgICAqCiAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuQ2hhbmdlTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJHVzZXJEZXBhcnRtZW50cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsICR1c2VyVW5pdHMpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJyksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyRGVwYXJ0bWVudHMpewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgIC8vICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbnRfdG9fcmVxdWlzaXRvcicsICd5ZXMnKS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3JlY2VpdmVkX2RhdGUnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5pZCkuJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+Jy4kZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnJlZmVyZW5jZV9ubycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5wb19kYXRlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJGdybikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy0+cGx1Y2soJ3JlcXVpc2l0aW9uLnJlZmVyZW5jZV9ubycpLT5pbXBsb2RlKCcsICcpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdyZXF1aXNpdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncmVxdWlzaXRpb25zJywgJ3JlcXVpc2l0aW9ucy5pZCcsICc9JywgJ3B1cmNoYXNlX29yZGVyX3JlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3B1cmNoYXNlX29yZGVyX3JlcXVpc2l0aW9ucycsICdwdXJjaGFzZV9vcmRlcl9yZXF1aXNpdGlvbnMucHVyY2hhc2Vfb3JkZXJfaWQnLCAnPScsICdwdXJjaGFzZV9vcmRlcnMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBzdHlsZT0id2lkdGg6IDEwMCUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogOTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayIgb25jbGljaz0ic2hvd1FFUE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkZ3JuLT5pZCkuJyIgZGF0YS10aXRsZT0iR2F0ZSBJbiBEZXRhaWxzIj4nLiRncm4tPnJlZmVyZW5jZV9uby4nPC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6IDEwJTtmbG9hdDogbGVmdDtjbGVhcjpyaWdodCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyIgaHJlZj0iJy4gdXJsKCdwbXMvZ3JuL2dhdGUtaW4tc2xpcC8nLiRncm4tPnB1cmNoYXNlX29yZGVyX2lkLic/Z3JuPScuJGdybi0+aWQpIC4nIiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9Im1hcmdpbi10b3A6IDcuNXB4Ij48aSBjbGFzcz0ibGEgbGEtcHJpbnQiPjwvaT48L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVmZXJlbmNlX25vJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JldHVybl9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3F0eScpLSRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3JlY2VpdmVkX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWNlaXZlZF9zdGF0dXMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdwYXJ0aWFsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdmdWxsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Jy51Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdyZXR1cm5fcXR5Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWRDb3VudCA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmVkID0gUHVyY2hhc2VSZXR1cm46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4tY2hhbmdlJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudCA9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPmNvdW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZihhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZS1yZXR1cm4tY2hhbmdlLXJlY2VpdmVkLWxpc3QnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkY291bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9ucyAuPSAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLnF1YWxpdHkuZW5zdXJlLnJldHVybi5jaGFuZ2Uuc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+Jy5fXygnSXRlbXMnKS4nICgnLiRjb3VudC4nKTwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZigkcmV0dXJuZWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5yZXBsYWNlLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tY2hhbmdlLWxpc3QnXSkuJyIgdGl0bGU9IlJldHVybiBSZXBsYWNlIExpc3QiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZigkYXBwcm92ZWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5yZXBsYWNlLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tY2hhbmdlJ10pLiciIHRpdGxlPSJSZXR1cm4gUmVwbGFjZSBBcHByb3ZlZCBMaXN0IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnJldHVybi1jaGFuZ2UtaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gUmVwbGFjZSBMaXN0IiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cmV0dXJuQ2hhbmdlTGlzdEhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXSk7CgogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gSXRlbSBMaXN0LgogICAgKgogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuV2lzZVJldHVybkNoYW5nZUl0ZW1MaXN0KCRpZCkKICAgIHsKICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGU9IlF1YWxpdHkgRW5zdXJlIFJldHVybiBSZXBsYWNlIExpc3QiOwoKICAgICAgICAgICAgJGNoYW5nZWQgPSBQdXJjaGFzZVJldHVybjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGlkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGlkKTsKICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpLT5nZXQoKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnJldHVybi1jaGFuZ2UtbGlzdCcsY29tcGFjdCgndGl0bGUnLCdjaGFuZ2VkJykpOwoKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYXBwcm92ZWRJdGVtUHJpbnQoJGlkLCR0eXBlKQogICAgewogICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGU9IlF1YWxpdHkgRW5zdXJlIEFwcHJvdmVkIFByaW50IFZpZXciOwoKICAgICAgICAgICAgJHF1b3RhdGlvbj1Hb29kc1JlY2VpdmVkTm90ZTo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtSWQgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRpZCktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJHR5cGUpLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICAkYXBwcm92YWxfbGlzdCA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmVJbignZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCcsJGdvb2RzUmVjZWl2ZWRJdGVtSWQpLT5nZXQoKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3TVBERigncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5hcHByb3ZlZC1pdGVtLXByaW50LXZpZXctcGRmJywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnYXBwcm92YWxfbGlzdCcgPT4gJGFwcHJvdmFsX2xpc3QsCiAgICAgICAgICAgICAgICAncXVvdGF0aW9uJyA9PiAkcXVvdGF0aW9uCiAgICAgICAgICAgIF0sICR0aXRsZSwgJHRpdGxlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LmFwcHJvdmVkLWl0ZW0tcHJpbnQtdmlldycsY29tcGFjdCgndGl0bGUnLCdhcHByb3ZhbF9saXN0JywncXVvdGF0aW9uJykpOwoKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuSXRlbVByaW50VmlldygkaWQsJHR5cGUpCiAgICB7CiAgICAgICAgIHRyeXsKCiAgICAgICAgICAgICR0aXRsZT0iUmV0dXJuIEl0ZW1zIjsKCiAgICAgICAgICAgICRxdW90YXRpb24gPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtSWQgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRpZCktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ3JldHVybicpLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICAkY29kZSA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGlkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGlkKTsKICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuJyktPmZpcnN0KCktPmNvZGU7CgoKICAgICAgICAgICAgaWYgKCR0eXBlPT0ncmV0dXJuLWFwcHJvdmVkLWxpc3QnKSB7CiAgICAgICAgICAgICAgICAkYXBwcm92ZWQgPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCRnb29kc1JlY2VpdmVkSXRlbUlkKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgICAgICdxdW90YXRpb24nID0+ICRxdW90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgJ2FwcHJvdmVkJyA9PiAkYXBwcm92ZWQsCiAgICAgICAgICAgICAgICAgICAgJ2NvZGUnID0+ICRjb2RlLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3TVBERigncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tYXBwcm92ZWQtaXRlbS1wcmludC12aWV3LXBkZicsICRkYXRhLCAkdGl0bGUsICR0aXRsZSk7CgogICAgICAgICAgICAgICAgLy9yZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tYXBwcm92ZWQtaXRlbS1wcmludC12aWV3JywgJGRhdGEpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRyZXR1cm5lZCA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlZEl0ZW1JZCktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuJyktPmdldCgpOwoKICAgICAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgICAgICdxdW90YXRpb24nID0+ICRxdW90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgJ3JldHVybmVkJyA9PiAkcmV0dXJuZWQsCiAgICAgICAgICAgICAgICAgICAgJ2NvZGUnID0+ICRjb2RlLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3TVBERigncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4taXRlbS1wcmludC12aWV3LXBkZicsICRkYXRhLCAkdGl0bGUsICR0aXRsZSk7CgogICAgICAgICAgICAgICAgLy9yZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4taXRlbS1wcmludC12aWV3JywgJGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAoKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuUmVwbGFjZUl0ZW1QcmludFZpZXcoJGlkLCR0eXBlKQogICAgewogICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGU9IlJldHVybiBSZXBsYWNlIEFwcHJvdmVkIExpc3QiOwoKICAgICAgICAgICAgJHF1b3RhdGlvbj1Hb29kc1JlY2VpdmVkTm90ZTo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgJHJldHVybkNoYW5nZUxpc3QgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRpZCkKICAgICAgICAgICAgLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPmdldCgpOwoKICAgICAgICAgICAgJGNvZGUgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRpZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRpZCk7CiAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybi1jaGFuZ2UnKS0+Zmlyc3QoKS0+Y29kZTsKCiAgICAgICAgICAgIGlmICgkdHlwZT09J3JldHVybi1jaGFuZ2UtbGlzdCcpIHsKICAgICAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgICAgICdxdW90YXRpb24nID0+ICRxdW90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgJ3JldHVybkNoYW5nZUxpc3QnID0+ICRyZXR1cm5DaGFuZ2VMaXN0LAogICAgICAgICAgICAgICAgICAgICdjb2RlJyA9PiAkY29kZSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLXJlcGxhY2UtcmV0dXJuLWl0ZW0tcHJpbnQtdmlldy1wZGYnLCAkZGF0YSwgJHRpdGxlLCAkdGl0bGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL3JldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnJldHVybi1yZXBsYWNlLXJldHVybi1pdGVtLXByaW50LXZpZXcnLGNvbXBhY3QoJ3RpdGxlJywncmV0dXJuQ2hhbmdlTGlzdCcsJ3F1b3RhdGlvbicsICdjb2RlJykpOwogICAgICAgICAgICB9ZWxzZXsKCiAgICAgICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tcmVwbGFjZS1pdGVtLXByaW50LXZpZXcnLGNvbXBhY3QoJ3RpdGxlJywncmV0dXJuQ2hhbmdlTGlzdCcsJ3F1b3RhdGlvbicsICdjb2RlJykpOwogICAgICAgICAgICB9CgogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZXR1cm5DaGFuZ2VSZWNlaXZlZChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgeyAgICAKCiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+aWQgYXMgJGtleT0+JGlkKXsKCiAgICAgICAgICAgICAgICAkbW9kZWw9R29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKFsnaWQnPT4kaWQsJ3F1YWxpdHlfZW5zdXJlJz0+J3JldHVybi1jaGFuZ2UnXSktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAkcHJvZHVjdD1Qcm9kdWN0OjpmaW5kT3JGYWlsKCRtb2RlbC0+cHJvZHVjdF9pZCk7CiAgICAgICAgICAgICAgICAkcHJlZml4PSdRRS1SUlAtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLVNTTFotJzsKICAgICAgICAgICAgICAgICRyZWZObz11bmlxdWVDb2RlKDE4LCRwcmVmaXgsJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luJywnaWQnKTsKCiAgICAgICAgICAgICAgICBpZihpc3NldCgkbW9kZWwtPmlkKSAmJiAkcmVxdWVzdC0+c3RhdHVzPT09J3JlY2VpdmVkJyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkbW9kZWwtPnF0eS0kbW9kZWwtPnJlY2VpdmVkX3F0eSkgPCAkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRrZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdZb3VyIHJldHVybiBxdHkgaXMgZ3JlYXRlciB0aGVuIG1heGltdW0gcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkdG90YWxSZWNlaXZlZFF0eSA9ICRtb2RlbC0+cmVjZWl2ZWRfcXR5KyRyZXF1ZXN0LT5yZWNlaXZlZF9xdHlbJGtleV07CgogICAgICAgICAgICAgICAgICAgICRxdWFsaXR5RW5zdXJlPSgkdG90YWxSZWNlaXZlZFF0eT09JG1vZGVsLT5xdHkpPydhcHByb3ZlZCc6J3JldHVybi1jaGFuZ2UnOwoKICAgICAgICAgICAgICAgICAgICAkdXBkYXRlPSRtb2RlbC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3F1YWxpdHlfZW5zdXJlJyA9PiAkcXVhbGl0eUVuc3VyZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlY2VpdmVkX3F0eScgPT4gICR0b3RhbFJlY2VpdmVkUXR5LAogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IEF1dGg6OnVzZXIoKS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCR1cGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUHVyY2hhc2VSZXR1cm46OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCc9PiRtb2RlbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuX25vdGUnID0+ICRyZXF1ZXN0LT5yZXR1cm5fbm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm5fcXR5JyA9PiAkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHJlcXVlc3QtPnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcmVjZWl2ZWRRdHk9JHJlcXVlc3QtPnJlY2VpdmVkX3F0eVska2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YnRvdGFsPSRyZWNlaXZlZFF0eSokbW9kZWwtPnVuaXRfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZGlzY291bnRBbW91bnQ9ICgkbW9kZWwtPmRpc2NvdW50X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhdEFtb3VudD0gKCRtb2RlbC0+dmF0X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbiA9IG5ldyBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnJlZmVyZW5jZV9ubyA9ICRyZWZObzsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5nb29kc19yZWNlaXZlZF9pdGVtX2lkID0gJG1vZGVsLT5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT51bml0X2Ftb3VudCA9ICRtb2RlbC0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVjZWl2ZWRfcXR5ID0gJHJlY2VpdmVkUXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnN1Yl90b3RhbCA9ICRzdWJ0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudF9wZXJjZW50YWdlID0gJG1vZGVsLT5kaXNjb3VudF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmRpc2NvdW50ID0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdF9wZXJjZW50YWdlID0gJG1vZGVsLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT52YXQgPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnRvdGFsX2Ftb3VudCA9ICgkc3VidG90YWwtJGRpc2NvdW50QW1vdW50KSskdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmlzX2dybl9jb21wbGV0ZSA9ICdubyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBmb3IgdGhlIEdSTi48L3NwYW4+JzsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCAkbWVzc2FnZSwndW5yZWFkJywnJyxnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCksJ3NlbmQtdG8tc3RvcmUnLCcnKTsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksJ3NlbnQtdG8tcHVyY2hhc2UnLCcnKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgdGhpcyBJdGVtIFF1YWxpdHkgU3RhdHVzISEnLCdwbXMucXVhbGl0eS5lbnN1cmUucmV0dXJuLmNoYW5nZS5saXN0Jyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHByb2Nlc3NTZWxmR1JOKCRzdG9jaykKICAgIHsKICAgICAgICAvL0dSTgogICAgICAgICRncm4gPSAkc3RvY2stPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGU7CiAgICAgICAgJHdhcmVob3VzZSA9IFdhcmVob3VzZXM6OndoZXJlTm90TnVsbCgnaWQnKS0+Zmlyc3QoKTsKICAgICAgICAkY3JlZGl0ID0gMDsKICAgICAgICAkc3RvY2tJbnMgPSBbXTsKICAgICAgICAkcHVyY2hhc2Vfb3JkZXJfaWQgPSBbXTsKICAgICAgICBpZigkc3RvY2stPmlzX2dybl9jb21wbGV0ZSA9PSAnbm8nKXsKICAgICAgICAgICAgJHByb2R1Y3QgPSBQcm9kdWN0OjpmaW5kT3JGYWlsKCRzdG9jay0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5wcm9kdWN0X2lkKTsKICAgICAgICAgICAgbmV3IEludmVudG9yeUFjdGlvbkNvbnRyb2woJHByb2R1Y3QsICR3YXJlaG91c2UsICRzdG9jay0+dG90YWxfYW1vdW50LCAkc3RvY2stPnJlY2VpdmVkX3F0eSwgJ2FjdGl2ZScsICRzdG9jay0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+Z3JuX3JlZmVyZW5jZV9ubywgJHN0b2NrLT5pZCk7CgogICAgICAgICAgICAkc3RvY2stPmlzX2dybl9jb21wbGV0ZSA9ICd5ZXMnOwogICAgICAgICAgICAkc3RvY2stPndhcmVob3VzZV9pZCA9ICR3YXJlaG91c2UtPmlkOwoKICAgICAgICAgICAgJHByb2plY3QgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zIGFzICRrZXkgPT4gJHBvcikgewogICAgICAgICAgICAgICAgICAgIGlmICgkcG9yLT5yZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25JdGVtcy0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkc3RvY2stPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cHJvZHVjdF9pZCktPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG9yLT5yZXF1aXNpdGlvbi0+cHJvamVjdFRhc2stPmlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2plY3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHN0b2NrLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX2ZpeGVkX2Fzc2V0ID09IDEgfHwgJHN0b2NrLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX2N3aXAgPT0gMSB8fCAkcHJvamVjdCkgewogICAgICAgICAgICAgICAgJGZpeGVkQXNzZXRMb2NhdGlvbiA9IFxBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRMb2NhdGlvbjo6d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICd1bml0X2lkJyA9PiAkc3RvY2stPnJlbFB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJyA9PiAkc3RvY2stPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y2F0ZWdvcnktPnBhcmVudF9pZCwKICAgICAgICAgICAgICAgIF0pLT5maXJzdCgpOwogICAgICAgICAgICAgICAgJHN0b2NrLT5maXhlZF9hc3NldF9sb2NhdGlvbl9pZCA9IChpc3NldCgkZml4ZWRBc3NldExvY2F0aW9uLT5pZCkgPyAkZml4ZWRBc3NldExvY2F0aW9uLT5pZCA6IDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkc3RvY2stPnNhdmUoKTsKCiAgICAgICAgICAgICRjcmVkaXQgKz0gJHN0b2NrLT50b3RhbF9hbW91bnQ7CgogICAgICAgICAgICBhcnJheV9wdXNoKCRzdG9ja0lucywgJHN0b2NrLT5pZCk7CiAgICAgICAgICAgIGFycmF5X3B1c2goJHB1cmNoYXNlX29yZGVyX2lkLCAkc3RvY2stPnB1cmNoYXNlX29yZGVyX2lkKTsKICAgICAgICB9CgogICAgICAgICRlbnRyeSA9ICR0aGlzLT5ydW5MZWRnZXJRdWVyaWVzKCRzdG9ja0lucywgJGdybik7CiAgICAgICAgaWYgKGlzc2V0KCRwdXJjaGFzZV9vcmRlcl9pZFswXSkgJiYgaXNzZXQoJGVudHJ5WydzdWNjZXNzJ10pICYmICRlbnRyeVsnc3VjY2VzcyddKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRwdXJjaGFzZV9vcmRlcl9pZCBhcyAka2V5ID0+ICRwb19pZCkgewogICAgICAgICAgICAgICAgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJFbnRyeTo6dXBkYXRlT3JDcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcG9faWQpLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2lkLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnZ3JuJywKICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXVsnaWQnXSwKICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpc3NldCgkc3RvY2tJbnNbMF0pKSB7CiAgICAgICAgICAgICRwcm9qZWN0ID0gaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9uc1swXS0+cmVxdWlzaXRpb24tPnByb2plY3RUYXNrLT5pZCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzdG9ja0lucyBhcyAka2V5ID0+ICRzdG9ja19pbl9pZCkgewogICAgICAgICAgICAgICAgJHN0b2NrSW4gPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdpZCcsICRzdG9ja19pbl9pZCktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAkY2FwaXRhbGl6ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoJHByb2plY3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfY3dpcCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjYXBpdGFsaXplID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfZml4ZWRfYXNzZXQgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkY2FwaXRhbGl6ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJGNhcGl0YWxpemUgJiYgJHN0b2NrSW4tPnJlY2VpdmVkX3F0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAkYmF0Y2ggPSBGaXhlZEFzc2V0QmF0Y2g6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCcgPT4gJHN0b2NrSW4tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnYmF0Y2gnID0+IHVuaXF1ZUNvZGVXaXRob3V0UHJlZml4KDgsICdmaXhlZF9hc3NldF9iYXRjaGVzJywgJ2JhdGNoJyksCgogICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX21ldGhvZF9pZCcgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX21ldGhvZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Jhc2VfcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+YmFzZV9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAncmF0ZV9tdWx0aXBsaWVyJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5yYXRlX211bHRpcGxpZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdpc195ZWFybHknID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3llYXJseSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3llYXJzJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT55ZWFycywKICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX29uZXRpbWUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX29uZXRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fc3RhcnRfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHN0b2NrSW4tPnVwZGF0ZWRfYXQpKSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGJhdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAxOyAkaSA8PSAkc3RvY2tJbi0+cmVjZWl2ZWRfcXR5OyAkaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaXhlZEFzc2V0QmF0Y2hJdGVtOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmaXhlZF9hc3NldF9iYXRjaF9pZCcgPT4gJGJhdGNoLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzZXRfY29kZScgPT4gJGJhdGNoLT5iYXRjaCAuICctJyAuICRpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX21ldGhvZF9pZCcgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX21ldGhvZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFzZV9yYXRlJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5iYXNlX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JhdGVfbXVsdGlwbGllcicgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+cmF0ZV9tdWx0aXBsaWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX3llYXJseScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfeWVhcmx5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5ZWFycycgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+eWVhcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX29uZXRpbWUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX29uZXRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9zdGFydF9kYXRlJyA9PiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkc3RvY2tJbi0+dXBkYXRlZF9hdCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9HUk4KCiAgICAgICAgLy9EZWxpdmVyeQogICAgICAgICRsZWRnZXJJdGVtcyA9IFtdOwoKICAgICAgICAkcmVxdWlzaXRpb25JZCA9ICRzdG9jay0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy0+Zmlyc3QoKS0+cmVxdWlzaXRpb25faWQ7CiAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmRPckZhaWwoJHJlcXVpc2l0aW9uSWQpOwoKICAgICAgICBpZiAoJHJlcXVpc2l0aW9uLT5wdXJjaGFzZU9yZGVycy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gJHJlcXVpc2l0aW9uLT5wdXJjaGFzZU9yZGVyc1swXS0+cHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gQ29zdENlbnRyZTo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+ICRyZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+YXNfdW5pdF9pZCwKICAgICAgICAgICAgICAgICdocl9kZXBhcnRtZW50X2lkJyA9PiAkcmVxdWlzaXRpb24tPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQsCiAgICAgICAgICAgIF0pLT5maXJzdCgpLT5pZDsKICAgICAgICB9CgogICAgICAgICRwcm9qZWN0ID0gaXNzZXQoJHJlcXVpc2l0aW9uLT5wcm9qZWN0VGFzay0+aWQpOwogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2hlcmVIYXMoJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbklkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbklkKTsKICAgICAgICB9KS0+Zmlyc3QoKTsKICAgICAgICAkcmVxdWlzaXRpb25EZWxpdmVyeSA9IFJlcXVpc2l0aW9uRGVsaXZlcnk6OmNyZWF0ZShbCiAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uSWQsCiAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nID0+ICRyZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vLAogICAgICAgICAgICAnZGVsaXZlcnlfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnKSwKICAgICAgICAgICAgJ25vdGUnID0+ICcnLAogICAgICAgICAgICAnZGVsaXZlcnlfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICBdKTsKCiAgICAgICAgJHByb2R1Y3QgPSBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgJ3Byb2R1Y3RVbml0Q29udmVyc2lvbnMnCiAgICAgICAgXSktPmZpbmRPckZhaWwoJHN0b2NrLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnByb2R1Y3RfaWQpOwogICAgICAgICRkZWxpdmVyeVF0eSA9ICRzdG9jay0+cmVjZWl2ZWRfcXR5OwogICAgICAgICRyZXF1aXNpdGlvbkl0ZW0gPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbklkKQogICAgICAgIC0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkc3RvY2stPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cHJvZHVjdF9pZCkKICAgICAgICAtPndoZXJlKCd1aWQnLCAkc3RvY2stPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+dWlkKQogICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT51cGRhdGUoWwogICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAkZGVsaXZlcnlRdHkgKyAkcmVxdWlzaXRpb25JdGVtLT5kZWxpdmVyeV9xdHkKICAgICAgICBdKTsKCiAgICAgICAgJHVuaXRQcmljZSA9IDA7CiAgICAgICAgJHN0b2NrUHJpY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVpc2l0aW9uSXRlbSkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb25JdGVtLT5yZXF1aXNpdGlvbl9pZCk7CiAgICAgICAgfSkKICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgndWlkJywgJHJlcXVpc2l0aW9uSXRlbS0+dWlkKTsKICAgICAgICB9KQogICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICBpZighaXNzZXQoJHN0b2NrUHJpY2UtPnVuaXRfYW1vdW50KSl7CiAgICAgICAgICAgICRzdG9ja1ByaWNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbkl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwcm9kdWN0X2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCd1aWQnLCAkcmVxdWlzaXRpb25JdGVtLT51aWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSGFzKCdpbnZlbnRvcnlMb2dzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhdmFpbGFibGUnLCAnPicsIDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgfQogICAgICAgIGlmKGlzc2V0KCRzdG9ja1ByaWNlLT51bml0X2Ftb3VudCkpewogICAgICAgICAgICAkdW5pdFByaWNlID0gJHN0b2NrUHJpY2UtPnVuaXRfYW1vdW50OwogICAgICAgIH0KCiAgICAgICAgJHJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtID0gUmVxdWlzaXRpb25EZWxpdmVyeUl0ZW06OmNyZWF0ZShbCiAgICAgICAgICAgICdyZXF1aXNpdGlvbl9kZWxpdmVyeV9pZCcgPT4gJHJlcXVpc2l0aW9uRGVsaXZlcnktPmlkLAogICAgICAgICAgICAnd2FyZWhvdXNlX2lkJyA9PiAkd2FyZWhvdXNlLT5pZCwKICAgICAgICAgICAgJ3VpZCcgPT4gJHN0b2NrLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnVpZCwKICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRzdG9jay0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5wcm9kdWN0X2lkLAogICAgICAgICAgICAnZGVsaXZlcnlfcXR5JyA9PiAkZGVsaXZlcnlRdHksCiAgICAgICAgXSk7CgogICAgICAgIGlmICgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5pc19maXhlZF9hc3NldCA9PSAwICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmlzX2N3aXAgPT0gMCAmJiAhJHByb2plY3QgJiYgJGRlbGl2ZXJ5UXR5ID4gMCkgewogICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoJ2pzb24nKTsKICAgICAgICAgICAgYXJyYXlfcHVzaCgkbGVkZ2VySXRlbXMsIFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+IChpc3NldCgkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCA+IDAgPyAkcmVxdWlzaXRpb25JdGVtLT5wcm9kdWN0LT5jb2dzX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY29nc19hY2NvdW50J10pLAogICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkZGVsaXZlcnlRdHkgKiAkdW5pdFByaWNlLAogICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IENPR1MgRGViaXQiLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIGFycmF5X3B1c2goJGxlZGdlckl0ZW1zLCBbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQpICYmICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCA/ICRyZXF1aXNpdGlvbkl0ZW0tPnByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGRlbGl2ZXJ5UXR5ICogJHVuaXRQcmljZSwKICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJQcm9kdWN0IERlbGl2ZXJ5IDo6IEludmVudG9yeSBDcmVkaXQiLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdwcm9kdWN0LWRlbGl2ZXJ5JywKICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+aWQKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICAkcmVxdWlzaXRpb25Nb2RlbCA9IFJlcXVpc2l0aW9uOjpmaW5kT3JGYWlsKCRyZXF1aXNpdGlvbklkKTsKICAgICAgICBSZXF1aXNpdGlvblRyYWNraW5nOjpzdG9yZVJlcXVpc2l0aW9uVHJhY2tpbmcoJHJlcXVpc2l0aW9uTW9kZWwtPmlkLCAnZGVsaXZlcmVkJyk7CiAgICAgICAgaWYgKCRyZXF1aXNpdGlvbk1vZGVsLT5yZXF1aXNpdGlvbkl0ZW1zLT5zdW0oJ3FjX3F0eScpID09ICRyZXF1aXNpdGlvbk1vZGVsLT5yZXF1aXNpdGlvbkl0ZW1zLT5zdW0oJ2RlbGl2ZXJ5X3F0eScpKSB7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbk1vZGVsLT51cGRhdGUoWydkZWxpdmVyeV9zdGF0dXMnID0+ICdkZWxpdmVyZWQnXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uTW9kZWwtPnVwZGF0ZShbJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3BhcnRpYWwtZGVsaXZlcmVkJ10pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzc2V0KCRsZWRnZXJJdGVtc1swXSkpIHsKICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICdQcm9kdWN0IERlbGl2ZXJ5JywgJGxlZGdlckl0ZW1zLCAoaXNzZXQoJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCkgPyAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkIDogZ2V0RXhjaGFuZ2VSYXRlcyhzeXN0ZW1DdXJyZW5jeSgpLT5pZCkpLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkY29zdF9jZW50cmVfaWQpLCBmYWxzZSwgJ2pzb24nKTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRlbnRyeVsnZW50cnknXS0+aWQpICYmIGlzc2V0KCRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkKSkgewogICAgICAgICAgICAgICAgc2F2ZVBPRW50cnkoJGVudHJ5LCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCwgJHB1cmNoYXNlT3JkZXItPmlkLCAncHJvZHVjdC1kZWxpdmVyeScpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vRGVsaXZlcnkKCiAgICAgICAgLy9SZWNlaXZlCiAgICAgICAgJHJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtLT5zdGF0dXMgPSAnYWNrbm93bGVkZ2UnOwogICAgICAgICRyZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS0+c2F2ZSgpOwogICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb25JZCwgJ3JlY2VpdmVkJyk7CiAgICAgICAgLy9SZWNlaXZlCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJ1bkxlZGdlclF1ZXJpZXMoJGlkcywgJGdybikKICAgIHsKICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoJ2pzb24nKTsKICAgICAgICAkc3RvY2tJbnMgPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSW4oJ2lkJywgJGlkcyktPndoZXJlKCdpc19ncm5fY29tcGxldGUnLCAneWVzJyktPmdldCgpOwogICAgICAgICRpdGVtcyA9IFtdOwogICAgICAgIGlmIChpc3NldCgkc3RvY2tJbnNbMF0pKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzdG9ja0lucyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQ7CgogICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snaW52ZW50b3J5X2FjY291bnQnXTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pZCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfc2VydmljZSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2NvZ3NfYWNjb3VudCddOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y29nc19hY2NvdW50X2lkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5jb2dzX2FjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmludmVudG9yeV9hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZWJpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGl0ZW0tPnRvdGFsX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdHUk4gOjogSW52ZW50b3J5IERlYml0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2dybicsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGl0ZW0tPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snZ3Jpcl9hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRpdGVtLT50b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0dSTiA6OiBHUi9JUiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnZ3JuJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkaXRlbS0+aWQKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICdHUk4nLCAkaXRlbXMsICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQpLCBmYWxzZSwgJ2pzb24nKTsKICAgIH0KfQo=