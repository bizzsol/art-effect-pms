<?php
bolt_decrypt( __FILE__ , 'B3Igri'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEFjY291bnRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyTGVkZ2VyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEJhbmtBY2NvdW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeVR5cGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIERCOwp1c2UgQXV0aDsKdXNlIEFwcDsKdXNlIERhdGFUYWJsZXM7CgpjbGFzcyBTdXBwbGllclBheW1lbnRDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncHVyY2hhc2Vfb3JkZXInLCAncHVyY2hhc2Vfb3JkZXInXSwKICAgICAgICAgICAgWydiaWxsJywgJ2JpbGwnLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnYW1vdW50cycsICdhbW91bnRzJ10sCiAgICAgICAgICAgIFsncGF5bWVudHMnLCAncGF5bWVudHMnXSwKICAgICAgICAgICAgWydjaGVja19hbGwnLCAnY2hlY2tfYWxsJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkc3lzdGVtQ3VycmVuY3kgPSBzeXN0ZW1DdXJyZW5jeSgpOwogICAgICAgICAgICAkc3VwcGxpZXJfaWQgPSByZXF1ZXN0KCktPmhhcygnc3VwcGxpZXJfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdzdXBwbGllcl9pZCcpIDogbnVsbDsKICAgICAgICAgICAgJGJpbGxfdHlwZSA9IHJlcXVlc3QoKS0+aGFzKCdiaWxsX3R5cGUnKSA/IHJlcXVlc3QoKS0+Z2V0KCdiaWxsX3R5cGUnKSA6IG51bGw7CiAgICAgICAgICAgICRjdXJyZW5jeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjdXJyZW5jeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJykgOiBudWxsOwoKICAgICAgICAgICAgJHN1cHBsaWVycyA9IFN1cHBsaWVyczo6d2hlcmUoJ3N0YXR1cycsICdBY3RpdmUnKS0+aGFzKCdyZWxQYXltZW50cycpLT5nZXQoWydpZCcsICduYW1lJywgJ2NvZGUnXSk7CiAgICAgICAgICAgICRjdXJyZW5jeVR5cGVzID0gQ3VycmVuY3lUeXBlOjp3aXRoKFsnY3VycmVuY2llcyddKS0+Z2V0KCk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICRleGNoYW5nZVJhdGUgPSAxOwogICAgICAgICAgICAgICAgJHN5c3RlbUV4Y2hhbmdlUmF0ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJykgIT0gcmVxdWVzdCgpLT5nZXQoJ3BheW1lbnRfY3VycmVuY3lfaWQnKSl7CiAgICAgICAgICAgICAgICAgICAgJHJhdGUgPSBnZXRFeGNoYW5nZVJhdGVzKHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZGF0ZXRpbWUnKSkpLCBkYXRlKCdIOmk6cycsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZGF0ZXRpbWUnKSkpKTsKICAgICAgICAgICAgICAgICAgICAkZXhjaGFuZ2VSYXRlID0gaXNzZXQoJHJhdGVbJ3JhdGVzJ11bcmVxdWVzdCgpLT5nZXQoJ3BheW1lbnRfY3VycmVuY3lfaWQnKV1bJ3JhdGUnXSkgPyAkcmF0ZVsncmF0ZXMnXVtyZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpXVsncmF0ZSddIDogMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkc3lzdGVtQ3VycmVuY3ktPmlkICE9IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpICYmICRzeXN0ZW1DdXJyZW5jeS0+aWQgIT0gcmVxdWVzdCgpLT5nZXQoJ3BheW1lbnRfY3VycmVuY3lfaWQnKSAmJiByZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSA9PSByZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpKXsKICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IGdldEV4Y2hhbmdlUmF0ZXMocmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJyksIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdkYXRldGltZScpKSksIGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdkYXRldGltZScpKSkpOwogICAgICAgICAgICAgICAgICAgICRzeXN0ZW1FeGNoYW5nZVJhdGUgPSBpc3NldCgkcmF0ZVsncmF0ZXMnXVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/ICRyYXRlWydyYXRlcyddWyRzeXN0ZW1DdXJyZW5jeS0+aWRdWydyYXRlJ10gOiAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwYXltZW50cyA9IFN1cHBsaWVyUGF5bWVudDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3JlbFN1cHBsaWVyTGVkZ2VycycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXInCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZSgnc3RhdHVzJywgJ2F1ZGl0ZWQnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlJyxmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGN1cnJlbmN5X2lkKXsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjdXJyZW5jeV9pZCcsICRjdXJyZW5jeV9pZCk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1cHBsaWVyX2lkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRzdXBwbGllcl9pZCkgJiYgJGJpbGxfdHlwZSAhPSAnYXNzZXQtY29zdGluZy1lbnRyaWVzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1cHBsaWVyX2lkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICchPScsICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkc3VwcGxpZXJfaWQpICYmICRiaWxsX3R5cGUgPT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHN1cHBsaWVyX2lkKS0+d2hlcmUoJ2JpbGxfdHlwZScsICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGJpbGxfdHlwZSksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRiaWxsX3R5cGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdiaWxsX3R5cGUnLCAkYmlsbF90eXBlKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkYXZhaWxhYmxlID0gW107CiAgICAgICAgICAgICAgICBpZihpc3NldCgkcGF5bWVudHNbMF0pKXsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwYXltZW50cyBhcyAka2V5ID0+ICRwYXltZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgJHBhaWRBbW91bnQgPSAkcGF5bWVudC0+cmVsU3VwcGxpZXJMZWRnZXJzLT5zdW0oJ2RlYml0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRiaWxsQW1vdW50ID0gKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiID8gJHBheW1lbnQtPnBheV9hbW91bnQgOiAkcGF5bWVudC0+YmlsbF9hbW91bnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGJpbGxBbW91bnQtJHBhaWRBbW91bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGF2YWlsYWJsZSwgJHBheW1lbnQtPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkcGF5bWVudHMgPSBTdXBwbGllclBheW1lbnQ6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxTdXBwbGllckxlZGdlcnMuZXhjaGFuZ2VSYXRlJywKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5Vbml0JywKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxQb0F0dGFjaG1lbnQnLAogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbFN1cHBsaWVyUGF5bWVudHMucmVsU3VwcGxpZXJMZWRnZXJzLmV4Y2hhbmdlUmF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlckVudHJpZXMuZW50cnknLAogICAgICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVyLnJlbEdvb2RSZWNlaXZlTm90ZS5iaWxsaW5nQ2hhbGxhbi5yZWxQdXJjaGFzZU9yZGVyQXR0YWNobWVudCcKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzdGF0dXMnLCAnYXVkaXRlZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUnLGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkY3VycmVuY3lfaWQpewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2N1cnJlbmN5X2lkJywgJGN1cnJlbmN5X2lkKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkc3VwcGxpZXJfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1cHBsaWVyX2lkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHN1cHBsaWVyX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRzdXBwbGllcl9pZCkgJiYgJGJpbGxfdHlwZSAhPSAnYXNzZXQtY29zdGluZy1lbnRyaWVzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1cHBsaWVyX2lkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwogICAgICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJHN1cHBsaWVyX2lkKSAmJiAkYmlsbF90eXBlID09ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdXBwbGllcl9pZCcsICRzdXBwbGllcl9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRiaWxsX3R5cGUpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkYmlsbF90eXBlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYmlsbF90eXBlJywgJGJpbGxfdHlwZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsICRhdmFpbGFibGUpOwoKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkcGF5bWVudHMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3B1cmNoYXNlX29yZGVyJywgZnVuY3Rpb24gKCRwYXltZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsU3VwcGxpZXJQYXltZW50cy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsU3VwcGxpZXJQYXltZW50cyBhcyAkcGF5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5iaWxsX3R5cGUgIT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxQYWlkICs9ICRwYXktPnJlbFN1cHBsaWVyTGVkZ2Vycy0+c3VtKCdkZWJpdCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLnRvb2xzLnB1cmNoYXNlT3JkZXInLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudCcgPT4gJHBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxQYWlkJyA9PiAkdG90YWxQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwdXJjaGFzZV9vcmRlcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRrZXl3b3JkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5Vbml0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHVyY2hhc2Vfb3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdzdXBwbGllcl9wYXltZW50cy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYmlsbCcsIGZ1bmN0aW9uICgkcGF5bWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYWNjb3VudHMudG9vbHMuYmlsbCcsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50JyA9PiAkcGF5bWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmlsbCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRrZXl3b3JkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdiaWxsX3R5cGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnYmlsbF9udW1iZXInLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgndHJhbnNlY3Rpb25fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2JpbGwnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgndHJhbnNlY3Rpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Ftb3VudHMnLCBmdW5jdGlvbiAoJHBheW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxTdXBwbGllclBheW1lbnRzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxTdXBwbGllclBheW1lbnRzIGFzICRwYXkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYWlkQW1vdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudC0+YmlsbF90eXBlID09ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+YmlsbF90eXBlID09ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYWlkQW1vdW50ID0gJHBheS0+cmVsU3VwcGxpZXJMZWRnZXJzLT5zdW0oJ2RlYml0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+YmlsbF90eXBlICE9ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYWlkQW1vdW50ID0gJHBheS0+cmVsU3VwcGxpZXJMZWRnZXJzLT5zdW0oJ2RlYml0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZCArPSAkcGFpZEFtb3VudDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiAmJiAkcGF5LT5iaWxsX3R5cGUgIT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWR2YW5jZVBhaWQgKz0gJHBhaWRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5hY2NvdW50cy50b29scy5hbW91bnRzJywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnQnID0+ICRwYXltZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsUGFpZCc9PiAkdG90YWxQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkdmFuY2VQYWlkJz0+ICRhZHZhbmNlUGFpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50RGV0YWlscycgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdncm4tYW1vdW50JyA9PiAkdGhpcy0+Z2V0R1JOQW1vdW50KCRwYXltZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFpZC1hbW91bnQnID0+ICRwYXltZW50LT5yZWxTdXBwbGllckxlZGdlcnMtPnN1bSgnZGViaXQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlsbC1hbW91bnQnID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/ICRwYXltZW50LT5wYXlfYW1vdW50IDogJHBheW1lbnQtPmJpbGxfYW1vdW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVhZG9ubHknID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/IHRydWUgOiBmYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3BheW1lbnRzJywgZnVuY3Rpb24gKCRwYXltZW50KSB1c2UoJGJpbGxfdHlwZSwgJGV4Y2hhbmdlUmF0ZSwgJHN5c3RlbUN1cnJlbmN5LCAkc3lzdGVtRXhjaGFuZ2VSYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb19yYXRlID0gKGlzc2V0KGpzb25fZGVjb2RlKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpW3JlcXVlc3QoKS0+Z2V0KCdwYXltZW50X2N1cnJlbmN5X2lkJyldWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbcmVxdWVzdCgpLT5nZXQoJ3BheW1lbnRfY3VycmVuY3lfaWQnKV1bJ3JhdGUnXSA6IDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHN5c3RlbV9wb19yYXRlID0gKGlzc2V0KGpzb25fZGVjb2RlKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpWyRzeXN0ZW1DdXJyZW5jeS0+aWRdWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHBheV9yYXRlID0gKGlzc2V0KGpzb25fZGVjb2RlKCRwYXltZW50LT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVtyZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRwYXltZW50LT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVtyZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpXVsncmF0ZSddIDogMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtX3BheV9yYXRlID0gKGlzc2V0KGpzb25fZGVjb2RlKCRwYXltZW50LT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRwYXltZW50LT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddIDogMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudFBhaWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudFBhaWRGb3JQYXltZW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRQYWlkRm9yU3lzdGVtID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxQYWlkRm9yUGF5bWVudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWRGb3JTeXN0ZW0gPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VQYWlkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VQYWlkRm9yUGF5bWVudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZEZvclN5c3RlbSA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsU3VwcGxpZXJQYXltZW50cy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsU3VwcGxpZXJQYXltZW50cyBhcyAkcGF5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2VlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5iaWxsX3R5cGUgPT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2NlZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXktPmJpbGxfdHlwZSAhPSAnYXNzZXQtY29zdGluZy1lbnRyaWVzJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvY2VlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gJ2dybicgJiYgJHBheS0+YmlsbF90eXBlID09ICdwby1hZHZhbmNlJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcm9jZWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFpZEFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN5c3RlbVBhaWRBbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwcm9jZWVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+cmVsU3VwcGxpZXJMZWRnZXJzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwYXktPnJlbFN1cHBsaWVyTGVkZ2VycyBhcyAka2V5ID0+ICRzbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhdGUgPSAoaXNzZXQoanNvbl9kZWNvZGUoJHNsLT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVtyZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRzbC0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbcmVxdWVzdCgpLT5nZXQoJ3BheW1lbnRfY3VycmVuY3lfaWQnKV1bJ3JhdGUnXSA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYWlkQW1vdW50ICs9ICgkc2wtPmRlYml0KiRyYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN5c3RlbVJhdGUgPSAoaXNzZXQoanNvbl9kZWNvZGUoJHNsLT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRzbC0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzeXN0ZW1QYWlkQW1vdW50ICs9ICgkc2wtPmRlYml0KiRzeXN0ZW1SYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5pZCA9PSAkcGF5bWVudC0+aWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudFBhaWQgKz0gKCRzbC0+ZGViaXQqJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudFBhaWRGb3JTeXN0ZW0gKz0gKCRzbC0+ZGViaXQqJHN5c3RlbVJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRQYWlkRm9yUGF5bWVudCArPSAkcGF5bWVudFBhaWQqJGV4Y2hhbmdlUmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudFBhaWRGb3JTeXN0ZW0gKz0gJHBheW1lbnRQYWlkRm9yU3lzdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWQgKz0gJHBhaWRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZEZvclBheW1lbnQgKz0gJHBhaWRBbW91bnQqJGV4Y2hhbmdlUmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxQYWlkRm9yU3lzdGVtICs9ICRzeXN0ZW1QYWlkQW1vdW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiICYmICRwYXktPmJpbGxfdHlwZSAhPSAnYXNzZXQtY29zdGluZy1lbnRyaWVzJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZCArPSAkcGFpZEFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VQYWlkRm9yUGF5bWVudCArPSAkcGFpZEFtb3VudCokZXhjaGFuZ2VSYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWR2YW5jZVBhaWRGb3JTeXN0ZW0gKz0gJHN5c3RlbVBhaWRBbW91bnQqKCRzeXN0ZW1FeGNoYW5nZVJhdGUgPyAkc3lzdGVtRXhjaGFuZ2VSYXRlIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWR2YW5jZUNsZWFyZWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudEFkdmFuY2VDbGVhcmVkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHN5c3RlbVBheW1lbnRBZHZhbmNlQ2xlYXJlZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyRW50cmllcy0+d2hlcmUoJ3R5cGUnLCAnYWR2YW5jZS1jbGVhcmluZycpLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyRW50cmllcy0+d2hlcmUoJ3R5cGUnLCAnYWR2YW5jZS1jbGVhcmluZycpIGFzICRrZXkgPT4gJGVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhdGUgPSAoaXNzZXQoanNvbl9kZWNvZGUoJGVudC0+ZW50cnktPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpW3JlcXVlc3QoKS0+Z2V0KCdwYXltZW50X2N1cnJlbmN5X2lkJyldWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJGVudC0+ZW50cnktPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpW3JlcXVlc3QoKS0+Z2V0KCdwYXltZW50X2N1cnJlbmN5X2lkJyldWydyYXRlJ10gOiAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXQgPSAkZW50LT5lbnRyeS0+ZGViaXQqJHJhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VDbGVhcmVkICs9ICRkZWJpdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudEFkdmFuY2VDbGVhcmVkICs9ICRkZWJpdCokZXhjaGFuZ2VSYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtUmF0ZSA9IChpc3NldChqc29uX2RlY29kZSgkZW50LT5lbnRyeS0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSkgPyBqc29uX2RlY29kZSgkZW50LT5lbnRyeS0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdCA9ICRlbnQtPmVudHJ5LT5kZWJpdCokc3lzdGVtUmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtUGF5bWVudEFkdmFuY2VDbGVhcmVkICs9ICRkZWJpdCooJHN5c3RlbUV4Y2hhbmdlUmF0ZSA/ICRzeXN0ZW1FeGNoYW5nZVJhdGUgOiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJHBheV9hbW91bnQgPSAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAncG8tYWR2YW5jZScgPyAkcGF5bWVudC0+cGF5X2Ftb3VudCA6ICRwYXltZW50LT5iaWxsX2Ftb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRwb0R1ZSA9ICgkcGF5X2Ftb3VudCokcG9fcmF0ZSktJHRvdGFsUGFpZDsKICAgICAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRQb0R1ZSA9ICgoJHBheV9hbW91bnQqJGV4Y2hhbmdlUmF0ZSktJHRvdGFsUGFpZEZvclBheW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtT2xkUG9EdWUgPSAoKCRwYXlfYW1vdW50KiRzeXN0ZW1fcGF5X3JhdGUpLSR0b3RhbFBhaWRGb3JTeXN0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtUG9EdWUgPSAoKCRwYXlfYW1vdW50Kigkc3lzdGVtRXhjaGFuZ2VSYXRlID8gJHN5c3RlbUV4Y2hhbmdlUmF0ZSA6IDApKS0kdG90YWxQYWlkRm9yU3lzdGVtKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRncm5BbW91bnQgPSAkdGhpcy0+Z2V0R1JOQW1vdW50KCRwYXltZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5hY2NvdW50cy50b29scy5wYXltZW50cycsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50JyA9PiAkcGF5bWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdleGNoYW5nZVJhdGUnID0+ICRleGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3lzdGVtQ3VycmVuY3knID0+ICRzeXN0ZW1DdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeXN0ZW1FeGNoYW5nZVJhdGUnID0+ICRzeXN0ZW1FeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9EZXRhaWxzJyA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsLXBhaWQnID0+ICR0b3RhbFBhaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnQtdG90YWwtcGFpZCcgPT4gJHRvdGFsUGFpZEZvclBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbS10b3RhbC1wYWlkJyA9PiAkdG90YWxQYWlkRm9yU3lzdGVtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZHZhbmNlLXBhaWQnID0+ICRhZHZhbmNlUGFpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudC1hZHZhbmNlLXBhaWQnID0+ICRhZHZhbmNlUGFpZEZvclBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbS1hZHZhbmNlLXBhaWQnID0+ICRhZHZhbmNlUGFpZEZvclN5c3RlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG8tZHVlJyA9PiAkcG9EdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnQtcG8tZHVlJyA9PiAkcGF5bWVudFBvRHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeXN0ZW0tb2xkLXBvLWR1ZScgPT4gJHN5c3RlbU9sZFBvRHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeXN0ZW0tcG8tZHVlJyA9PiAkc3lzdGVtUG9EdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkdmFuY2UtY2xlYXJlZCcgPT4gJGFkdmFuY2VDbGVhcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50LWFkdmFuY2UtY2xlYXJlZCcgPT4gJHBheW1lbnRBZHZhbmNlQ2xlYXJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3lzdGVtLWFkdmFuY2UtY2xlYXJlZCcgPT4gJHN5c3RlbVBheW1lbnRBZHZhbmNlQ2xlYXJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudERldGFpbHMnID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ3JuLWFtb3VudCcgPT4gJGdybkFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudC1ncm4tYW1vdW50JyA9PiAkZ3JuQW1vdW50KiRleGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbS1ncm4tYW1vdW50JyA9PiAkZ3JuQW1vdW50Kigkc3lzdGVtRXhjaGFuZ2VSYXRlID8gJHN5c3RlbUV4Y2hhbmdlUmF0ZSA6IDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50LXBhaWQnID0+ICRwYXltZW50UGFpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudC1wYXltZW50LXBhaWQnID0+ICRwYXltZW50UGFpZEZvclBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbS1vbGQtcGF5bWVudC1wYWlkJyA9PiAkcGF5bWVudFBhaWRGb3JTeXN0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbS1wYXltZW50LXBhaWQnID0+ICRwYXltZW50UGFpZEZvclN5c3RlbSooJHN5c3RlbUV4Y2hhbmdlUmF0ZSA/ICRzeXN0ZW1FeGNoYW5nZVJhdGUgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlsbC1hbW91bnQnID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/ICRwYXltZW50LT5wYXlfYW1vdW50KiRwYXlfcmF0ZSA6ICRwYXltZW50LT5iaWxsX2Ftb3VudCokcGF5X3JhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXltZW50LWJpbGwtYW1vdW50JyA9PiAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAicG8tYWR2YW5jZSIgPyAkcGF5bWVudC0+cGF5X2Ftb3VudCokZXhjaGFuZ2VSYXRlIDogJHBheW1lbnQtPmJpbGxfYW1vdW50KiRleGNoYW5nZVJhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeXN0ZW0tb2xkLWJpbGwtYW1vdW50JyA9PiAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAicG8tYWR2YW5jZSIgPyAkcGF5bWVudC0+cGF5X2Ftb3VudCokc3lzdGVtX3BheV9yYXRlIDogJHBheW1lbnQtPmJpbGxfYW1vdW50KiRzeXN0ZW1fcGF5X3JhdGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeXN0ZW0tYmlsbC1hbW91bnQnID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/ICRwYXltZW50LT5wYXlfYW1vdW50Kigkc3lzdGVtRXhjaGFuZ2VSYXRlID8gJHN5c3RlbUV4Y2hhbmdlUmF0ZSA6IDApIDogJHBheW1lbnQtPmJpbGxfYW1vdW50Kigkc3lzdGVtRXhjaGFuZ2VSYXRlID8gJHN5c3RlbUV4Y2hhbmdlUmF0ZSA6IDApKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVhZG9ubHknID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/IHRydWUgOiBmYWxzZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjaGVja19hbGwnLCBmdW5jdGlvbiAoJHBheW1lbnQpIHVzZSgkYmlsbF90eXBlLCAkZXhjaGFuZ2VSYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXltZW50UGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXltZW50UGFpZEZvclBheW1lbnQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWRGb3JQYXltZW50ID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZEZvclBheW1lbnQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFN1cHBsaWVyUGF5bWVudHMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlbFN1cHBsaWVyUGF5bWVudHMgYXMgJHBheSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2NlZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudC0+YmlsbF90eXBlID09ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+YmlsbF90eXBlID09ICdhc3NldC1jb3N0aW5nLWVudHJpZXMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcm9jZWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5iaWxsX3R5cGUgIT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2NlZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFpZEFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHByb2NlZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5LT5yZWxTdXBwbGllckxlZGdlcnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHBheS0+cmVsU3VwcGxpZXJMZWRnZXJzIGFzICRrZXkgPT4gJHNsKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IChpc3NldChqc29uX2RlY29kZSgkc2wtPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpW3JlcXVlc3QoKS0+Z2V0KCdwYXltZW50X2N1cnJlbmN5X2lkJyldWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJHNsLT5leGNoYW5nZVJhdGUtPnJhdGVzLCB0cnVlKVtyZXF1ZXN0KCktPmdldCgncGF5bWVudF9jdXJyZW5jeV9pZCcpXVsncmF0ZSddIDogMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhaWRBbW91bnQgKz0gKCRzbC0+ZGViaXQqJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXktPmlkID09ICRwYXltZW50LT5pZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXltZW50UGFpZCArPSAoJHNsLT5kZWJpdCokcmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWQgKz0gJHBhaWRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZEZvclBheW1lbnQgKz0gJHBhaWRBbW91bnQqJGV4Y2hhbmdlUmF0ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRQYWlkRm9yUGF5bWVudCArPSAkcGF5bWVudFBhaWQqJGV4Y2hhbmdlUmF0ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBheS0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiAmJiAkcGF5LT5iaWxsX3R5cGUgIT0gJ2Fzc2V0LWNvc3RpbmctZW50cmllcycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWR2YW5jZVBhaWQgKz0gJHBhaWRBbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZHZhbmNlUGFpZEZvclBheW1lbnQgKz0gJHBhaWRBbW91bnQqJGV4Y2hhbmdlUmF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRwYXlfcmF0ZSA9IChpc3NldChqc29uX2RlY29kZSgkcGF5bWVudC0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbcmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJyldWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJHBheW1lbnQtPmV4Y2hhbmdlUmF0ZS0+cmF0ZXMsIHRydWUpW3JlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpXVsncmF0ZSddIDogMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYWNjb3VudHMudG9vbHMuY2hlY2snLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudCcgPT4gJHBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWR2YW5jZS1wYWlkJyA9PiAkYWR2YW5jZVBhaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudC1hZHZhbmNlLXBhaWQnID0+ICRhZHZhbmNlUGFpZEZvclBheW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudERldGFpbHMnID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF5bWVudC1wYWlkJyA9PiAkcGF5bWVudFBhaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnQtcGF5bWVudC1wYWlkJyA9PiAkcGF5bWVudFBhaWRGb3JQYXltZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiaWxsLWFtb3VudCcgPT4gKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiID8gJHBheW1lbnQtPnBheV9hbW91bnQqJHBheV9yYXRlIDogJHBheW1lbnQtPmJpbGxfYW1vdW50KiRwYXlfcmF0ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnQtYmlsbC1hbW91bnQnID0+ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/ICRwYXltZW50LT5wYXlfYW1vdW50KiRwYXlfcmF0ZSokZXhjaGFuZ2VSYXRlIDogJHBheW1lbnQtPmJpbGxfYW1vdW50KiRwYXlfcmF0ZSokZXhjaGFuZ2VSYXRlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydwdXJjaGFzZV9vcmRlcicsICdiaWxsJywgJ2Ftb3VudHMnLCAncGF5bWVudHMnLCAnY2hlY2tfYWxsJ10pCiAgICAgICAgICAgICAgICAgICAgLT50b0pzb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLnN1cHBsaWVyLXBheW1lbnQtbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1N1cHBsaWVyIFBheW1lbnRzJywKICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJGJpbGxfdHlwZSwKICAgICAgICAgICAgICAgICdzdXBwbGllcnMnID0+ICRzdXBwbGllcnMsCiAgICAgICAgICAgICAgICAnY3VycmVuY3lUeXBlcycgPT4gJGN1cnJlbmN5VHlwZXMsCiAgICAgICAgICAgICAgICAnY3VycmVuY3knID0+IEN1cnJlbmN5OjpmaW5kKCRjdXJyZW5jeV9pZCksCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgICAgICdjaGVja0FsbCcgPT4gNgogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldEdSTkFtb3VudCgkcGF5bWVudCkKICAgIHsKICAgICAgICAkZ3JuQW1vdW50ID0gMDsKICAgICAgICBpZigkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgIGZvcmVhY2goJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPnJlbEdvb2RSZWNlaXZlTm90ZSBhcyAka2V5ID0+ICRncm4pewogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGdybi0+YmlsbGluZ0NoYWxsYW4tPnJlbFB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCkgJiYgJGdybi0+YmlsbGluZ0NoYWxsYW4tPnJlbFB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5wdXJjaGFzZV9vcmRlcl9pZCA9PSAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+aWQgJiYgJGdybi0+YmlsbGluZ0NoYWxsYW4tPnJlbFB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkID09ICRwYXltZW50LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkICYmICRncm4tPmJpbGxpbmdDaGFsbGFuLT5yZWxQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+YmlsbF90eXBlID09ICRwYXltZW50LT5iaWxsX3R5cGUpewogICAgICAgICAgICAgICAgICAgICRncm5BbW91bnQgKz0gJGdybi0+Z3Jvc3NfcHJpY2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkZ3JuQW1vdW50OwogICAgfQoKICAgIC8qCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXhfX19faW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRzdXBwbGllcl9pZCA9IHJlcXVlc3QoKS0+aGFzKCdzdXBwbGllcl9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ3N1cHBsaWVyX2lkJykgOiBudWxsOwogICAgICAgICAgICAkYmlsbF90eXBlID0gcmVxdWVzdCgpLT5oYXMoJ2JpbGxfdHlwZScpID8gcmVxdWVzdCgpLT5nZXQoJ2JpbGxfdHlwZScpIDogbnVsbDsKICAgICAgICAgICAgJGN1cnJlbmN5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2N1cnJlbmN5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSA6IG51bGw7CgogICAgICAgICAgICAkc3VwcGxpZXJzID0gU3VwcGxpZXJzOjp3aGVyZSgnc3RhdHVzJywgJ0FjdGl2ZScpLT5oYXMoJ3JlbFBheW1lbnRzJyktPmdldChbJ2lkJywgJ25hbWUnXSk7CiAgICAgICAgICAgICRjdXJyZW5jeVR5cGVzID0gQ3VycmVuY3lUeXBlOjp3aXRoKFsnY3VycmVuY2llcyddKS0+Z2V0KCk7CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ1VuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbicsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsU3VwcGxpZXJQYXltZW50cy5yZWxTdXBwbGllckxlZGdlcnMnLAogICAgICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXJFbnRyaWVzLmVudHJ5JywKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUuYmlsbGluZ0NoYWxsYW4ucmVsUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlJyxmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGN1cnJlbmN5X2lkKXsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2N1cnJlbmN5X2lkJywgJGN1cnJlbmN5X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsU3VwcGxpZXJQYXltZW50cycsZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlUmF3KCdwdXJjaGFzZV9vcmRlcnMuaWQ9c3VwcGxpZXJfcGF5bWVudHMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkc3VwcGxpZXJfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHN1cHBsaWVyX2lkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWVtcHR5KCRiaWxsX3R5cGUpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkYmlsbF90eXBlKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxTdXBwbGllclBheW1lbnRzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGJpbGxfdHlwZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsX3R5cGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+cGFnaW5hdGUoMTAwKTsKCiAgICAgICAgICAgICRwb1BheW1lbnREZXRhaWxzID0gW107CiAgICAgICAgICAgICRwYXltZW50RGV0YWlscyA9IFtdOwogICAgICAgICAgICBpZigkcHVyY2hhc2VPcmRlci0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcHVyY2hhc2VPcmRlciBhcyAka2V5ID0+ICRwbyl7CiAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRzID0gJHBvLT5yZWxTdXBwbGllclBheW1lbnRzLT53aGVyZSgnc3RhdHVzJywgJ2F1ZGl0ZWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGJpbGxfdHlwZSksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRiaWxsX3R5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2JpbGxfdHlwZScsICRiaWxsX3R5cGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICRjb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgJHRvdGFsUGFpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VQYWlkID0gMDsKICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudHMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcGF5bWVudHMgYXMgJGtleSA9PiAkcGF5bWVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFpZEFtb3VudCA9ICRwYXltZW50LT5yZWxTdXBwbGllckxlZGdlcnMtPnN1bSgnZGViaXQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbFBhaWQgKz0gJHBhaWRBbW91bnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJpbGxBbW91bnQgPSAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAicG8tYWR2YW5jZSIgPyAkcGF5bWVudC0+cGF5X2Ftb3VudCA6ICRwYXltZW50LT5iaWxsX2Ftb3VudCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGJpbGxBbW91bnQtJHBhaWRBbW91bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiAmJiAkcGF5bWVudC0+c3RhdHVzID09ICJhdWRpdGVkIil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFkdmFuY2VQYWlkICs9ICRwYWlkQW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRncm5BbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRwby0+cmVsR29vZFJlY2VpdmVOb3RlIGFzICRrZXkgPT4gJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRncm4tPmJpbGxpbmdDaGFsbGFuLT5yZWxQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+cHVyY2hhc2Vfb3JkZXJfaWQpICYmICRncm4tPmJpbGxpbmdDaGFsbGFuLT5yZWxQdXJjaGFzZU9yZGVyQXR0YWNobWVudC0+cHVyY2hhc2Vfb3JkZXJfaWQgPT0gJHBvLT5pZCAmJiAkZ3JuLT5iaWxsaW5nQ2hhbGxhbi0+cmVsUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQgPT0gJHBheW1lbnQtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQgJiYgJGdybi0+YmlsbGluZ0NoYWxsYW4tPnJlbFB1cmNoYXNlT3JkZXJBdHRhY2htZW50LT5iaWxsX3R5cGUgPT0gJHBheW1lbnQtPmJpbGxfdHlwZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ3JuQW1vdW50ICs9ICRncm4tPmdyb3NzX3ByaWNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXltZW50RGV0YWlsc1skcGF5bWVudC0+aWRdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdncm4tYW1vdW50JyA9PiAkZ3JuQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYWlkLWFtb3VudCcgPT4gJHBhaWRBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JpbGwtYW1vdW50JyA9PiAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAicG8tYWR2YW5jZSIgPyAkcGF5bWVudC0+cGF5X2Ftb3VudCA6ICRwYXltZW50LT5iaWxsX2Ftb3VudCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWRvbmx5JyA9PiAoJHBheW1lbnQtPmJpbGxfdHlwZSA9PSAicG8tYWR2YW5jZSIgPyB0cnVlIDogZmFsc2UpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJGNvdW50ID4gMCAmJiAkcGF5bWVudHMtPmNvdW50KCkgPiAwICYmICgkcG8tPmdyb3NzX3ByaWNlLSR0b3RhbFBhaWQpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHBvUGF5bWVudERldGFpbHMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcicgPT4gJHBvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BheW1lbnRzJyA9PiAkcGF5bWVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY291bnQnID0+ICRjb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbC1wYWlkJyA9PiAkdG90YWxQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkdmFuY2UtcGFpZCcgPT4gJGFkdmFuY2VQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvLWR1ZScgPT4gJHBvLT5ncm9zc19wcmljZS0kdG90YWxQYWlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkdmFuY2UtY2xlYXJlZCcgPT4gJHBvLT5wdXJjaGFzZU9yZGVyRW50cmllcy0+d2hlcmUoJ3R5cGUnLCAnYWR2YW5jZS1jbGVhcmluZycpLT5zdW0oJ2RlYml0JyksCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLnN1cHBsaWVyLXBheW1lbnQtbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1N1cHBsaWVyIFBheW1lbnRzJywKICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgJ2JpbGxfdHlwZScgPT4gJGJpbGxfdHlwZSwKICAgICAgICAgICAgICAgICdzdXBwbGllcnMnID0+ICRzdXBwbGllcnMsCiAgICAgICAgICAgICAgICAnY3VycmVuY3lUeXBlcycgPT4gJGN1cnJlbmN5VHlwZXMsCiAgICAgICAgICAgICAgICAnY3VycmVuY3knID0+IEN1cnJlbmN5OjpmaW5kKCRjdXJyZW5jeV9pZCksCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIsCiAgICAgICAgICAgICAgICAncG9QYXltZW50RGV0YWlscycgPT4gJHBvUGF5bWVudERldGFpbHMsCiAgICAgICAgICAgICAgICAncGF5bWVudERldGFpbHMnID0+ICRwYXltZW50RGV0YWlscywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGJpbGxpbmdMaXN0SGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnUE9fZGF0ZScsICdQT19kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZWZlcmVuY2UnLCAncmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnUE9fcXR5JywgJ1BPX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydQT19hbW91bnQnLCAnUE9fYW1vdW50JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydHUk5fcXR5JywgJ0dSTl9xdHknLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ0dSTl9hbW91bnQnLCAnR1JOX2Ftb3VudCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYmlsbF9hbW91bnQnLCAnYmlsbF9hbW91bnQnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3BhaWRfYW1vdW50JywgJ3BhaWRfYW1vdW50JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlX3N0YXR1cycsICdyZWNlaXZlX3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ29wdGlvbnMnLCAnb3B0aW9ucycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGJpbGxpbmdMaXN0KCkKICAgIHsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVycyA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcycsCiAgICAgICAgICAgICAgICAncmVsUG9BdHRhY2htZW50JywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLAogICAgICAgICAgICAgICAgJ3JlbFN1cHBsaWVyUGF5bWVudHMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUnLGZ1bmN0aW9uICgkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+aGFzKCdyZWxQb0F0dGFjaG1lbnQnKTsKICAgICAgICAgICAgLy8gLT53aGVyZUhhcygncmVsUG9BdHRhY2htZW50JyxmdW5jdGlvbiAoJHF1ZXJ5KXsKICAgICAgICAgICAgLy8gICAgICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsJ2FwcHJvdmVkJyk7CiAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJHB1cmNoYXNlT3JkZXJzKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRwby0+cG9fZGF0ZSkgPyBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcG8tPnBvX2RhdGUpKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSk/JHBvLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZS4nICgnLiRwby0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknOicnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVmZXJlbmNlJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHBvLT5pZCkuJyI+Jy4kcG8tPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fcXR5JywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwby0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwby0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX2Ftb3VudCcsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkcG8tPmdyb3NzX3ByaWNlKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19hbW91bnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ3Jvc3NfcHJpY2UnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ0dSTl9xdHknLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGVbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwkaSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXSA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdHUk5fYW1vdW50JywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHBvLT5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW5bMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkcG8tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICd5ZXMnKS0+c3VtKCd0b3RhbF9hbW91bnQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiaWxsX2Ftb3VudCcsIGZ1bmN0aW9uKCRwbyl7CiAgICAgICAgICAgICAgICAgICAgICAgICRiaWxsX2Ftb3VudCA9ICRwby0+cmVsUG9BdHRhY2htZW50LT5zdW0oJ2JpbGxfYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRiaWxsX2Ftb3VudCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRiaWxsX2Ftb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdOb3QgVXBkYXRlZCBZZXQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncGFpZF9hbW91bnQnLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHBvLT5yZWxTdXBwbGllclBheW1lbnRzLT5zdW0oJ3BheV9hbW91bnQnKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVjZWl2ZV9zdGF0dXMnLCBmdW5jdGlvbigkcG8pewogICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcG8tPnJlbEdvb2RSZWNlaXZlTm90ZVswXSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBvLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdGVtLCRpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbVsnZ3JuX3F0eSddPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG90YWxfZ3JuX3F0eSA9ICRwby0+cmVsR29vZFJlY2VpdmVOb3RlLT5zdW0oJ2dybl9xdHknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZigkcG8tPnJlbFB1cmNoYXNlT3JkZXJJdGVtcy0+c3VtKCdxdHknKSA9PSAkdG90YWxfZ3JuX3F0eSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxidXR0b24gY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi14cyI+UGFydGlhbCBSZWNlaXZlZDwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcHRpb25zJywgZnVuY3Rpb24oJHBvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLmJpbGxpbmctbGlzdC1vcHRpb25zJywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvJyA9PiAkcG8KICAgICAgICAgICAgICAgICAgICAgICAgXSktPnJlbmRlcigpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlJywgJ3JlY2VpdmVfc3RhdHVzJywgJ2ludm9pY2UnLCAndmF0JywgJ3N0YXR1cycsICdvcHRpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT50b0pzb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLmJpbGxpbmctbGlzdCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIkJpbGxpbmcgTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmJpbGxpbmdMaXN0SGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBvSW52b2ljZUxpc3QoJGlkKQogICAgewogICAgICAgIHRyeXsKCiAgICAgICAgICAgICR0aXRsZT0iUHVyY2hhc2UgT3JkZXIgV2lzZSBDaGFsbGFuIExpc3QiOwoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRjdXJyZW5jeSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuYWNjb3VudHMucG8taW52b2ljZS1saXN0Jyxjb21wYWN0KCd0aXRsZScsJ3B1cmNoYXNlT3JkZXInLCAnY3VycmVuY3knKSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnZGF0ZXRpbWUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwYXltZW50X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncGF5bWVudF9pZC4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAndmF0X2Ftb3VudCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3ZhdF9hbW91bnQuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3RheF9hbW91bnQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICd0YXhfYW1vdW50LionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwYXlfYW1vdW50JyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncGF5X2Ftb3VudC4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBpZihpbl9hcnJheSgkcmVxdWVzdC0+cGF5bWVudF90eXBlLCBbJ2NoZXF1ZScsICdmdW5kLXRyYW5zZmVyJ10pKXsKICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICdwYXltZW50X2RldGFpbHMnID0+ICdyZXF1aXJlZCcKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKCiAgICAgICAgICAgICRzeXN0ZW1DdXJyZW5jeSA9IHN5c3RlbUN1cnJlbmN5KCk7CiAgICAgICAgICAgICRzeXN0ZW1FeGNoYW5nZVJhdGVzID0gZ2V0RXhjaGFuZ2VSYXRlcygkc3lzdGVtQ3VycmVuY3ktPmlkLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSwgZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpOwogICAgICAgICAgICAkc3lzdGVtRXhjaGFuZ2VSYXRlID0gaXNzZXQoJHN5c3RlbUV4Y2hhbmdlUmF0ZXNbJ3JhdGUnXS0+aWQpID8gJHN5c3RlbUV4Y2hhbmdlUmF0ZXNbJ3JhdGUnXS0+aWQgOiBmYWxzZTsKCiAgICAgICAgICAgICRyYXRlID0gZ2V0RXhjaGFuZ2VSYXRlcygkcmVxdWVzdC0+cGF5bWVudF9jdXJyZW5jeV9pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmhpZGRlbl9kYXRldGltZSkpLCBkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+aGlkZGVuX2RhdGV0aW1lKSkpOwogICAgICAgICAgICAkZXhjaGFuZ2VSYXRlSWQgPSBpc3NldCgkcmF0ZVsncmF0ZSddLT5pZCkgPyAkcmF0ZVsncmF0ZSddLT5pZCA6IGZhbHNlOwoKICAgICAgICAgICAgJHB1cmNoYXNlX29yZGVyX2lkID0gW107CiAgICAgICAgICAgICRhbW91bnRzID0gW107CiAgICAgICAgICAgICRwYXltZW50cyA9IFN1cHBsaWVyUGF5bWVudDo6d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+cGF5bWVudF9pZCktPmdldCgpOwogICAgICAgICAgICBpZihpc3NldCgkcGF5bWVudHNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHBheW1lbnRzIGFzICRrZXkgPT4gJHBheW1lbnQpewogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5wYXlfYW1vdW50WyRwYXltZW50LT5pZF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRwYWlkX2Ftb3VudCA9IERCOjp0YWJsZSgnc3VwcGxpZXJfbGVkZ2VycycpLT53aGVyZSgnc3VwcGxpZXJfcGF5bWVudF9pZCcsICRwYXltZW50LT5pZCktPnN1bSgnZGViaXQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGJpbGxfYW1vdW50ID0gKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiID8gJHBheW1lbnQtPnBheV9hbW91bnQgOiAkcGF5bWVudC0+YmlsbF9hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAkZHVlX2Ftb3VudCA9ICRiaWxsX2Ftb3VudC0kcGFpZF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXlfYW1vdW50ID0gJHJlcXVlc3QtPnBheV9hbW91bnRbJHBheW1lbnQtPmlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhdF9hbW91bnQgPSAkcmVxdWVzdC0+dmF0X2Ftb3VudFskcGF5bWVudC0+aWRdOwogICAgICAgICAgICAgICAgICAgICAgICAkdGF4X2Ftb3VudCA9ICRyZXF1ZXN0LT50YXhfYW1vdW50WyRwYXltZW50LT5pZF07CiAgICAgICAgICAgICAgICAgICAgICAgICRnYWluID0gaXNzZXQoJHJlcXVlc3QtPmN1cnJlbmN5X2dhaW5bJHBheW1lbnQtPmlkXSkgPyAkcmVxdWVzdC0+Y3VycmVuY3lfZ2FpblskcGF5bWVudC0+aWRdIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGxvc3MgPSBpc3NldCgkcmVxdWVzdC0+Y3VycmVuY3lfbG9zc1skcGF5bWVudC0+aWRdKSA/ICRyZXF1ZXN0LT5jdXJyZW5jeV9sb3NzWyRwYXltZW50LT5pZF0gOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAkc3lzdGVtX2dhaW4gPSBpc3NldCgkcmVxdWVzdC0+c3lzdGVtX2dhaW5bJHBheW1lbnQtPmlkXSkgPyAkcmVxdWVzdC0+c3lzdGVtX2dhaW5bJHBheW1lbnQtPmlkXSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRzeXN0ZW1fbG9zcyA9IGlzc2V0KCRyZXF1ZXN0LT5zeXN0ZW1fbG9zc1skcGF5bWVudC0+aWRdKSA/ICRyZXF1ZXN0LT5zeXN0ZW1fbG9zc1skcGF5bWVudC0+aWRdIDogMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncGFpZF9hbW91bnQnID0+ICRwYWlkX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdiaWxsX2Ftb3VudCcgPT4gJGJpbGxfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ2R1ZV9hbW91bnQnID0+ICRkdWVfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3BheV9hbW91bnQnID0+ICRwYXlfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3ZhdF9hbW91bnQnID0+ICR2YXRfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3RheF9hbW91bnQnID0+ICR0YXhfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ2dhaW4nID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ2xvc3MnID0+ICRsb3NzLAogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3N5c3RlbV9nYWluJyA9PiAkc3lzdGVtX2dhaW4sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAnc3lzdGVtX2xvc3MnID0+ICRzeXN0ZW1fbG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgLy8gXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRkdWVfYW1vdW50ID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGF5bWVudC0+cGF5X2Ftb3VudCA9ICgkcGF5bWVudC0+YmlsbF90eXBlID09ICJwby1hZHZhbmNlIiA/ICRwYXltZW50LT5wYXlfYW1vdW50IDogJHBheW1lbnQtPmJpbGxfYW1vdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXltZW50LT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyTGVkZ2VyID0gc2F2ZVN1cHBsaWVyTGVkZ2VyKCRwYXltZW50LT5zdXBwbGllcl9pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHBheW1lbnQtPnRyYW5zZWN0aW9uX2RhdGUpKSwgKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiID8gJHBheW1lbnQtPnBheV9hbW91bnQgOiAkcGF5bWVudC0+YmlsbF9hbW91bnQpLCAwLCAkcmVxdWVzdC0+cGF5bWVudF90eXBlLCAkcmVxdWVzdC0+cGF5bWVudF9kZXRhaWxzLCAnU3VwcGxpZXIgUGF5bWVudCA6OiAnLnVjd29yZHMoJHBheW1lbnQtPmJpbGxfdHlwZSksICgkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdjYXNoJyA/IDAgOiAkcmVxdWVzdC0+YmFua19hY2NvdW50X2lkKSwgJHBheW1lbnQtPmlkLCAkZXhjaGFuZ2VSYXRlSWQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXltZW50LT5iaWxsX3R5cGUgPT0gInBvLWFkdmFuY2UiKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJvY2Vzc0FkdmFuY2VQYXltZW50KCRwYXltZW50LCAkcGF5X2Ftb3VudCwgJHJlcXVlc3QtPnBheW1lbnRfdHlwZSwgJHJlcXVlc3QtPmJhbmtfYWNjb3VudF9pZCwgJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQsICRyZXF1ZXN0LT5wYXltZW50X2RldGFpbHMsICR2YXRfYW1vdW50LCAkdGF4X2Ftb3VudCwgJGdhaW4sICRsb3NzLCAkZXhjaGFuZ2VSYXRlSWQsICRyZXF1ZXN0LT5oaWRkZW5fZGF0ZXRpbWUsICRzdXBwbGllckxlZGdlci0+aWQsICRzeXN0ZW1FeGNoYW5nZVJhdGUsICRzeXN0ZW1fZ2FpbiwgJHN5c3RlbV9sb3NzLCAkcmVxdWVzdC0+bmFycmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcm9jZXNzUE9QYXltZW50KCRwYXltZW50LCAkcGF5X2Ftb3VudCwgJHJlcXVlc3QtPnBheW1lbnRfdHlwZSwgJHJlcXVlc3QtPmJhbmtfYWNjb3VudF9pZCwgJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQsIGlzc2V0KCRyZXF1ZXN0LT5hZHZhbmNlX2NsZWFyaW5nc1skcGF5bWVudC0+aWRdKSA/ICRyZXF1ZXN0LT5hZHZhbmNlX2NsZWFyaW5nc1skcGF5bWVudC0+aWRdIDogMCwgaXNzZXQoJHJlcXVlc3QtPmNsZWFyaW5nX2Ftb3VudHNbJHBheW1lbnQtPmlkXSkgPyAkcmVxdWVzdC0+Y2xlYXJpbmdfYW1vdW50c1skcGF5bWVudC0+aWRdIDogMCwgJHJlcXVlc3QtPnBheW1lbnRfZGV0YWlscywgJHZhdF9hbW91bnQsICR0YXhfYW1vdW50LCAkZ2FpbiwgJGxvc3MsICRleGNoYW5nZVJhdGVJZCwgJHJlcXVlc3QtPmhpZGRlbl9kYXRldGltZSwgJHN1cHBsaWVyTGVkZ2VyLT5pZCwgJHN5c3RlbUV4Y2hhbmdlUmF0ZSwgJHN5c3RlbV9nYWluLCAkc3lzdGVtX2xvc3MsICRyZXF1ZXN0LT5uYXJyYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAnUGF5bWVudCBoYXMgYmVlbiBwcm9lc3NlZCBTdWNjZXNzZnVsbHkuJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHByb2Nlc3NBZHZhbmNlUGF5bWVudCgkcGF5bWVudCwgJHBheV9hbW91bnQsICRwYXltZW50X3R5cGUsICRiYW5rX2FjY291bnRfaWQsICRjaGFydF9vZl9hY2NvdW50X2lkLCAkcGF5bWVudF9kZXRhaWxzID0gJycsICR2YXRfYW1vdW50ID0gMCwgJHRheF9hbW91bnQgPSAwLCAkZ2FpbiA9IDAsICRsb3NzID0gMCwgJGV4Y2hhbmdlX3JhdGVfaWQgPSBmYWxzZSwgJGRhdGV0aW1lID0gZmFsc2UsICRzdXBwbGllcl9sZWRnZXJfaWQgPSAwLCAkc3lzdGVtRXhjaGFuZ2VSYXRlID0gZmFsc2UsICRzeXN0ZW1fZ2FpbiA9IDAsICRzeXN0ZW1fbG9zcyA9IDAsICRuYXJyYXRpb24gPSAnJykKICAgIHsKICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoJ2pzb24nKTsKICAgICAgICAkZGViaXRfYWNjb3VudCA9IChpc3NldCgkcGF5bWVudC0+cmVsU3VwcGxpZXItPmFkdmFuY2VfYWNjb3VudF9pZCkgJiYgJHBheW1lbnQtPnJlbFN1cHBsaWVyLT5hZHZhbmNlX2FjY291bnRfaWQgPiAwID8gJHBheW1lbnQtPnJlbFN1cHBsaWVyLT5hZHZhbmNlX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfYWR2YW5jZV9hY2NvdW50J10pOwogICAgICAgICRjcmVkaXRfYWNjb3VudCA9ICRjaGFydF9vZl9hY2NvdW50X2lkOwogICAgICAgIGlmKCRwYXltZW50X3R5cGUgPT0gJ2Nhc2gnKXsKICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2Nhc2hfaW5faGFuZF9hY2NvdW50J107CiAgICAgICAgfWVsc2VpZigkcGF5bWVudF90eXBlID09ICdjaGVxdWUnIHx8ICRwYXltZW50X3R5cGUgPT0gJ2Z1bmQtdHJhbnNmZXInKXsKICAgICAgICAgICAgJGJhbmtBY2NvdW50ID0gQmFua0FjY291bnQ6OmZpbmQoJGJhbmtfYWNjb3VudF9pZCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRiYW5rQWNjb3VudC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCkgJiYgJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkID4gMCl7CiAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2JhbmtfYWNjb3VudCddOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkaXRlbXMgPSBhcnJheShbCiAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGRlYml0X2FjY291bnQsCiAgICAgICAgICAgICdkZWJpdCcgPT4gJHBheV9hbW91bnQrJHZhdF9hbW91bnQrJHRheF9hbW91bnQrKCRnYWluID4gMCA/ICRnYWluIDogMCktKCRsb3NzID4gMCA/ICRsb3NzIDogMCksCiAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdTdXBwbGllciBBZHZhbmNlIFBheW1lbnQgOjogQWR2YW5jZSBEZWJpdCcsCiAgICAgICAgICAgICd0eXBlJyA9PiAnYWR2YW5jZS1wYXltZW50JywKICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgXSxbCiAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNyZWRpdF9hY2NvdW50LAogICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICdjcmVkaXQnID0+ICRwYXlfYW1vdW50LAogICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnU3VwcGxpZXIgQWR2YW5jZSBQYXltZW50IDo6ICcudWN3b3JkcyhzdHJfcmVwbGFjZSgnLScsICcgJywgJHBheW1lbnRfdHlwZSkpLicgQ3JlZGl0JywKICAgICAgICAgICAgJ3R5cGUnID0+ICdhZHZhbmNlLXBheW1lbnQnLAogICAgICAgICAgICAnc291cmNlJyA9PiAkcGF5bWVudC0+aWQKICAgICAgICBdKTsKCiAgICAgICAgaWYoJHZhdF9hbW91bnQgPiAwKXsKICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWyd2YXRfcGF5YWJsZSddLAogICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJHZhdF9hbW91bnQsCiAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnU3VwcGxpZXIgQWR2YW5jZSBQYXltZW50IDo6ICcudWN3b3JkcyhzdHJfcmVwbGFjZSgnLScsICcgJywgJHBheW1lbnRfdHlwZSkpLicgVmF0IENyZWRpdCcsCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2FkdmFuY2UtcGF5bWVudCcsCiAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcGF5bWVudC0+aWQKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBpZigkdGF4X2Ftb3VudCA+IDApewogICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcyxbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1sndGF4X3BheWFibGUnXSwKICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICR0YXhfYW1vdW50LAogICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1N1cHBsaWVyIEFkdmFuY2UgUGF5bWVudCA6OiAnLnVjd29yZHMoc3RyX3JlcGxhY2UoJy0nLCAnICcsICRwYXltZW50X3R5cGUpKS4nIFRheCBDcmVkaXQnLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhZHZhbmNlLXBheW1lbnQnLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCgogICAgICAgIGlmKCRnYWluID4gMCl7CiAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY3VycmVuY3lfZ2Fpbl9sb3NzX2FjY291bnQnXSwKICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRnYWluLAogICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0N1cnJlbmN5IEdhaW4gQ3JlZGl0JywKICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYWR2YW5jZS1wYXltZW50JywKICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwYXltZW50LT5pZAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIGlmKCRsb3NzID4gMCl7CiAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY3VycmVuY3lfZ2Fpbl9sb3NzX2FjY291bnQnXSwKICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0N1cnJlbmN5IExvc3MgRGViaXQnLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhZHZhbmNlLXBheW1lbnQnLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNCwgJGRhdGV0aW1lLCAxLCAnJywgJG5hcnJhdGlvbiwgJGl0ZW1zLCAkZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CiAgICAgICAgc2F2ZVBPRW50cnkoJGVudHJ5LCAkcGF5bWVudC0+c3VwcGxpZXJfaWQsICRwYXltZW50LT5wdXJjaGFzZV9vcmRlcl9pZCwgJ2FkdmFuY2UnKTsKCiAgICAgICAgaWYoJHBheW1lbnRfdHlwZSA9PSAnY2hlcXVlJyl7CiAgICAgICAgICAgIHNhdmVDaGVxdWUoJGJhbmtBY2NvdW50LT5pZCwgJGVudHJ5WydlbnRyeSddWydpZCddLCAkc3VwcGxpZXJfbGVkZ2VyX2lkLCBkYXRlKCdZLW0tZCBIOmk6cycpLCAnYWR2YW5jZS1wYXltZW50JywgJHBheW1lbnRfdHlwZSwgJHBheW1lbnRfZGV0YWlscywgJ0MnLCAkcGF5X2Ftb3VudCwgJG5hcnJhdGlvbik7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+c2F2ZVN5c3RlbUdhaW5Mb3NzKCRwYXltZW50LCAkZGViaXRfYWNjb3VudCwgJGFjY291bnREZWZhdWx0U2V0dGluZ3MsICRkYXRldGltZSwgJGVudHJ5WydlbnRyeSddLT5udW1iZXIsICRuYXJyYXRpb24sICRzeXN0ZW1FeGNoYW5nZVJhdGUsICRzeXN0ZW1fZ2FpbiwgJHN5c3RlbV9sb3NzLCAnYWR2YW5jZScpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzUE9QYXltZW50KCRwYXltZW50LCAkcGF5X2Ftb3VudCwgJHBheW1lbnRfdHlwZSwgJGJhbmtfYWNjb3VudF9pZCwgJGNoYXJ0X29mX2FjY291bnRfaWQsICRhZHZhbmNlX2NsZWFyaW5ncyA9IDAsICRjbGVhcmluZ19hbW91bnRzID0gMCwgJHBheW1lbnRfZGV0YWlscyA9ICcnLCAkdmF0X2Ftb3VudCA9IDAsICR0YXhfYW1vdW50ID0gMCwgJGdhaW4gPSAwLCAkbG9zcyA9IDAsICRleGNoYW5nZV9yYXRlX2lkID0gZmFsc2UsICRkYXRldGltZSA9IGZhbHNlLCAkc3VwcGxpZXJfbGVkZ2VyX2lkID0gMCwgJHN5c3RlbUV4Y2hhbmdlUmF0ZSA9IGZhbHNlLCAkc3lzdGVtX2dhaW4gPSAwLCAkc3lzdGVtX2xvc3MgPSAwLCAkbmFycmF0aW9uID0gJycpCiAgICB7CiAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyk7CgogICAgICAgIGlmKCRhZHZhbmNlX2NsZWFyaW5ncyA9PSAxICYmICRjbGVhcmluZ19hbW91bnRzID4gMCl7CiAgICAgICAgICAgICRhZHZhbmNlUGFpZCA9IEVudHJ5Ojp3aGVyZUhhcygncHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwYXltZW50KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRwYXltZW50LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2FkdmFuY2UnLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0pLT5zdW0oJ2RlYml0Jyk7CiAgICAgICAgICAgIGlmKCRhZHZhbmNlUGFpZCA+IDApewogICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSAoaXNzZXQoJHBheW1lbnQtPnJlbFN1cHBsaWVyLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRwYXltZW50LT5yZWxTdXBwbGllci0+cGF5YWJsZV9hY2NvdW50X2lkID4gMCA/ICRwYXltZW50LT5yZWxTdXBwbGllci0+cGF5YWJsZV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3N1cHBsaWVyX3BheWFibGVfYWNjb3VudCddKTsKICAgICAgICAgICAgICAgICRjcmVkaXRfYWNjb3VudCA9IChpc3NldCgkcGF5bWVudC0+cmVsU3VwcGxpZXItPmFkdmFuY2VfYWNjb3VudF9pZCkgJiYgJHBheW1lbnQtPnJlbFN1cHBsaWVyLT5hZHZhbmNlX2FjY291bnRfaWQgPiAwID8gJHBheW1lbnQtPnJlbFN1cHBsaWVyLT5hZHZhbmNlX2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfYWR2YW5jZV9hY2NvdW50J10pOwoKICAgICAgICAgICAgICAgICRpdGVtcyA9IGFycmF5KFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGRlYml0X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkY2xlYXJpbmdfYW1vdW50cywKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdBZHZhbmNlIENsZWFyaW5nIDo6IFBheWFibGUgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYWR2YW5jZS1jbGVhcmluZycsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNyZWRpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkY2xlYXJpbmdfYW1vdW50cywKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQWR2YW5jZSBDbGVhcmluZyA6OiBBZHZhbmNlIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhZHZhbmNlLWNsZWFyaW5nJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcGF5bWVudC0+aWQKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgJGRhdGV0aW1lLCAxLCAnJywgJG5hcnJhdGlvbiwgJGl0ZW1zLCAkcGF5bWVudC0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkKSwgZmFsc2UsICdqc29uJyk7CiAgICAgICAgICAgICAgICBzYXZlUE9FbnRyeSgkZW50cnksICRwYXltZW50LT5zdXBwbGllcl9pZCwgJHBheW1lbnQtPnB1cmNoYXNlX29yZGVyX2lkLCAnYWR2YW5jZS1jbGVhcmluZycpOwoKICAgICAgICAgICAgICAgIFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBheW1lbnQtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICdiaWxsX3R5cGUnID0+ICdwby1hZHZhbmNlJywKICAgICAgICAgICAgICAgICAgICAnaXNfY2xlYXJlZCcgPT4gMAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAnaXNfY2xlYXJlZCcgPT4gMQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRkZWJpdF9hY2NvdW50ID0gKGlzc2V0KCRwYXltZW50LT5yZWxTdXBwbGllci0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkcGF5bWVudC0+cmVsU3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkcGF5bWVudC0+cmVsU3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSk7CiAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgaWYoJHBheW1lbnRfdHlwZSA9PSAnY2FzaCcpewogICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY2FzaF9pbl9oYW5kX2FjY291bnQnXTsKICAgICAgICB9ZWxzZWlmKCRwYXltZW50X3R5cGUgPT0gJ2NoZXF1ZScgfHwgJHBheW1lbnRfdHlwZSA9PSAnZnVuZC10cmFuc2ZlcicpewogICAgICAgICAgICAkYmFua0FjY291bnQgPSBCYW5rQWNjb3VudDo6ZmluZCgkYmFua19hY2NvdW50X2lkKTsKICAgICAgICAgICAgaWYoaXNzZXQoJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkKSAmJiAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQgPiAwKXsKICAgICAgICAgICAgICAgICRjcmVkaXRfYWNjb3VudCA9ICRiYW5rQWNjb3VudC0+Y2hhcnRfb2ZfYWNjb3VudF9pZDsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFua19hY2NvdW50J107CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRpdGVtcyA9IGFycmF5KFsKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkZGViaXRfYWNjb3VudCwKICAgICAgICAgICAgJ2RlYml0JyA9PiAkcGF5X2Ftb3VudCskdmF0X2Ftb3VudCskdGF4X2Ftb3VudCsoJGdhaW4gPiAwID8gJGdhaW4gOiAwKS0oJGxvc3MgPiAwID8gJGxvc3MgOiAwKSwKICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1N1cHBsaWVyIFBheW1lbnQgOjogUGF5YWJsZSBEZWJpdCcsCiAgICAgICAgICAgICd0eXBlJyA9PiAnc3VwcGxpZXItcGF5bWVudCcsCiAgICAgICAgICAgICdzb3VyY2UnID0+ICRwYXltZW50LT5pZAogICAgICAgIF0sWwogICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRjcmVkaXRfYWNjb3VudCwKICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAnY3JlZGl0JyA9PiAkcGF5X2Ftb3VudCwKICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1N1cHBsaWVyIFBheW1lbnQgOjogJy51Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkcGF5bWVudF90eXBlKSkuJyBDcmVkaXQnLAogICAgICAgICAgICAndHlwZScgPT4gJ3N1cHBsaWVyLXBheW1lbnQnLAogICAgICAgICAgICAnc291cmNlJyA9PiAkcGF5bWVudC0+aWQKICAgICAgICBdKTsKCiAgICAgICAgaWYoJHZhdF9hbW91bnQgPiAwKXsKICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWyd2YXRfcGF5YWJsZSddLAogICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJHZhdF9hbW91bnQsCiAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnU3VwcGxpZXIgUGF5bWVudCA6OiAnLnVjd29yZHMoc3RyX3JlcGxhY2UoJy0nLCAnICcsICRwYXltZW50X3R5cGUpKS4nIFZhdCBDcmVkaXQnLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdzdXBwbGllci1wYXltZW50JywKICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwYXltZW50LT5pZAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIGlmKCR0YXhfYW1vdW50ID4gMCl7CiAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1sndGF4X3BheWFibGUnXSwKICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICR0YXhfYW1vdW50LAogICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1N1cHBsaWVyIFBheW1lbnQgOjogJy51Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkcGF5bWVudF90eXBlKSkuJyBUYXggQ3JlZGl0JywKICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnc3VwcGxpZXItcGF5bWVudCcsCiAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkcGF5bWVudC0+aWQKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBpZigkZ2FpbiA+IDApewogICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N1cnJlbmN5X2dhaW5fbG9zc19hY2NvdW50J10sCiAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdDdXJyZW5jeSBHYWluIENyZWRpdCcsCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3N1cHBsaWVyLXBheW1lbnQnLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgaWYoJGxvc3MgPiAwKXsKICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHBheW1lbnQtPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjdXJyZW5jeV9nYWluX2xvc3NfYWNjb3VudCddLAogICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkbG9zcywKICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQ3VycmVuY3kgTG9zcyBEZWJpdCcsCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3N1cHBsaWVyLXBheW1lbnQnLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNCwgJGRhdGV0aW1lLCAxLCAnJywgJG5hcnJhdGlvbiwgJGl0ZW1zLCAgJGV4Y2hhbmdlX3JhdGVfaWQsIDAsIDAsIDAsIGdldENvc3RDZW50cmVDb21wYW55KCRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCksIGZhbHNlLCAnanNvbicpOwogICAgICAgIHNhdmVQT0VudHJ5KCRlbnRyeSwgJHBheW1lbnQtPnN1cHBsaWVyX2lkLCAkcGF5bWVudC0+cHVyY2hhc2Vfb3JkZXJfaWQsICdzdXBwbGllci1wYXltZW50Jyk7CgogICAgICAgIGlmKCRwYXltZW50X3R5cGUgPT0gJ2NoZXF1ZScpewogICAgICAgICAgICBzYXZlQ2hlcXVlKCRiYW5rQWNjb3VudC0+aWQsICRlbnRyeVsnZW50cnknXVsnaWQnXSwgJHN1cHBsaWVyX2xlZGdlcl9pZCwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgJ3BheW1lbnQnLCAkcGF5bWVudF90eXBlLCAkcGF5bWVudF9kZXRhaWxzLCAnQycsICgkcGF5X2Ftb3VudCskdmF0X2Ftb3VudCskdGF4X2Ftb3VudCksICRuYXJyYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPnNhdmVTeXN0ZW1HYWluTG9zcygkcGF5bWVudCwgJGRlYml0X2FjY291bnQsICRhY2NvdW50RGVmYXVsdFNldHRpbmdzLCAkZGF0ZXRpbWUsICRlbnRyeVsnZW50cnknXS0+bnVtYmVyLCAkbmFycmF0aW9uLCAkc3lzdGVtRXhjaGFuZ2VSYXRlLCAkc3lzdGVtX2dhaW4sICRzeXN0ZW1fbG9zcywgJ3N1cHBsaWVyLXBheW1lbnQnKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2F2ZVN5c3RlbUdhaW5Mb3NzKCRwYXltZW50LCAkZGViaXRfYWNjb3VudCwgJGFjY291bnREZWZhdWx0U2V0dGluZ3MsICRkYXRldGltZSwgJG51bWJlciwgJG5hcnJhdGlvbiwgJHN5c3RlbUV4Y2hhbmdlUmF0ZSwgJHN5c3RlbV9nYWluLCAkc3lzdGVtX2xvc3MsICR0eXBlKQogICAgewogICAgICAgIGlmKCRzeXN0ZW1FeGNoYW5nZVJhdGUgJiYgKCRzeXN0ZW1fZ2FpbiA+IDAgfHwgJHN5c3RlbV9sb3NzID4gMCkpewogICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgaWYoJHN5c3RlbV9nYWluID4gMCl7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZWJpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHN5c3RlbV9nYWluLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0N1cnJlbmN5IEdhaW4gRGViaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnc3VwcGxpZXItcGF5bWVudCcsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRwYXltZW50LT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N1cnJlbmN5X2dhaW5fbG9zc19hY2NvdW50J10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRzeXN0ZW1fZ2FpbiwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQ3VycmVuY3kgR2FpbiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnc3VwcGxpZXItcGF5bWVudCcsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJHN5c3RlbV9sb3NzID4gMCl7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBhcnJheShbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjdXJyZW5jeV9nYWluX2xvc3NfYWNjb3VudCddLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHN5c3RlbV9sb3NzLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0N1cnJlbmN5IExvc3MgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnc3VwcGxpZXItcGF5bWVudCcsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHBheW1lbnQtPmlkCiAgICAgICAgICAgICAgICBdLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZWJpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkc3lzdGVtX2xvc3MsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0N1cnJlbmN5IExvc3MgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ3N1cHBsaWVyLXBheW1lbnQnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRwYXltZW50LT5pZAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKDQsICRkYXRldGltZSwgMSwgJG51bWJlciwgJG5hcnJhdGlvbiwgJGl0ZW1zLCAkc3lzdGVtRXhjaGFuZ2VSYXRlLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkcGF5bWVudC0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQpLCBmYWxzZSwgJ2pzb24nKTsKICAgICAgICAgICAgc2F2ZVBPRW50cnkoJGVudHJ5LCAkcGF5bWVudC0+c3VwcGxpZXJfaWQsICRwYXltZW50LT5wdXJjaGFzZV9vcmRlcl9pZCwgJHR5cGUpOwogICAgICAgIH0KICAgIH0KfQo=