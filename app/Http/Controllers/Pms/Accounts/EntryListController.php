<?php
bolt_decrypt( __FILE__ , 'jkf78V'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEFjY291bnRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyTGVkZ2VyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk7CnVzZSBEQjsKdXNlIEF1dGg7CnVzZSBBcHA7CnVzZSBEYXRhVGFibGVzOwoKY2xhc3MgRW50cnlMaXN0Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKeyAgIAogICAgLyoqCiAgICAgKiBTZXQgZ2xvYmFsIGRhdGEgdGFibGUgaGVhZGVycy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhlYWRlckNvbHVtbnMKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICAkcm93cyA9ICBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ3BvX2RhdGUnLCAncG9fZGF0ZSddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nXSwKICAgICAgICAgICAgWydzdXBwbGllcnMnLCAnc3VwcGxpZXJzJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3F1b3RhdGlvbl9yZWZfbm8nLCAncXVvdGF0aW9uX3JlZl9ubycsICd0ZXh0LWxlZnQnXSwgCiAgICAgICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ3RvdGFsX3ByaWNlJywgJ3RvdGFsX3ByaWNlJywgJ3RleHQtcmlnaHQnXSwgCiAgICAgICAgICAgIFsndmF0JywgJ3ZhdCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnZ3Jvc3NfcHJpY2UnLCAnZ3Jvc3NfcHJpY2UnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRyb3dzOwogICAgfQogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsUXVvdGF0aW9uJywncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlckVudHJpZXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPXB1cmNoYXNlX29yZGVyX2VudHJpZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRwdXJjaGFzZU9yZGVyKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnZC1NLVknLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWxpbmsgc2hvd1BPRGV0YWlscyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCR2YWx1ZXMtPmlkKS4nIj4nLiR2YWx1ZXMtPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVycycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24pID8gKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lLicgKCcuJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5LiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubzonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleS4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjdXJyZW5jeScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUpPyR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZTonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScuJGtleS4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3RvdGFsX3ByaWNlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbURvdWJsZVZhbHVlKCR2YWx1ZXMtPnRvdGFsX3ByaWNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Eb3VibGVWYWx1ZSgkdmFsdWVzLT52YXQsIDIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtRG91YmxlVmFsdWUoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UsIDIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLmFjY291bnRzLnBvLndpc2UuZW50cnkuc2hvdycsJHZhbHVlcy0+aWQpLicvcHJpbnQiICB0aXRsZT0iUHJpbnQgQWxsIFRyYW5zYWN0aW9ucyIgY2xhc3M9ImJ0biBtYi0xIGJ0bi14cyBidG4tc3VjY2VzcyI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPlByaW50PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgdGFyZ2V0PSJfX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYWNjb3VudHMucG8ud2lzZS5lbnRyeS5zaG93JywkdmFsdWVzLT5pZCkuJyIgIHRpdGxlPSJFbnRyeSBMaXN0IiBjbGFzcz0iYnRuIG1iLTEgYnRuLXhzIGJ0bi1pbmZvIj48aSBjbGFzcz0ibGFyIGxhLXBsdXMtc3F1YXJlIj48L2k+RW50cmllczwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2RhdGUnLCAncmVmZXJlbmNlX25vJywgJ3RvdGFsX3ByaWNlJywgJ3ZhdCcsICdncm9zc19wcmljZScsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnUHVyY2hhc2UgT3JkZXIgV2lzZSBFbnRyeSBMaXN0JywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLnBvLXdpc2UtZW50cnktbGlzdCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICAgcHVibGljIGZ1bmN0aW9uIHBvV2lzZUVudHJ5TGlzdCgkaWQpCiAgICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRlbnRyeUxpc3QgPSBQdXJjaGFzZU9yZGVyRW50cnk6OndpdGgoWwogICAgICAgICAgICAgICAgJ2VudHJ5Lml0ZW1zLmNoYXJ0T2ZBY2NvdW50JywKICAgICAgICAgICAgICAgICdlbnRyeS5lbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgJ2VudHJ5LmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkaWQpCiAgICAgICAgICAgIC0+b3JkZXJCeSgnaWQnLCAnZGVzYycpCiAgICAgICAgICAgIC0+cGFnaW5hdGUoMTAwKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRW50cnkgTGlzdCcsCiAgICAgICAgICAgICAgICAnZW50cnlMaXN0JyA9PiAkZW50cnlMaXN0LAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmFjY291bnRzLmVudHJ5LWxpc3QnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBwb1dpc2VFbnRyeUxpc3RQcmludCgkaWQpCiAgICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlckVudHJpZXMuZW50cnkuaXRlbXMuY2hhcnRPZkFjY291bnQnLAogICAgICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXJFbnRyaWVzLmVudHJ5Lml0ZW1zLmNvc3RDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlckVudHJpZXMuZW50cnkuZW50cnlUeXBlJywKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyRW50cmllcy5lbnRyeS5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkdGl0bGUgPSAnUHVyY2hhc2UgT3JkZXIgVHJhbnNhY3Rpb25zICMnLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm87CiAgICAgICAgICAgIHJldHVybiB2aWV3TVBERigncG1zLmJhY2tlbmQucGFnZXMuYWNjb3VudHMuZW50cnktbGlzdC1wcmludCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ3N5c3RlbUN1cnJlbmN5JyA9PiBzeXN0ZW1DdXJyZW5jeSgpLAogICAgICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXInID0+ICRwdXJjaGFzZU9yZGVyLAogICAgICAgICAgICBdLCAkdGl0bGUsICR0aXRsZSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3Igc3VwcGxpZXJXaXNlRW50cnlMaXN0IGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc3VwcGxpZXJXaXNlRW50cnlMaXN0KCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGZyb21fZGF0ZSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tX2RhdGUnKSAmJiAhZW1wdHkocmVxdWVzdCgpLT5nZXQoJ2Zyb21fZGF0ZScpKSA/IGRhdGUoIlktbS1kIiwgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tX2RhdGUnKSkpIDogZGF0ZSgiWS1tLWQiLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLTAxJykpKTsKICAgICAgICAgICAgJHRvX2RhdGUgPSByZXF1ZXN0KCktPmhhcygndG9fZGF0ZScpICYmICFlbXB0eShyZXF1ZXN0KCktPmdldCgndG9fZGF0ZScpKSA/IGRhdGUoIlktbS1kIiwgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0b19kYXRlJykpKSA6IGRhdGUoIlktbS1kIiwgc3RydG90aW1lKGRhdGUoJ1ktbS10JykpKTsKICAgICAgICAgICAgJHN1cHBsaWVyX2lkID0gcmVxdWVzdCgpLT5oYXMoJ3N1cHBsaWVyX2lkJykgPyByZXF1ZXN0KCktPmdldCgnc3VwcGxpZXJfaWQnKSA6IG51bGw7CiAgICAgICAgICAgICRzZWxlY3RlZF9zdXBwbGllciA9IFN1cHBsaWVyczo6ZmluZCgkc3VwcGxpZXJfaWQpOwoKICAgICAgICAgICAgJHN1cHBsaWVycyA9IFN1cHBsaWVyczo6d2hlcmUoJ3N0YXR1cycsICdBY3RpdmUnKQogICAgICAgICAgICAtPmhhcygncmVsUXVvdGF0aW9ucy5yZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJFbnRyaWVzJykKICAgICAgICAgICAgLT5nZXQoWydpZCcsICduYW1lJ10pOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsncmVsUXVvdGF0aW9uJywncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncHVyY2hhc2VPcmRlckVudHJpZXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPXB1cmNoYXNlX29yZGVyX2VudHJpZXMucHVyY2hhc2Vfb3JkZXJfaWQnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRzdXBwbGllcl9pZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHN1cHBsaWVyX2lkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlQmV0d2VlbigncG9fZGF0ZScsIFskZnJvbV9kYXRlLCAkdG9fZGF0ZV0pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcHVyY2hhc2VPcmRlcikKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwb19kYXRlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ2QtTS1ZJywgc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBjbGFzcz0iYnRuIGJ0bi1saW5rIHNob3dQT0RldGFpbHMiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkdmFsdWVzLT5pZCkuJyI+Jy4kdmFsdWVzLT5yZWZlcmVuY2Vfbm8uJzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcnMnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uKSA/IChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZS4nICgnLiR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5jb2RlLicpJyA6ICcnKSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleS4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubyk/JHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWZlcmVuY2Vfbm86Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXkuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU6Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXkuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0b3RhbF9wcmljZScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Eb3VibGVWYWx1ZSgkdmFsdWVzLT50b3RhbF9wcmljZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd2YXQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtRG91YmxlVmFsdWUoJHZhbHVlcy0+dmF0LCAyKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2dyb3NzX3ByaWNlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbURvdWJsZVZhbHVlKCR2YWx1ZXMtPmdyb3NzX3ByaWNlLCAyKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5hY2NvdW50cy5wby53aXNlLmVudHJ5LnNob3cnLCR2YWx1ZXMtPmlkKS4nL3ByaW50IiAgdGl0bGU9IlByaW50IEFsbCBUcmFuc2FjdGlvbnMiIGNsYXNzPSJidG4gbWItMSBidG4teHMgYnRuLXN1Y2Nlc3MiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT5QcmludDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLmFjY291bnRzLnBvLndpc2UuZW50cnkuc2hvdycsJHZhbHVlcy0+aWQpLiciICB0aXRsZT0iRW50cnkgTGlzdCIgY2xhc3M9ImJ0biBtYi0xIGJ0bi14cyBidG4taW5mbyI+PGkgY2xhc3M9ImxhciBsYS1wbHVzLXNxdWFyZSI+PC9pPkVudHJpZXM8L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydkYXRlJywgJ3JlZmVyZW5jZV9ubycsICd0b3RhbF9wcmljZScsICd2YXQnLCAnZ3Jvc3NfcHJpY2UnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1N1cHBsaWVyIFdpc2UgRW50cnkgTGlzdCcsCiAgICAgICAgICAgICAgICAnZnJvbV9kYXRlJyA9PiAkZnJvbV9kYXRlLAogICAgICAgICAgICAgICAgJ3RvX2RhdGUnID0+ICR0b19kYXRlLAogICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiAkc3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAnY2hvb3NlU3VwcGxpZXJzJyA9PiAkc3VwcGxpZXJzLAogICAgICAgICAgICAgICAgJ3NlbGVjdGVkX3N1cHBsaWVyJyA9PiAkc2VsZWN0ZWRfc3VwcGxpZXIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5hY2NvdW50cy5zdXBwbGllci13aXNlLWVudHJ5LWxpc3QnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==