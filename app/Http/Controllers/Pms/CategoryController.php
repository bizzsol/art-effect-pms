<?php
bolt_decrypt( __FILE__ , 'Uegi0F'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSW1wb3J0c1xDYXRlZ29yeUltcG9ydDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UeXBlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5RGVwYXJ0bWVudDsKdXNlIEFwcFxNb2RlbHNcSHJcRGVwYXJ0bWVudDsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgSWxsdW1pbmF0ZVxWYWxpZGF0aW9uXFJ1bGU7CnVzZSBNYWF0d2Vic2l0ZVxFeGNlbFxGYWNhZGVzXEV4Y2VsOwp1c2UgREIsIERhdGFUYWJsZXM7CgpjbGFzcyBDYXRlZ29yeUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydjb2RlJywgJ2NvZGUnXSwKICAgICAgICAgICAgWyduYW1lJywgJ25hbWUnXSwKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnXSwKICAgICAgICAgICAgWydwcm9kdWN0X3R5cGUnLCAncHJvZHVjdF90eXBlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndHlwZScsICd0eXBlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc2VydmljZScsICdzZXJ2aWNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc2FsZV9pdGVtJywgJ3NhbGVfaXRlbScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdDYXRlZ29yeSc7CiAgICAgICAgICAgICRpc19maXhlZF9hc3NldCA9IHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKTsKICAgICAgICAgICAgJGlzX2N3aXAgPSByZXF1ZXN0KCktPmhhcygnY3dpcCcpOwoKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6ZG9lc250SGF2ZSgnY2F0ZWdvcnknKQogICAgICAgICAgICAtPndpdGgoWydjYXRlZ29yeScsICdkZXBhcnRtZW50c0xpc3QnLCAnZGVwYXJ0bWVudHNMaXN0LmRlcGFydG1lbnQnXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnY29kZScsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoJGNhdGVnb3JpZXMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24oJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICAkZGVwYXJ0bWVudCA9ICcnOwoKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjYXRlZ29yeS0+ZGVwYXJ0bWVudHNMaXN0IGFzICR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgICAgICAkZGVwYXJ0bWVudCAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj48c3BhbiBjbGFzcz0ibS0xIGJhZGdlIGJhZGdlLXByaW1hcnkiPicuKGlzc2V0KCR2YWx1ZXMtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSk/JHZhbHVlcy0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lOicnKS4nPC9zcGFuPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGRlcGFydG1lbnQ7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdkZXBhcnRtZW50c0xpc3QuZGVwYXJ0bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2RlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDYXRlZ29yeURlcGFydG1lbnQ6OnNlbGVjdCgnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2hyX2RlcGFydG1lbnQnLCAnaHJfZGVwYXJ0bWVudC5ocl9kZXBhcnRtZW50X2lkJywgJz0nLCAnY2F0ZWdvcmllc19kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjYXRlZ29yaWVzX2RlcGFydG1lbnQuY2F0ZWdvcnlfaWQnLCAnY2F0ZWdvcmllcy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfdHlwZScsIGZ1bmN0aW9uICgkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0ID09IDEgPyAnRml4ZWQgQXNzZXQnIDogKCRjYXRlZ29yeS0+aXNfY3dpcCA9PSAxID8gJ0NXSVAnIDogKCRjYXRlZ29yeS0+aXNfc2FsZV9pdGVtID09IDEgPyAiU2FsZSBJdGVtIiA6ICdQcm9kdWN0cycpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3R5cGUnLCBmdW5jdGlvbiAoJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdWN3b3JkcygkY2F0ZWdvcnktPnR5cGUpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzZXJ2aWNlJywgZnVuY3Rpb24gKCRjYXRlZ29yeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRjYXRlZ29yeS0+aXNfc2VydmljZSA9PSAxID8gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5ZZXM8L2E+JyA6ICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Tm88L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc2FsZV9pdGVtJywgZnVuY3Rpb24gKCRjYXRlZ29yeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRjYXRlZ29yeS0+aXNfc2FsZV9pdGVtID09IDEgPyAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPlllczwvYT4nIDogJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj5ObzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICR1cmwgPSByb3V0ZSgncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5jYXRlZ29yeS5lZGl0JywgJGNhdGVnb3J5LT5pZCk7CiAgICAgICAgICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ2ZpeGVkLWFzc2V0cycpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHVybCA9IHVybCgncG1zL2ZpeGVkLWFzc2V0cy9jYXRlZ29yeS9lZGl0LycuJGNhdGVnb3J5LT5pZC4nP2ZpeGVkLWFzc2V0cycpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlaWYocmVxdWVzdCgpLT5oYXMoJ2N3aXAnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9jd2lwL2NhdGVnb3J5LycuJGNhdGVnb3J5LT5pZC4nL2VkaXQ/Y3dpcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWluZm8gcm91bmRlZC1jaXJjbGUgbS0xIiBocmVmPSInLiR1cmwuJyI+PGkgY2xhc3M9ImxhIGxhLWVkaXQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIG0tMSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wcm9kdWN0LW1hbmFnZW1lbnQuY2F0ZWdvcnkuZGVzdHJveScsICRjYXRlZ29yeS0+aWQpLiciIG9uY2xpY2s9ImRlbGV0ZUZyb21DUlVEKCQodGhpcykpIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2RlcGFydG1lbnQnLCAnYWN0aW9ucycsICdzZXJ2aWNlJywgJ3NhbGVfaXRlbSddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuY2F0ZWdvcnkuaW5kZXgnLFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4kdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgICAgICdpc19maXhlZF9hc3NldCcgPT4gJGlzX2ZpeGVkX2Fzc2V0LAogICAgICAgICAgICAgICAgJ2lzX2N3aXAnID0+ICRpc19jd2lwLAogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygndXBkYXRlLWNhdGVnb3J5LWRlcGFydG1lbnRzJykpewogICAgICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpLT5kb2VzbnRIYXZlKCdkZXBhcnRtZW50c0xpc3QnKS0+Z2V0KCk7CiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IERlcGFydG1lbnQ6OmFsbCgpOwogICAgICAgICAgICBpZigkY2F0ZWdvcmllcy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkY2F0ZWdvcmllcyBhcyAkY2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgICRjYXRlZ29yeS0+ZGVwYXJ0bWVudCgpLT5zeW5jKCRkZXBhcnRtZW50cy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHRpdGxlID0gJ0NhdGVnb3J5IEFkZCc7CgogICAgICAgICRjb2RlID0gdW5pcXVlQ29kZSg3LCdDVC0nLCdjYXRlZ29yaWVzJywnaWQnKTsKICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb25UeXBlOjphbGwoKTsKICAgICAgICAkZGVwYXJ0bWVudHMgPSBEZXBhcnRtZW50OjphbGwoKTsKCiAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyk7CiAgICAgICAgJGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMgPSBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCBbXSk7CiAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmNhdGVnb3J5LmNyZWF0ZScsIGNvbXBhY3QoJ3RpdGxlJywncmVxdWlzaXRpb25zJywnZGVwYXJ0bWVudHMnLCdjb2RlJywgJ2FjY291bnREZWZhdWx0U2V0dGluZ3MnLCAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY29kZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NScsICd1bmlxdWU6Y2F0ZWdvcmllcyddLAogICAgICAgICAgICAnbmFtZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAndHlwZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAncGFyZW50JyA9PiBbJ251bGxhYmxlJywgJ2ludGVnZXInXSwKICAgICAgICAgICAgJ2hyX2RlcGFydG1lbnRfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgJ3Byb2R1Y3RfdHlwZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgLy8gJ3JlcXVpc2l0aW9uX3R5cGVfaWQnID0+IFsncmVxdWlyZWQnLCAnaW50ZWdlciddLAogICAgICAgIF0pOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkaW5wdXRzID0gJHJlcXVlc3QtPmFsbCgpOwogICAgICAgICAgICBpZigkcmVxdWVzdC0+cHJvZHVjdF90eXBlID09ICdwcm9kdWN0cycpewogICAgICAgICAgICAgICAgJGlucHV0c1snaXNfZml4ZWRfYXNzZXQnXSA9IDA7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19jd2lwJ10gPSAwOwogICAgICAgICAgICB9ZWxzZWlmKCRyZXF1ZXN0LT5wcm9kdWN0X3R5cGUgPT0gJ2ZpeGVkX2Fzc2V0Jyl7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19maXhlZF9hc3NldCddID0gMTsKICAgICAgICAgICAgICAgICRpbnB1dHNbJ2lzX2N3aXAnXSA9IDA7CiAgICAgICAgICAgIH1lbHNlaWYoJHJlcXVlc3QtPnByb2R1Y3RfdHlwZSA9PSAnY3dpcCcpewogICAgICAgICAgICAgICAgJGlucHV0c1snaXNfZml4ZWRfYXNzZXQnXSA9IDA7CiAgICAgICAgICAgICAgICAkaW5wdXRzWydpc19jd2lwJ10gPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1bnNldCgkaW5wdXRzWydfdG9rZW4nXSk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ19tZXRob2QnXSk7CgogICAgICAgICAgICAkY2F0ZWdvcnk9Q2F0ZWdvcnk6OmNyZWF0ZSgkaW5wdXRzKTsKCiAgICAgICAgICAgICRkZXBhcnRtZW50cz0kcmVxdWVzdC0+aHJfZGVwYXJ0bWVudF9pZDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5kZXBhcnRtZW50KCktPnN5bmMoJGRlcGFydG1lbnRzKTsKCiAgICAgICAgICAgIC8vcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnQ2F0ZWdvcnkgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LmNhdGVnb3J5LmluZGV4Jyk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVybFJlZGlyZWN0QmFjaygnQ2F0ZWdvcnkgY3JlYXRlZCBzdWNjZXNzZnVsbHknLCAncG1zL3Byb2R1Y3QtbWFuYWdlbWVudC9jYXRlZ29yeScsICdzdWNjZXNzJyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3coQ2F0ZWdvcnkgJGNhdGVnb3J5KQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAkY2F0ZWdvcnktPnBhcmVudF9pZCA9ICEkY2F0ZWdvcnktPmNhdGVnb3J5P251bGw6JGNhdGVnb3J5LT5jYXRlZ29yeTsKICAgICAgICAgICAgJGFycmF5PVtdOwogICAgICAgICAgICBmb3JlYWNoKCRjYXRlZ29yeS0+ZGVwYXJ0bWVudHNMaXN0IGFzICRrZXkgPT4gJGRlcGFydG1lbnQpewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksJGRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkbmV3X2FycmF5PVtdOwoKICAgICAgICAgICAgZm9yZWFjaChEZXBhcnRtZW50Ojp3aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywkYXJyYXkpLT5zZWxlY3QoJ2hyX2RlcGFydG1lbnRfaWQnKS0+Z2V0KCkgYXMgJHZhbHVlcyl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRuZXdfYXJyYXksICR2YWx1ZXMtPmhyX2RlcGFydG1lbnRfaWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0NhdGVnb3J5IEVkaXQnLAogICAgICAgICAgICAgICAgJ2NhdGVnb3J5JyA9PiAkY2F0ZWdvcnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNJZCcgPT4gRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsJGFycmF5KS0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+YWxsKCksCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zJyA9PiBSZXF1aXNpdGlvblR5cGU6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiBEZXBhcnRtZW50OjphbGwoKSwKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCdqc29uJyksCiAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCwgMCwgW10pLAogICAgICAgICAgICBdOwoKICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuY2F0ZWdvcnkuZWRpdCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IHRoZSBmb3JtIGZvciBlZGl0aW5nIHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6d2l0aChbCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNMaXN0JwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkY2F0ZWdvcnktPnBhcmVudF9pZCA9ICEkY2F0ZWdvcnktPmNhdGVnb3J5P251bGw6JGNhdGVnb3J5LT5jYXRlZ29yeTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnQ2F0ZWdvcnkgRWRpdCcsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnknID0+ICRjYXRlZ29yeSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50c0lkJyA9PiAkY2F0ZWdvcnktPmRlcGFydG1lbnRzTGlzdC0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9ucycgPT4gUmVxdWlzaXRpb25UeXBlOjphbGwoKSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gRGVwYXJ0bWVudDo6YWxsKCksCiAgICAgICAgICAgICAgICAnYWNjb3VudERlZmF1bHRTZXR0aW5ncycgPT4gYWNjb3VudERlZmF1bHRTZXR0aW5ncygnanNvbicpLAogICAgICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50c09wdGlvbnMnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sIDAsIDAsIFtdKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmNhdGVnb3J5LmVkaXQnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsIENhdGVnb3J5ICRjYXRlZ29yeSkKICAgIHsKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ2NvZGUnID0+IFsncmVxdWlyZWQnLCAnc3RyaW5nJywgJ21heDoyNTUnLCBSdWxlOjp1bmlxdWUoJ2NhdGVnb3JpZXMnKS0+aWdub3JlKCRjYXRlZ29yeS0+aWQpXSwKICAgICAgICAgICAgJ25hbWUnID0+IFsncmVxdWlyZWQnLCAnc3RyaW5nJywgJ21heDoyNTUnXSwKICAgICAgICAgICAgJ3R5cGUnID0+IFsncmVxdWlyZWQnLCAnc3RyaW5nJywgJ21heDoyNTUnXSwKICAgICAgICAgICAgJ3BhcmVudF9pZCcgPT4gWydudWxsYWJsZScsICdpbnRlZ2VyJ10sCiAgICAgICAgICAgIC8vICdyZXF1aXNpdGlvbl90eXBlX2lkJyA9PiBbJ3JlcXVpcmVkJywgJ2ludGVnZXInXSwKICAgICAgICBdKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkaW5wdXRzID0gJHJlcXVlc3QtPmFsbCgpOwogICAgICAgICAgICB1bnNldCgkaW5wdXRzWydfdG9rZW4nXSk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ19tZXRob2QnXSk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+dXBkYXRlKCRpbnB1dHMpOwoKICAgICAgICAgICAgJGRlcGFydG1lbnRzPSRyZXF1ZXN0LT5ocl9kZXBhcnRtZW50X2lkOwogICAgICAgICAgICAkY2F0ZWdvcnktPmRlcGFydG1lbnQoKS0+c3luYygkZGVwYXJ0bWVudHMpOwoKICAgICAgICAgICAgCiAgICAgICAgICAgICRzdWJDYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndoZXJlKCdwYXJlbnRfaWQnLCAkY2F0ZWdvcnktPmlkKS0+Z2V0KCk7CiAgICAgICAgICAgICRkZXBhcnRtZW50cyA9IENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCktPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgaWYoaXNzZXQoJHN1YkNhdGVnb3JpZXNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHN1YkNhdGVnb3JpZXMgYXMgJGtleSA9PiAkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgICRzdWJDYXRlZ29yeS0+ZGVwYXJ0bWVudCgpLT5zeW5jKCRkZXBhcnRtZW50cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnQ2F0ZWdvcnkgdXBkYXRlZCBzdWNjZXNzZnVsbHknLCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LmNhdGVnb3J5LmluZGV4Jyk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVybFJlZGlyZWN0QmFjaygnQ2F0ZWdvcnkgdXBkYXRlZCBzdWNjZXNzZnVsbHknLCAgJ3Btcy9wcm9kdWN0LW1hbmFnZW1lbnQvY2F0ZWdvcnknLCAnc3VjY2VzcycpOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBmcm9tIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KENhdGVnb3J5ICRjYXRlZ29yeSkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgaWYgKCRjYXRlZ29yeS0+c3ViQ2F0ZWdvcnktPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ0NhdGVnb3J5IGNhbiBub3QgYmUgZGVsZXRlZC4nCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNhdGVnb3J5LT5zdWJDYXRlZ29yeS0+ZWFjaC0+ZGVsZXRlKCk7CiAgICAgICAgICAgIENhdGVnb3J5RGVwYXJ0bWVudDo6d2hlcmUoJ2NhdGVnb3J5X2lkJywgJGNhdGVnb3J5LT5pZCktPmRlbGV0ZSgpOwogICAgICAgICAgICAkY2F0ZWdvcnktPmRlbGV0ZSgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnQ2F0ZWdvcnkgU3VjY2Vzc2Z1bGx5IERlbGV0ZWQuJwogICAgICAgICAgICBdKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIGltcG9ydENhdGVnb3J5KFJlcXVlc3QgJHJlcXVlc3QpewoKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ2NhdGVnb3J5X2ZpbGUnID0+ICdyZXF1aXJlZHxtaW1lczp4bHMseGxzeCcKICAgICAgICBdKTsKCiAgICAgICAgJHBhdGggPSAkcmVxdWVzdC0+ZmlsZSgnY2F0ZWdvcnlfZmlsZScpLT5nZXRSZWFsUGF0aCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBFeGNlbDo6aW1wb3J0KG5ldyBDYXRlZ29yeUltcG9ydCgpLCAkcGF0aCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnQ2F0ZWdvcnkgRGF0YSBJbXBvcnRlZCBzdWNjZXNzZnVsbHkuJyk7CgogICAgICAgIH1jYXRjaCAoXE1hYXR3ZWJzaXRlXEV4Y2VsXFZhbGlkYXRvcnNcVmFsaWRhdGlvbkV4Y2VwdGlvbiAkZSkgewoKICAgICAgICAgICAgJGVycm9yTWVzc2FnZT0nJzsKICAgICAgICAgICAgJHJvd051bWJlcj0xOwogICAgICAgICAgICAkcm93TnVtYmVyKz0kZS0+ZmFpbHVyZXMoKVswXS0+cm93KCk7CiAgICAgICAgICAgICRjb2x1bW49JGUtPmZhaWx1cmVzKClbMF0tPmF0dHJpYnV0ZSgpOwoKICAgICAgICAgICAgJGVycm9yTWVzc2FnZS49JGUtPmZhaWx1cmVzKClbMF0tPmVycm9ycygpWzBdLicgZm9yIHJvdyAnLiRyb3dOdW1iZXIuJyBvbiBDb2x1bW4gJy4kY29sdW1uOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCRlcnJvck1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KfQo=