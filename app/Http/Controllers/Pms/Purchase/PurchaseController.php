<?php
bolt_decrypt( __FILE__ , '4ZWBpi'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXFB1cmNoYXNlOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcTWFpbFxQbXNcUHVyY2hhc2VPcmRlck1haWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmZwXFJlcXVlc3RQcm9wb3NhbERldGFpbHM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsRGVmaW5lU3VwcGxpZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xRdW90YXRpb25zOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uc0l0ZW1zOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50VGVybTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHJhY2tpbmc7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbkl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeVR5cGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7CnVzZSBBcHBcTW9kZWxzXEhyXFVuaXQ7CnVzZSBBcHBcTW9kZWxzXEhyXERlcGFydG1lbnQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKCnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXE1haWw7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWaWV3Owp1c2UgREI7CnVzZSBQREYsIERhdGFUYWJsZXM7CgpjbGFzcyBQdXJjaGFzZUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2FwcHJvdmFsX2RhdGUnLCAnYXBwcm92YWxfZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdXBwbGllcicsICdzdXBwbGllcicsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydxdW90YXRpb25fcmVmX25vJywgJ3F1b3RhdGlvbl9yZWZfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyd0b3RhbF9wcmljZScsICd0b3RhbF9wcmljZScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsndmF0JywgJ3ZhdCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnZ3Jvc3NfcHJpY2UnLCAnZ3Jvc3NfcHJpY2UnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlcicsICd3aWR0aDoxNSUnXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnUHVyY2hhc2UgT3JkZXInOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlckxpc3QgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAncmVsU3VwcGxpZXJQYXltZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCduYW1lJywgaWdub3JlU3VwcGxpZXJzKCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdBdWRpdCcsICdCaWxsaW5nJywgJ01hbmFnZW1lbnQnLCAnQWNjb3VudHMnXSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Fzc2lnbmVkX3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ3R5cGUnLCBbJ2RpcmVjdC1wdXJjaGFzZSddKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUluKCdpc19zZW5kJywgWydubycsICd5ZXMnXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgICRvcHRpb25zID0gWwogICAgICAgICAgICAgICAgJ3NlbmQtcG8tdG8tc3VwcGxpZXInID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3NlbmQtcG8tdG8tc3VwcGxpZXInKSwKICAgICAgICAgICAgICAgICdwby1jYW5jZWwnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3BvLWNhbmNlbCcpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJHB1cmNoYXNlT3JkZXJMaXN0KQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZhbF9kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhcHByb3ZhbF9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBkYXRhLXNyYz0iJyAuIHJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJHZhbHVlcy0+aWQpIC4gJyI+JyAuICR2YWx1ZXMtPnJlZmVyZW5jZV9ubyAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycykgPyAoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUgLiAnICgnIC4gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUgLiAnKScgOiAnJykgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgncXVvdGF0aW9ucy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0b3RhbF9wcmljZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sIDogJycpIC4gJyAnIC4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigndmF0JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wgOiAnJykgLiAnICcgLiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT52YXQpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCA6ICcnKSAuICcgJyAuIHN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPmdyb3NzX3ByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpID09IDApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ3NlbmQtcG8tdG8tc3VwcGxpZXInXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5pc19zZW5kID09ICdubycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5zZW5kLnBvLnRvLnN1cHBsaWVyJywgJHZhbHVlcy0+aWQpIC4gJyIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkgbS0xIiB0aXRsZT0iU2VuZCBQdXJjaGFzZSBPcmRlciBUbyBTdXBwbGllciIgb25jbGljaz0icG9BY3Rpb25zKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXBhcGVyLXBsYW5lIj48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyBtLTEiIHRpdGxlPSJQdXJjaGFzZSBPcmRlciBBbHJlYWR5IFNlbnQgVG8gU3VwcGxpZXIiPjxpIGNsYXNzPSJsYXMgbGEtY2hlY2stY2lyY2xlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1sncG8tY2FuY2VsJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLmNhbmNlbC5wbycsICR2YWx1ZXMtPmlkKSAuICciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgZGVsZXRlUG8gbS0xIiB0aXRsZT0iQ2FuY2VsIFB1cmNoYXNlIE9yZGVyIiBvbmNsaWNrPSJwb0FjdGlvbnMoJCh0aGlzKSkiPjxpIGNsYXNzPSJsYXMgbGEtdGltZXMtY2lyY2xlIj48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5yZWxQb0F0dGFjaG1lbnQtPmNvdW50KCkgPD0gMCAmJiAkdmFsdWVzLT5yZWxTdXBwbGllclBheW1lbnRzLT53aGVyZUluKCdzdGF0dXMnLFsnYXBwcm92ZWQnLCdhdWRpdGVkJ10pLT5jb3VudCgpIDw9MCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3QucmV2aXNlLnBvJywkdmFsdWVzLT5pZCkuJyIgdGFyZ2V0PSJfX2JsYW5rIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyBtLTEiIHRpdGxlPSJQdXJjaGFzZSBPcmRlciBSZXZpc2UiPjxpIGNsYXNzPSJsYXMgbGEtZWRpdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJyA8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLnByaW50JywgJHZhbHVlcy0+aWQpIC4gJyIgIHRpdGxlPSJQdXJjaGFzZSBPcmRlciBQcmludCBWaWV3IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyBtLTEiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICcgPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9IicgLiByb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaGlzdG9yeScsICR2YWx1ZXMtPmlkKSAuICciICB0aXRsZT0iUE8gSGlzdG9yeSIgY2xhc3M9ImJ0biBidG4teHMgYnRuLWluZm8gbS0xIj48aSBjbGFzcz0ibGFzIGxhLXVzZXItY2xvY2siPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2Vfbm8nLCAnc3VwcGxpZXInLCAndG90YWxfcHJpY2UnLCAndmF0JywgJ2dyb3NzX3ByaWNlJywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5wdXJjaGFzZS5vcmRlci1saXN0JywgWyd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCldKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRQb1RvU3VwcGxpZXIoJGlkKQogICAgewogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlci0+aXNfc2VuZCA9ICd5ZXMnOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlci0+c2F2ZSgpOwoKICAgICAgICAgICAgJGRhdGFbImVtYWlsIl0gPSAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmVtYWlsOwogICAgICAgICAgICAkZGF0YVsidGl0bGUiXSA9ICJQdXJjaGFzZSBPcmRlciBFbWFpbCI7CiAgICAgICAgICAgICRkYXRhWyJyZWZlcmVuY2Vfbm8iXSA9ICRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm87CiAgICAgICAgICAgICRkYXRhWyJwdXJjaGFzZU9yZGVyIl0gPSAkcHVyY2hhc2VPcmRlcjsKCiAgICAgICAgICAgIC8vICRwZGYgPSBQREY6OmxvYWRWaWV3KCdwbXMuYmFja2VuZC5tYWlsLnB1cmNoYXNlLW9yZGVyLW1haWwnLCAkZGF0YSktPnNldE9wdGlvbnMoWydkZWZhdWx0Rm9udCcgPT4gJ3NhbnMtc2VyaWYnXSk7CgogICAgICAgICAgICAvLyBNYWlsOjpzZW5kKCdwbXMuYmFja2VuZC5tYWlsLnBvX21haWxfYm9keScsICRkYXRhLCBmdW5jdGlvbiAoJG1lc3NhZ2UpIHVzZSAoJGRhdGEsICRwZGYpIHsKICAgICAgICAgICAgLy8gICAgICRtZXNzYWdlLT50bygkZGF0YVsiZW1haWwiXSwgJGRhdGFbImVtYWlsIl0pCiAgICAgICAgICAgIC8vICAgICAtPnN1YmplY3QoJGRhdGFbInRpdGxlIl0pCiAgICAgICAgICAgIC8vICAgICAtPmF0dGFjaERhdGEoJHBkZi0+b3V0cHV0KCksICRkYXRhWyJyZWZlcmVuY2Vfbm8iXS4iLnBkZiIpOwogICAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICAgIC8vICRwZGYgPSBvdXRwdXRNUERGKCdwbXMuYmFja2VuZC5wYWdlcy5iaWxsaW5nLnBvLWludm9pY2UtcGRmJywgJGRhdGEsICRkYXRhWyJyZWZlcmVuY2Vfbm8iXSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdKTsKCiAgICAgICAgICAgIC8vIE1haWw6OnNlbmQoJ3Btcy5iYWNrZW5kLm1haWwucG9fbWFpbF9ib2R5JywgJGRhdGEsIGZ1bmN0aW9uICgkbWVzc2FnZSkgdXNlICgkZGF0YSwgJHBkZikgewogICAgICAgICAgICAvLyAgICAgJG1lc3NhZ2UtPnRvKCRkYXRhWyJlbWFpbCJdLCAkZGF0YVsiZW1haWwiXSkKICAgICAgICAgICAgLy8gICAgIC0+c3ViamVjdCgkZGF0YVsidGl0bGUiXSkKICAgICAgICAgICAgLy8gICAgIC0+YXR0YWNoRGF0YSgkcGRmLCAkZGF0YVsicmVmZXJlbmNlX25vIl0uIi5wZGYiKTsKICAgICAgICAgICAgLy8gfSk7CgogICAgICAgICAgICAvLyAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHB1cmNoYXNlT3JkZXItPmlkKS4nP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBGb3IgR2F0ZSBJbi48L3NwYW4+JzsKCiAgICAgICAgICAgIC8vIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdHYXRlIFBlcm1pc3Npb24nLCRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwnc2VuZC10by1nYXRlLW1hbmFnZXInKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1B1cmNoYXNlIG9yZGVyIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBzZW50IHRvIHN1cHBsaWVyLicKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkbW9kYWwgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsUXVvdGF0aW9uSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMuU3VwcGxpZXJSYXRpbmdzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1aXNpdGlvbi5yZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRtb2RhbCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWVzdF9wcm9wb3NhbF9pZCcsICRtb2RhbC0+cmVsUXVvdGF0aW9uLT5yZXF1ZXN0X3Byb3Bvc2FsX2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRzeXN0ZW1DdXJyZW5jeSA9IHN5c3RlbUN1cnJlbmN5KCk7CiAgICAgICAgICAgICRjdXJyZW5jeSA9ICRtb2RhbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlOwogICAgICAgICAgICAkZXhjaGFuZ2VSYXRlID0gZXhjaGFuZ2VSYXRlKCRtb2RhbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAkc2FtZSA9ICgkc3lzdGVtQ3VycmVuY3ktPmlkID09ICRtb2RhbC0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5X2lkID8gdHJ1ZSA6IGZhbHNlKTsKICAgICAgICAgICAgaWYgKCRtb2RhbCkgewogICAgICAgICAgICAgICAgJGJvZHkgPSBWaWV3OjptYWtlKCdwbXMuYmFja2VuZC5wYWdlcy5wdXJjaGFzZS5zaG93JywgWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVyJyA9PiAkbW9kYWwsCiAgICAgICAgICAgICAgICAgICAgJ3N5c3RlbUN1cnJlbmN5JyA9PiAkc3lzdGVtQ3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgJ2N1cnJlbmN5JyA9PiAkY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZScgPT4gJGV4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgICAgICAnc2FtZScgPT4gJHNhbWUsCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uSXRlbXMnID0+ICRyZXF1aXNpdGlvbkl0ZW1zCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3ZpZXcnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkYm9keS0+cmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ3N1Y2Nlc3MnOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydib2R5J10gPSAkYm9keS0+cmVuZGVyKCk7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgR2VuZXJhdGVkIFBPJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnUHVyY2hhc2UgT3JkZXIgbm90IGZvdW5kISEnOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCd2aWV3JykpIHsKICAgICAgICAgICAgcmV0dXJuICRib2R5LT5yZW5kZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gd29ya09yZGVyQ2FuY2VsKCRpZCkKICAgIHsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXItPmlzX3NlbmQgPSAnaGFsdCc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5zYXZlKCk7CgogICAgICAgICAgICAvLyAkZGF0YVsiZW1haWwiXSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+ZW1haWw7CiAgICAgICAgICAgIC8vICRkYXRhWyJ0aXRsZSJdID0gIlB1cmNoYXNlIE9yZGVyIEVtYWlsIjsKICAgICAgICAgICAgLy8gJGRhdGFbInJlZmVyZW5jZV9ubyJdID0gJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgLy8gJGRhdGFbInB1cmNoYXNlT3JkZXIiXSA9ICRwdXJjaGFzZU9yZGVyOwoKICAgICAgICAgICAgLy8gJHBkZiA9IG91dHB1dE1QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCAkZGF0YSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLCAkZGF0YVsicmVmZXJlbmNlX25vIl0pOwogICAgICAgICAgICAvLyBNYWlsOjpzZW5kKCdwbXMuYmFja2VuZC5tYWlsLnBvX21haWxfYm9keScsICRkYXRhLCBmdW5jdGlvbiAoJG1lc3NhZ2UpIHVzZSAoJGRhdGEsICRwZGYpIHsKICAgICAgICAgICAgLy8gICAgICRtZXNzYWdlLT50bygkZGF0YVsiZW1haWwiXSwgJGRhdGFbImVtYWlsIl0pCiAgICAgICAgICAgIC8vICAgICAtPnN1YmplY3QoJGRhdGFbInRpdGxlIl0pCiAgICAgICAgICAgIC8vICAgICAtPmF0dGFjaERhdGEoJHBkZiwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLiIucGRmIik7CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAvLyAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHB1cmNoYXNlT3JkZXItPmlkKS4nP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBGb3IgR2F0ZSBJbi48L3NwYW4+JzsKCiAgICAgICAgICAgIC8vIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdHYXRlIFBlcm1pc3Npb24nLCRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwnc2VuZC10by1nYXRlLW1hbmFnZXInKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlB1cmNoYXNlIGhhcyBiZWVuIGNhbmNlbGxlZCBzdWNjZXNzZnVsbHkuIgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY2FuY2VsbGVkTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdQdXJjaGFzZSBPcmRlciBDYW5jZWxsZWQgTGlzdCc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyTGlzdCA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZScsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVuKCFhdXRoKCktPnVzZXIoKS0+aGFzQW55Um9sZShbJ1B1cmNoYXNlLURlcGFydG1lbnQnLCAnQXVkaXQnLCAnQmlsbGluZycsICdNYW5hZ2VtZW50JywgJ0FjY291bnRzJ10pLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3B1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMucmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc3NpZ25lZF91c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxRdW90YXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZU5vdEluKCd0eXBlJywgWydkaXJlY3QtcHVyY2hhc2UnXSk7CiAgICAgICAgICAgIH0pLT53aGVyZSgnaXNfc2VuZCcsIFsnaGFsdCddKQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdyZXN0b3JlLXBvJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdyZXN0b3JlLXBvJyksCiAgICAgICAgICAgIF07CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkcHVyY2hhc2VPcmRlckxpc3QpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZhbHVlcy0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhcHByb3ZhbF9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWZlcmVuY2Vfbm8nLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkdmFsdWVzLT5pZCkgLiAnIj4nIC4gJHZhbHVlcy0+cmVmZXJlbmNlX25vIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzKSA/IChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+bmFtZSAuICcgKCcgLiAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZSAuICcpJyA6ICcnKSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3N1cHBsaWVycycsICdzdXBwbGllcnMuaWQnLCAnPScsICdxdW90YXRpb25zLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgncXVvdGF0aW9ucy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0b3RhbF9wcmljZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sIDogJycpIC4gJyAnIC4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigndmF0JywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wgOiAnJykgLiAnICcgLiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT52YXQpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCA6ICcnKSAuICcgJyAuIHN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPmdyb3NzX3ByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkdmFsdWVzKSB1c2UgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3B0aW9uc1sncmVzdG9yZS1wbyddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5yZXN0b3JlLnBvJywgJHZhbHVlcy0+aWQpIC4gJyIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MgcmVzdG9yZVBvIG0tMSIgdGl0bGU9IlJlc3RvcmUgUHVyY2hhc2UgT3JkZXIiIG9uY2xpY2s9InBvQWN0aW9ucygkKHRoaXMpKSI+PGkgY2xhc3M9ImxhcyBsYS1yZWRvLWFsdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnIDxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LnBvLmludm9pY2UucHJpbnQnLCAkdmFsdWVzLT5pZCkgLiAnIiAgdGl0bGU9IlB1cmNoYXNlIE9yZGVyIFByaW50IFZpZXciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIG0tMSI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPjwvYT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJyA8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJyAuIHJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywgJHZhbHVlcy0+aWQpIC4gJyIgIHRpdGxlPSJQTyBIaXN0b3J5IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyBtLTEiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPjwvYT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsncmVmZXJlbmNlX25vJywgJ3N1cHBsaWVyJywgJ3RvdGFsX3ByaWNlJywgJ3ZhdCcsICdncm9zc19wcmljZScsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnB1cmNoYXNlLmNhbmNlbGxlZC1saXN0JywgWyd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCldKTsKCiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHdvcmtPcmRlclJlc3RvcmUoJGlkKQogICAgewogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlci0+aXNfc2VuZCA9ICdubyc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5zYXZlKCk7CgogICAgICAgICAgICAvLyAkZGF0YVsiZW1haWwiXSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+ZW1haWw7CiAgICAgICAgICAgIC8vICRkYXRhWyJ0aXRsZSJdID0gIlB1cmNoYXNlIE9yZGVyIEVtYWlsIjsKICAgICAgICAgICAgLy8gJGRhdGFbInJlZmVyZW5jZV9ubyJdID0gJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgLy8gJGRhdGFbInB1cmNoYXNlT3JkZXIiXSA9ICRwdXJjaGFzZU9yZGVyOwoKICAgICAgICAgICAgLy8gJHBkZiA9IG91dHB1dE1QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCAkZGF0YSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLCAkZGF0YVsicmVmZXJlbmNlX25vIl0pOwogICAgICAgICAgICAvLyBNYWlsOjpzZW5kKCdwbXMuYmFja2VuZC5tYWlsLnBvX21haWxfYm9keScsICRkYXRhLCBmdW5jdGlvbiAoJG1lc3NhZ2UpIHVzZSAoJGRhdGEsICRwZGYpIHsKICAgICAgICAgICAgLy8gICAgICRtZXNzYWdlLT50bygkZGF0YVsiZW1haWwiXSwgJGRhdGFbImVtYWlsIl0pCiAgICAgICAgICAgIC8vICAgICAtPnN1YmplY3QoJGRhdGFbInRpdGxlIl0pCiAgICAgICAgICAgIC8vICAgICAtPmF0dGFjaERhdGEoJHBkZiwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLiIucGRmIik7CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAvLyAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHB1cmNoYXNlT3JkZXItPmlkKS4nP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBGb3IgR2F0ZSBJbi48L3NwYW4+JzsKCiAgICAgICAgICAgIC8vIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCd1bnJlYWQnLCcnLGdldE1hbmFnZXJJbmZvKCdHYXRlIFBlcm1pc3Npb24nLCRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwnc2VuZC10by1nYXRlLW1hbmFnZXInKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAibWVzc2FnZSIgPT4gIlB1cmNoYXNlIE9yZGVyIGhhcyBiZWVuIHJlc3RvcmVkIHN1Y2Nlc3NmdWxseS4iCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAibWVzc2FnZSIgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiByZXZpc2VQbygkcHVyY2hhc2VJZCkKICAgIHsKICAgICAgICAkdGl0bGUgPSAnUHVyY2hhc2UgT3JkZXIgUmV2aXNlJzsKCiAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwdXJjaGFzZUlkKTsKCiAgICAgICAgJHF1b3RhdGlvbiA9IFF1b3RhdGlvbnM6OndpdGgoWwogICAgICAgICAgICAncmVsUXVvdGF0aW9uSXRlbXMnLAogICAgICAgICAgICAncmVsUmVxdWVzdFByb3Bvc2FsLnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uJwogICAgICAgIF0pLT53aGVyZShbJ3N0YXR1cycgPT4gJ2FjdGl2ZScsICdpc19hcHByb3ZlZCcgPT4gJ2FwcHJvdmVkJywgJ2lkJyA9PiAkcHVyY2hhc2VPcmRlci0+cXVvdGF0aW9uX2lkXSktPmZpcnN0KCk7CgogICAgICAgICR1bmNvbW1vbiA9IENhdGVnb3J5Ojp3aGVyZUhhcygnc3ViQ2F0ZWdvcnkucHJvZHVjdHMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRxdW90YXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaWQnLCAkcXVvdGF0aW9uLT5yZWxRdW90YXRpb25JdGVtcy0+cGx1Y2soJ3Byb2R1Y3RfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICB9KS0+d2hlcmUoJ3R5cGUnLCAndW5jb21tb24nKS0+Y291bnQoKTsKCiAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScKICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbi5yZWxSZXF1ZXN0UHJvcG9zYWwucmVsUXVvdGF0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHF1b3RhdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJHF1b3RhdGlvbi0+aWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHF1b3RhdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbigncHJvZHVjdF9pZCcsICRxdW90YXRpb24tPnJlbFF1b3RhdGlvbkl0ZW1zLT53aGVyZSgnaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKS0+cGx1Y2soJ3Byb2R1Y3RfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgJHVuaXRfaWRzID0gJHJlcXVpc2l0aW9ucy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICRkZXBhcnRtZW50X2lkcyA9IFtdOwogICAgICAgIGlmICgkcmVxdWlzaXRpb25zLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb25zIGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRkZXBhcnRtZW50X2lkcywgJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR1bml0cyA9IFVuaXQ6OndoZXJlSW4oJ2hyX3VuaXRfaWQnLCAkdW5pdF9pZHMpLT5nZXQoKTsKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50X2lkcyktPmdldCgpOwoKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgJGN1cnJlbmN5ID0gJHF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZTsKICAgICAgICAgICAgJGV4Y2hhbmdlUmF0ZSA9IGV4Y2hhbmdlUmF0ZSgkcXVvdGF0aW9uLT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAkc2FtZSA9ICgkc3lzdGVtQ3VycmVuY3ktPmlkID09ICRxdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3lfaWQgPyB0cnVlIDogZmFsc2UpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnB1cmNoYXNlLnJldmlzZS1wdXJjaGFzZS1vcmRlcicsIGNvbXBhY3QoJ3RpdGxlJywgJ3F1b3RhdGlvbicsICd1bml0cycsICdkZXBhcnRtZW50cycsICd1bmNvbW1vbicsICdzeXN0ZW1DdXJyZW5jeScsICdleGNoYW5nZVJhdGUnLCAnY3VycmVuY3knLCAnc2FtZScsICdwdXJjaGFzZU9yZGVyJykpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdW5pdFdpc2VSZXF1aXNpdGlvbigkdW5pdElkLCAkcXVvdGF0aW9uSWQpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRwcm9kdWN0SWRzID0gUXVvdGF0aW9uc0l0ZW1zOjp3aGVyZSgncXVvdGF0aW9uX2lkJywgJHF1b3RhdGlvbklkKQogICAgICAgICAgICAgICAgLT5wbHVjaygncHJvZHVjdF9pZCcpLT50b0FycmF5KCk7CgogICAgICAgICAgICAkYXJyYXkxID0gUmVxdWlzaXRpb246OndoZXJlKFsKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAkdW5pdElkLAogICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdyZnAnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwcm9kdWN0SWRzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncG9fZ2VuZXJhdGUnLCAneWVzJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdwcm9kdWN0X2lkJywgJHByb2R1Y3RJZHMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLnJlbFJlcXVlc3RQcm9wb3NhbC5yZWxRdW90YXRpb25zJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcXVvdGF0aW9uSWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkcXVvdGF0aW9uSWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgndW5jb21tb24nKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdocl9kZXBhcnRtZW50X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRhcnJheTIgPSBSZXF1aXNpdGlvbjo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+ICR1bml0SWQsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAncmVxdWVzdF9zdGF0dXMnID0+ICdzZW5kX3JmcCcsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb25JdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHByb2R1Y3RJZHMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcHJvZHVjdElkcyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24ucmVsUmVxdWVzdFByb3Bvc2FsLnJlbFF1b3RhdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRxdW90YXRpb25JZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRxdW90YXRpb25JZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCd1bmNvbW1vbicpID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2hyX2RlcGFydG1lbnRfaWQnKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAgICAgJGFycmF5ID0gYXJyYXlfdW5pcXVlKGFycmF5X21lcmdlKCRhcnJheTEsICRhcnJheTIpKTsKCiAgICAgICAgICAgIHJldHVybiBSZXF1aXNpdGlvbjo6d2hlcmVJbignaWQnLCAkYXJyYXkpLT5nZXQoWydpZCcsICdyZWZlcmVuY2Vfbm8nXSk7CgogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxdWlzaXRpb25XaXNlSXRlbXNRdHkoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJGl0ZW1zID0gUXVvdGF0aW9uc0l0ZW1zOjp3aGVyZSgncXVvdGF0aW9uX2lkJywgJHJlcXVlc3QtPnF1b3RhdGlvbklkKS0+Z2V0KCk7CiAgICAgICAgICAgICRkYXRhID0gW107CiAgICAgICAgICAgIGlmIChpc3NldCgkaXRlbXNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkaXRlbXMgYXMgJGtleSA9PiAkaXRlbSkgewogICAgICAgICAgICAgICAgICAgICRxdHkgPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVlc3QtPnJlcXVpc2l0aW9uSWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkaXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsICd5ZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgncXR5Jyk7CgogICAgICAgICAgICAgICAgICAgICRkZWxpdmVyeVF0eSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmVJbigncmVxdWlzaXRpb25faWQnLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25JZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncHJvZHVjdF9pZCcsICRpdGVtLT5wcm9kdWN0X2lkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywgJ3llcycpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3BvX2dlbmVyYXRlJywgJ3llcycpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCdkZWxpdmVyeV9xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgJGRhdGFbJGl0ZW0tPmlkXSA9ICgkZGVsaXZlcnlRdHkgPiAwKSA/ICRxdHkgLSAkZGVsaXZlcnlRdHkgOiAkcXR5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJGRhdGE7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldmlzZVBvVXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsICRwdXJjaGFzZU9yZGVySWQpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdxdW90YXRpb25faWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgJ3BvX3F0eScgPT4gWydyZXF1aXJlZCddLAogICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgJ2hyX3VuaXRfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICBdKTsKCiAgICAgICAgJGZpbHRlclBvUXR5ID0gYXJyYXlfZGlmZigkcmVxdWVzdC0+cG9fcXR5LCBbMF0pOwogICAgICAgICRjb2xsZWN0UHJvZHVjdElkID0gYXJyYXlfa2V5cygkZmlsdGVyUG9RdHkpOwoKICAgICAgICBpZiAoYXJyYXlfc3VtKCRmaWx0ZXJQb1F0eSkgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1BsZWFzZSBwbyBxdHkgY2FuIG5vdCBiZSAwJyk7CiAgICAgICAgfQoKICAgICAgICAkbW9kYWwgPSBRdW90YXRpb25zOjp3aGVyZSgnaWQnLCAkcmVxdWVzdC0+cXVvdGF0aW9uX2lkKS0+Zmlyc3QoKTsKCiAgICAgICAgLy8gJHByZWZpeCA9ICdQTy0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpLictJy51bml0TmFtZSgkcmVxdWVzdC0+aHJfdW5pdF9pZCktPmhyX3VuaXRfc2hvcnRfbmFtZS4nLSc7CiAgICAgICAgLy8gJHJlZk5vID0gdW5pcXVlQ29kZSgxNiwkcHJlZml4LCdwdXJjaGFzZV9vcmRlcnMnLCdpZCcpOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwoKICAgICAgICB0cnkgewoKICAgICAgICAgICAgJHBvX2RhdGEgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwdXJjaGFzZU9yZGVySWQpOwogICAgICAgICAgICAkcG9fZGF0YS0+aHJfdW5pdF9pZCA9ICRyZXF1ZXN0LT5ocl91bml0X2lkOwogICAgICAgICAgICAkcG9fZGF0YS0+cG9fZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5wb19kYXRlKSk7CiAgICAgICAgICAgICRwb19kYXRhLT5yZW1hcmtzID0gJHJlcXVlc3QtPnJlbWFya3M7CiAgICAgICAgICAgICRwb19kYXRhLT5yZXZpc2VfY291bnQgPSAkcG9fZGF0YS0+cmV2aXNlX2NvdW50ICsgMTsKICAgICAgICAgICAgJHBvX2RhdGEtPnNhdmUoKTsKCiAgICAgICAgICAgICRwb1N1YlRvdGFsID0gMDsKICAgICAgICAgICAgJHBvVmF0ID0gMDsKICAgICAgICAgICAgJHBvR3Jvc3NUb3RhbCA9IDA7CgogICAgICAgICAgICAkaXRlbXMgPSBRdW90YXRpb25zSXRlbXM6OndoZXJlKCdxdW90YXRpb25faWQnLCAkbW9kYWwtPmlkKS0+d2hlcmVJbigncHJvZHVjdF9pZCcsICRjb2xsZWN0UHJvZHVjdElkKS0+d2hlcmUoJ2lzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJyktPmdldCgpOwoKICAgICAgICAgICAgLy9kZWxldGUgcHVyY2hhc2Ugb3JkZXIgaXRlbXMKICAgICAgICAgICAgJHBvX2RhdGEtPnJlbFB1cmNoYXNlT3JkZXJJdGVtcygpLT5kZWxldGUoKTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAka2V5ID0+ICR2YWx1ZXMpIHsKCiAgICAgICAgICAgICAgICAkZGlzY291bnRlZCA9ICgkdmFsdWVzLT5kaXNjb3VudCA+IDAgPyAoJHZhbHVlcy0+dW5pdF9wcmljZSAqICgkdmFsdWVzLT5kaXNjb3VudCAvIDEwMCkpIDogMCk7CiAgICAgICAgICAgICAgICAkdW5pdF9wcmljZSA9ICgkdmFsdWVzLT51bml0X3ByaWNlIC0gJGRpc2NvdW50ZWQpOwoKICAgICAgICAgICAgICAgICRwb1F0eSA9ICRmaWx0ZXJQb1F0eVskdmFsdWVzLT5wcm9kdWN0X2lkXTsKICAgICAgICAgICAgICAgICRzdWJUb3RhbCA9ICR1bml0X3ByaWNlICogJHBvUXR5OwogICAgICAgICAgICAgICAgJHBvU3ViVG90YWwgKz0gJHN1YlRvdGFsOwoKICAgICAgICAgICAgICAgICR2YXRBbW91bnQgPSAoJHZhbHVlcy0+dmF0X3BlcmNlbnRhZ2UgPiAwICYmICRzdWJUb3RhbCA+IDAgPyAoJHN1YlRvdGFsICogKCR2YWx1ZXMtPnZhdF9wZXJjZW50YWdlIC8gMTAwKSkgOiAwKTsKICAgICAgICAgICAgICAgICRwb1ZhdCArPSAkdmF0QW1vdW50OwoKICAgICAgICAgICAgICAgICRncm9zc1RvdGFsID0gKCRzdWJUb3RhbCArICR2YXRBbW91bnQpOwogICAgICAgICAgICAgICAgJHBvR3Jvc3NUb3RhbCArPSAkZ3Jvc3NUb3RhbDsKCiAgICAgICAgICAgICAgICAkcG9faXRlbXMgPSBuZXcgUHVyY2hhc2VPcmRlckl0ZW0oKTsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+cG9faWQgPSAkcG9fZGF0YS0+aWQ7CiAgICAgICAgICAgICAgICAkcG9faXRlbXMtPnByb2R1Y3RfaWQgPSAkdmFsdWVzLT5wcm9kdWN0X2lkOwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT51bml0X3ByaWNlID0gJHVuaXRfcHJpY2U7CiAgICAgICAgICAgICAgICAkcG9faXRlbXMtPnF0eSA9ICRwb1F0eTsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+c3ViX3RvdGFsX3ByaWNlID0gJHN1YlRvdGFsOwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT5kaXNjb3VudF9wZXJjZW50YWdlID0gMDsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+ZGlzY291bnQgPSAwOwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT52YXRfcGVyY2VudGFnZSA9ICR2YWx1ZXMtPnZhdF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT52YXQgPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT50b3RhbF9wcmljZSA9ICRncm9zc1RvdGFsOwogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgLy91cGRhdGUgbGF0ZXN0IHByb2R1Y3QgcHJpY2UKICAgICAgICAgICAgICAgIGxhdGVzdFByb2R1Y3RQcmljZVVwZGF0ZSgkdmFsdWVzLT5wcm9kdWN0X2lkLCAkdW5pdF9wcmljZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vVXBkYXRlIFB1cmNhaHNlIE9yZGVyCiAgICAgICAgICAgIFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsICRwb19kYXRhLT5pZCktPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAndG90YWxfcHJpY2UnID0+ICRwb1N1YlRvdGFsLAogICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAwLAogICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJHBvVmF0LAogICAgICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAkcG9Hcm9zc1RvdGFsLAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmICgkbW9kYWwtPnJlbFN1cHBsaWVyUGF5bWVudFRlcm0tPnR5cGUgPT0gJ3BhaWQnKSB7CiAgICAgICAgICAgICAgICAvL0FkZCBTdXBwbGllciBQeWFtZW50cwogICAgICAgICAgICAgICAgJGR1cmF0aW9uX2RhdGUgPSAkbW9kYWwtPnJlbFN1cHBsaWVyUGF5bWVudFRlcm0tPmRheV9kdXJhdGlvbjsKICAgICAgICAgICAgICAgICRwYXlfZGF0ZSA9IGRhdGUoJ1ktbS1kIGg6aTpzJywgc3RydG90aW1lKCcrJyAuICRkdXJhdGlvbl9kYXRlIC4gJyBkYXknLCBzdHJ0b3RpbWUoJHBvX2RhdGEtPnBvX2RhdGUpKSk7CiAgICAgICAgICAgICAgICAvL1BheW1lbnQgZGF0ZSBiYXNlZCBvbiBhZHZhbmNlICYgZHVlCiAgICAgICAgICAgICAgICAkcGF5X2Ftb3VudCA9ICgkbW9kYWwtPnJlbFN1cHBsaWVyUGF5bWVudFRlcm0tPnBheW1lbnRfcGVyY2VudCA+IDAgJiYgJHBvR3Jvc3NUb3RhbCA+IDAgPyAoJG1vZGFsLT5yZWxTdXBwbGllclBheW1lbnRUZXJtLT5wYXltZW50X3BlcmNlbnQgKiAkcG9Hcm9zc1RvdGFsKSAvIDEwMCA6IDApOwogICAgICAgICAgICAgICAgaWYgKCRwYXlfYW1vdW50ID4gMCkgewoKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudCA9IFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoWydzdXBwbGllcl9pZCcgPT4gJG1vZGFsLT5zdXBwbGllcl9pZCwgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcG9fZGF0YS0+aWRdKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnRyYW5zZWN0aW9uX2RhdGUgPSBkYXRlKCdZLW0tZCBoOmk6cycpOwogICAgICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl90eXBlID0gJ3B1cmNoYXNlJzsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+cGF5X2Ftb3VudCA9ICRwYXlfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5wYXlfZGF0ZSA9ICRwYXlfZGF0ZTsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+YmlsbF90eXBlID0gJ3BvLWFkdmFuY2UnOwogICAgICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uIHNlbmQgdG8gYWNjb3VudHMKICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiAgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkcG9fZGF0YS0+cmVmZXJlbmNlX25vIC4gJy4gQSBQTyAocmV2aXNlZCkgaGFzIGJlZW4gc3VibWl0dGVkIHdpdGggYW4gYWR2YW5jZSBhbW91bnQgb2YgVEsgJyAuICRzdXBwbGllcl9wYXltZW50LT5wYXlfYW1vdW50IC4gJzwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCBnZXRNYW5hZ2VySW5mbygnQWNjb3VudHMnLCBudWxsLCB0cnVlKSwgJ3NlbmQtdG8tYWNjb3VudHMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9VcGRhdGUgcmVxdWlzaXRpb24KICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjp3aGVyZUluKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbigncHJvZHVjdF9pZCcsICRjb2xsZWN0UHJvZHVjdElkKQogICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZSgncG9fZ2VuZXJhdGUnLCAnbm8nKQogICAgICAgICAgICAgICAgLT51cGRhdGUoWydwb19nZW5lcmF0ZScgPT4gJ3llcyddKTsKCiAgICAgICAgICAgIFB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbjo6d2hlcmUoWydwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2RhdGEtPmlkXSktPmRlbGV0ZSgpOwoKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZFswXSkpIHsKCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQgYXMgJGtleSA9PiAkcmVxdWlzaXRpb25faWQpIHsKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb246OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcG9fZGF0YS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgIF0sIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2RlcGFydG1lbnRfaWQnID0+IGlzc2V0KCRyZXF1ZXN0LT5ocl9kZXBhcnRtZW50X2lkKSA/ICRyZXF1ZXN0LT5ocl9kZXBhcnRtZW50X2lkIDogMCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAvL1JlcXVpc2l0aW9uIHRyYWNraW5nIHdpdGggcmVxdWlzaXRvbiBpZAogICAgICAgICAgICAgICAgICAgIFJlcXVpc2l0aW9uVHJhY2tpbmc6OnN0b3JlUmVxdWlzaXRpb25UcmFja2luZygkcmVxdWlzaXRpb25faWQsICdQTy1Jc3N1ZScpOwoKICAgICAgICAgICAgICAgICAgICAvL05vdGlmaWNhdGlvbiBnZW5lcmF0ZQogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvblVzZXIgPSBSZXF1aXNpdGlvbjo6d2hlcmUoJ2lkJywgJHJlcXVpc2l0aW9uX2lkKS0+Zmlyc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlBPIFJlZmVyZW5jZSBObyAjJyAuICRwb19kYXRhLT5yZWZlcmVuY2Vfbm8gLiAnLiBBIFBPIGhhcyBiZWVuIElzc3VlZCAocmV2aXNlZCkgYWdhaW5zdCB5b3VyIHJlcXVpc2l0aW9uICMnIC4gJHJlcXVpc2l0aW9uVXNlci0+cmVmZXJlbmNlX25vIC4gJzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsIFskcmVxdWlzaXRpb25Vc2VyLT5hdXRob3JfaWRdLCAncmVxdWlzaXRpb24nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGFycmF5ID0gW107CgogICAgICAgICAgICAvL1BPIEdlbmVyYXRlIEVxdWFsbHkgZGlzdHJpYnV0ZQogICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPnByb2R1Y3RfaWRbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+cHJvZHVjdF9pZCBhcyAka2V5ID0+ICRwcm9kdWN0X2lkKSB7CgogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbl9xdHkgPSAoaXNzZXQoJHJlcXVlc3QtPnJlcXVpc2l0aW9uX3F0eVskcHJvZHVjdF9pZF0pID8gJHJlcXVlc3QtPnJlcXVpc2l0aW9uX3F0eVskcHJvZHVjdF9pZF0gOiAwKTsKICAgICAgICAgICAgICAgICAgICAkcG9fcXR5ID0gKGlzc2V0KCRyZXF1ZXN0LT5wb19xdHlbJHByb2R1Y3RfaWRdKSA/ICRyZXF1ZXN0LT5wb19xdHlbJHByb2R1Y3RfaWRdIDogMCk7CiAgICAgICAgICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSAoJHJlcXVpc2l0aW9uX3F0eSA+IDAgJiYgJHBvX3F0eSA+IDAgPyAoKCRwb19xdHkgLyAkcmVxdWlzaXRpb25fcXR5KSAqIDEwMCkgOiAwKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkIGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uX2lkKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbl9pZCktPndoZXJlKCdwcm9kdWN0X2lkJywgJHByb2R1Y3RfaWQpLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVpc2l0aW9uSXRlbXNbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uSXRlbXMgYXMgJGtleSA9PiAkcmVxdWlzaXRpb25JdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcG9fcXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcG9fcXR5ID0gcm91bmQoKCRwZXJjZW50YWdlID4gMCA/ICgkcmVxdWlzaXRpb25JdGVtLT5xdHkgKiAoJHBlcmNlbnRhZ2UgLyAxMDApKSA6IDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzX3BvX3F0eSA9ICgkdGhpc19wb19xdHkgPiAkcG9fcXR5ID8gJHBvX3F0eSA6ICR0aGlzX3BvX3F0eSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID0gJHRoaXNfcG9fcXR5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb19xdHkgPSAoJHBvX3F0eSAtICR0aGlzX3BvX3F0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcG9fcXR5ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uX2lkKS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcHJvZHVjdF9pZCktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5wdXJjaGFzZV9xdHkgPSAoJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ICsgcm91bmQoJHBvX3F0eSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnUHVyY2hhc2UgT3JkZXIgaGFzIGJlZW4gcmV2aXNlZCBzdWNjZXNzZnVsbHkhJywgJ3Btcy5wdXJjaGFzZS5vcmRlci1pbmRleCcpOwoKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxzdHJpbmdbXVtdCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVjZWl2YWJsZUhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnYXBwcm92YWxfZGF0ZScsICdhcHByb3ZhbF9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGVsaXZlcnlfZGF0ZScsICdkZWxpdmVyeV9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3F1b3RhdGlvbl9yZWZfbm8nLCAncXVvdGF0aW9uX3JlZl9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3RvdGFsX3ByaWNlJywgJ3RvdGFsX3ByaWNlJywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWyd2YXQnLCAndmF0JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydncm9zc19wcmljZScsICdncm9zc19wcmljZScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJywgJ3dpZHRoOjE1JSddCiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVjZWl2YWJsZUxpc3QoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aXRsZSA9ICdVcGNvbWluZyBSZWNlaXZhYmxlIFB1cmNoYXNlIE9yZGVyJzsKCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyTGlzdCA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RSZWNlaXZlTm90ZScsCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUG9BdHRhY2htZW50JywKICAgICAgICAgICAgICAgICdyZWxTdXBwbGllclBheW1lbnRzJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdBdWRpdCcsICdCaWxsaW5nJywgJ01hbmFnZW1lbnQnLCAnQWNjb3VudHMnXSksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Fzc2lnbmVkX3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaHJfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCkpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ3R5cGUnLCBbJ2RpcmVjdC1wdXJjaGFzZSddKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPj0nLCBkYXRlKCdZLW0tZCcpKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RlbGl2ZXJ5X2RhdGUnLCAnPD0nLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgnKzEwIGRheScpKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaXNfc2VuZCcsIFsnbm8nLCAneWVzJ10pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdyZWNlaXZhYmxlcy1wby1zZW5kLW5vdGlmeScgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygncmVjZWl2YWJsZXMtcG8tc2VuZC1ub3RpZnknKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRwdXJjaGFzZU9yZGVyTGlzdCkKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncG9fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgY2xhc3M9ImJ0biBidG4tbGluayIgZGF0YS1zcmM9IicgLiByb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICR2YWx1ZXMtPmlkKSAuICciPicgLiAkdmFsdWVzLT5yZWZlcmVuY2Vfbm8gLiAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMpID8gKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lIC4gJyAoJyAuICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5jb2RlIC4gJyknIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgnc3VwcGxpZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdzdXBwbGllcnMnLCAnc3VwcGxpZXJzLmlkJywgJz0nLCAncXVvdGF0aW9ucy5zdXBwbGllcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubykgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3F1b3RhdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWxpdmVyeV9kYXRlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZGVsaXZlcnlfZGF0ZSkgPyBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZQogICAgICAgICAgICAgICAgICAgICAgICAoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5kZWxpdmVyeV9kYXRlKSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZWxpdmVyeV9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2RlbGl2ZXJ5X2RhdGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdkZWxpdmVyeV9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFF1b3RhdGlvbnM6OnNlbGVjdCgncXVvdGF0aW9ucy5kZWxpdmVyeV9kYXRlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3F1b3RhdGlvbnMuaWQnLCAncHVyY2hhc2Vfb3JkZXJzLnF1b3RhdGlvbl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigndG90YWxfcHJpY2UnLCBmdW5jdGlvbiAoJHZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCkgPyAkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCA6ICcnKSAuICcgJyAuIHN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPnRvdGFsX3ByaWNlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uICgkdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sIDogJycpIC4gJyAnIC4gc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dmF0KSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2dyb3NzX3ByaWNlJywgZnVuY3Rpb24gKCR2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wgOiAnJykgLiAnICcgLiBzeXN0ZW1Nb25leUZvcm1hdCgkdmFsdWVzLT5ncm9zc19wcmljZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJHZhbHVlcykgdXNlICgkb3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnIDxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInIC4gcm91dGUoJ3Btcy5iaWxsaW5nLWF1ZGl0LnBvLmludm9pY2UucHJpbnQnLCAkdmFsdWVzLT5pZCkgLiAnIiAgdGl0bGU9IlB1cmNoYXNlIE9yZGVyIFByaW50IFZpZXciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIG0tMSI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPjwvYT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwoKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsICdzdXBwbGllcicsICd0b3RhbF9wcmljZScsICd2YXQnLCAnZ3Jvc3NfcHJpY2UnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnB1cmNoYXNlLnJlY2VpdmFibGUtbGlzdCcsIFsndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cmVjZWl2YWJsZUhlYWRlckNvbHVtbnMoKV0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKfQo=