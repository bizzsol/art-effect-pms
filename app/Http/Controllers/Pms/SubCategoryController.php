<?php
bolt_decrypt( __FILE__ , 'y9q92r'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSW1wb3J0c1xDYXRlZ29yeUltcG9ydDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdEF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeURlcGFydG1lbnQ7CnVzZSBBcHBcTW9kZWxzXEhyXERlcGFydG1lbnQ7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcVmFsaWRhdGlvblxSdWxlOwp1c2UgTWFhdHdlYnNpdGVcRXhjZWxcRmFjYWRlc1xFeGNlbDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEF0dHJpYnV0ZU9wdGlvbjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeUF0dHJpYnV0ZTsKCnVzZSBEQiwgRGF0YVRhYmxlczsKCmNsYXNzIFN1YkNhdGVnb3J5Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2R1Y3RfdHlwZScsICdwcm9kdWN0X3R5cGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydtYWluX2NhdGVnb3J5JywgJ21haW5fY2F0ZWdvcnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjb2RlJywgJ2NvZGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyduYW1lJywgJ25hbWUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhdHRyaWJ1dGVzJywgJ2F0dHJpYnV0ZXMnXSwKICAgICAgICAgICAgWydzZXJ2aWNlJywgJ3NlcnZpY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzYWxlX2l0ZW0nLCAnc2FsZV9pdGVtJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJ10KICAgICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gJ1N1YiBDYXRlZ29yeSc7CgogICAgICAgICAgICAkaXNfZml4ZWRfYXNzZXQgPSByZXF1ZXN0KCktPmhhcygnZml4ZWQtYXNzZXRzJyk7CiAgICAgICAgICAgICRpc19jd2lwID0gcmVxdWVzdCgpLT5oYXMoJ2N3aXAnKTsKCiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmhhcygnY2F0ZWdvcnknKQogICAgICAgICAgICAtPndpdGgoWydjYXRlZ29yeScsICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZSddKQogICAgICAgICAgICAvLyAtPndoZXJlKCdpc19maXhlZF9hc3NldCcsICRpc19maXhlZF9hc3NldCkKICAgICAgICAgICAgLy8gLT53aGVyZSgnaXNfY3dpcCcsICRpc19jd2lwKQogICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdwYXJlbnRfaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgJGF0dHJpYnV0ZU9wdGlvbnMgPSBBdHRyaWJ1dGVPcHRpb246OmFsbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRjYXRlZ29yaWVzKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncHJvZHVjdF90eXBlJywgZnVuY3Rpb24oJHN1YkNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN1YkNhdGVnb3J5LT5jYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMSA/ICdGaXhlZCBBc3NldCcgOiAoJHN1YkNhdGVnb3J5LT5jYXRlZ29yeS0+aXNfY3dpcCA9PSAxID8gJ0NXSVAnIDogJ1Byb2R1Y3RzJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3NlcnZpY2UnLCBmdW5jdGlvbiAoJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNhdGVnb3J5LT5pc19zZXJ2aWNlID09IDEgPyAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPlllczwvYT4nIDogJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj5ObzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzYWxlX2l0ZW0nLCBmdW5jdGlvbiAoJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNhdGVnb3J5LT5pc19zYWxlX2l0ZW0gPT0gMSA/ICc8YSBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+WWVzPC9hPicgOiAnPGEgY2xhc3M9ImJ0biBidG4tZGFyayBidG4teHMiPk5vPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ21haW5fY2F0ZWdvcnknLCBmdW5jdGlvbigkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lKT8kc3ViQ2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lOicnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdtYWluX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2F0dHJpYnV0ZXMnLCBmdW5jdGlvbiAoJHN1YkNhdGVnb3J5KSB1c2UoJGF0dHJpYnV0ZU9wdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhdHRyID0nJzsKICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlcyA9IGlzc2V0KCRzdWJDYXRlZ29yeS0+YXR0cmlidXRlc1swXSkgPyBjb2xsZWN0KCRzdWJDYXRlZ29yeS0+YXR0cmlidXRlcyktPnNvcnRCeSgnc2VyaWFsJyktPnZhbHVlcygpLT5hbGwoKSA6IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlc1swXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHIgLj0nPHVsPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRhdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGNhdGVnb3J5QXR0cmlidXRlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0ciAuPSc8bGk+PHN0cm9uZz4nLiRjYXRlZ29yeUF0dHJpYnV0ZS0+YXR0cmlidXRlLT5uYW1lLic6PC9zdHJvbmc+ICcuJGF0dHJpYnV0ZU9wdGlvbnMtPndoZXJlKCdhdHRyaWJ1dGVfaWQnLCAkY2F0ZWdvcnlBdHRyaWJ1dGUtPmF0dHJpYnV0ZV9pZCktPndoZXJlSW4oJ2lkJywgKCFlbXB0eSgkY2F0ZWdvcnlBdHRyaWJ1dGUtPm9wdGlvbnMpID8ganNvbl9kZWNvZGUoJGNhdGVnb3J5QXR0cmlidXRlLT5vcHRpb25zLCB0cnVlKSA6IFtdKSktPnBsdWNrKCduYW1lJyktPmltcGxvZGUoJywgJykuJzwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHIgLj0nPC91bD4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGF0dHI7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2F0dHJpYnV0ZXMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdhdHRyaWJ1dGVzLmF0dHJpYnV0ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KS0+b3JXaGVyZUhhcygnYXR0cmlidXRlcy5hdHRyaWJ1dGUub3B0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdhdHRyaWJ1dGVzJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ2F0ZWdvcnlBdHRyaWJ1dGU6OnNlbGVjdCgnYXR0cmlidXRlcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdhdHRyaWJ1dGVzJywgJ2F0dHJpYnV0ZXMuaWQnLCAnPScsICdjYXRlZ29yeV9hdHRyaWJ1dGVzLmF0dHJpYnV0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2NhdGVnb3J5X2F0dHJpYnV0ZXMuY2F0ZWdvcnlfaWQnLCAnY2F0ZWdvcmllcy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkc3ViQ2F0ZWdvcnkpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JzxhIGhyZWY9IicudXJsKCdwbXMvcHJvZHVjdC1tYW5hZ2VtZW50L3N1Yi1jYXRlZ29yeS8nLiRzdWJDYXRlZ29yeS0+aWQuJy9jcmVhdGUtYXR0cmlidXRlcycpLiciIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgbS0xIGJ0bi14cyI+PGkgY2xhc3M9ImxhcyBsYS1zaXRlbWFwIj48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICR1cmwgPSByb3V0ZSgncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5zdWItY2F0ZWdvcnkuZWRpdCcsICRzdWJDYXRlZ29yeS0+aWQpOwogICAgICAgICAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdmaXhlZC1hc3NldHMnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9maXhlZC1hc3NldHMvc3ViLWNhdGVnb3J5L2VkaXQvJy4kc3ViQ2F0ZWdvcnktPmlkLic/Zml4ZWQtYXNzZXRzJyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmhhcygnY3dpcCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHVybCA9IHVybCgncG1zL2N3aXAvc3ViLWNhdGVnb3J5LycuJHN1YkNhdGVnb3J5LT5pZC4nL2VkaXQ/Y3dpcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iJy4gJHVybCAuJyIgY2xhc3M9ImJ0biBidG4taW5mbyBtLTEgYnRuLXhzIj48aSBjbGFzcz0ibGFzIGxhLWVkaXQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBkYXRhLXJvbGU9ImRlbGV0ZSIgZGF0YS1zcmM9IicuIHJvdXRlKCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LnN1Yi1jYXRlZ29yeS5kZXN0cm95JywgJHN1YkNhdGVnb3J5LT5pZCkgLiciIGNsYXNzPSJidG4gYnRuLWRhbmdlciBtLTEgYnRuLXhzIGRlbGV0ZUJ0biIgb25jbGljaz0iZGVsZXRlRnJvbUNSVUQoJCh0aGlzKSkiPjxpIGNsYXNzPSJsYXMgbGEtdHJhc2giPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2F0dHJpYnV0ZXMnLCAnYWN0aW9ucycsICdzZXJ2aWNlJywgJ3NhbGVfaXRlbSddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3ViLWNhdGVnb3J5LmluZGV4JyxbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+JHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgICAgICAnaXNfZml4ZWRfYXNzZXQnID0+ICRpc19maXhlZF9hc3NldCwKICAgICAgICAgICAgICAgICdpc19jd2lwJyA9PiAkaXNfY3dpcCwKICAgICAgICAgICAgXSk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCd1cGRhdGUtY2F0ZWdvcnktZGVwYXJ0bWVudHMnKSl7CiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OmhhcygnY2F0ZWdvcnknKS0+ZG9lc250SGF2ZSgnZGVwYXJ0bWVudHNMaXN0JyktPmdldCgpOwogICAgICAgICAgICAkZGVwYXJ0bWVudHMgPSBEZXBhcnRtZW50OjphbGwoKTsKICAgICAgICAgICAgaWYoJGNhdGVnb3JpZXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGNhdGVnb3JpZXMgYXMgJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICAkY2F0ZWdvcnktPmRlcGFydG1lbnQoKS0+c3luYygkZGVwYXJ0bWVudHMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdnZXQtY2F0ZWdvcmllcycpKXsKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6d2l0aChbCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnknLCAnZGVwYXJ0bWVudHNMaXN0JwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2NhdGVnb3J5JykKICAgICAgICAgICAgLT5vcmRlcmJ5KCdjb2RlJywgJ2FzYycpCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgncHJvZHVjdF90eXBlJykgPT0gJ3Byb2R1Y3RzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19maXhlZF9hc3NldCcsIDApLT53aGVyZSgnaXNfY3dpcCcsIDApOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfdHlwZScpID09ICdmaXhlZF9hc3NldCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZml4ZWRfYXNzZXQnLCAxKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X3R5cGUnKSA9PSAnY3dpcCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfY3dpcCcsIDEpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGRhdGEgPSAnJzsKICAgICAgICAgICAgaWYoaXNzZXQoJGNhdGVnb3JpZXNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGNhdGVnb3JpZXMgYXMgJGNhdGVnb3J5KXsKICAgICAgICAgICAgICAgICAgICBpZighaXNzZXQoJGNhdGVnb3J5LT5jYXRlZ29yeS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgLj0gJzxvcHRpb24gdmFsdWU9IicuJGNhdGVnb3J5LT5pZC4nIiAnLihyZXF1ZXN0KCktPmdldCgnc2VsZWN0ZWQnKSA9PSAkY2F0ZWdvcnktPmlkID8gJ3NlbGVjdGVkJyA6ICcnKS4nIGRhdGEtZGVwYXJ0bWVudHM9IicuJGNhdGVnb3J5LT5kZXBhcnRtZW50c0xpc3QtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPmltcGxvZGUoJywnKS4nIiBpbnZlbnRvcnlfYWNjb3VudF9pZD0iJy4kY2F0ZWdvcnktPmludmVudG9yeV9hY2NvdW50X2lkLiciIGN3aXBfYXNzZXRfYWNjb3VudF9pZD0iJy4kY2F0ZWdvcnktPmN3aXBfYXNzZXRfYWNjb3VudF9pZC4nIiBjb2dzX2FjY291bnRfaWQ9IicuJGNhdGVnb3J5LT5jb2dzX2FjY291bnRfaWQuJyIgaW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnRfaWQ9IicuJGNhdGVnb3J5LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZC4nIiBpc19maXhlZF9hc3NldD0iJy4kY2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0LiciIGlzX2N3aXA9IicuJGNhdGVnb3J5LT5pc19jd2lwLiciICBkZXByZWNpYXRpb25fcmF0ZT0iJy4kY2F0ZWdvcnktPmRlcHJlY2lhdGlvbl9yYXRlLiciIHNhbGVzX2FjY291bnRfaWQ9IicuJGNhdGVnb3J5LT5zYWxlc19hY2NvdW50X2lkLiciIGRlcHJlY2lhdGlvbl9jb3N0X2FjY291bnRfaWQ9IicuJGNhdGVnb3J5LT5kZXByZWNpYXRpb25fY29zdF9hY2NvdW50X2lkLiciIGRlcHJlY2lhdGlvbl9kaXNwb3NhbF9hY2NvdW50X2lkPSInLiRjYXRlZ29yeS0+ZGVwcmVjaWF0aW9uX2Rpc3Bvc2FsX2FjY291bnRfaWQuJyIgZGF0YS1wcm9kdWN0LXR5cGU9IicucmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfdHlwZScpLiciIGRhdGEtc2VydmljZT0iJy4kY2F0ZWdvcnktPmlzX3NlcnZpY2UuJyI+Jy4kY2F0ZWdvcnktPm5hbWUuJyAoJy4kY2F0ZWdvcnktPmNvZGUuJyApJy4nPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkZGF0YTsKICAgICAgICB9CgogICAgICAgICR0aXRsZSA9ICJTdWIgQ2F0ZWdvcnkgQ3JlYXRlIjsKICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb25UeXBlOjphbGwoKTsKICAgICAgICAkZGVwYXJ0bWVudHMgPSBEZXBhcnRtZW50OjphbGwoKTsKICAgICAgICAkY29kZSA9IHVuaXF1ZUNvZGUoNywnQ1QtJywnY2F0ZWdvcmllcycsJ2lkJyk7CiAgICAgICAgJGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMgPSBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCBbXSk7CgogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5zdWItY2F0ZWdvcnkuY3JlYXRlJywgY29tcGFjdCgndGl0bGUnLCdyZXF1aXNpdGlvbnMnLCdkZXBhcnRtZW50cycsJ2NvZGUnLCAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlQXR0cmlidXRlcygkY2F0ZWdvcnlfaWQpCiAgICB7CiAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGNhdGVnb3J5X2lkKTsKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAiQXR0cmlidXRlcyBmb3IgIyIuJGNhdGVnb3J5LT5uYW1lLAogICAgICAgICAgICAnc3ViY2F0ZWdvcnknID0+ICRjYXRlZ29yeSwKICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnID0+IEF0dHJpYnV0ZTo6aGFzKCdvcHRpb25zJyktPndpdGgoWydvcHRpb25zJ10pLT5nZXQoKSwKICAgICAgICAgICAgJ2NhdGVnb3J5QXR0cmlidXRlcycgPT4gQ2F0ZWdvcnlBdHRyaWJ1dGU6OndoZXJlKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeS0+aWQpLT5wbHVjaygnYXR0cmlidXRlX2lkJyktPnRvQXJyYXkoKSwKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuc3ViLWNhdGVnb3J5LmF0dHJpYnV0ZXMnLCAkZGF0YSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZUF0dHJpYnV0ZXMoUmVxdWVzdCAkcmVxdWVzdCwgJGlkKQogICAgewogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5maWxsKCRyZXF1ZXN0LT5hbGwoKSktPnNhdmUoKTsKCiAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0QXR0cmlidXRlc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnByb2R1Y3RBdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGF0dHJpYnV0ZV9pZCkgewogICAgICAgICAgICAgICAgICAgIENhdGVnb3J5QXR0cmlidXRlOjp1cGRhdGVPckNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlX2lkJyA9PiAkYXR0cmlidXRlX2lkCiAgICAgICAgICAgICAgICAgICAgXSwgWwogICAgICAgICAgICAgICAgICAgICAgICAnc2VyaWFsJyA9PiAkcmVxdWVzdC0+YXR0cmlidXRlU2VyaWFsc1skYXR0cmlidXRlX2lkXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ29wdGlvbnMnID0+IGpzb25fZW5jb2RlKCRyZXF1ZXN0LT5hdHRyaWJ1dGVPcHRpb25zWyRhdHRyaWJ1dGVfaWRdKSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgQ2F0ZWdvcnlBdHRyaWJ1dGU6OndoZXJlKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeS0+aWQpCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignYXR0cmlidXRlX2lkJywgJHJlcXVlc3QtPnByb2R1Y3RBdHRyaWJ1dGVzKQogICAgICAgICAgICAtPmRlbGV0ZSgpOwoKICAgICAgICAgICAgJHByb2R1Y3RBdHRyaWJ1dGVzID0gUHJvZHVjdEF0dHJpYnV0ZTo6d2hlcmVIYXMoJ2F0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUuY2F0ZWdvcmllcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjYXRlZ29yeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnktPmlkKTsKICAgICAgICAgICAgfSktPmdldCgpOwoKICAgICAgICAgICAgaWYoaXNzZXQoJHByb2R1Y3RBdHRyaWJ1dGVzWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRwcm9kdWN0QXR0cmlidXRlcyBhcyAka2V5ID0+ICRwcm9kdWN0QXR0cmlidXRlKXsKICAgICAgICAgICAgICAgICAgICAkc2VyaWFsID0gQ2F0ZWdvcnlBdHRyaWJ1dGU6OndoZXJlKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeS0+aWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYXR0cmlidXRlLm9wdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZHVjdEF0dHJpYnV0ZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRwcm9kdWN0QXR0cmlidXRlLT5hdHRyaWJ1dGVfb3B0aW9uX2lkKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdEF0dHJpYnV0ZS0+c2VyaWFsX25vID0gKGlzc2V0KCRzZXJpYWwtPnNlcmlhbCkgPyAkc2VyaWFsLT5zZXJpYWwgOiAwKTsKICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdEF0dHJpYnV0ZS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdTdWIgQ2F0ZWdvcnkgQXR0cmlidXRlcyBoYXZlIGJlbm4gdXBkYXRlZC4gJyk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAnY29kZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NScsICd1bmlxdWU6Y2F0ZWdvcmllcyddLAogICAgICAgICAgICAnbmFtZScgPT4gWydyZXF1aXJlZCcsICdzdHJpbmcnLCAnbWF4OjI1NSddLAogICAgICAgICAgICAncGFyZW50X2lkJyA9PiBbJ251bGxhYmxlJywgJ2ludGVnZXInXSwKICAgICAgICAgICAgLy8gJ3JlcXVpc2l0aW9uX3R5cGVfaWQnID0+IFsncmVxdWlyZWQnLCAnaW50ZWdlciddLAogICAgICAgIF0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRpbnB1dHMgPSAkcmVxdWVzdC0+YWxsKCk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ190b2tlbiddKTsKICAgICAgICAgICAgdW5zZXQoJGlucHV0c1snX21ldGhvZCddKTsKCiAgICAgICAgICAgICRjYXRlZ29yeSA9IENhdGVnb3J5OjpjcmVhdGUoJGlucHV0cyk7CgogICAgICAgICAgICAkcGFyZW50ID0gQ2F0ZWdvcnk6OmZpbmQoJHJlcXVlc3QtPnBhcmVudF9pZCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPSAkcGFyZW50LT5pc19maXhlZF9hc3NldDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19jd2lwID0gJHBhcmVudC0+aXNfY3dpcDsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19zZXJ2aWNlID0gJHBhcmVudC0+aXNfc2VydmljZTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19zYWxlX2l0ZW0gPSAkcGFyZW50LT5pc19zYWxlX2l0ZW07CiAgICAgICAgICAgICRjYXRlZ29yeS0+c2F2ZSgpOwoKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gQ2F0ZWdvcnlEZXBhcnRtZW50Ojp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkcmVxdWVzdC0+cGFyZW50X2lkKS0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkY2F0ZWdvcnktPmRlcGFydG1lbnQoKS0+c3luYygkZGVwYXJ0bWVudHMpOwoKICAgICAgICAgICAgLy8gcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnU3ViIENhdGVnb3J5IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JywncG1zLnByb2R1Y3QtbWFuYWdlbWVudC5zdWItY2F0ZWdvcnkuaW5kZXgnKTsKCiAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9wcm9kdWN0LW1hbmFnZW1lbnQvc3ViLWNhdGVnb3J5Jyk7CiAgICAgICAgICAgIGlmKCRwYXJlbnQtPmlzX2ZpeGVkX2Fzc2V0ID09IDEpewogICAgICAgICAgICAgICAgJHVybCA9IHVybCgncG1zL2ZpeGVkLWFzc2V0cy9zdWItY2F0ZWdvcnknKS4nP2ZpeGVkLWFzc2V0cyc7CiAgICAgICAgICAgIH1lbHNlaWYoJHBhcmVudC0+aXNfY3dpcCA9PSAxKXsKICAgICAgICAgICAgICAgICR1cmwgPSB1cmwoJ3Btcy9jd2lwL3N1Yi1jYXRlZ29yeScpLic/Y3dpcCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+dXJsUmVkaXJlY3RCYWNrKCdTdWIgQ2F0ZWdvcnkgdXBkYXRlZCBzdWNjZXNzZnVsbHknLCAkdXJsLCAnc3VjY2VzcycpOwogICAgICAgICAgICAKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRjYXRlZ29yeV9pZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6ZmluZE9yRmFpbCgkY2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAkY2F0ZWdvcnktPnNyYyA9IHJvdXRlKCdwbXMucHJvZHVjdC1tYW5hZ2VtZW50LnN1Yi1jYXRlZ29yeS51cGRhdGUnLCAkY2F0ZWdvcnktPmlkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5yZXFfdHlwZSA9ICdwdXQnOwogICAgICAgICAgICAkY2F0ZWdvcnktPnBhcmVudF9pZCA9ICEkY2F0ZWdvcnktPmNhdGVnb3J5P251bGw6JGNhdGVnb3J5LT5jYXRlZ29yeTsKCiAgICAgICAgICAgICRhcnJheT1bXTsKICAgICAgICAgICAgZm9yZWFjaCgkY2F0ZWdvcnktPmRlcGFydG1lbnRzTGlzdCBhcyAka2V5ID0+ICRkZXBhcnRtZW50KXsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGFycmF5LCRkZXBhcnRtZW50LT5ocl9kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG5ld19hcnJheT1bXTsKCiAgICAgICAgICAgIGZvcmVhY2goRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsJGFycmF5KS0+c2VsZWN0KCdocl9kZXBhcnRtZW50X2lkJyktPmdldCgpIGFzICR2YWx1ZXMpewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbmV3X2FycmF5LCAkdmFsdWVzLT5ocl9kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnknID0+ICRjYXRlZ29yeSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50cycgPT4gRGVwYXJ0bWVudDo6YWxsKCksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudHNJZCc9PkRlcGFydG1lbnQ6OndoZXJlSW4oJ2hyX2RlcGFydG1lbnRfaWQnLCRhcnJheSktPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPmFsbCgpLAogICAgICAgICAgICAgICAgJ2ludmVudG9yeV9hY2NvdW50X2lkJyA9PiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAkY2F0ZWdvcnktPmludmVudG9yeV9hY2NvdW50X2lkKSwKICAgICAgICAgICAgICAgICdjb2dzX2FjY291bnRfaWQnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sICRjYXRlZ29yeS0+Y29nc19hY2NvdW50X2lkKSwKICAgICAgICAgICAgICAgICdpbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCcgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgJGNhdGVnb3J5LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCksCiAgICAgICAgICAgIF07CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gbnVsbCwKICAgICAgICAgICAgICAgICdpbmZvJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigkZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgZWRpdGluZyB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZWRpdCgkaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5wYXJlbnRfaWQgPSAhJGNhdGVnb3J5LT5jYXRlZ29yeT9udWxsOiRjYXRlZ29yeS0+Y2F0ZWdvcnk7CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0VkaXQgU3ViLUNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdjYXRlZ29yeScgPT4gJGNhdGVnb3J5LAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgICAgICAgICAtPndpdGgoWwogICAgICAgICAgICAgICAgICAgICdkZXBhcnRtZW50c0xpc3QnLCAnY2F0ZWdvcnknCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5vcmRlcmJ5KCdjb2RlJywgJ2FzYycpCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiBEZXBhcnRtZW50OjphbGwoKSwKICAgICAgICAgICAgICAgICdkZXBhcnRtZW50c0lkJyA9PiAkY2F0ZWdvcnktPmRlcGFydG1lbnRzTGlzdC0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpLAogICAgICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50c09wdGlvbnMnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sIDAsIDAsIFtdKSwKICAgICAgICAgICAgICAgICdwcm9kdWN0X3R5cGUnID0+ICgkY2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0ID09IDEgPyAnZml4ZWRfYXNzZXQnIDogKCRjYXRlZ29yeS0+aXNfY3dpcCA9PSAxID8gJ2N3aXAnIDogJ3Byb2R1Y3RzJykpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN1Yi1jYXRlZ29yeS5lZGl0JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgc3BlY2lmaWVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgICRyZXF1ZXN0CiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkY2F0ZWdvcnlfaWQpCiAgICB7CiAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmRPckZhaWwoJGNhdGVnb3J5X2lkKTsKCiAgICAgICAgJHRoaXMtPnZhbGlkYXRlKCRyZXF1ZXN0LCBbCiAgICAgICAgICAgICdjb2RlJyA9PiBbJ3JlcXVpcmVkJywgJ3N0cmluZycsICdtYXg6MjU1JywgUnVsZTo6dW5pcXVlKCdjYXRlZ29yaWVzJyktPmlnbm9yZSgkY2F0ZWdvcnktPmlkKV0sCiAgICAgICAgICAgICduYW1lJyA9PiBbJ3JlcXVpcmVkJywgJ3N0cmluZycsICdtYXg6MjU1J10sCiAgICAgICAgICAgICdwYXJlbnRfaWQnID0+IFsnbnVsbGFibGUnLCAnaW50ZWdlciddLAogICAgICAgICAgICAvLyAncmVxdWlzaXRpb25fdHlwZV9pZCcgPT4gWydyZXF1aXJlZCcsICdpbnRlZ2VyJ10sCiAgICAgICAgXSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gQ2F0ZWdvcnlEZXBhcnRtZW50Ojp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnktPnBhcmVudF9pZCktPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKCiAgICAgICAgICAgICRpbnB1dHMgPSAkcmVxdWVzdC0+YWxsKCk7CiAgICAgICAgICAgIHVuc2V0KCRpbnB1dHNbJ190b2tlbiddKTsKICAgICAgICAgICAgdW5zZXQoJGlucHV0c1snX21ldGhvZCddKTsKCiAgICAgICAgICAgICRwYXJlbnQgPSBDYXRlZ29yeTo6ZmluZCgkcmVxdWVzdC0+cGFyZW50X2lkKTsKICAgICAgICAgICAgJGNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9ICRwYXJlbnQtPmlzX2ZpeGVkX2Fzc2V0OwogICAgICAgICAgICAkY2F0ZWdvcnktPmlzX2N3aXAgPSAkcGFyZW50LT5pc19jd2lwOwogICAgICAgICAgICAkY2F0ZWdvcnktPnNhdmUoKTsKCiAgICAgICAgICAgICRjYXRlZ29yeS0+dXBkYXRlKCRpbnB1dHMpOwoKICAgICAgICAgICAgJGNhdGVnb3J5LT5kZXBhcnRtZW50KCktPnN5bmMoJGRlcGFydG1lbnRzKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+dXJsUmVkaXJlY3RCYWNrKCdTdWIgQ2F0ZWdvcnkgdXBkYXRlZCBzdWNjZXNzZnVsbHknLCB1cmwoJ3Btcy9wcm9kdWN0LW1hbmFnZW1lbnQvc3ViLWNhdGVnb3J5JyksICdzdWNjZXNzJyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgc3BlY2lmaWVkIHJlc291cmNlIGZyb20gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3koJGNhdGVnb3J5X2lkKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6ZmluZE9yRmFpbCgkY2F0ZWdvcnlfaWQpOwoKICAgICAgICAgICAgaWYgKCRjYXRlZ29yeS0+cHJvZHVjdHMtPmNvdW50KCkgPiAwIHx8ICRjYXRlZ29yeS0+c3ViQ2F0ZWdvcnktPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnU3ViQ2F0ZWdvcnkgY2FuIG5vdCBiZSBkZWxldGVkLicKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkY2F0ZWdvcnktPnN1YkNhdGVnb3J5LT5lYWNoLT5kZWxldGUoKTsKICAgICAgICAgICAgQ2F0ZWdvcnlEZXBhcnRtZW50Ojp3aGVyZSgnY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcnktPmlkKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICRjYXRlZ29yeS0+ZGVsZXRlKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICdTdWJDYXRlZ29yeSBTdWNjZXNzZnVsbHkgRGVsZXRlZC4nCiAgICAgICAgICAgIF0pOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIGltcG9ydENhdGVnb3J5KFJlcXVlc3QgJHJlcXVlc3QpewoKICAgICAgICAkdGhpcy0+dmFsaWRhdGUoJHJlcXVlc3QsIFsKICAgICAgICAgICAgJ2NhdGVnb3J5X2ZpbGUnID0+ICdyZXF1aXJlZHxtaW1lczp4bHMseGxzeCcKICAgICAgICBdKTsKCiAgICAgICAgJHBhdGggPSAkcmVxdWVzdC0+ZmlsZSgnY2F0ZWdvcnlfZmlsZScpLT5nZXRSZWFsUGF0aCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBFeGNlbDo6aW1wb3J0KG5ldyBDYXRlZ29yeUltcG9ydCgpLCAkcGF0aCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygnQ2F0ZWdvcnkgRGF0YSBJbXBvcnRlZCBzdWNjZXNzZnVsbHkuJyk7CgogICAgICAgIH1jYXRjaCAoXE1hYXR3ZWJzaXRlXEV4Y2VsXFZhbGlkYXRvcnNcVmFsaWRhdGlvbkV4Y2VwdGlvbiAkZSkgewoKICAgICAgICAgICAgJGVycm9yTWVzc2FnZT0nJzsKICAgICAgICAgICAgJHJvd051bWJlcj0xOwogICAgICAgICAgICAkcm93TnVtYmVyKz0kZS0+ZmFpbHVyZXMoKVswXS0+cm93KCk7CiAgICAgICAgICAgICRjb2x1bW49JGUtPmZhaWx1cmVzKClbMF0tPmF0dHJpYnV0ZSgpOwoKICAgICAgICAgICAgJGVycm9yTWVzc2FnZS49JGUtPmZhaWx1cmVzKClbMF0tPmVycm9ycygpWzBdLicgZm9yIHJvdyAnLiRyb3dOdW1iZXIuJyBvbiBDb2x1bW4gJy4kY29sdW1uOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCRlcnJvck1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KfQo=