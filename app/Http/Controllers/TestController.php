<?php
bolt_decrypt( __FILE__ , 'JEcrGU'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnM7CnVzZSBBcHBcSGVscGVyc1xFbXBsb3llZUhlbHBlcjsKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xIclxJREdlbmVyYXRvciBhcyBJREdlbmVyYXRvcjsKdXNlIEFwcFxKb2JzXFByb2Nlc3NBdHRlbmRhbmNlSW5PdXRUaW1lOwp1c2UgQXBwXEpvYnNcUHJvY2Vzc0F0dGVuZGFuY2VJbnRpbWU7CnVzZSBBcHBcSm9ic1xQcm9jZXNzQXR0ZW5kYW5jZU91dHRpbWU7CnVzZSBBcHBcSm9ic1xQcm9jZXNzQnV5ZXJTYWxhcnk7CnVzZSBBcHBcSm9ic1xQcm9jZXNzVW5pdFdpc2VTYWxhcnk7CnVzZSBBcHBcTWFpbFxUZXN0TWFpbDsKdXNlIEFwcFxNb2RlbHNcRW1wbG95ZWU7CnVzZSBBcHBcTW9kZWxzXEhyXEFic2VudDsKdXNlIEFwcFxNb2RlbHNcSHJcQWR2YW5jZUluZm87CnVzZSBBcHBcTW9kZWxzXEhyXEF0dGVuZGFjZTsKdXNlIEFwcFxNb2RlbHNcSHJcQXR0ZW5kYWNlTWFudWFsOwp1c2UgQXBwXE1vZGVsc1xIclxIb2xpZGF5Um9hc3RlcjsKdXNlIEFwcFxNb2RlbHNcSHJcSHJMYXRlQ291bnQ7CnVzZSBBcHBcTW9kZWxzXEhyXEhyTW9udGhseVNhbGFyeTsKdXNlIEFwcFxNb2RlbHNcSHJcTGVhdmU7CnVzZSBBcHBcTW9kZWxzXEhyXE1lZGljYWxJbmZvOwp1c2UgQXBwXE1vZGVsc1xIclxTYWxhcnlBZGREZWR1Y3Q7CnVzZSBBcHBcTW9kZWxzXEhyXFNhbGFyeUFkanVzdERldGFpbHM7CnVzZSBBcHBcTW9kZWxzXEhyXFNhbGFyeUFkanVzdE1hc3RlcjsKdXNlIEFwcFxNb2RlbHNcSHJcU2hpZnQ7CnVzZSBBcHBcTW9kZWxzXEhyXFVuaXQ7CnVzZSBBcHBcTW9kZWxzXEhyXFllYXJseUhvbHlEYXk7CnVzZSBBcHBcUmVwb3NpdG9yeVxIclxQYXJ0aWFsU2FsYXJ5UmVwb3NpdG9yeTsKdXNlIENhcmJvblxDYXJib247CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxBcnI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgUERGLCBWYWxpZGF0b3IsIEF1dGgsIEFDTCwgREIsIERhdGFUYWJsZXMsIENhY2hlOwp1c2UgUmFwMmhwb3V0cmVcRmFzdEV4Y2VsXEZhc3RFeGNlbDsKCgpjbGFzcyBUZXN0Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljICR0aW1lb3V0ID0gNTAwOwogICAgcHVibGljICRidXllcjsKICAgIHB1YmxpYyAkbW9udGg7CiAgICBwdWJsaWMgJHllYXI7CiAgICBwdWJsaWMgJGFzSWQ7CiAgICBwdWJsaWMgJGF0dFRhYmxlOwogICAgcHVibGljICRzYWxhcnlUYWJsZTsKCiAgICBwcm90ZWN0ZWQgJHBhcnRpYWxTYWxhcnlSZXBvc2l0b3J5OwoKCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgam9iIGluc3RhbmNlLgogICAgICoKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoUGFydGlhbFNhbGFyeVJlcG9zaXRvcnkgJHBhcnRpYWxTYWxhcnlSZXBvc2l0b3J5KQogICAgewogICAgICAgICR0aGlzLT5wYXJ0aWFsU2FsYXJ5UmVwb3NpdG9yeSA9ICRwYXJ0aWFsU2FsYXJ5UmVwb3NpdG9yeTsKICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIHRlc3QoKQogICAgewogICAgICAgIAoKICAgICAgICAvL3JldHVybiAkdGhpcy0+cHJvY2Vzc0xlZnRTYWxhcnkoKTsKICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgCiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBhY3RpdmVNYXRlcm5pdHkoKQogICAgewogICAgICAgIC8vcmV0dXJuICcnOwogICAgICAgIC8vICRmaXJzdERhdGUgPSBkYXRlKCdZLW0nKS4nLTAxJzsKICAgICAgICAkZmlyc3REYXRlID0gJzIwMjEtMTEtMDEnOwogICAgICAgICR0b2RheSA9IGRhdGUoJ1ktbS1kJyk7CiAgICAgICAgCiAgICAgICAgJGxlYXZlRW5kID0gREI6OnRhYmxlKCdocl9tYXRlcm5pdHlfbGVhdmUnKQogICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV90bycsJz49JywkZmlyc3REYXRlKQogICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV90bycsJzw9JywkdG9kYXkpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgCiAgICAgICAgZm9yZWFjaCgkbGVhdmVFbmQgYXMgJGsgPT4gJGx2KXsKICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgIC0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsICRsdi0+YXNzb2NpYXRlX2lkKQogICAgICAgICAgICAgLT53aGVyZSgnYXNfc3RhdHVzJywgNikKICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAnYXNfc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgICdhc19zdGF0dXNfZGF0ZScgPT4gXENhcmJvblxDYXJib246OnBhcnNlKCRsdi0+bGVhdmVfdG8pLT5hZGREYXkoKS0+dG9EYXRlU3RyaW5nKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbGVhdmVFbmQ7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzTGVmdFNhbGFyeSgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfYXFsIGFzIGEnKQogICAgICAgIC0+c2VsZWN0KCdiLmFzc29jaWF0ZV9pZCcsIERCOjpyYXcoJ21heChpbl9kYXRlKSBhcyBpbl9kYXRlJykpCiAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywnYi5hc19pZCcsJ2EuYXNfaWQnKQogICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCAnPj0nLCAnMjAyMS0xMS0wMScpCiAgICAgICAgLT53aGVyZSgnaW5fZGF0ZScsICc8PScsICcyMDIxLTExLTMxJykKICAgICAgICAtPndoZXJlSW4oJ2IuYXNfc3RhdHVzJyxbMiw1XSkKICAgICAgICAtPndoZXJlKCdiLmFzX3N0YXR1c19kYXRlJywgJzw9JywgJzIwMjEtMTEtMzEnKQogICAgICAgIC8vLT53aGVyZUluKCdiLmFzc29jaWF0ZV9pZCcsWycyMUgxMTUwNDNOJ10pCiAgICAgICAgLT5ncm91cEJ5KCdhLmFzX2lkJykKICAgICAgICAtPnBsdWNrKCdpbl9kYXRlJywnYXNzb2NpYXRlX2lkJyk7CiAgICAgICAgCiAgICAgICAgLy9yZXR1cm4gJGRhdGE7CiAgICAgICAgLy8kZGF0YSA9IFsnMjBGMDI1MDE2RCcgPT4gICcyMDIxLTA4LTMxJ107CiAgICAgICAgCiAgICAgICAgJGxlYXZlID0gREI6OnRhYmxlKCdocl9sZWF2ZScpCiAgICAgICAgIC0+c2VsZWN0KCdsZWF2ZV9hc3NfaWQnLCBEQjo6cmF3KCdtYXgobGVhdmVfdG8pIGFzIGluX2RhdGUnKSkKICAgICAgICAgLT53aGVyZSgnbGVhdmVfdG8nLCc+PScsICcyMDIxLTExLTAxJykKICAgICAgICAgLT53aGVyZUluKCdsZWF2ZV9hc3NfaWQnLCBjb2xsZWN0KCRkYXRhKS0+a2V5cygpLT50b0FycmF5KCkpCiAgICAgICAgIC0+Z3JvdXBCeSgnbGVhdmVfYXNzX2lkJykKICAgICAgICAgLT5wbHVjaygnaW5fZGF0ZScsICdsZWF2ZV9hc3NfaWQnKTsKICAgICAgICAgCiAgICAgICAgCiAgICAgICAgJGRhdGFzID0gRW1wbG95ZWU6OndoZXJlSW4oJ2Fzc29jaWF0ZV9pZCcsIGNvbGxlY3QoJGRhdGEpLT5rZXlzKCktPnRvQXJyYXkoKSkKICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYmVuZWZpdHMgYXMgYmVuJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywnYmVuLmJlbl9hc19pZCcpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAkaWRzID0gY29sbGVjdCgkZGF0YXMpLT5wbHVjaygnYXNzb2NpYXRlX2lkJyk7CgogICAgICAgICRiZW4gPSBEQjo6dGFibGUoJ2hyX2FsbF9naXZlbl9iZW5lZml0cycpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2Fzc29jaWF0ZV9pZCcsJGlkcykKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgICAgIC0+a2V5QnkoJ2Fzc29jaWF0ZV9pZCcpOwogICAgICAgICRoID0gW107CiAgICAgICAgZm9yZWFjaCAoJGRhdGFzIGFzICRrZXkgPT4gJHYpIHsKICAgICAgICAgICAgJGR0ID0gJGRhdGFbJHYtPmFzc29jaWF0ZV9pZF07CiAgICAgICAgICAgIGlmKGlzc2V0KCRsZWF2ZVskdi0+YXNzb2NpYXRlX2lkXSkpewogICAgICAgICAgICAgICAgaWYoJGxlYXZlWyR2LT5hc3NvY2lhdGVfaWRdID4gICRkdCApewogICAgICAgICAgICAgICAgICAgICAkZHQgPSAkbGVhdmVbJHYtPmFzc29jaWF0ZV9pZF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY2hlY2sgaG9saWRheQogICAgICAgICAgICAkZHQgPSAkdGhpcy0+aXNIb2xpZGF5KCR2LT5hc3NvY2lhdGVfaWQsICRkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZigkdi0+c2hpZnRfcm9hc3Rlcl9zdGF0dXMgPT0gMCl7CiAgICAgICAgICAgICAgICAkZHQgPSAkdGhpcy0+aXNHbG9iYWxIb2xpZGF5KCR2LT5hc191bml0X2lkLCAkZHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvL3JldHVybiAkZHQ7CiAgICAgICAgICAgICRzcCA9IGNsb25lICR0aGlzLT5wYXJ0aWFsU2FsYXJ5UmVwb3NpdG9yeTsKICAgICAgICAgICAgJHBxID0gJHNwLT5wcm9jZXNzKCR2LCAkZHQgLCR2LT5hc19zdGF0dXMpOwogICAgICAgICAgICAgJGhbJHYtPmFzc29jaWF0ZV9pZF0gPSAkcHEtPnN0YXR1cy4nLScuJGR0OwogICAgICAgICAgICAvL2RkKCRwcSk7CgogICAgICAgICAgICBpZihpc3NldCgkYmVuWyR2LT5hc3NvY2lhdGVfaWRdKSl7CiAgICAgICAgICAgICAgICAkbGR0ID0gJGJlblskdi0+YXNzb2NpYXRlX2lkXS0+c3RhdHVzX2RhdGU/PyRkdDsKCiAgICAgICAgICAgICAgICBpZigkZHQgPj0gICRsZHQgfHwgJHYtPmFzX3N0YXR1cyA9PSAyKXsKCiAgICAgICAgICAgICAgICAgICAgJGxkdCA9IENhcmJvbjo6cGFyc2UoJGR0KS0+YWRkRGF5KCktPnRvRGF0ZVN0cmluZygpOwogICAgCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICR2LT5hc19pZCkKICAgICAgICAgICAgICAgICAgICAtPnVwZGF0ZShbJ2FzX3N0YXR1c19kYXRlJyA9PiAkbGR0XSk7CgogICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hbGxfZ2l2ZW5fYmVuZWZpdHMnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsICR2LT5hc3NvY2lhdGVfaWQpCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXNfZGF0ZScgPT4gJGxkdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzYWxhcnlfZGF0ZScgPT4gJGR0IAogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICggJGgpOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gbWFrZUhvbGlkYXkoKQogICAgewogICAgICAgICRmaXJzdF9kYXkgPSBkYXRlKCdZLTEyLTMxJyk7CiAgICAgICAgJHllYXIgPSBkYXRlKCdZJywgc3RydG90aW1lKCRmaXJzdF9kYXkpKTsKICAgICAgICAkeWVhck1vbnRoID0gZGF0ZSgnWS9tJywgc3RydG90aW1lKCRmaXJzdF9kYXkpKTsKICAgICAgICAKICAgICAgICAkbW9udGggPSBkYXRlKCdtJywgc3RydG90aW1lKCRmaXJzdF9kYXkpKTsKICAgICAgICAkZGF5X2NvdW50ID0gMzE7CiAgICAgICAgJGRhdGVfYnlfZGF5ID0gW107CiAgICAgICAgZm9yICgkaSA9IDE7ICRpIDw9ICRkYXlfY291bnQ7ICRpKyspIHsKICAgICAgICAgICAgJGRhdGUgPSAkeWVhck1vbnRoLicvJy4kaTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRkYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAgICAgJGRheSA9IGRhdGUoJ0QnLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAgICAgJGRhdGVfYnlfZGF5WyRkYXldW10gPSAkZGF0ZTsKICAgICAgICAgICAgLy8kZGF0ZV9ieV9kYXlbXSA9ICRkYXRlOwogICAgICAgIH0KCiAgICAgICAgICAgCiAgICAgICAgJGhvbGlkYXkgPSBEQjo6dGFibGUoJ2hyX3JvYXN0ZXJfaG9saWRheSBhcyByJykKICAgICAgICAgICAgLT5zZWxlY3QoJ3IuKicsJ2IuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgLT53aGVyZSgnYi5zaGlmdF9yb2FzdGVyX3N0YXR1cycsIDEpCiAgICAgICAgICAgIC8vLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLCBbMl0pCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsJ2IuYXNfaWQnLCdyLmFzX2lkJykKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgJGhvbGlkYXlzID0gY29sbGVjdCgkaG9saWRheSkKICAgICAgICAgICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdkYXknKTsKICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAvL3JldHVybiAkaG9saWRheXM7CiAgICAgICAgJGV4aXN0cyA9IERCOjp0YWJsZSgnaG9saWRheV9yb2FzdGVyJykKICAgICAgICAgICAgLT5zZWxlY3QoCiAgICAgICAgICAgICAgICBEQjo6cmF3KCJDT05DQVQoZGF0ZSxhc19pZCkgQVMgcHAiKSwKICAgICAgICAgICAgICAgICdyZW1hcmtzJwogICAgICAgICAgICApCiAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQogICAgICAgICAgICAtPndoZXJlKCd5ZWFyJywgJHllYXIpCiAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgLT5rZXlCeSgncHAnKTsKCiAgICAgICAgZm9yZWFjaCAoJGhvbGlkYXlzIGFzICRrZXkgPT4gJGVtcCkgewogICAgICAgICAgICAkaW5zID0gW107CiAgICAgICAgICAgIGZvcmVhY2ggKCRlbXAgYXMgJGsxID0+ICRoKSB7CiAgICAgICAgICAgICAgICBpZihpc3NldCgkZGF0ZV9ieV9kYXlbJGtleV0pKXsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGVfYnlfZGF5WyRrZXldIGFzICRrID0+ICR2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZighaXNzZXQoJGV4aXN0c1skdi4kaC0+YXNzb2NpYXRlX2lkXSkpewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNbJHYuJGgtPmFzc29jaWF0ZV9pZF0gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWVhcicgID0+ICR5ZWFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb250aCcgPT4gJG1vbnRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19pZCcgPT4gJGgtPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZScgID0+ICAkdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgICA9PiAnSG9saWRheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hYnNlbnQnKS0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsJGgtPmFzc29jaWF0ZV9pZCktPndoZXJlKCdkYXRlJywgJHYpLT5kZWxldGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlcicpLT5pbnNlcnRPcklnbm9yZSgkaW5zKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAnZG9uZSc7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBtYWtlaG9saWRheUUoKQogICAgewogICAgICAgICRkYXRhID0gW107CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZm9yZWFjaCgkZGF0YSBhcyAkZCl7CiAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlcicpCiAgICAgICAgICAgICAgICAtPmluc2VydE9ySWdub3JlKFsKICAgICAgICAgICAgICAgICAgICAneWVhcicgID0+IDIwMjEsCiAgICAgICAgICAgICAgICAgICAgJ21vbnRoJyA9PiAnMDInLAogICAgICAgICAgICAgICAgICAgICdhc19pZCcgPT4gJGQsCiAgICAgICAgICAgICAgICAgICAgJ2RhdGUnICA9PiAgJzIwMjEtMDQtMDInLAogICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyAgID0+ICdIb2xpZGF5JywKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gbWFrZWF0dCgpCiAgICB7CiAgICAgICAgJGRhdGEgPSAgREI6OnRhYmxlKCdocl9idXllcl9hdHRfY2VpbDQnKQogICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywnPj0nLCcyMDIxLTAyLTAxJykKICAgICAgICAgICAgLT53aGVyZSgnaW5fZGF0ZScsJzw9JywnMjAyMS0wMi0yOCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2luX3RpbWUnLCAnbGlrZScsICclMDg6MDIlJykKICAgICAgICAgICAgLT53aGVyZSgnbGF0ZV9zdGF0dXMnLDEpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgIAogICAgICAgICAgICAKICAgICAgICBmb3JlYWNoKCRkYXRhIGFzICRrID0+ICR2KXsKICAgICAgICAgICAgJGluID0gQ2FyYm9uOjpwYXJzZSgkdi0+aW5fdGltZSktPmFkZE1pbnV0ZSgpLT5mb3JtYXQoJ1ktbS1kIEg6aTpzJyk7CiAgICAgICAgICAgIERCOjp0YWJsZSgnaHJfYnV5ZXJfYXR0X2NlaWw0JykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywgJHYtPmlkKQogICAgICAgICAgICAgICAgLT51cGRhdGUoWydpbl90aW1lJyA9PiAkaW5dKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICcnOwogICAgICAgIAogICAgICAgIAogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gbGVhdmVIb2xpZGF5KCkKICAgIHsKICAgICAgICAkcm9hc3RlciA9IFsnMjAyMS0wMi0wNScsJzIwMjEtMDItMTInLCcyMDIxLTAyLTEyJ107CiAgICAgICAgJGx2ID0gW107CiAgICAgICAgZm9yZWFjaCgkcm9hc3RlciBhcyAkayA9PiAkdil7CiAgICAgICAgICAgICRjID0gREI6OnRhYmxlKCdocl9sZWF2ZScpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2xlYXZlX2Fzc19pZCcsICR2LT5hc3NvY2lhdGVfaWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdsZWF2ZV9mcm9tJywnPj0nLCR2LT5kYXRlKQogICAgICAgICAgICAgICAgLT53aGVyZSgnbGVhdmVfdG8nLCc8PScsJHYtPmRhdGUpCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYoJGMpewogICAgICAgICAgICAgICAgJGx2W10gPSAkYzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJGx2OwogICAgfQogICAgCiAgICAKCiAgICBwdWJsaWMgZnVuY3Rpb24gam9iY2FyZHVwZGF0ZSgpCiAgICB7CiAgICAgICAgLyokaWQgPSBEQjo6dGFibGUoJ2hyX21vbnRobHlfc2FsYXJ5IGFzIHMnKQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywncy5hc19pZCcsJ2IuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3MubW9udGgnLCAnMDMnKQogICAgICAgICAgICAgICAgLT53aGVyZSgncy55ZWFyJywgMjAyMSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2IuYXNfb3QnLCAxKQogICAgICAgICAgICAgICAgLy8tPndoZXJlKCdzLm90X2hvdXInLCc+JywgMCkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2IuYXNfaWQnKTsqLwogICAgICAgICAgICAgICAgCiAgICAgICAgJGlkID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgLT53aGVyZUluKCdhc3NvY2lhdGVfaWQnLCBbXSktPnBsdWNrKCdhc191bml0X2lkJywnYXNfaWQnKTsKICAgIGZvcmVhY2goJGlkIGFzICRrID0+ICRpKSAgIHsgICAKICAgICAgICAkdGIgPSBnZXRfYXR0X3RhYmxlKCRpKTsKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgkdGIpCiAgICAgICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCc+PScsJzIwMjEtMDMtMDEnKQogICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywnPD0nLCcyMDIxLTAzLTEwJykKICAgICAgICAgICAgLT53aGVyZSgnYXNfaWQnLCAkaykKICAgICAgICAgICAgLT5nZXQoKTsKICAgIAogICAgICAgIGZvcmVhY2ggKCRkYXRhIGFzICRrZXkgPT4gJHYpIAogICAgICAgIHsKICAgICAgICAgICAgaWYoJHYtPmluX3RpbWUgJiYgJHYtPm91dF90aW1lKXsKICAgICAgICAgICAgICAgICRxdWV1ZSA9IChuZXcgUHJvY2Vzc0F0dGVuZGFuY2VPdXR0aW1lKCR0YiwgJGssICRpKSkKICAgICAgICAgICAgICAgICAgICAgICAgLT5kZWxheShDYXJib246Om5vdygpLT5hZGRTZWNvbmRzKDIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goJHF1ZXVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgCgogICAgICAgICAgICAKICAgICAgICB9CiAgICB9CiAgICAgICAgcmV0dXJuIGNvdW50KCRpZCk7CgogICAgfSAKCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlU2FsYXJ5KCkKICAgIHsKICAgICAgICAkaW4gPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicpCiAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBhcyBibicsJ2JuLmJlbl9hc19pZCcsICdiLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgICAgICAvKi0+d2hlcmUoJ2FzX3VuaXRfaWQnLCAyKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfbG9jYXRpb24nLCA3KSovCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICBmb3JlYWNoICgkaW4gYXMgJGsgPT4gJHZhbCkgewogICAgICAgICAgICAjIGNvZGUuLi4KICAgICAgICAgICAgREI6OnRhYmxlKCdocl9tb250aGx5X3NhbGFyeScpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICR2YWwtPmFzc29jaWF0ZV9pZCkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAndW5pdF9pZCcgPT4gJHZhbC0+YXNfdW5pdF9pZCwKICAgICAgICAgICAgICAgICAgICAnZGVzaWduYXRpb25faWQnID0+ICR2YWwtPmFzX2Rlc2lnbmF0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgICdzdWJfc2VjdGlvbl9pZCcgPT4gJHZhbC0+YXNfc3Vic2VjdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAnbG9jYXRpb25faWQnID0+ICR2YWwtPmFzX2xvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICdwYXlfdHlwZScgPT4gJHZhbC0+YmFua19uYW1lCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdkb25lJzsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIG90SG91ckNoZWNrKCkKICAgIHsKICAgICAgICAkZ2V0QmFzaWMgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgIC0+d2hlcmUoJ2FzX290JywgMSkKICAgICAgICAtPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCBbMl0pCiAgICAgICAgLT53aGVyZSgnYXNfc3RhdHVzJywgMSkKICAgICAgICAtPnBsdWNrKCdhc19pZCcpOwogICAgICAgICRnZXRhdCA9IFtdOwogICAgICAgICAgICAkZ2V0RGF0YSA9IERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9jZWlsIEFTIG0nKQogICAgICAgICAgICAtPnNlbGVjdCgnbS4qJywgJ2IuaHJfc2hpZnRfZW5kX3RpbWUnLCAnYi5ocl9zaGlmdF9icmVha190aW1lJykKICAgICAgICAgICAgLT53aGVyZSgnbS5pbl9kYXRlJywgJz49JywnMjAyMS0wMi0wMScpCiAgICAgICAgICAgIC0+d2hlcmUoJ20uaW5fZGF0ZScsICc8PScsJzIwMjEtMDItMjgnKQogICAgICAgICAgICAtPndoZXJlSW4oJ20uYXNfaWQnLCAkZ2V0QmFzaWMpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX3NoaWZ0IEFTIGInLCBmdW5jdGlvbigkcSl7CiAgICAgICAgICAgICAgICAkcS0+b24oJ2IuaHJfc2hpZnRfY29kZScsICdtLmhyX3NoaWZ0X2NvZGUnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZU5vdE51bGwoJ20ub3V0X3RpbWUnKQogICAgICAgICAgICAtPndoZXJlTm90TnVsbCgnbS5pbl90aW1lJykKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgLy8gZGQoJGdldERhdGEpOwogICAgICAgICAgIAogICAgICAgICAgICBmb3JlYWNoICgkZ2V0RGF0YSBhcyAkZGF0YSkgewogICAgICAgICAgICAgICAgJHB1bmNoT3V0ID0gJGRhdGEtPm91dF90aW1lOwogICAgICAgICAgICAgICAgJHNoaWZ0T3V0dGltZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRwdW5jaE91dCkpLicgJy4kZGF0YS0+aHJfc2hpZnRfZW5kX3RpbWU7CiAgICAgICAgICAgICAgICAkb3REaWZmID0gKChzdHJ0b3RpbWUoJHB1bmNoT3V0KSAtIChzdHJ0b3RpbWUoJHNoaWZ0T3V0dGltZSkgKyAoKCRkYXRhLT5ocl9zaGlmdF9icmVha190aW1lICsgMTApICogNjApKSkpLzM2MDA7CiAgICAgICAgICAgICAgICBpZigkb3REaWZmID4gMCAmJiAkZGF0YS0+b3RfaG91ciA8PSAwKXsKICAgICAgICAgICAgICAgICAgICAkZ2V0YXRbJGRhdGEtPmFzX2lkXSA9ICRkYXRhOwogICAgICAgICAgICAgICAgICAgIC8qJHF1ZXVlID0gKG5ldyBQcm9jZXNzQXR0ZW5kYW5jZU91dHRpbWUoJ2hyX2F0dGVuZGFuY2VfY2VpbCcsICRkYXRhLT5pZCwgMikpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+ZGVsYXkoQ2FyYm9uOjpub3coKS0+YWRkU2Vjb25kcygyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKCRxdWV1ZSk7Ki8KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgcmV0dXJuICgkZ2V0YXQpOwogICAgICAgCiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gbGluZUF0dCgpCiAgICB7CiAgICAgICAgLyokdXNlciA9IERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbycpCiAgICAgICAgICAgIC0+d2hlcmUoJ2FzX3VuaXRfaWQnLCAzKQogICAgICAgICAgICAtPndoZXJlKCdhc19sb2NhdGlvbicsIDkpCiAgICAgICAgICAgIC0+cGx1Y2soJ2FzX2xpbmVfaWQnLCAnYXNfaWQnKTsKCiAgICAgICAgZm9yZWFjaCAoJHVzZXIgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfYXFsJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGtleSkKICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsnbGluZV9pZCcgPT4gJHZdKTsKICAgICAgICB9Ki8KCiAgICAgICAgcmV0dXJuICdoaSc7CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gbGluZVVwZGF0ZSgpCiAgICB7CiAgICAgICAgJGxpbmUgPSBEQjo6dGFibGUoJ2hyX2xpbmUnKQogICAgICAgICAgICAgICAgICAgIC0+c2VsZWN0KCdocl9saW5lX25hbWUnLCdocl9saW5lX2lkJywnaHJfbGluZV9mbG9vcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfbGluZV91bml0X2lkJywgMykKICAgICAgICAgICAgICAgICAgICAtPmdldCgpLT5rZXlCeSgnaHJfbGluZV9uYW1lJyk7CgogICAgICAgICRkYXRhID0gICAgICAgICBbXTsKICAgICRuZj0gW107CiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICBpZihpc3NldCgkbGluZVskdlsnTGluZSddXSkpewogICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19vcmFjbGVfY29kZScsICRrZXkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIDMpCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnYXNfbGluZV9pZCcgPT4gJGxpbmVbJHZbJ0xpbmUnXV0tPmhyX2xpbmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdhc19mbG9vcl9pZCcgPT4gJGxpbmVbJHZbJ0xpbmUnXV0tPmhyX2xpbmVfZmxvb3JfaWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkbmYgPSBbJHZbJ0xpbmUnXV07CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheV91bmlxdWUoJG5mKTsKCiAgICB9CgoKICAgIAoKICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzU2FsYXJ5TGVmdCgpCiAgICB7CiAgICAgICAgJGRhdGFzID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvIGFzIGInKQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfbW9udGhseV9zYWxhcnkgYXMgcycsICdzLmFzX2lkJywnYi5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYmVuZWZpdHMgYXMgYmVuJywgJ2Jlbi5iZW5fYXNfaWQnLCAnYi5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzc29jaWF0ZV9pZCcsIFsiMTdFMTAwMTYyTiIsIjE0TTEwMDMwNE4iLCIxN0s3MDAwOTBQIiwiMTdFMTAwMTc3TiIsIjE4RzEwMTg5OE4iLCIxN0E1MDAyNDhPIiwiMThHMTAwMzI5TiIsIjE4SzEwMDg2ME4iLCIxOEMxMDA3OTJOIiwiMThHMTAwNjI5TiIsIjE1TDEwMDQyNU4iLCIwOEIxMDA1MzROIiwiMTFBMTAwNDUxTiIsIjA4QTEwMDUwMU4iLCIxN0QxMDA1MjROIiwiMThBMTAwNzM3TiIsIjE5SzEwNjA3NE4iLCIxOEMxMDExNzVOIgogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3MubW9udGgnLDEyKQogICAgICAgICAgICAgICAgLT53aGVyZSgncy55ZWFyJywyMDIwKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgZm9yZWFjaCAoJGRhdGFzIGFzICRrZXkgPT4gJGRhdGEpIHsKICAgICAgICAgICAgaWYoaXNzZXQoJGRhdGEtPnRvdGFsX3BheWFibGUpKXsKCgogICAgICAgICAgICAgICAgJHBheWFibGUgPSAkZGF0YS0+cHJlc2VudCArICRkYXRhLT5ob2xpZGF5ICsgJGRhdGEtPmFic2VudCArJGRhdGEtPmxlYXZlOwogICAgICAgICAgICAgICAgJHBlckRheUJhc2ljID0gJGRhdGEtPmJlbl9iYXNpYyAvIDMwOwogICAgICAgICAgICAgICAgJHBlckRheUdyb3NzICAgPSAkZGF0YS0+YmVuX2N1cnJlbnRfc2FsYXJ5LyAzMTsKICAgICAgICAgICAgICAgICRhYnNlbnRfZGVkdWN0ID0gKGludCkgKCRkYXRhLT5hYnNlbnQgKiAkcGVyRGF5QmFzaWMpOwoKICAgICAgICAgICAgICAgICRzYWxhcnlQYXlhYmxlID0gJHBlckRheUdyb3NzKiRwYXlhYmxlIC0gKCRhYnNlbnRfZGVkdWN0ICsgJGRhdGEtPnN0YW1wKTsKICAgICAgICAgICAgICAgIGlmKCRkYXRhLT5hc19vdCA9PSAxKXsKICAgICAgICAgICAgICAgICAgICAkb3ZlcnRpbWVfcmF0ZSA9IG51bWJlcl9mb3JtYXQoKCgkZGF0YS0+YmVuX2Jhc2ljLzIwOCkqMiksIDIsICIuIiwgIiIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkb3ZlcnRpbWVfcmF0ZSA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb3RfcGF5YWJsZSA9ICRvdmVydGltZV9yYXRlICogJGRhdGEtPm90X2hvdXI7CgogICAgICAgICAgICAgICAgJHRvdGFsX3BheWFibGUgPSBjZWlsKCRzYWxhcnlQYXlhYmxlICsgJG90X3BheWFibGUgKyRkYXRhLT5hdHRlbmRhbmNlX2JvbnVzICsgJGRhdGEtPnByb2R1Y3Rpb25fYm9udXMpOwogICAgICAgICAgICAgICAgJHNhbCA9IFsKICAgICAgICAgICAgICAgICAgICAnZ3Jvc3MnID0+ICRkYXRhLT5iZW5fY3VycmVudF9zYWxhcnksCiAgICAgICAgICAgICAgICAgICAgJ2Jhc2ljJyA9PiAkZGF0YS0+YmVuX2Jhc2ljLAogICAgICAgICAgICAgICAgICAgICdob3VzZScgPT4gJGRhdGEtPmJlbl9ob3VzZV9yZW50LAogICAgICAgICAgICAgICAgICAgICdvdF9yYXRlJyA9PiAkb3ZlcnRpbWVfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAnc2FsYXJ5X3BheWFibGUnID0+ICRzYWxhcnlQYXlhYmxlLAogICAgICAgICAgICAgICAgICAgICd0b3RhbF9wYXlhYmxlJyA9PiAkdG90YWxfcGF5YWJsZSwKICAgICAgICAgICAgICAgICAgICAnY2FzaF9wYXlhYmxlJyA9PiAkdG90YWxfcGF5YWJsZSwKICAgICAgICAgICAgICAgICAgICAnYWJzZW50X2RlZHVjdCcgPT4gJGFic2VudF9kZWR1Y3QKICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9tb250aGx5X3NhbGFyeScpLT53aGVyZSgnaWQnLCRkYXRhLT5pZCktPnVwZGF0ZSgkc2FsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICdoaSc7CiAgICB9CgogICAKCgogICAgcHVibGljIGZ1bmN0aW9uIG1pZ3JhdGVlbXBsb3llZSgpCiAgICB7CgoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZXhwb3J0UmVwb3J0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CgogICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5kYXRlKSl7CiAgICAgICAgICAgICRkYXRlID0gJHJlcXVlc3QtPmRhdGU7CiAgICAgICAgICAgICRkYXRhID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvIEFTIGInKQogICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBhcyBjJywnYi5hc3NvY2lhdGVfaWQnLCdjLmJlbl9hc19pZCcpCiAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnVuaXRfcGVybWlzc2lvbnMoKSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2IuYXNfbG9jYXRpb24nLCBhdXRoKCktPnVzZXIoKS0+bG9jYXRpb25fcGVybWlzc2lvbnMoKSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKGZ1bmN0aW9uKCRxKSB1c2UgKCRkYXRlKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHEtPndoZXJlKGZ1bmN0aW9uKCRxYSkgdXNlICgkZGF0ZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcWEtPndoZXJlKCdiLmFzX3N0YXR1cycsMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcWEtPndoZXJlKCdiLmFzX2RvaicgLCAnPD0nLCAkZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAkcS0+b3JXaGVyZShmdW5jdGlvbigkcWEpIHVzZSAoJGRhdGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHFhLT53aGVyZUluKCdiLmFzX3N0YXR1cycsWzIsMyw0LDUsNiw3LDhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxYS0+d2hlcmUoJ2IuYXNfc3RhdHVzX2RhdGUnICwgJz4nLCAkZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICAkZGF0YSA9IGNvbGxlY3QoJGRhdGEpLT5rZXlCeSgnYXNzb2NpYXRlX2lkJyk7CiAgICAgICAgICAgICR1bml0cyA9IGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCk7CiAgICAgICAgCiAgICAgICAgICAgICRmaWxlbmFtZSA9ICdFbXBsb3llZSByZWNvcmQgLScuJGRhdGUuJy54bHN4JzsKICAgICAgICAgICAgCiAgICAgICAgICAgICRkZXNpZ25hdGlvbiA9IGRlc2lnbmF0aW9uX2J5X2lkKCk7CiAgICAgICAgICAgICRkZXBhcnRtZW50ID0gZGVwYXJ0bWVudF9ieV9pZCgpOwogICAgICAgICAgICAkc2VjdGlvbiA9IHNlY3Rpb25fYnlfaWQoKTsKICAgICAgICAgICAgJHN1YnNlY3Rpb24gPSBzdWJTZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgICAgICR1bml0ID0gdW5pdF9ieV9pZCgpOwogICAgICAgICAgICAkZXhjZWwgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCAoJHVuaXRzIGFzICRrZXkgPT4gJHUpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJHRhYmxlID0gZ2V0X2F0dF90YWJsZSgkdSkuJyBBUyBhJzsKICAgICAgICAgICAgICAgICRhdHQgPSBEQjo6dGFibGUoJHRhYmxlKQogICAgICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIGFzIGInLCdiLmFzX2lkJywnYS5hc19pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgYXV0aCgpLT51c2VyKCktPnVuaXRfcGVybWlzc2lvbnMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX2xvY2F0aW9uJywgYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2JlbmVmaXRzIGFzIGMnLCdiLmFzc29jaWF0ZV9pZCcsJ2MuYmVuX2FzX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5pbl9kYXRlJywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRhdHQgYXMgJGtleSA9PiAkYSkgewogICAgICAgICAgICAgICAgICAgICRleGNlbFskYS0+YXNzb2NpYXRlX2lkXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAnQXNzb2NpYXRlIElEJyA9PiAkYS0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnT3JhY2xlIElEJyA9PiAkYS0+YXNfb3JhY2xlX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdOYW1lJyA9PiAkYS0+YXNfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ1JGIElEJyA9PiAkYS0+YXNfcmZpZF9jb2RlPz8wLAogICAgICAgICAgICAgICAgICAgICAgICAnRE9KJyA9PiBkYXRlKCdkLU0tWScsIHN0cnRvdGltZSgkYS0+YXNfZG9qKSksCiAgICAgICAgICAgICAgICAgICAgICAgICdDdXJyZW50IFNhbGFyeScgPT4gJGEtPmJlbl9jdXJyZW50X3NhbGFyeSwKICAgICAgICAgICAgICAgICAgICAgICAgJ0Jhc2ljIFNhbGFyeScgPT4gJGEtPmJlbl9iYXNpYywKICAgICAgICAgICAgICAgICAgICAgICAgJ0hvdXNlIFJlbnQnID0+ICRhLT5iZW5faG91c2VfcmVudD8/MCwKICAgICAgICAgICAgICAgICAgICAgICAgJ0Nhc2ggQW1vdW50JyA9PiAkYS0+YmVuX2Nhc2hfYW1vdW50Pz8wLAogICAgICAgICAgICAgICAgICAgICAgICAnQmFuay9Sb2NrZXQnID0+ICRhLT5iZW5fYmFua19hbW91bnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gJGRlc2lnbmF0aW9uWyRhLT5hc19kZXNpZ25hdGlvbl9pZF1bJ2hyX2Rlc2lnbmF0aW9uX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgICAgICdEZXBhcnRtZW50JyA9PiAkZGVwYXJ0bWVudFskYS0+YXNfZGVwYXJ0bWVudF9pZF1bJ2hyX2RlcGFydG1lbnRfbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ1NlY3Rpb24nID0+ICRzZWN0aW9uWyRhLT5hc19zZWN0aW9uX2lkXVsnaHJfc2VjdGlvbl9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICAgICAnU3ViIFNlY3Rpb24nID0+ICRzdWJzZWN0aW9uWyRhLT5hc19zdWJzZWN0aW9uX2lkXVsnaHJfc3Vic2VjX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgICAgICdVbml0JyA9PiAkdW5pdFskYS0+YXNfdW5pdF9pZF1bJ2hyX3VuaXRfc2hvcnRfbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ09UL05PTk9UJyA9PiAkYS0+YXNfb3QgPT0gMT8nT1QnOidOb25PVCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdTdGF0dXMnID0+ICdQcmVzZW50JywKICAgICAgICAgICAgICAgICAgICAgICAgJ0xhdGUnID0+ICRhLT5sYXRlX3N0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgJ09UIEhvdXInID0+IG51bWJlclRvVGltZUNsb2NrRm9ybWF0KCRhLT5vdF9ob3VyKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ0RhdGUnID0+ICRkYXRlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAkZXhjZWxbJGEtPmFzc29jaWF0ZV9pZF1bJ0luIFRpbWUnXSA9ICcnOwogICAgICAgICAgICAgICAgICAgICRleGNlbFskYS0+YXNzb2NpYXRlX2lkXVsnT3V0IFRpbWUnXSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmKCRhLT5pbl90aW1lICE9IG51bGwgJiYgJGEtPnJlbWFya3MgIT0gJ0RTSScpewogICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWxbJGEtPmFzc29jaWF0ZV9pZF1bJ0luIFRpbWUnXSA9IGRhdGUoJ0guaScsIHN0cnRvdGltZSgkYS0+aW5fdGltZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZigkYS0+b3V0X3RpbWUgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGUoJ0g6aScsIHN0cnRvdGltZSgkYS0+b3V0X3RpbWUpKSAhPSAnMDA6MDAnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleGNlbFskYS0+YXNzb2NpYXRlX2lkXVsnT3V0IFRpbWUnXSA9IGRhdGUoJ0guaScsIHN0cnRvdGltZSgkYS0+b3V0X3RpbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZXhjZWxbJGEtPmFzc29jaWF0ZV9pZF1bJ0FzU3RhdHVzJ10gPSAkYS0+YXNfc3RhdHVzOwogICAgICAgICAgICAgICAgICAgICRleGNlbFskYS0+YXNzb2NpYXRlX2lkXVsnQXNTdGF0dXNEYXRlJ10gPSAkYS0+YXNfc3RhdHVzX2RhdGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAkYWIgPSBEQjo6dGFibGUoJ2hyX2Fic2VudCBhcyBhJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIGFzIGInLCdiLmFzc29jaWF0ZV9pZCcsJ2EuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBhcyBjJywnYi5hc3NvY2lhdGVfaWQnLCdjLmJlbl9hc19pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+dW5pdF9wZXJtaXNzaW9ucygpKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc19sb2NhdGlvbicsIGF1dGgoKS0+dXNlcigpLT5sb2NhdGlvbl9wZXJtaXNzaW9ucygpKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2EuZGF0ZScsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgJHVuaXRzKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkbHYgPSBEQjo6dGFibGUoJ2hyX2xlYXZlIGFzIGEnKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsJ2IuYXNzb2NpYXRlX2lkJywnYS5sZWF2ZV9hc3NfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2JlbmVmaXRzIGFzIGMnLCdiLmFzc29jaWF0ZV9pZCcsJ2MuYmVuX2FzX2lkJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2IuYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX2xvY2F0aW9uJywgYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5sZWF2ZV9mcm9tJywgIjw9IiwgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5sZWF2ZV90bycsICI+PSIsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgJHVuaXRzKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkZG8gPSBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlciBhcyBhJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIGFzIGInLCdiLmFzc29jaWF0ZV9pZCcsJ2EuYXNfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2JlbmVmaXRzIGFzIGMnLCdiLmFzc29jaWF0ZV9pZCcsJ2MuYmVuX2FzX2lkJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2IuYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX2xvY2F0aW9uJywgYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5kYXRlJywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLCAkdW5pdHMpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5yZW1hcmtzJywgJ0hvbGlkYXknKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAKCiAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgZm9yZWFjaCAoJGFiIGFzICRrZXkgPT4gJGEpIHsKICAgICAgICAgICAgICAgICRleGNlbFskYS0+YXNzb2NpYXRlX2lkXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICdBc3NvY2lhdGUgSUQnID0+ICRhLT5hc3NvY2lhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ09yYWNsZSBJRCcgPT4gJGEtPmFzX29yYWNsZV9jb2RlLAogICAgICAgICAgICAgICAgICAgICdOYW1lJyA9PiAkYS0+YXNfbmFtZSwKICAgICAgICAgICAgICAgICAgICAnUkYgSUQnID0+ICRhLT5hc19yZmlkX2NvZGU/PzAsCiAgICAgICAgICAgICAgICAgICAgJ0RPSicgPT4gZGF0ZSgnZC1NLVknLCBzdHJ0b3RpbWUoJGEtPmFzX2RvaikpLAogICAgICAgICAgICAgICAgICAgICdDdXJyZW50IFNhbGFyeScgPT4gJGEtPmJlbl9jdXJyZW50X3NhbGFyeSwKICAgICAgICAgICAgICAgICAgICAnQmFzaWMgU2FsYXJ5JyA9PiAkYS0+YmVuX2Jhc2ljLAogICAgICAgICAgICAgICAgICAgICdIb3VzZSBSZW50JyA9PiAkYS0+YmVuX2hvdXNlX3JlbnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgJ0Nhc2ggQW1vdW50JyA9PiAkYS0+YmVuX2Nhc2hfYW1vdW50Pz8wLAogICAgICAgICAgICAgICAgICAgICdCYW5rL1JvY2tldCcgPT4gJGEtPmJlbl9iYW5rX2Ftb3VudD8/MCwKICAgICAgICAgICAgICAgICAgICAnRGVzaWduYXRpb24nID0+ICRkZXNpZ25hdGlvblskYS0+YXNfZGVzaWduYXRpb25faWRdWydocl9kZXNpZ25hdGlvbl9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdEZXBhcnRtZW50JyA9PiAkZGVwYXJ0bWVudFskYS0+YXNfZGVwYXJ0bWVudF9pZF1bJ2hyX2RlcGFydG1lbnRfbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAnU2VjdGlvbicgPT4gJHNlY3Rpb25bJGEtPmFzX3NlY3Rpb25faWRdWydocl9zZWN0aW9uX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgJ1N1YiBTZWN0aW9uJyA9PiAkc3Vic2VjdGlvblskYS0+YXNfc3Vic2VjdGlvbl9pZF1bJ2hyX3N1YnNlY19uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdVbml0JyA9PiAkdW5pdFskYS0+YXNfdW5pdF9pZF1bJ2hyX3VuaXRfc2hvcnRfbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAnT1QvTk9OT1QnID0+ICRhLT5hc19vdCA9PSAxPydPVCc6J05vbk9UJywKICAgICAgICAgICAgICAgICAgICAnU3RhdHVzJyA9PiAnQWJzZW50JywKICAgICAgICAgICAgICAgICAgICAnTGF0ZScgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgJ09UIEhvdXInID0+ICcnLAogICAgICAgICAgICAgICAgICAgICdEYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAnSW4gVGltZScgPT4gICcnLAogICAgICAgICAgICAgICAgICAgICdPdXQgVGltZScgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgJ0FzU3RhdHVzJyA9PiAkYS0+YXNfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAnQXNTdGF0dXNEYXRlJyA9PiAkYS0+YXNfc3RhdHVzX2RhdGUKCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoICgkbHYgYXMgJGtleSA9PiAkYSkgewogICAgICAgICAgICAgICAgJGV4Y2VsWyRhLT5hc3NvY2lhdGVfaWRdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgJ0Fzc29jaWF0ZSBJRCcgPT4gJGEtPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICAgICAnT3JhY2xlIElEJyA9PiAkYS0+YXNfb3JhY2xlX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgJ05hbWUnID0+ICRhLT5hc19uYW1lLAogICAgICAgICAgICAgICAgICAgICdSRiBJRCcgPT4gJGEtPmFzX3JmaWRfY29kZT8/MCwKICAgICAgICAgICAgICAgICAgICAnRE9KJyA9PiBkYXRlKCdkLU0tWScsIHN0cnRvdGltZSgkYS0+YXNfZG9qKSksCiAgICAgICAgICAgICAgICAgICAgJ0N1cnJlbnQgU2FsYXJ5JyA9PiAkYS0+YmVuX2N1cnJlbnRfc2FsYXJ5LAogICAgICAgICAgICAgICAgICAgICdCYXNpYyBTYWxhcnknID0+ICRhLT5iZW5fYmFzaWMsCiAgICAgICAgICAgICAgICAgICAgJ0hvdXNlIFJlbnQnID0+ICRhLT5iZW5faG91c2VfcmVudD8/MCwKICAgICAgICAgICAgICAgICAgICAnQ2FzaCBBbW91bnQnID0+ICRhLT5iZW5fY2FzaF9hbW91bnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgJ0JhbmsvUm9ja2V0JyA9PiAkYS0+YmVuX2JhbmtfYW1vdW50Pz8wLAogICAgICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gJGRlc2lnbmF0aW9uWyRhLT5hc19kZXNpZ25hdGlvbl9pZF1bJ2hyX2Rlc2lnbmF0aW9uX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgJ0RlcGFydG1lbnQnID0+ICRkZXBhcnRtZW50WyRhLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdTZWN0aW9uJyA9PiAkc2VjdGlvblskYS0+YXNfc2VjdGlvbl9pZF1bJ2hyX3NlY3Rpb25fbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAnU3ViIFNlY3Rpb24nID0+ICRzdWJzZWN0aW9uWyRhLT5hc19zdWJzZWN0aW9uX2lkXVsnaHJfc3Vic2VjX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgJ1VuaXQnID0+ICR1bml0WyRhLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdPVC9OT05PVCcgPT4gJGEtPmFzX290ID09IDE/J09UJzonTm9uT1QnLAogICAgICAgICAgICAgICAgICAgICdTdGF0dXMnID0+ICdMZWF2ZScsCiAgICAgICAgICAgICAgICAgICAgJ0xhdGUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICdPVCBIb3VyJyA9PiAnJywKICAgICAgICAgICAgICAgICAgICAnRGF0ZScgPT4gJGRhdGUsCiAgICAgICAgICAgICAgICAgICAgJ0luIFRpbWUnID0+ICAnJywKICAgICAgICAgICAgICAgICAgICAnT3V0IFRpbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICdBc1N0YXR1cycgPT4gJGEtPmFzX3N0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgJ0FzU3RhdHVzRGF0ZScgPT4gJGEtPmFzX3N0YXR1c19kYXRlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoICgkZG8gYXMgJGtleSA9PiAkYSkgewogICAgICAgICAgICAgICAgJGV4Y2VsWyRhLT5hc3NvY2lhdGVfaWRdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgJ0Fzc29jaWF0ZSBJRCcgPT4gJGEtPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICAgICAnT3JhY2xlIElEJyA9PiAkYS0+YXNfb3JhY2xlX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgJ05hbWUnID0+ICRhLT5hc19uYW1lLAogICAgICAgICAgICAgICAgICAgICdSRiBJRCcgPT4gJGEtPmFzX3JmaWRfY29kZT8/MCwKICAgICAgICAgICAgICAgICAgICAnRE9KJyA9PiBkYXRlKCdkLU0tWScsIHN0cnRvdGltZSgkYS0+YXNfZG9qKSksCiAgICAgICAgICAgICAgICAgICAgJ0N1cnJlbnQgU2FsYXJ5JyA9PiAkYS0+YmVuX2N1cnJlbnRfc2FsYXJ5LAogICAgICAgICAgICAgICAgICAgICdCYXNpYyBTYWxhcnknID0+ICRhLT5iZW5fYmFzaWMsCiAgICAgICAgICAgICAgICAgICAgJ0hvdXNlIFJlbnQnID0+ICRhLT5iZW5faG91c2VfcmVudD8/MCwKICAgICAgICAgICAgICAgICAgICAnQ2FzaCBBbW91bnQnID0+ICRhLT5iZW5fY2FzaF9hbW91bnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgJ0JhbmsvUm9ja2V0JyA9PiAkYS0+YmVuX2JhbmtfYW1vdW50Pz8wLAogICAgICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gJGRlc2lnbmF0aW9uWyRhLT5hc19kZXNpZ25hdGlvbl9pZF1bJ2hyX2Rlc2lnbmF0aW9uX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgJ0RlcGFydG1lbnQnID0+ICRkZXBhcnRtZW50WyRhLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdTZWN0aW9uJyA9PiAkc2VjdGlvblskYS0+YXNfc2VjdGlvbl9pZF1bJ2hyX3NlY3Rpb25fbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAnU3ViIFNlY3Rpb24nID0+ICRzdWJzZWN0aW9uWyRhLT5hc19zdWJzZWN0aW9uX2lkXVsnaHJfc3Vic2VjX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgJ1VuaXQnID0+ICR1bml0WyRhLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICdPVC9OT05PVCcgPT4gJGEtPmFzX290ID09IDE/J09UJzonTm9uT1QnLAogICAgICAgICAgICAgICAgICAgICdTdGF0dXMnID0+ICdEYXkgT2ZmJywKICAgICAgICAgICAgICAgICAgICAnTGF0ZScgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgJ09UIEhvdXInID0+ICcnLAogICAgICAgICAgICAgICAgICAgICdEYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAnSW4gVGltZScgPT4gICcnLAogICAgICAgICAgICAgICAgICAgICdPdXQgVGltZScgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgJ0FzU3RhdHVzJyA9PiAkYS0+YXNfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAnQXNTdGF0dXNEYXRlJyA9PiAkYS0+YXNfc3RhdHVzX2RhdGUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvcmVhY2ggKCRkYXRhIGFzICRrZXkgPT4gJGEpIHsKICAgICAgICAgICAgICAgIGlmKCFpc3NldCgkZXhjZWxbJGEtPmFzc29jaWF0ZV9pZF0pKXsKCiAgICAgICAgICAgICAgICAgICAgJGV4Y2VsWyRhLT5hc3NvY2lhdGVfaWRdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICdBc3NvY2lhdGUgSUQnID0+ICRhLT5hc3NvY2lhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdPcmFjbGUgSUQnID0+ICRhLT5hc19vcmFjbGVfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ05hbWUnID0+ICRhLT5hc19uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAnUkYgSUQnID0+ICRhLT5hc19yZmlkX2NvZGU/PzAsCiAgICAgICAgICAgICAgICAgICAgICAgICdET0onID0+IGRhdGUoJ2QtTS1ZJywgc3RydG90aW1lKCRhLT5hc19kb2opKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ0N1cnJlbnQgU2FsYXJ5JyA9PiAkYS0+YmVuX2N1cnJlbnRfc2FsYXJ5LAogICAgICAgICAgICAgICAgICAgICAgICAnQmFzaWMgU2FsYXJ5JyA9PiAkYS0+YmVuX2Jhc2ljLAogICAgICAgICAgICAgICAgICAgICAgICAnSG91c2UgUmVudCcgPT4gJGEtPmJlbl9ob3VzZV9yZW50Pz8wLAogICAgICAgICAgICAgICAgICAgICAgICAnQ2FzaCBBbW91bnQnID0+ICRhLT5iZW5fY2FzaF9hbW91bnQ/PzAsCiAgICAgICAgICAgICAgICAgICAgICAgICdCYW5rL1JvY2tldCcgPT4gJGEtPmJlbl9iYW5rX2Ftb3VudD8/MCwKICAgICAgICAgICAgICAgICAgICAgICAgJ0Rlc2lnbmF0aW9uJyA9PiAkZGVzaWduYXRpb25bJGEtPmFzX2Rlc2lnbmF0aW9uX2lkXVsnaHJfZGVzaWduYXRpb25fbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0RlcGFydG1lbnQnID0+ICRkZXBhcnRtZW50WyRhLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICAgICAnU2VjdGlvbicgPT4gJHNlY3Rpb25bJGEtPmFzX3NlY3Rpb25faWRdWydocl9zZWN0aW9uX25hbWUnXT8/JycsCiAgICAgICAgICAgICAgICAgICAgICAgICdTdWIgU2VjdGlvbicgPT4gJHN1YnNlY3Rpb25bJGEtPmFzX3N1YnNlY3Rpb25faWRdWydocl9zdWJzZWNfbmFtZSddPz8nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ1VuaXQnID0+ICR1bml0WyRhLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10/PycnLAogICAgICAgICAgICAgICAgICAgICAgICAnT1QvTk9OT1QnID0+ICRhLT5hc19vdCA9PSAxPydPVCc6J05vbk9UJywKICAgICAgICAgICAgICAgICAgICAgICAgJ1N0YXR1cycgPT4gJGEtPmFzX3N0YXR1cy4nICcuJGEtPmFzX3N0YXR1c19kYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAnTGF0ZScgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgICdPVCBIb3VyJyA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0RhdGUnID0+ICRkYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAnSW4gVGltZScgPT4gICcnLAogICAgICAgICAgICAgICAgICAgICAgICAnT3V0IFRpbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAnQXNTdGF0dXMnID0+ICRhLT5hc19zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICdBc1N0YXR1c0RhdGUnID0+ICRhLT5hc19zdGF0dXNfZGF0ZQoKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAKCiAgICAgICAgICAgIHJldHVybiAobmV3IEZhc3RFeGNlbChjb2xsZWN0KCRleGNlbCkpKS0+ZG93bmxvYWQoJGZpbGVuYW1lKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2aWV3KCdjb21tb24uZW1wbG95ZWUtcmVjb3JkJyk7CiAgICB9CgoKCgoKICAgIHB1YmxpYyBmdW5jdGlvbiBidWxrTWFudWFsU3RvcmUoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgLy8gZGQoJHJlcXVlc3QtPmFsbCgpKTsKICAgICAgICAkdW5pdD0kcmVxdWVzdFsnYXNfdW5pdF9pZCddOwogICAgICAgICRpbmZvID0gRW1wbG95ZWU6OndoZXJlKCdhc19pZCcsJHJlcXVlc3RbJ2FzX2lkJ10pLT5maXJzdCgpOwogICAgICAgICR0YWJsZU5hbWU9IGdldF9hdHRfdGFibGUoJHVuaXQpOwogICAgICAgICRkYXRlID0gJHJlcXVlc3RbJ2luX2RhdGUnXTsKICAgICAgICAkbW9udGggPSAnMDknOwogICAgICAgICR5ZWFyID0gJzIwMjAnOwoKICAgICAgICBpZihzdHJsZW4oJHJlcXVlc3RbJ2luX3RpbWUnXSkgPiAyKXsKICAgICAgICAgICAgJGludGltZSA9IGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0Wydpbl90aW1lJ10pKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGludGltZSA9IGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0Wydpbl90aW1lJ10uJy4wJykpOwogICAgICAgIH0KCiAgICAgICAgaWYoc3RybGVuKCRyZXF1ZXN0WydvdXRfdGltZSddKSA+IDIpewogICAgICAgICAgICAkb3V0dGltZSA9IGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0WydvdXRfdGltZSddKSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRvdXR0aW1lID0gZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3RbJ291dF90aW1lJ10uJy4wJykpOwogICAgICAgIH0KCiAgICAgICAgCiAgICAgICAgCgogICAgICAgICRkYXlfb2ZfZGF0ZSA9IGRhdGUoJ2onLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAkZGF5X251bSA9ICJkYXlfIi4kZGF5X29mX2RhdGU7CiAgICAgICAgJHNoaWZ0PSBEQjo6dGFibGUoImhyX3NoaWZ0X3JvYXN0ZXIiKQogICAgICAgIC0+d2hlcmUoJ3NoaWZ0X3JvYXN0ZXJfbW9udGgnLCAkbW9udGgpCiAgICAgICAgLT53aGVyZSgnc2hpZnRfcm9hc3Rlcl95ZWFyJywgJHllYXIpCiAgICAgICAgLT53aGVyZSgic2hpZnRfcm9hc3Rlcl91c2VyX2lkIiwgJGluZm8tPmFzX2lkKQogICAgICAgIC0+c2VsZWN0KFsKICAgICAgICAgICAgJGRheV9udW0sCiAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9pZCcsCiAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9zdGFydF90aW1lJywKICAgICAgICAgICAgJ2hyX3NoaWZ0LmhyX3NoaWZ0X2VuZF90aW1lJywKICAgICAgICAgICAgJ2hyX3NoaWZ0LmhyX3NoaWZ0X2NvZGUnLAogICAgICAgICAgICAnaHJfc2hpZnQuaHJfc2hpZnRfYnJlYWtfdGltZScsCiAgICAgICAgICAgICdocl9zaGlmdC5ocl9zaGlmdF9uaWdodF9mbGFnJwogICAgICAgIF0pCiAgICAgICAgLT5sZWZ0Sm9pbignaHJfc2hpZnQnLCBmdW5jdGlvbigkcSkgdXNlKCRkYXlfbnVtLCAkdW5pdCkgewogICAgICAgICAgICAkcS0+b24oJ2hyX3NoaWZ0LmhyX3NoaWZ0X25hbWUnLCAnaHJfc2hpZnRfcm9hc3Rlci4nLiRkYXlfbnVtKTsKICAgICAgICAgICAgJHEtPndoZXJlKCdocl9zaGlmdC5ocl9zaGlmdF91bml0X2lkJywgJHVuaXQpOwogICAgICAgIH0pCiAgICAgICAgLT5vcmRlckJ5KCdocl9zaGlmdC5ocl9zaGlmdF9pZCcsICdkZXNjJykKICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgCiAgICAgICAgaWYoIWVtcHR5KCRzaGlmdCkgJiYgJHNoaWZ0LT4kZGF5X251bSAhPSBudWxsKXsKICAgICAgICAgICAgJHNoaWZ0X3N0YXJ0PSAkc2hpZnQtPmhyX3NoaWZ0X3N0YXJ0X3RpbWU7CiAgICAgICAgICAgICRzaGlmdF9lbmQ9ICRzaGlmdC0+aHJfc2hpZnRfZW5kX3RpbWU7CiAgICAgICAgICAgICRicmVhaz0gJHNoaWZ0LT5ocl9zaGlmdF9icmVha190aW1lOwogICAgICAgICAgICAkbmlnaHRGbGFnPSAkc2hpZnQtPmhyX3NoaWZ0X25pZ2h0X2ZsYWc7CiAgICAgICAgICAgICRzaGlmdENvZGU9ICRzaGlmdC0+aHJfc2hpZnRfY29kZTsKICAgICAgICAgICAgJG5ld19zaGlmdF9pZCA9ICRzaGlmdC0+aHJfc2hpZnRfaWQ7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRzaGlmdF9zdGFydD0gJGluZm8tPnNoaWZ0Wydocl9zaGlmdF9zdGFydF90aW1lJ107CiAgICAgICAgICAgICRzaGlmdF9lbmQ9ICRpbmZvLT5zaGlmdFsnaHJfc2hpZnRfZW5kX3RpbWUnXTsKICAgICAgICAgICAgJGJyZWFrPSAkaW5mby0+c2hpZnRbJ2hyX3NoaWZ0X2JyZWFrX3RpbWUnXTsKICAgICAgICAgICAgJG5pZ2h0RmxhZz0gJGluZm8tPnNoaWZ0Wydocl9zaGlmdF9uaWdodF9mbGFnJ107CiAgICAgICAgICAgICRzaGlmdENvZGU9ICRpbmZvLT5zaGlmdFsnaHJfc2hpZnRfY29kZSddOwogICAgICAgICAgICAkbmV3X3NoaWZ0X2lkPSAkaW5mby0+c2hpZnRbJ2hyX3NoaWZ0X2lkJ107CiAgICAgICAgfQoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJGNoZWNrRGF5ID0gRW1wbG95ZWVIZWxwZXI6OmVtcGxveWVlRGF0ZVdpc2VTdGF0dXMoJGRhdGUsICRpbmZvLT5hc3NvY2lhdGVfaWQsICRpbmZvLT5hc191bml0X2lkLCAkaW5mby0+c2hpZnRfcm9hc3Rlcl9zdGF0dXMpOwogICAgICAgICAgICAgICAgICAgIGlmKCRjaGVja0RheSA9PSAnb3BlbicgfHwgJGNoZWNrRGF5ID09ICdPVCcpewogICAgICAgICAgICAgICAgICAgICAgICAkaW5zZXJ0ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ3JlbWFya3MnXSA9ICdCTSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ2FzX2lkJ10gPSAkaW5mby0+YXNfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ2hyX3NoaWZ0X2NvZGUnXSA9ICRzaGlmdENvZGU7CgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkaW50aW1lLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCgkb25lLCR0d28sJHRocmVlKSA9IGFycmF5X3BhZChleHBsb2RlKCc6JywkaW50aW1lKSwzLDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGludCkkb25lKyhpbnQpJHR3bysoaW50KSR0aHJlZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGludGltZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRvdXR0aW1lLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCgkb25lLCR0d28sJHRocmVlKSA9IGFycmF5X3BhZChleHBsb2RlKCc6Jywkb3V0dGltZSksMywwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChpbnQpJG9uZSsoaW50KSR0d28rKGludCkkdGhyZWUgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvdXR0aW1lID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZigkaW50aW1lID09IG51bGwgJiYgJG91dHRpbWUgPT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWJzZW50RGF0YSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyA9PiAkaW5mby0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdCcgPT4gJGluZm8tPmFzX3VuaXRfaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2V0QWJzZW50ID0gQWJzZW50Ojp3aGVyZSgkYWJzZW50RGF0YSktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkZ2V0QWJzZW50ID09IG51bGwgJiYgJGNoZWNrRGF5ID09ICdvcGVuJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWJzZW50OjppbnNlcnQoJGFic2VudERhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRpbnRpbWUgPT0gJzAwOjAwOjAwJyB8fCAkaW50aW1lID09IG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbXBJbnRpbWUgPSAkc2hpZnRfc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsncmVtYXJrcyddID0gJ0RTSSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW1wSW50aW1lID0gJGludGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdHRJbnNlcnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnaW5fdGltZSddID0gJGRhdGUuJyAnLiRlbXBJbnRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkb3V0dGltZSA9PSAnMDA6MDA6MDAnIHx8ICRvdXR0aW1lID09IG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ291dF90aW1lJ10gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnb3V0X3RpbWUnXSA9ICRkYXRlLicgJy4kb3V0dGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjaGVja0RheSA9PSAnT1QnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5zZXJ0WydsYXRlX3N0YXR1cyddID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKCRpbnRpbWUgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnaW5fdW5pdCddID0gJHVuaXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnbGF0ZV9zdGF0dXMnXSA9ICR0aGlzLT5nZXRMYXRlU3RhdHVzKCR1bml0LCAkbmV3X3NoaWZ0X2lkLCRkYXRlLCRpbnRpbWUsJHNoaWZ0X3N0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ2xhdGVfc3RhdHVzJ10gPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJG91dHRpbWUgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnb3V0X3VuaXQnXSA9ICR1bml0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ291dF90aW1lJ10gPSAkZGF0ZS4nICcuJG91dHRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGludGltZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG91dCB0aW1lIGlzIHRvbW9ycm93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN0cnRvdGltZSgkaW50aW1lKSA+IHN0cnRvdGltZSgkb3V0dGltZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkYXRlTW9kaWZ5ID0gZGF0ZSgiWS1tLWQiLCBzdHJ0b3RpbWUoIisxIGRheSIsIHN0cnRvdGltZSgkZGF0ZSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ291dF90aW1lJ10gPSAkZGF0ZU1vZGlmeS4nICcuJG91dHRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBPVCBob3VyIGlmIG91dCB0aW1lIGV4aXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkaW50aW1lICE9IG51bGwgJiYgJG91dHRpbWUgIT0gbnVsbCAmJiAkaW5mby0+YXNfb3QgIT0gMCAmJiAkaW5zZXJ0WydyZW1hcmtzJ10gIT0gJ0RTSScpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvdmVydGltZXMgPSBFbXBsb3llZUhlbHBlcjo6ZGFsaXlPVENhbGN1bGF0aW9uKCRpbnNlcnRbJ2luX3RpbWUnXSwgJGluc2VydFsnb3V0X3RpbWUnXSwgJHNoaWZ0X3N0YXJ0LCAkc2hpZnRfZW5kLCAkYnJlYWssICRuaWdodEZsYWcsICRpbmZvLT5hc3NvY2lhdGVfaWQsICRpbmZvLT5zaGlmdF9yb2FzdGVyX3N0YXR1cywgJHVuaXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJ290X2hvdXInXSA9ICRvdmVydGltZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5zZXJ0WydvdF9ob3VyJ10gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGluc2VydFsnaW5fZGF0ZSddID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGluc2VydFsnaW5fdGltZSddKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlTmFtZSktPmluc2VydCgkaW5zZXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhYnNlbnRXaGVyZSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyA9PiAkaW5mby0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdCcgPT4gJGluZm8tPmFzX3VuaXRfaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBYnNlbnQ6OndoZXJlKCRhYnNlbnRXaGVyZSktPmRlbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFic2VudFdoZXJlID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fzc29jaWF0ZV9pZCcgPT4gJGluZm8tPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdocl91bml0JyA9PiAkaW5mby0+YXNfdW5pdF9pZAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICBBYnNlbnQ6OndoZXJlKCRhYnNlbnRXaGVyZSktPmRlbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgCgogICAgICAgICAgICAvL2RkKCR5ZWFyKTtleGl0OwogICAgICAgICAgICAkeWVhck1vbnRoID0gJHllYXIuJy0nLiRtb250aDsKICAgICAgICAgICAgaWYoJG1vbnRoID09IGRhdGUoJ20nKSl7CiAgICAgICAgICAgICAgICAkdG90YWxEYXkgPSBkYXRlKCdkJyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJHRvdGFsRGF5ID0gQ2FyYm9uOjpwYXJzZSgkeWVhck1vbnRoKS0+ZGF5c0luTW9udGg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICdzdWNjZXNzJzsKICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJGUtPmdldE1lc3NhZ2UoKTsKICAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0KCgoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXRlU3RhdHVzKCR1bml0LCRzaGlmdF9pZCwkZGF0ZSwkaW50aW1lLCRzaGlmdF9zdGFydCkKICAgIHsKICAgICAgICAkZ2V0TGF0ZUNvdW50ID0gSHJMYXRlQ291bnQ6OmdldFVuaXRTaGlmdElkV2lzZUNoZWNrRXhpc3RzKCR1bml0LCAkc2hpZnRfaWQpOwogICAgICAgIGlmKCRnZXRMYXRlQ291bnQgIT0gbnVsbCl7CiAgICAgICAgICAgIGlmKGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRkYXRlKSk+PSAkZ2V0TGF0ZUNvdW50LT5kYXRlX2Zyb20gJiYgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGRhdGUpKSA8PSAkZ2V0TGF0ZUNvdW50LT5kYXRlX3RvKXsKICAgICAgICAgICAgICAgICRsYXRlVGltZSA9ICRnZXRMYXRlQ291bnQtPnZhbHVlOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRsYXRlVGltZSA9ICRnZXRMYXRlQ291bnQtPmRlZmF1bHRfdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGxhdGVUaW1lID0gMTgwOwogICAgICAgIH0KICAgICAgICAkc2hpZnRpblRpbWUgPSAoc3RydG90aW1lKGRhdGUoIkg6aTpzIiwgc3RydG90aW1lKCRzaGlmdF9zdGFydCkpKSskbGF0ZVRpbWUpOwogICAgICAgIGlmKHN0cnRvdGltZShkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgkaW50aW1lKSkpID4gJHNoaWZ0aW5UaW1lKXsKICAgICAgICAgICAgJGxhdGUgPSAxOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAkbGF0ZSA9IDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbGF0ZTsKICAgIH0KCiAgICAKCiAgICBwdWJsaWMgZnVuY3Rpb24gbm9NYWN0aCgpCiAgICB7CiAgICAgICAgJG5vbWF0Y2ggPSBbXTsKICAgICAgICBmb3JlYWNoICgkZ2V0RGF0YSBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkZmxhZz0wOwogICAgICAgICAgICAkY291bnRlcj0wOwogICAgICAgICAgICBmb3JlYWNoICgkZ2V0RW1wbG95ZWUgYXMgJGVtcCkgewogICAgICAgICAgICAgICAgKyskY291bnRlcjsKICAgICAgICAgICAgICAgIGlmKCRlbXAtPmFzX29yYWNsZV9jb2RlID09ICR2YWx1ZVsnUElEJ10pewogICAgICAgICAgICAgICAgICAgICRmbGFnPTA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkZmxhZysrOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkZmxhZz4wIHx8ICRjb3VudGVyPT0wICl7CiAgICAgICAgICAgICAgICAkbm9tYXRjaFtdID0gJHZhbHVlWydQSUQnXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIHJldHVybiAoJG5vbWF0Y2gpOwogICAgfQoKCiAgICBwdWJsaWMgZnVuY3Rpb24gY2hlY2soKQogICAgewoKICAgICAgICAKICAgICAgICAkbGVhdmVfYXJyYXkgPSBbXTsKICAgICAgICAgICAgJGFic2VudF9hcnJheSA9IFtdOwogICAgICAgICAgICBmb3IoJGk9MTsgJGk8PTMxOyAkaSsrKSB7CiAgICAgICAgICAgICRkYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJzIwMjEtMDEtJy4kaSkpOwogICAgICAgICAgICAkbGVhdmUgPSBEQjo6dGFibGUoJ2hyX2xlYXZlIEFTIGwnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2wubGVhdmVfZnJvbScsICc8PScsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2wubGVhdmVfdG8nLCAgICc+PScsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2wubGVhdmVfc3RhdHVzJywgJz0nLCAxKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gQVMgYicsIGZ1bmN0aW9uKCRxKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHEtPm9uKCdiLmFzc29jaWF0ZV9pZCcsICdsLmxlYXZlX2Fzc19pZCcpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5wbHVjaygnYi5hc19pZCcsICdiLmFzc29jaWF0ZV9pZCcpOwogICAgICAgICAgICAkbGVhdmVfYXJyYXlbXSA9ICRsZWF2ZTsKICAgICAgICAgICAgJGFic2VudF9hcnJheVtdID0gREI6OnRhYmxlKCdob2xpZGF5X3JvYXN0ZXInKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVEYXRlKCdkYXRlJywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdhc19pZCcsICRsZWF2ZSkKICAgICAgICAgICAgICAgICAgICAtPmdldCgpLT50b0FycmF5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcmV0dXJuICJkb25lIjsKICAgICAgICAgICAgZHVtcCgkbGVhdmVfYXJyYXksJGFic2VudF9hcnJheSk7CiAgICAgICAgICAgIGRkKCdlbmQnKTsKICAgICAgICAKICAgIH0KICAgIHB1YmxpYyBmdW5jdGlvbiBtb250aGx5Y2hlY2soJHZhbHVlPScnKQogICAgewogICAgICAgICR1c2VyID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJyktPndoZXJlKCdhc19kb2onLCAnPj0nLCcyMDIxLTAxLTAxJyktPmdldCgpOwogICAgICAgICRkYXRhID0gW107CiAgICAgICAgZm9yZWFjaCAoJHVzZXIgYXMgJGtleSA9PiAkZSkgewogICAgICAgICAgICAkcXVlcnlbXSA9IERCOjp0YWJsZSgnaG9saWRheV9yb2FzdGVyJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICRlLT5hc3NvY2lhdGVfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZURhdGUoJ2RhdGUnLCc8JywkZS0+YXNfZG9qKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+Z2V0KCktPnRvQXJyYXkoKTsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIGRkKCRxdWVyeSk7CiAgICAgICAgCiAgICAgICAgJGxlYXZlX2FycmF5ID0gW107CiAgICAgICAgJGFic2VudF9hcnJheSA9IFtdOwogICAgICAgIGZvcigkaT0xOyAkaTw9MzE7ICRpKyspIHsKICAgICAgICAgICAgJGRhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgnMjAyMC0xMi0nLiRpKSk7CiAgICAgICAgICAgICRsZWF2ZSA9IERCOjp0YWJsZSgnaHJfbGVhdmUgQVMgbCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbC5sZWF2ZV9mcm9tJywgJzw9JywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbC5sZWF2ZV90bycsICAgJz49JywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnbC5sZWF2ZV9zdGF0dXMnLCAnPScsIDEpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBBUyBiJywgZnVuY3Rpb24oJHEpewogICAgICAgICAgICAgICAgICAgICAgICAkcS0+b24oJ2IuYXNzb2NpYXRlX2lkJywgJ2wubGVhdmVfYXNzX2lkJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdiLmFzc29jaWF0ZV9pZCcsJ2IuYXNfaWQnKTsKICAgICAgICAgICAgJGxlYXZlX2FycmF5W10gPSAkbGVhdmU7CiAgICAgICAgICAgICRhYnNlbnRfYXJyYXlbXSA9IERCOjp0YWJsZSgnaHJfYWJzZW50JykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlRGF0ZSgnZGF0ZScsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNzb2NpYXRlX2lkJywgJGxlYXZlKQogICAgICAgICAgICAgICAgICAgIC0+ZGVsZXRlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYWJzZW50X2FycmF5OwogICAgICAgIGR1bXAoJGxlYXZlX2FycmF5LCRhYnNlbnRfYXJyYXkpOwogICAgICAgIGRkKCdlbmQnKTsKCiAgICAgICAgICAgICRsZWF2ZV9hcnJheSA9IFtdOwogICAgICAgICAgICAkYWJzZW50X2FycmF5ID0gW107CiAgICAgICAgICAgIGZvcigkaT0xOyAkaTw9MjA7ICRpKyspIHsKICAgICAgICAgICAgJGRhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgnMjAyMC0xMS0nLiRpKSk7CiAgICAgICAgICAgICRsZWF2ZSA9IERCOjp0YWJsZSgnaHJfYWJzZW50IEFTIGEnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2EuZGF0ZScsICc9JywgJGRhdGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLCBbMSwgNCwgNV0pCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBBUyBiJywgZnVuY3Rpb24oJHEpewogICAgICAgICAgICAgICAgICAgICAgICAkcS0+b24oJ2IuYXNzb2NpYXRlX2lkJywgJ2EuYXNzb2NpYXRlX2lkJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdiLmFzX2lkJywgJ2IuYXNzb2NpYXRlX2lkJyk7CiAgICAgICAgICAgICRsZWF2ZV9hcnJheVtdID0gJGxlYXZlOwogICAgICAgICAgICAkYWJzZW50X2FycmF5W10gPSBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfbWJtJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlRGF0ZSgnaW5fdGltZScsICRkYXRlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfaWQnLCAkbGVhdmUpCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKS0+dG9BcnJheSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGR1bXAoJGxlYXZlX2FycmF5LCRhYnNlbnRfYXJyYXkpOwogICAgICAgICAgICBkZCgnZW5kJyk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldExlZnRFbXBsb3llZSgpCiAgICB7CgogICAgICAgICRkZXNpZ25hdGlvbiA9IGRlc2lnbmF0aW9uX2J5X2lkKCk7CiAgICAgICAgJGRlcGFydG1lbnQgPSBkZXBhcnRtZW50X2J5X2lkKCk7CiAgICAgICAgJHNlY3Rpb24gPSBzZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgJHN1YnNlY3Rpb24gPSBzdWJTZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgJHVuaXQgPSB1bml0X2J5X2lkKCk7CiAgICAgICAgJGRpc2N0cmljdCA9IGRpc3RyaWN0X2J5X2lkKCk7CiAgICAgICAgJHVwemlsbGEgPSB1cHppbGFfYnlfaWQoKTsKCiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLCBbMSw0LDVdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc19zdGF0dXMnLCBbMiwzLDQsNSw3LDhdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2IuYXNfc3RhdHVzX2RhdGUnLCAnPj0nLCAnMjAyMC0xMS0wMScpLT53aGVyZSgnYi5hc19zdGF0dXNfZGF0ZScsICc8PScsICcyMDIwLTExLTMwJyktPmdldCgpOwoKCiAgICAgICAKICAgICAgICAgICAKICAgICAgICAKICAgICAgICBmb3JlYWNoICgkZGF0YSBhcyAka2V5ID0+ICRlKSB7CiAgICAgICAgICAgICRzYWxbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgJ0Fzc29jaWF0ZSBJRCcgPT4gICRlLT5hc3NvY2lhdGVfaWQsCiAgICAgICAgICAgICAgICAnT3JhY2xlIElEJyA9PiAgJGUtPmFzX29yYWNsZV9jb2RlLAogICAgICAgICAgICAgICAgJ1JGIElEJyA9PiAgJGUtPmFzX3JmaWRfY29kZSwKICAgICAgICAgICAgICAgICdOYW1lJyA9PiAgJGUtPmFzX25hbWUsCiAgICAgICAgICAgICAgICAnRE9KJyA9PiAgJGUtPmFzX2RvaiwKICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gICRkZXNpZ25hdGlvblskZS0+YXNfZGVzaWduYXRpb25faWRdWydocl9kZXNpZ25hdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnU2VjdGlvbicgPT4gICRzZWN0aW9uWyRlLT5hc19zZWN0aW9uX2lkXVsnaHJfc2VjdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnRGVwYXJ0bWVudCcgPT4gICRkZXBhcnRtZW50WyRlLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10sCiAgICAgICAgICAgICAgICAnVW5pdCcgPT4gICR1bml0WyRlLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10sCiAgICAgICAgICAgICAgICAnT1QvTk9OT1QnID0+ICRlLT5hc19vdCA9PSAxPydPVCc6J05vbk9UJywKICAgICAgICAgICAgICAgICdEYXRlJyA9PiAkZS0+YXNfc3RhdHVzX2RhdGUsCiAgICAgICAgICAgICAgICAnU3RhdHVzJyA9PiBlbXBfc3RhdHVzX25hbWUoJGUtPmFzX3N0YXR1cykKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAobmV3IEZhc3RFeGNlbChjb2xsZWN0KCRzYWwpKSktPmRvd25sb2FkKCdNb250aGx5IFN1bW1hcnkueGxzeCcpOwoKICAgIH0KICAgIAogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TW9udGhseVNhbGFyeShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRtb250aCA9ICRyZXF1ZXN0LT5tb250aD8/ZGF0ZSgnbScpOwogICAgICAgICR5ZWFyID0gJHJlcXVlc3QtPnllYXI/P2RhdGUoJ1knKTsKICAgICAgICAkZGVzaWduYXRpb24gPSBkZXNpZ25hdGlvbl9ieV9pZCgpOwogICAgICAgICRkZXBhcnRtZW50ID0gZGVwYXJ0bWVudF9ieV9pZCgpOwogICAgICAgICRzZWN0aW9uID0gc2VjdGlvbl9ieV9pZCgpOwogICAgICAgICRzdWJzZWN0aW9uID0gc3ViU2VjdGlvbl9ieV9pZCgpOwogICAgICAgICR1bml0ID0gdW5pdF9ieV9pZCgpOwogICAgICAgICRkaXNjdHJpY3QgPSBkaXN0cmljdF9ieV9pZCgpOwogICAgICAgICR1cHppbGxhID0gdXB6aWxhX2J5X2lkKCk7CgogICAgICAgICRkYXRhID0gREI6OnRhYmxlKCdocl9tb250aGx5X3NhbGFyeSBBUyBzJykKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIEFTIGInLCdiLmFzc29jaWF0ZV9pZCcsJ3MuYXNfaWQnICkKICAgICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBBUyBiZW4nLCdiZW4uYmVuX2FzX2lkJywnYi5hc3NvY2lhdGVfaWQnICkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2IuYXNfdW5pdF9pZCcsIGF1dGgoKS0+dXNlcigpLT51bml0X3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX2xvY2F0aW9uJywgYXV0aCgpLT51c2VyKCktPmxvY2F0aW9uX3Blcm1pc3Npb25zKCkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncy5lbXBfc3RhdHVzJywgMSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdzLm1vbnRoJywkbW9udGggKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3MueWVhcicsICR5ZWFyKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkZSkgewogICAgICAgICAgICAkc2FsW10gPSBhcnJheSgKICAgICAgICAgICAgICAgICdOYW1lJyA9PiAgJGUtPmFzX25hbWUsCiAgICAgICAgICAgICAgICAnQXNzb2NpYXRlIElEJyA9PiAgJGUtPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICdPcmFjbGUgSUQnID0+ICAkZS0+YXNfb3JhY2xlX2NvZGUsCiAgICAgICAgICAgICAgICAnT1QvTk9OT1QnID0+ICRlLT5vdF9zdGF0dXMgPT0gMT8nT1QnOidOb25PVCcsCiAgICAgICAgICAgICAgICAnUHJlc2VudCcgPT4gJGUtPnByZXNlbnQsCiAgICAgICAgICAgICAgICAnTGVhdmUnID0+ICRlLT5sZWF2ZSwKICAgICAgICAgICAgICAgICdBYnNlbnQnID0+ICRlLT5hYnNlbnQsCiAgICAgICAgICAgICAgICAnSG9saWRheScgPT4gJGUtPmhvbGlkYXksCiAgICAgICAgICAgICAgICAnVG90YWwgRGF5JyA9PiAkZS0+cHJlc2VudCArICRlLT5sZWF2ZSArICRlLT5ob2xpZGF5ICwKICAgICAgICAgICAgICAgICdMYXRlIENvdW50JyA9PiAkZS0+bGF0ZV9jb3VudCwKICAgICAgICAgICAgICAgICdPVCBIb3VyJyA9PiAkZS0+b3RfaG91ciwKICAgICAgICAgICAgICAgICdPVCBSYXRlJyA9PiAkZS0+b3RfcmF0ZSwKICAgICAgICAgICAgICAgICdPVCBBbW91bnQnID0+IHJvdW5kKCRlLT5vdF9yYXRlKiRlLT5vdF9ob3VyLDIpLAogICAgICAgICAgICAgICAgJ0F0dCBCb251cycgPT4gJGUtPmF0dGVuZGFuY2VfYm9udXMsCiAgICAgICAgICAgICAgICAnQWR2YW5jZSBTYWxhcnknID0+ICRlLT5wYXJ0aWFsX2Ftb3VudCwKICAgICAgICAgICAgICAgICdMZWF2ZSBBZGp1c3QnID0+ICRlLT5sZWF2ZV9hZGp1c3QsCiAgICAgICAgICAgICAgICAnQWJzZW50IERlZHVjdCcgPT4gJGUtPmFic2VudF9kZWR1Y3QsCiAgICAgICAgICAgICAgICAnU3RhbXAnID0+ICRlLT5zdGFtcCwKICAgICAgICAgICAgICAgICdUb3RhbCBTYWxhcnknID0+ICRlLT50b3RhbF9wYXlhYmxlLAogICAgICAgICAgICAgICAgJ0JhbmsgQW1vdW50JyA9PiAkZS0+YmFua19wYXlhYmxlLAogICAgICAgICAgICAgICAgJ0Nhc2ggQW1vdW50JyA9PiAkZS0+Y2FzaF9wYXlhYmxlLAogICAgICAgICAgICAgICAgJ1REUycgPT4gJGUtPnRkcywKICAgICAgICAgICAgICAgICdCYW5rIE5hbWUnID0+ICRlLT5iYW5rX25hbWU/PycnLAogICAgICAgICAgICAgICAgJ0FjY291bnQgTnVtYmVyJyA9PiAkZS0+YmFua19ubz8/JycsCiAgICAgICAgICAgICAgICAnQ3VycmVudCBTYWxhcnknID0+ICRlLT5ncm9zcywKICAgICAgICAgICAgICAgICdCYXNpYycgPT4gJGUtPmJhc2ljLAogICAgICAgICAgICAgICAgJ0hvdXNlIFJlbnQnID0+ICRlLT5ob3VzZSwKICAgICAgICAgICAgICAgICdSRiBJRCcgPT4gICRlLT5hc19yZmlkX2NvZGUsCiAgICAgICAgICAgICAgICAnRE9KJyA9PiAgJGUtPmFzX2RvaiwKICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gICRkZXNpZ25hdGlvblskZS0+YXNfZGVzaWduYXRpb25faWRdWydocl9kZXNpZ25hdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnU2VjdGlvbicgPT4gICRzZWN0aW9uWyRlLT5hc19zZWN0aW9uX2lkXVsnaHJfc2VjdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnRGVwYXJ0bWVudCcgPT4gICRkZXBhcnRtZW50WyRlLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10sCiAgICAgICAgICAgICAgICAnVW5pdCcgPT4gICR1bml0WyRlLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKG5ldyBGYXN0RXhjZWwoY29sbGVjdCgkc2FsKSkpLT5kb3dubG9hZCgnTW9udGhseSBTYWxhcnkueGxzeCcpOwoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5jcmVtZW50ZXhjZWwoKQogICAgewogICAgICAgICRkYXRhID0gW107CiAgICAgICAgCiAgICAgICAgJGV4aXN0ID0gW107ICRub3QgPSBbXTsKICAgICAgICBmb3JlYWNoICgkZGF0YSBhcyAka2V5ID0+ICR2YWwpIHsKCiAgICAgICAgICAgICRiZW4gPSBEQjo6dGFibGUoJ2hyX2JlbmVmaXRzIGFzIGInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBhJywnYS5hc3NvY2lhdGVfaWQnLCdiLmJlbl9hc19pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhLmFzX29yYWNsZV9jb2RlJywgJGtleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgJHVwWydiZW5fY3VycmVudF9zYWxhcnknXSA9ICR2YWxbJ05ldyBHcm9zcyddOwogICAgICAgICAgICAkdXBbJ2Jlbl9iYXNpYyddID0gY2VpbCgoJHZhbFsnTmV3IEdyb3NzJ10tMTg1MCkvMS41KTsKICAgICAgICAgICAgJHVwWydiZW5faG91c2VfcmVudCddID0gJHZhbFsnTmV3IEdyb3NzJ10gLTE4NTAgLSAkdXBbJ2Jlbl9iYXNpYyddOwoKICAgICAgICAgICAgaWYoJGJlbi0+YmVuX2JhbmtfYW1vdW50ID4gMCl7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9iYW5rX2Ftb3VudCddID0gJHZhbFsnTmV3IEdyb3NzJ107CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gMDsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gJHZhbFsnTmV3IEdyb3NzJ107CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9iYW5rX2Ftb3VudCddID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGV4aXN0WyRrZXldID0gREI6OnRhYmxlKCdocl9iZW5lZml0cycpLT53aGVyZSgnYmVuX2lkJywgJGJlbi0+YmVuX2lkKS0+dXBkYXRlKCR1cCk7CgogICAgICAgICAgICAkdGFibGVOYW1lID0gZ2V0X2F0dF90YWJsZSgkYmVuLT5hc191bml0X2lkKTsKCiAgICAgICAgICAgIGlmKCRiZW4tPmFzX3N0YXR1cyA9PSAxKXsKCiAgICAgICAgICAgICAgICAkcXVldWUgPSAobmV3IFByb2Nlc3NVbml0V2lzZVNhbGFyeSgkdGFibGVOYW1lLCBkYXRlKCdtJyksIGRhdGUoJ1knKSwgJGJlbi0+YXNfaWQsIGRhdGUoJ2QnKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9uUXVldWUoJ3NhbGFyeWdlbmVyYXRlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+ZGVsYXkoQ2FyYm9uOjpub3coKS0+YWRkU2Vjb25kcygyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaCgkcXVldWUpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRub3RbXT0kYmVuLT5hc3NvY2lhdGVfaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIHJldHVybiAkbm90OwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5jcmVtZW50KCkKICAgIHsKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgnaHJfaW5jcmVtZW50IGFzIGljJykKICAgICAgICAgICAgICAgIC0+c2VsZWN0KCdpYy4qJywnYS5hc19pZCcsJ2EuYXNfdW5pdF9pZCcsJ2EuYXNfc3RhdHVzJywnYi4qJykKICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYScsJ2EuYXNzb2NpYXRlX2lkJywnaWMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2JlbmVmaXRzIGFzIGInLCdiLmJlbl9hc19pZCcsJ2ljLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpYy5jcmVhdGVkX2F0JywnbGlrZScsJzIwMjEtMDItMDElJykKICAgICAgICAgICAgICAgIC8vLT53aGVyZSgnaWMuc3RhdHVzJywgMCkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAKCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkZCkgewogICAgICAgICAgIC8qICRncm9zcyA9ICRkLT5jdXJyZW50X3NhbGFyeSArICRkLT5pbmNyZW1lbnRfYW1vdW50OwogICAgICAgICAgICAkdXBbJ2Jlbl9jdXJyZW50X3NhbGFyeSddID0gJGdyb3NzOwogICAgICAgICAgICAkdXBbJ2Jlbl9iYXNpYyddID0gY2VpbCgoJGdyb3NzLTE4NTApLzEuNSk7CiAgICAgICAgICAgICR1cFsnYmVuX2hvdXNlX3JlbnQnXSA9ICRncm9zcyAtMTg1MCAtICR1cFsnYmVuX2Jhc2ljJ107CgogICAgICAgICAgICBpZigkZC0+YmVuX2JhbmtfYW1vdW50ID4gMCAmJiAkZC0+YmVuX2Nhc2hfYW1vdW50ID4gMCl7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gJGdyb3NzIC0gJGQtPmJlbl9iYW5rX2Ftb3VudDsKICAgICAgICAgICAgfWVsc2UgaWYgKCRkLT5iZW5fYmFua19hbW91bnQgPiAwICYmICRkLT5iZW5fY2FzaF9hbW91bnQgPT0gMCl7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9iYW5rX2Ftb3VudCddID0gJGdyb3NzOwogICAgICAgICAgICAgICAgJHVwWydiZW5fY2FzaF9hbW91bnQnXSA9IDA7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJHVwWydiZW5fYmFua19hbW91bnQnXSA9IDA7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gJGdyb3NzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2JlbmVmaXRzJyktPndoZXJlKCdiZW5faWQnLCAkZC0+YmVuX2lkKS0+dXBkYXRlKCR1cCk7CiAgICAgICAgICAgIERCOjp0YWJsZSgnaHJfaW5jcmVtZW50JyktPndoZXJlKCdpZCcsICRkLT5pZCktPndoZXJlKCdhc3NvY2lhdGVfaWQnLCAkZC0+YXNzb2NpYXRlX2lkKS0+dXBkYXRlKFsnc3RhdHVzJyA9PiAxXSk7Ki8KCiAgICAgICAgICAgICR0YWJsZU5hbWUgPSBnZXRfYXR0X3RhYmxlKCRkLT5hc191bml0X2lkKTsKCiAgICAgICAgICAgIGlmKCRkLT5hc19zdGF0dXMgPT0gMSl7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRtb250aCA9IGRhdGUoJ20nLCBzdHJ0b3RpbWUoJGQtPmVmZmVjdGl2ZV9kYXRlKSk7CiAgICAgICAgICAgICAgJHllYXIgPSBkYXRlKCdZJywgc3RydG90aW1lKCRkLT5lZmZlY3RpdmVfZGF0ZSkpOwogICAgICAgICAgICAgICR0ID0gZGF0ZSgndCcsIHN0cnRvdGltZSgkZC0+ZWZmZWN0aXZlX2RhdGUpKTsKCiAgICAgICAgICAgICAgICAkcXVldWUgPSAobmV3IFByb2Nlc3NVbml0V2lzZVNhbGFyeSgkdGFibGVOYW1lLCAkbW9udGgsICR5ZWFyLCAkZC0+YXNfaWQsICR0KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b25RdWV1ZSgnc2FsYXJ5Z2VuZXJhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5kZWxheShDYXJib246Om5vdygpLT5hZGRTZWNvbmRzKDIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKCRxdWV1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudCgkZGF0YSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiB0ZXN0TWFpbCgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBbXTsKCiAgICAgICAgTWFpbDo6dG8oJ3Jha2liQG1ibWRoYWthLmNvbScpLT5zZW5kKG5ldyBUZXN0TWFpbCgkZGF0YSkpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBtYWtlQWJzZW50KCkKICAgIHsKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbycpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdzaGlmdF9yb2FzdGVyX3N0YXR1cycsMSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfdW5pdF9pZCcsWzEsNCw1XSkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2Fzc29jaWF0ZV9pZCcsJ2FzX2lkJyk7CiAgICAgICAgJGRhdGVzID0gWycyMDIwLTEyLTExJywnMjAyMC0wMS0xNicsJzIwMjAtMDEtMjUnLCcyMDIwLTAxLTE3JywnMjAyMC0wMS0xOCddOwoKICAgICAgICBmb3JlYWNoICgkZGF0YSBhcyAka2V5ID0+ICR2YWwpIHsKICAgICAgICAgICAgJGF0dCA9IERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9tYm0nKQogICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdpbl9kYXRlJywgJGRhdGVzKQogICAgICAgICAgICAgICAgICAgLT5wbHVjaygnaW5fZGF0ZScpOwoKICAgICAgICAgICAgJGhvbGlkYXkgPSBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlcicpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0RmlsZSgkZGF0ZSkKICAgIHsKICAgICAgICAkb3V0ZGF0ZSA9IENhcmJvbjo6cGFyc2UoJGRhdGUpLT5zdWJEYXlzKDEpLT50b0RhdGVTdHJpbmcoKTsKICAgICAgICAkb3V0dGltZSA9IERCOjp0YWJsZSgnaHJfYXR0ZW5kYW5jZV9tYm0gYXMgYScpCiAgICAgICAgICAgICAgICAgICAgLT5zZWxlY3QoJ2Eub3V0X3RpbWUnLCdiLmFzX3JmaWRfY29kZScpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywgJ2EuYXNfaWQnLCAnYi5hc19pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5vdXRfdGltZScsICdsaWtlJywgJG91dGRhdGUuJyUnKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgCiAgICAgICAgZm9yZWFjaCAoJG91dHRpbWUgYXMgJGtleSA9PiAkdmFsKSB7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2FsYXJ5RGF0ZSgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX21vbnRobHlfc2FsYXJ5JyktPndoZXJlSW4oJ2VtcF9zdGF0dXMnLFsyLDMsNCw1LDYsN10pLT5nZXQoKTsKCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICAkZGF0ZSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2LT55ZWFyLictJy4kdi0+bW9udGguJy0nLigkdi0+cHJlc2VudCskdi0+YWJzZW50KyR2LT5ob2xpZGF5KyR2LT5sZWF2ZSkpKTsKICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hbGxfZ2l2ZW5fYmVuZWZpdHMnKS0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsICR2LT5hc19pZCktPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAnc2FsYXJ5X2RhdGUnID0+ICRkYXRlCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICB9CgogICAgCgogICAgcHVibGljIGZ1bmN0aW9uIGluc2VydFJvYXN0ZXIoKQogICAgewoKICAgICAgICAkanNvbiA9ICcnOwoKICAgICAgICAkZXggPSBjb2xsZWN0KGpzb25fZGVjb2RlKCRqc29uKSktPnRvQXJyYXkoKTsKCgoKCiAgICAgICAgcmV0dXJuICdzdWNjZXNzJzsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHN1YnN0aXR1dGUoKQogICAgewogICAgICAgICRkZXNpZ25hdGlvbiA9IGRlc2lnbmF0aW9uX2J5X2lkKCk7CiAgICAgICAgJGRlcGFydG1lbnQgPSBkZXBhcnRtZW50X2J5X2lkKCk7CiAgICAgICAgJHNlY3Rpb24gPSBzZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgJHN1YnNlY3Rpb24gPSBzdWJTZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgJHVuaXQgPSB1bml0X2J5X2lkKCk7CiAgICAgICAgJGRpc2N0cmljdCA9IGRpc3RyaWN0X2J5X2lkKCk7CiAgICAgICAgJHVwemlsbGEgPSB1cHppbGFfYnlfaWQoKTsKICAgICAgICAKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgnaHJfYXNfYmFzaWNfaW5mbyBBUyBiJykKICAgICAgICAgICAgICAgIC0+c2VsZWN0KCdyLmFzX2lkJywnci5pbl9kYXRlJywnYi5hc3NvY2lhdGVfaWQnLCdiLmFzX29yYWNsZV9jb2RlJywnYi5hc19zdGF0dXMnLCdiLmFzX25hbWUnLCdiLmFzX3NlY3Rpb25faWQnLCdiLmFzX2Rlc2lnbmF0aW9uX2lkJywnYi5hc19kZXBhcnRtZW50X2lkJywnYi5hc191bml0X2lkJywnYm4uYmVuX2N1cnJlbnRfc2FsYXJ5JywnYi5hc19kb2onKQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXR0ZW5kYW5jZV9tYm0gQVMgcicsJ2IuYXNfaWQnLCdyLmFzX2lkJykKICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2JlbmVmaXRzIGFzIGJuJywnYm4uYmVuX2FzX2lkJywnYi5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdyLmluX2RhdGUnLFsnMjAyMC0xMC0zMCcsJzIwMjAtMTAtMDInXSkKICAgICAgICAgICAgICAgIC8vLT53aGVyZSgnYi5hc19lbXBfdHlwZV9pZCcsIDMpCiAgICAgICAgICAgICAgICAvLy0+d2hlcmUoJ2IuYXNfZG9qJywnPj0nLCcyMDIwLTA4LTA5JykKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgCiAgICAgICAgJGVtcGxveWVlcyA9IGNvbGxlY3QoJGRhdGEpLT5ncm91cEJ5KCdhc19pZCcpOwogICAgICAgICRzYWw9W107CiAgICAgICAgZm9yZWFjaCAoJGVtcGxveWVlcyBhcyAka2V5ID0+ICRlKSB7CiAgICAgICAgICAgICRzYWxbJGtleV0gPSBhcnJheSgKICAgICAgICAgICAgICAgICdBc3NvY2lhdGUgSUQnID0+ICAkZVswXS0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgJ09yYWNsZSBJRCcgPT4gICRlWzBdLT5hc19vcmFjbGVfY29kZSwKICAgICAgICAgICAgICAgICdOYW1lJyA9PiAgJGVbMF0tPmFzX25hbWUsCiAgICAgICAgICAgICAgICAnRE9KJyA9PiAgJGVbMF0tPmFzX2RvaiwKICAgICAgICAgICAgICAgICdEZXNpZ25hdGlvbicgPT4gICRkZXNpZ25hdGlvblskZVswXS0+YXNfZGVzaWduYXRpb25faWRdWydocl9kZXNpZ25hdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnU2VjdGlvbicgPT4gICRzZWN0aW9uWyRlWzBdLT5hc19zZWN0aW9uX2lkXVsnaHJfc2VjdGlvbl9uYW1lJ10sCiAgICAgICAgICAgICAgICAnRGVwYXJ0bWVudCcgPT4gICRkZXBhcnRtZW50WyRlWzBdLT5hc19kZXBhcnRtZW50X2lkXVsnaHJfZGVwYXJ0bWVudF9uYW1lJ10sCiAgICAgICAgICAgICAgICAnVW5pdCcgPT4gICR1bml0WyRlWzBdLT5hc191bml0X2lkXVsnaHJfdW5pdF9zaG9ydF9uYW1lJ10sCiAgICAgICAgICAgICAgICAnR3Jvc3MnID0+ICAkZVswXS0+YmVuX2N1cnJlbnRfc2FsYXJ5LAogICAgICAgICAgICAgICAgJ0RheScgPT4gY291bnQoJGUpLAogICAgICAgICAgICAgICAgJ1BlciBEYXknID0+ICByb3VuZCgkZVswXS0+YmVuX2N1cnJlbnRfc2FsYXJ5LzMxLDIpLAogICAgICAgICAgICAgICAgJ1RvdGFsJyA9PiBjZWlsKGNvdW50KCRlKSpyb3VuZCgkZVswXS0+YmVuX2N1cnJlbnRfc2FsYXJ5LzMxLDIpKSwKICAgICAgICAgICAgICAgICdTdGF0dXMnID0+IGVtcF9zdGF0dXNfbmFtZSgkZVswXS0+YXNfc3RhdHVzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRzYWxbJGtleV1bJ0RhdGUxJ10gPSAnJzsKICAgICAgICAgICAgJHNhbFska2V5XVsnRGF0ZTInXSA9ICcnOwogICAgICAgICAgICBpZigkZVswXS0+aW5fZGF0ZSA9PSAnMjAyMC0xMC0wMicpewogICAgICAgICAgICAgICAgJHNhbFska2V5XVsnRGF0ZTEnXSA9ICAkZVswXS0+aW5fZGF0ZTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkc2FsWyRrZXldWydEYXRlMiddID0gICRlWzBdLT5pbl9kYXRlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlzc2V0KCRlWzFdKSl7CiAgICAgICAgICAgICAgICBpZigkZVsxXS0+aW5fZGF0ZSA9PSAnMjAyMC0xMC0zMCcpewogICAgICAgICAgICAgICAgICAgICRzYWxbJGtleV1bJ0RhdGUyJ10gPSAgJGVbMV0tPmluX2RhdGU7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkc2FsWyRrZXldWydEYXRlMSddID0gICRlWzFdLT5pbl9kYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gKG5ldyBGYXN0RXhjZWwoY29sbGVjdCgkc2FsKSkpLT5kb3dubG9hZCgnU3Vic3RpdHV0ZSBIb2xpZGF5IFBheW1lbnQueGxzeCcpOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gbmV3TWlncmF0ZSgpCiAgICB7CiAgICAgICAgJHNlY3Rpb24gPSBzdWJTZWN0aW9uX2J5X2lkKCk7CiAgICAgICAgJGRlc2lnbmF0aW9uID0gZGVzaWduYXRpb25fYnlfaWQoKTsKCiAgICAgICAgJGVtcHMgPSAgW107CgogICAgICAgICRpbnNlcnQgPSBbXTsKICAgICAgICBmb3JlYWNoICgkZW1wcyBhcyAka2V5ID0+ICR2KSB7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ2FzX29yYWNsZV9jb2RlJ10gPSAka2V5OwogICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfbmFtZSddID0gJHZbJ05BTUUnXTsKICAgICAgICAgICAgJGluc2VydFska2V5XVsnd29ya2VyX2RvaiddID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHZbJ2RvaiddKSk7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9kb2InXSA9IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCR2Wydkb2InXSkpOwogICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfb3QnXSA9ICR2WydPVCddID09ICdZJz8xOjA7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9nZW5kZXInXSA9ICR2WydzZXgnXSA9PSAnTSc/J01hbGUnOidGZW1hbGUnOwogICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfdW5pdF9pZCddID0gMzsKICAgICAgICAgICAgJGluc2VydFska2V5XVsnbG9jYXRpb25faWQnXSA9IDk7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9hcmVhX2lkJ10gPSBudWxsOwogICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfZGVwYXJ0bWVudF9pZCddID0gbnVsbDsKICAgICAgICAgICAgJGluc2VydFska2V5XVsnd29ya2VyX3NlY3Rpb25faWQnXSA9IG51bGw7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9zdWJzZWN0aW9uX2lkJ10gPSBudWxsOwogICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfZW1wX3R5cGVfaWQnXSA9IG51bGw7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9kZXNpZ25hdGlvbl9pZCddID0gbnVsbDsKICAgICAgICAgICAgJGMgPSAwOwogICAgICAgICAgICBpZigkdlsnU0VDVElPTiddICE9IG51bGwpewogICAgICAgICAgICAgICAgJGsgPSAkdlsnU0VDVElPTiddOwogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHNlY3Rpb25bJGtdKSl7CgogICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9hcmVhX2lkJ10gPSAkc2VjdGlvblska11bJ2hyX3N1YnNlY19hcmVhX2lkJ107CiAgICAgICAgICAgICAgICAgICAgJGluc2VydFska2V5XVsnd29ya2VyX2RlcGFydG1lbnRfaWQnXSA9ICRzZWN0aW9uWyRrXVsnaHJfc3Vic2VjX2RlcGFydG1lbnRfaWQnXTsKICAgICAgICAgICAgICAgICAgICAkaW5zZXJ0WyRrZXldWyd3b3JrZXJfc2VjdGlvbl9pZCddID0gJHNlY3Rpb25bJGtdWydocl9zdWJzZWNfc2VjdGlvbl9pZCddOwogICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9zdWJzZWN0aW9uX2lkJ10gPSAkazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJHZbJ0RFU0lHTkFUSU9OJ10gIT0gbnVsbCl7CgogICAgICAgICAgICAgICAgJGtkID0gJHZbJ0RFU0lHTkFUSU9OJ107CiAgICAgICAgICAgICAgICBpZihpc3NldCgkZGVzaWduYXRpb25bJGtkXSkpewogICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9lbXBfdHlwZV9pZCddID0gJGRlc2lnbmF0aW9uWyRrZF1bJ2hyX2Rlc2lnbmF0aW9uX2VtcF90eXBlJ107CiAgICAgICAgICAgICAgICAgICAgJGluc2VydFska2V5XVsnd29ya2VyX2Rlc2lnbmF0aW9uX2lkJ10gPSAka2Q7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9jb2xvcl9iYW5kX2pvaW4nXSA9IDE7CiAgICAgICAgICAgICRpbnNlcnRbJGtleV1bJ3dvcmtlcl9kb2N0b3JfYWNjZXB0YW5jZSddID0gMTsKCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gREI6OnRhYmxlKCdocl93b3JrZXJfcmVjcnVpdG1lbnQnKS0+aW5zZXJ0KCRpbnNlcnQpOwoKICAgICAgICByZXR1cm4gKGNvdW50KCRpbnNlcnQpKTsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIG1pZ3JhdGVBbGwoKXsKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgnaHJfd29ya2VyX3JlY3J1aXRtZW50JykKICAgICAgICAgICAgLT53aGVyZSgnd29ya2VyX3VuaXRfaWQnLCAzKQogICAgICAgICAgICAtPndoZXJlTm90TnVsbCgnd29ya2VyX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAtPndoZXJlTm90SW4oJ2FzX29yYWNsZV9jb2RlJyxbJzIxQjEwNjBFJywnMjFCMTMzM0UnLCcyMUIxNDIxRScsJzIxQjE0MjRFJywnMjFCMzI0MEYnLCcyMUIzMjQxRicsJzIxQjM0MzBHJywnMjFCMzY1N0cnLCcyMUI0NjU1SicsJzIxQjQ2NTZKJ10pCiAgICAgICAgICAgIC0+dGFrZSgxNSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGQgPSBbXTsKICAgICAgICBmb3JlYWNoICgkZGF0YSBhcyAka2V5ID0+ICR3b3JrZXIpIHsKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICggKCR3b3JrZXItPndvcmtlcl91bml0X2lkICE9IG51bGwgfHwgJHdvcmtlci0+d29ya2VyX3VuaXRfaWQgIT0gJycpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbj0gREI6OnRhYmxlKCdocl9sb2NhdGlvbicpLT53aGVyZSgnaHJfbG9jYXRpb25fdW5pdF9pZCcsICR3b3JrZXItPndvcmtlcl91bml0X2lkKS0+b3JkZXJCeSgnaHJfbG9jYXRpb25faWQnLCAnYXNjJyktPmZpcnN0KFsnaHJfbG9jYXRpb25faWQnXSk7IAogICAgICAgICAgICAgICAgICAgICRzaGlmdF9leGlzdD0gREI6OnRhYmxlKCdocl9zaGlmdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl9zaGlmdF91bml0X2lkJywgJHdvcmtlci0+d29ya2VyX3VuaXRfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl9zaGlmdF9kZWZhdWx0JywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2hyX3NoaWZ0X25hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRJREdlbmVyYXRvciA9IChuZXcgIFxBcHBcSHR0cFxDb250cm9sbGVyc1xIclxJREdlbmVyYXRvciktPmdlbmVyYXRvcjIoYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXBhcnRtZW50JyA9PiAkd29ya2VyLT53b3JrZXJfZGVwYXJ0bWVudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnID0+ICR3b3JrZXItPndvcmtlcl9kb2oKICAgICAgICAgICAgICAgICAgICApKTsKCiAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJElER2VuZXJhdG9yWydlcnJvciddKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoc3RybGVuKCRJREdlbmVyYXRvclsnaWQnXSkgIT0gMTApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKCRzaGlmdF9leGlzdCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9EZWZhdWx0IFNoaWZ0IENvZGUKICAgICAgICAgICAgICAgICAgICAgICAgJGRlZmF1bHRfc2hpZnQ9IERCOjp0YWJsZSgnaHJfc2hpZnQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl9zaGlmdF91bml0X2lkJywgJHdvcmtlci0+d29ya2VyX3VuaXRfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2hyX3NoaWZ0X2RlZmF1bHQnLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAtPnBsdWNrKCdocl9zaGlmdF9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAvKi0tLUlOU0VSVCBJTlRPIEJBU0lDIElORk8gVEFCTEUtLS0qLwogICAgICAgICAgICAgICAgICAgICAgICAkY2hlY2sgPSBFbXBsb3llZTo6aW5zZXJ0KGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2VtcF90eXBlX2lkJyAgPT4gJHdvcmtlci0+d29ya2VyX2VtcF90eXBlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX3VuaXRfaWQnICAgICAgPT4gJHdvcmtlci0+d29ya2VyX3VuaXRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNfc2hpZnRfaWQnICAgICA9PiAkZGVmYXVsdF9zaGlmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19hcmVhX2lkJyAgICAgID0+ICR3b3JrZXItPndvcmtlcl9hcmVhX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2RlcGFydG1lbnRfaWQnID0+ICR3b3JrZXItPndvcmtlcl9kZXBhcnRtZW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX3NlY3Rpb25faWQnICA9PiAkd29ya2VyLT53b3JrZXJfc2VjdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19zdWJzZWN0aW9uX2lkJyAgPT4gJHdvcmtlci0+d29ya2VyX3N1YnNlY3Rpb25faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNfZGVzaWduYXRpb25faWQnID0+ICR3b3JrZXItPndvcmtlcl9kZXNpZ25hdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19kb2onICAgICAgICAgPT4gKCFlbXB0eSgkd29ya2VyLT53b3JrZXJfZG9qKT9kYXRlKCdZLW0tZCcsc3RydG90aW1lKCR3b3JrZXItPndvcmtlcl9kb2opKTpudWxsKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZW1wX2lkJyAgICAgICAgPT4gJElER2VuZXJhdG9yWyd0ZW1wJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyAgID0+ICRJREdlbmVyYXRvclsnaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19uYW1lJyAgICAgICAgPT4gJHdvcmtlci0+d29ya2VyX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNfZ2VuZGVyJyAgICAgID0+ICR3b3JrZXItPndvcmtlcl9nZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNfZG9iJyAgICAgICAgID0+ICghZW1wdHkoJHdvcmtlci0+d29ya2VyX2RvYik/ZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkd29ya2VyLT53b3JrZXJfZG9iKSk6bnVsbCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNfY29udGFjdCcgICAgID0+ICR3b3JrZXItPndvcmtlcl9jb250YWN0Pz8nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19vdCcgICAgICAgICAgPT4gJHdvcmtlci0+d29ya2VyX290LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX29yYWNsZV9jb2RlJyA9PiAkd29ya2VyLT5hc19vcmFjbGVfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19vcmFjbGVfc2wnICAgPT4gKCR3b3JrZXItPmFzX29yYWNsZV9jb2RlICE9ICcnP3N1YnN0cigkd29ya2VyLT5hc19vcmFjbGVfY29kZSwzLCAtMSk6JycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX3JmaWRfY29kZScgICA9PiAkd29ya2VyLT5hc19yZmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX3BpYycgICAgICAgICA9PiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYXQnICAgICA9PiBkYXRlKCJZLW0tZCBIOmk6cyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknICAgICA9PiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX3N0YXR1cycgICAgICA9PiAxICwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19sb2NhdGlvbicgICAgPT4gJGxvY2F0aW9uLT5ocl9sb2NhdGlvbl9pZD8/JycKICAgICAgICAgICAgICAgICAgICAgICAgKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX21lZF9pbmZvJyktPmluc2VydChhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZWRfYXNfaWQnICAgICAgID0+ICRJREdlbmVyYXRvclsnaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZWRfaGVpZ2h0JyAgICAgID0+ICR3b3JrZXItPndvcmtlcl9oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVkX3dlaWdodCcgICAgICA9PiAkd29ya2VyLT53b3JrZXJfd2VpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lZF90b290aF9zdHInICAgPT4gJHdvcmtlci0+d29ya2VyX3Rvb3RoX3N0cnVjdHVyZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZWRfYmxvb2RfZ3JvdXAnID0+ICR3b3JrZXItPndvcmtlcl9ibG9vZF9ncm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZWRfaWRlbnRfbWFyaycgID0+ICghZW1wdHkoJHdvcmtlci0+d29ya2VyX2lkZW50aWZpY2F0aW9uX21hcmspPyR3b3JrZXItPndvcmtlcl9pZGVudGlmaWNhdGlvbl9tYXJrOiJOL0EiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZWRfZG9jdF9jb21tZW50JyAgID0+ICR3b3JrZXItPndvcmtlcl9kb2N0b3JfY29tbWVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVkX2RvY3RfY29uZl9hZ2UnICA9PiAkd29ya2VyLT53b3JrZXJfZG9jdG9yX2FnZV9jb25maXJtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lZF9kb2N0X3NpZ25hdHVyZScgPT4gJHdvcmtlci0+d29ya2VyX2RvY3Rvcl9zaWduYXR1cmUKICAgICAgICAgICAgICAgICAgICAgICAgKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Fkdl9pbmZvJyktPmluc2VydChhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fYXNfaWQnID0+ICRJREdlbmVyYXRvclsnaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fbmlkJyAgID0+ICR3b3JrZXItPndvcmtlcl9uaWQKICAgICAgICAgICAgICAgICAgICAgICAgKSk7CgoKICAgICAgICAgICAgICAgICAgICAgICAgJHQgPSBEQjo6dGFibGUoJ2hyX3dvcmtlcl9yZWNydWl0bWVudCcpLT53aGVyZSgnd29ya2VyX2lkJywgJHdvcmtlci0+d29ya2VyX2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5kZWxldGUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2UgZGVmYXVsdCBhYnNlbnQKICAgICAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hYnNlbnQnKS0+aW5zZXJ0KFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc3NvY2lhdGVfaWQnID0+ICRJREdlbmVyYXRvclsnaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiBkYXRlKCdZLW0tZCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX3VuaXQnID0+ICR3b3JrZXItPndvcmtlcl91bml0X2lkCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAkZFtdID0gJElER2VuZXJhdG9yWydpZCddOwogICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgIENhY2hlOjpmb3JnZXQoJ2VtcGxveWVlX2NvdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgJGRbXSA9ICRlLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDYWNoZTo6Zm9yZ2V0KCdlbXBsb3llZV9jb3VudCcpOwoKICAgICAgICByZXR1cm4gJGQ7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRfZW1wX3R5cGVfaWQoKQogICAgewogICAgICAgICRkZXNpZ25hdGlvbiA9IGRlc2lnbmF0aW9uX2J5X2lkKCk7CiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX3dvcmtlcl9yZWNydWl0bWVudCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCd3b3JrZXJfdW5pdF9pZCcsWzMsOF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdsb2NhdGlvbl9pZCcsWzksMTFdKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgIGZvcmVhY2ggKCRkYXRhICBhcyAka2V5ID0+ICR2KSB7CiAgICAgICAgICAgIGlmKCR2LT53b3JrZXJfZGVzaWduYXRpb25faWQgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAka2QgPSAkdi0+d29ya2VyX2Rlc2lnbmF0aW9uX2lkOwogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGRlc2lnbmF0aW9uWyRrZF0pKXsKICAgICAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX3dvcmtlcl9yZWNydWl0bWVudCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3dvcmtlcl9pZCcsICR2LT53b3JrZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3b3JrZXJfZW1wX3R5cGVfaWQnID0+ICRkZXNpZ25hdGlvblska2RdWydocl9kZXNpZ25hdGlvbl9lbXBfdHlwZSddCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICMgY29kZS4uLgogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJ2RvbmUnOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlUkZJRCgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBbXTsKCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIDMpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19sb2NhdGlvbicsIDkpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19vcmFjbGVfY29kZScsICRrZXkpCiAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ2FzX2NvbnRhY3QnID0+ICR2Wydhc19jb250YWN0J10KICAgICAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICdkb25lJzsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGFkdkJuKCkKICAgIHsKICAgICAgICAkZGF0YSA9IFtdOwoKCiAgICAgICAgJGFzID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIDgpCiAgICAgICAgICAgIC0+cGx1Y2soJ2Fzc29jaWF0ZV9pZCcsJ2FzX29yYWNsZV9jb2RlJyk7CgogICAgICAgICRibiA9IERCOjp0YWJsZSgnaHJfZW1wbG95ZWVfYmVuZ2FsaScpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2hyX2JuX2Fzc29jaWF0ZV9pZCcsICRhcykKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2hyX2JuX2Fzc29jaWF0ZV9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgJGluc2VydCA9IFtdOwogICAgICAgIGZvcmVhY2ggKCRkYXRhIGFzICRrZXkgPT4gJHYpIHsKICAgICAgICAgICAgaWYoaXNzZXQoJGFzWyRrZXldKSl7CiAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Fkdl9pbmZvJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdlbXBfYWR2X2luZm9fYXNfaWQnLCAkYXNbJGtleV0pCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnZW1wX2Fkdl9pbmZvX25hdGlvbmFsaXR5JyA9PiAnQkFOR0xBREVTSEknLCAKICAgICAgICAgICAgICAgICAgICAgICAgJ2VtcF9hZHZfaW5mb19mYXRoZXJzX25hbWUnID0+ICR2WydGTkFNRSddLCAKICAgICAgICAgICAgICAgICAgICAgICAgJ2VtcF9hZHZfaW5mb19tb3RoZXJzX25hbWUnID0+ICR2WydNTkFNRSddLCAKICAgICAgICAgICAgICAgICAgICAgICAgJ2VtcF9hZHZfaW5mb19zcG91c2UnID0+ICR2WydITkFNRSddLCAKICAgICAgICAgICAgICAgICAgICAgICAgLyonZW1wX2Fkdl9pbmZvX2NoaWxkcmVuJyA9PiAkdlsnQ0hJTERSRU4nXSwgKi8KICAgICAgICAgICAgICAgICAgICAgICAgLy8nZW1wX2Fkdl9pbmZvX3JlbGlnaW9uJyA9PiAkdlsnRk5BTUUnXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fcGVyX3ZpbGwnID0+ICR2WydQQUQxJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fcGVyX3BvJyA9PiAkdlsnUFBPU1QnXSwKICAgICAgICAgICAgICAgICAgICAgICAgLyonZW1wX2Fkdl9pbmZvX3Blcl9kaXN0JyA9PiAkdlsnUERJU1QnXSwqLwogICAgICAgICAgICAgICAgICAgICAgICAnZW1wX2Fkdl9pbmZvX3ByZXNfaG91c2Vfbm8nID0+ICR2WydDQUQxJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fcHJlc19yb2FkJyA9PiAkdlsnQ0FEMiddLAogICAgICAgICAgICAgICAgICAgICAgICAnZW1wX2Fkdl9pbmZvX3ByZXNfcG8nID0+ICR2WydDUE9TVCddLAogICAgICAgICAgICAgICAgICAgICAgICAnZW1wX2Fkdl9pbmZvX3ByZXNfZGlzdCcgPT4gJHZbJ0NESVNUJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdlbXBfYWR2X2luZm9fcHJlc191cHonID0+ICR2WydDVEhBTkEnXSwKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBpZihpbl9hcnJheSgkYXNbJGtleV0sICRibikpewogICAgICAgICAgICAgICAgICAgIERCOjp0YWJsZSgnaHJfZW1wbG95ZWVfYmVuZ2FsaScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2hyX2JuX2Fzc29jaWF0ZV9pZCcsICRhc1ska2V5XSkKICAgICAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fYXNzb2NpYXRlX25hbWUnID0+ICR2WydCbl9uYW1lJ10sIAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fZmF0aGVyX25hbWUnID0+ICR2WydCRkFUSEVSJ10sIAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fbW90aGVyX25hbWUnID0+ICR2WydNT1RIRVInXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICdocl9ibl9wZXJtYW5lbnRfdmlsbGFnZScgPT4gJHZbJ0JHUkFNJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdocl9ibl9wZXJtYW5lbnRfcG8nID0+ICR2WydCUE9TVCddLAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fcHJlc2VudF9yb2FkJyA9PiAkdlsnUk9BRF9OTyddLAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fcHJlc2VudF9ob3VzZScgPT4gJHZbJ0hPVVNFX05PJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdocl9ibl9wcmVzZW50X3BvJyA9PiAkdlsnUE8nXQogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRpbnNlcnRbJGtleV0gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICdocl9ibl9hc3NvY2lhdGVfaWQnID0+ICRhc1ska2V5XSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2JuX2Fzc29jaWF0ZV9uYW1lJyA9PiAkdlsnQm5fbmFtZSddLCAKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2JuX2ZhdGhlcl9uYW1lJyA9PiAkdlsnQkZBVEhFUiddLCAKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2JuX21vdGhlcl9uYW1lJyA9PiAkdlsnTU9USEVSJ10sIAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fcGVybWFuZW50X3ZpbGxhZ2UnID0+ICR2WydCR1JBTSddLAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fcGVybWFuZW50X3BvJyA9PiAkdlsnQlBPU1QnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2JuX3ByZXNlbnRfcm9hZCcgPT4gJHZbJ1JPQURfTk8nXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2hyX2JuX3ByZXNlbnRfaG91c2UnID0+ICR2WydIT1VTRV9OTyddLAogICAgICAgICAgICAgICAgICAgICAgICAnaHJfYm5fcHJlc2VudF9wbycgPT4gJHZbJ1BPJ10KICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIERCOjp0YWJsZSgnaHJfZW1wbG95ZWVfYmVuZ2FsaScpLT5pbnNlcnQoJGluc2VydCk7CgogICAgICAgIHJldHVybiAnZGQnOwogICAgfQogICAgCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBpc0hvbGlkYXkoJGFzc29jaWF0ZUlkLCAkZGF0ZSl7CiAgICAgICAgJG5kYXRlID0gQ2FyYm9uOjpwYXJzZSgkZGF0ZSktPmFkZERheSgpLT50b0RhdGVTdHJpbmcoKTsgCiAgICAgICAgJGR0ID0gREI6OnRhYmxlKCdob2xpZGF5X3JvYXN0ZXInKQogICAgICAgICAgLT53aGVyZSgnZGF0ZScsICRuZGF0ZSkKICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywgJGFzc29jaWF0ZUlkKQogICAgICAgICAgLT53aGVyZUluKCdyZW1hcmtzJywgWydIb2xpZGF5JywgJ09UJ10pCiAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAKICAgICAgICBpZigkZHQpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmlzSG9saWRheSgkYXNzb2NpYXRlSWQsICRuZGF0ZSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiAkZGF0ZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBpc0dsb2JhbEhvbGlkYXkoJHVuaXQsICRkYXRlKXsKICAgICAgICAkbmRhdGUgPSBDYXJib246OnBhcnNlKCRkYXRlKS0+YWRkRGF5KCktPnRvRGF0ZVN0cmluZygpOyAKICAgICAgICAkZHQgPSBEQjo6dGFibGUoJ2hyX3llYXJseV9ob2xpZGF5X3BsYW5uZXInKQogICAgICAgICAgLT53aGVyZSgnaHJfeWhwX2RhdGVzX29mX2hvbGlkYXlzJywgJG5kYXRlKQogICAgICAgICAgLT53aGVyZSgnaHJfeWhwX3VuaXQnLCAkdW5pdCkKICAgICAgICAgIC0+d2hlcmVJbignaHJfeWhwX29wZW5fc3RhdHVzJywgWzAsMl0pCiAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAKICAgICAgICBpZigkZHQpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmlzR2xvYmFsSG9saWRheSgkdW5pdCwgJG5kYXRlKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgcmV0dXJuICRkYXRlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzQnV5ZXJMZWZ0U2FsYXJ5KCkKICAgIHsKICAgICAgICAkbW9udGggPSAnMDknOyAkdGFibGUgPSAnaHJfYnV5ZXJfc2FsYXJ5X2FxbCc7ICRhdHRUYWJsZSA9ICdocl9idXllcl9hdHRfYXFsJzsKICAgICAgICAkdW5pdCA9IDM7CiAgICAgICAgJG1vbnRoU3RhcnQgPSAnMjAyMS0wOS0wMSc7CiAgICAgICAgJG1vbnRoRW5kID0gJzIwMjEtMDktMzAnOwogICAgICAgICRkYXlDb3VudCA9IDMwOwogICAgICAgICRkYXRhcyA9IERCOjp0YWJsZSgnaHJfbW9udGhseV9zYWxhcnkgYXMgcycpCiAgICAgICAgICAgIC0+c2VsZWN0KCdzLionLCdiLmFzX2lkIGFzIGFzcycpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsICdiLmFzc29jaWF0ZV9pZCcsJ3MuYXNfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdiLmFzX3VuaXRfaWQnLCAkdW5pdCkKICAgICAgICAgICAgLT53aGVyZSgncy5tb250aCcsJG1vbnRoKQogICAgICAgICAgICAtPndoZXJlSW4oJ3MuZW1wX3N0YXR1cycsWzIsNV0pCiAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdzLmRpc2J1cnNlX2RhdGUnKQogICAgICAgICAgICAtPndoZXJlKCdzLmxvY2F0aW9uX2lkJyw5KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAkYXNfaWQgPSBjb2xsZWN0KCRkYXRhcyktPnBsdWNrKCdhc3MnKTsKCgogICAgICAgICRidXllcl9zYWwgPSBEQjo6dGFibGUoJHRhYmxlLicgYXMgcycpCiAgICAgICAgICAgICAgICAgICAgLT5zZWxlY3QoJ3MuKicpCiAgICAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywnYi5hc19pZCcsJ3MuYXNfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbigncy5hc19pZCcsICRhc19pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdiLmFzX3VuaXRfaWQnLCAkdW5pdCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdzLm1vbnRoJywgJG1vbnRoKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgICAgICAgICAtPmtleUJ5KCdhc19pZCcpOwoKICAgICAgICBmb3JlYWNoICgkZGF0YXMgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICBpZihpc3NldCgkYnV5ZXJfc2FsWyR2LT5hc3NdKSl7CiAgICAgICAgICAgICAgICAgICAgJHNsID0gJGJ1eWVyX3NhbFskdi0+YXNzXTsKICAgICAgICAgICAgICAgICAgICAkZGVkdWN0Q29zdCA9ICgkc2wtPmFkdl9kZWR1Y3QgKyAkc2wtPmNnX2RlZHVjdCArICRzbC0+Zm9vZF9kZWR1Y3QgKyAkc2wtPm90aGVyc19kZWR1Y3QpOwogICAgICAgICAgICAgICAgICAgICRvdCA9ICgkdi0+b3RfcmF0ZSokc2wtPm90X2hvdXIpOwogICAgICAgICAgICAgICAgICAgICRsdmFkanVzdCA9ICRzbC0+bGVhdmVfYWRqdXN0OwogICAgICAgICAgICAgICAgICAgICRkZWR1Y3RTYWxhcnlBZGQgPSAkc2wtPnNhbGFyeV9hZGQ7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRhZHZfZGVkdWN0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGNnX2RlZHVjdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb29kX2RlZHVjdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRvdGhlcnNfZGVkdWN0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHNhbGFyeV9hZGQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkYm9udXNfYWRkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJGRlZHVjdENvc3QgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdGlvbkJvbnVzID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRnZXRBZGREZWR1Y3QgPSBEQjo6dGFibGUoJ2hyX3NhbGFyeV9hZGRfZGVkdWN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsICR2LT5hc19pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJz0nLCAkbW9udGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCd5ZWFyJywgJz0nLCAyMDIxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5maXJzdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdldEFkZERlZHVjdCAhPSBudWxsKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZHZwX2RlZHVjdCA9ICRnZXRBZGREZWR1Y3QtPmFkdnBfZGVkdWN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNnX2RlZHVjdCA9ICRnZXRBZGREZWR1Y3QtPmNnX2RlZHVjdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmb29kX2RlZHVjdCA9ICRnZXRBZGREZWR1Y3QtPmZvb2RfZGVkdWN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG90aGVyc19kZWR1Y3QgPSAkZ2V0QWRkRGVkdWN0LT5vdGhlcnNfZGVkdWN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNhbGFyeV9hZGQgPSAkZ2V0QWRkRGVkdWN0LT5zYWxhcnlfYWRkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlZHVjdFNhbGFyeUFkZCA9ICRzYWxhcnlfYWRkOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWR1Y3RDb3N0ID0gKCRhZHZwX2RlZHVjdCArICRjZ19kZWR1Y3QgKyAkZm9vZF9kZWR1Y3QgKyAkb3RoZXJzX2RlZHVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdGlvbkJvbnVzID0gJGdldEFkZERlZHVjdC0+Ym9udXNfYWRkOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRvdCA9IERCOjp0YWJsZSgkYXR0VGFibGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICR2LT5hc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywnPj0nLCRtb250aFN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaW5fZGF0ZScsJzw9JywkbW9udGhFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnb3RfaG91cicpOwogICAgICAgICAgICAgICAgICAgICRvdF9ob3VyID0gMDsKICAgICAgICAgICAgICAgICAgICAkb3RfbnVtX21pbiA9IG1pbl90b19vdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJG90ID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3RmbSA9IGV4cGxvZGUoIi4iLCAkb3QpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRvdGZtWzFdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG90X21pbiA9IHJvdW5kKCgoJzAuJy4kb3RmbVsxXSkgKiA2MCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvdF9ob3VyID0gJG90Zm1bMF0gKyAoJG90X21pbiA9PSAxPyAxOigkb3RfbnVtX21pblskb3RfbWluXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG90X2hvdXIgPSAkb3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJG90ID0gJG90KiR2LT5vdF9yYXRlOwogICAgICAgICAgICAgICAgICAgICRsdmFkanVzdCA9IDA7CgoKICAgICAgICAgICAgfQogICAgICAgICAgICAkYXQgPSBbCiAgICAgICAgICAgICAgICAncHJlc2VudCcgPT4gJHYtPnByZXNlbnQsCiAgICAgICAgICAgICAgICAnYWJzZW50JyA9PiAkdi0+YWJzZW50LAogICAgICAgICAgICAgICAgJ2hvbGlkYXknID0+ICR2LT5ob2xpZGF5LAogICAgICAgICAgICAgICAgJ2xhdGVfY291bnQnID0+ICR2LT5sYXRlX2NvdW50LAogICAgICAgICAgICAgICAgJ2xlYXZlJyA9PiAkdi0+bGVhdmUsCiAgICAgICAgICAgICAgICAnb3RfcmF0ZScgPT4gJHYtPm90X3JhdGUsCiAgICAgICAgICAgICAgICAnc3RhbXAnID0+ICR2LT5zdGFtcCwKICAgICAgICAgICAgICAgICdwYXlfdHlwZScgPT4gbnVsbCwKICAgICAgICAgICAgICAgICdlbXBfc3RhdHVzJyA9PiAkdi0+ZW1wX3N0YXR1cwogICAgICAgICAgICBdOwoKICAgICAgICAgICAgJGF0dEJvbnVzID0gMDsKICAgICAgICAgICAgJHNhbGFyeV9kYXRlID0gJHYtPnByZXNlbnQgKyAkdi0+aG9saWRheSArICR2LT5sZWF2ZSArICR2LT5hYnNlbnQ7CiAgICAgICAgICAgICRzdGFtcCA9ICR2LT5zdGFtcDsKICAgICAgICAgICAgCgogICAgICAgICAgICAkcGVyRGF5QmFzaWMgPSByb3VuZCgoJHYtPmJhc2ljIC8gMzApLDIpOwogICAgICAgICAgICAkcGVyRGF5R3Jvc3MgPSByb3VuZCgoJHYtPmdyb3NzIC8gICRkYXlDb3VudCksMik7CiAgICAgICAgICAgICRnZXRBYnNlbnREZWR1Y3QgPSAoaW50KSgkdi0+YWJzZW50ICogJHBlckRheUJhc2ljKTsKCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gZ2V0IHNhbGFyeSBwYXlhYmxlIGNhbGN1bGF0aW9uCiAgICAgICAgICAgICRzYWxhcnlQYXlhYmxlID0gcm91bmQoKCgkcGVyRGF5R3Jvc3MqJHNhbGFyeV9kYXRlKSAtICgkZ2V0QWJzZW50RGVkdWN0ICsgJGRlZHVjdENvc3QgKyAkc3RhbXApKSwgMik7CiAgICAgICAgICAgIAogICAgICAgICAgICAkcGFydGlhbEFtb3VudCA9ICR2LT5wYXJ0aWFsX2Ftb3VudDsKICAgICAgICAgICAgJHRvdGFsUGF5YWJsZSA9IGNlaWwoKGZsb2F0KSgkc2FsYXJ5UGF5YWJsZSArICRvdCAgICsgJHYtPnByb2R1Y3Rpb25fYm9udXMgKyAkbHZhZGp1c3QgLSAkcGFydGlhbEFtb3VudCkpOwogICAgICAgICAgICAkYXRbJ3BhcnRpYWxfYW1vdW50J10gPSAkcGFydGlhbEFtb3VudDsKICAgICAgICAgICAgJGF0Wyd0b3RhbF9wYXlhYmxlJ10gPSAkdG90YWxQYXlhYmxlOwogICAgICAgICAgICAkYXRbJ2Nhc2hfcGF5YWJsZSddID0gJHRvdGFsUGF5YWJsZTsKICAgICAgICAgICAgJGF0WydiYW5rX3BheWFibGUnXSA9IDA7CiAgICAgICAgICAgICRhdFsnc2FsYXJ5X3BheWFibGUnXSA9ICRzYWxhcnlQYXlhYmxlOwogICAgICAgICAgICAkYXRbJ2xlYXZlX2FkanVzdCddID0gJGx2YWRqdXN0OwogICAgICAgICAgICAkYXRbJ2Fic2VudF9kZWR1Y3QnXSA9ICRnZXRBYnNlbnREZWR1Y3Q7CgogICAgICAgICAgICBpZihpc3NldCgkYnV5ZXJfc2FsWyR2LT5hc3NdKSl7CgogICAgICAgICAgICAgICAgREI6OnRhYmxlKCR0YWJsZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICR2LT5hc3MpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkc2wtPmlkKQogICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKCRhdCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGF0Wydtb250aCddID0gJG1vbnRoOwogICAgICAgICAgICAgICAgJGF0Wydhc19pZCddID0gJHYtPmFzczsKICAgICAgICAgICAgICAgICRhdFsneWVhciddID0gMjAyMTsKCiAgICAgICAgICAgICAgICAkYXRbJ2dyb3NzJ10gPSAkdi0+Z3Jvc3M7CiAgICAgICAgICAgICAgICAkYXRbJ2Jhc2ljJ10gPSAkdi0+YmFzaWM7CiAgICAgICAgICAgICAgICAkYXRbJ2hvdXNlJ10gPSAkdi0+aG91c2U7CiAgICAgICAgICAgICAgICAkYXRbJ21lZGljYWwnXSA9ICR2LT5tZWRpY2FsOwogICAgICAgICAgICAgICAgJGF0Wyd0cmFuc3BvcnQnXSA9ICR2LT50cmFuc3BvcnQ7CiAgICAgICAgICAgICAgICAkYXRbJ2Zvb2QnXSA9ICR2LT5mb29kOwogICAgICAgICAgICAgICAgJGF0WydsYXRlX2NvdW50J10gPSAkdi0+bGF0ZV9jb3VudDsKICAgICAgICAgICAgICAgICRhdFsnYWJzZW50X2RlZHVjdCddID0gJGdldEFic2VudERlZHVjdDsKICAgICAgICAgICAgICAgICRhdFsnYWR2X2RlZHVjdCddID0gJGFkdl9kZWR1Y3Q7CiAgICAgICAgICAgICAgICAkYXRbJ2NnX2RlZHVjdCddID0gJGNnX2RlZHVjdDsKICAgICAgICAgICAgICAgICRhdFsnZm9vZF9kZWR1Y3QnXSA9ICRmb29kX2RlZHVjdDsKICAgICAgICAgICAgICAgICRhdFsnb3RoZXJzX2RlZHVjdCddID0gJG90aGVyc19kZWR1Y3Q7CiAgICAgICAgICAgICAgICAkYXRbJ3NhbGFyeV9hZGQnXSA9ICRzYWxhcnlfYWRkOwogICAgICAgICAgICAgICAgJGF0Wydib251c19hZGQnXSA9ICRib251c19hZGQ7CiAgICAgICAgICAgICAgICAkYXRbJ2xlYXZlX2FkanVzdCddID0gJHYtPmxlYXZlX2FkanVzdDsKICAgICAgICAgICAgICAgICRhdFsnb3RfaG91ciddID0gJG90X2hvdXI7CiAgICAgICAgICAgICAgICAkYXRbJ2F0dGVuZGFuY2VfYm9udXMnXSA9IDA7CiAgICAgICAgICAgICAgICAkYXRbJ3Byb2R1Y3Rpb25fYm9udXMnXSA9ICRwcm9kdWN0aW9uQm9udXM7CiAgICAgICAgICAgICAgICAkYXRbJ3N0YW1wJ10gPSAkc3RhbXA7CiAgICAgICAgICAgICAgICAkYXRbJ3NhbGFyeV9wYXlhYmxlJ10gPSAkc2FsYXJ5UGF5YWJsZTsKICAgICAgICAgICAgICAgICRhdFsndG90YWxfcGF5YWJsZSddID0gJHRvdGFsUGF5YWJsZTsKICAgICAgICAgICAgICAgICRhdFsnY2FzaF9wYXlhYmxlJ10gPSAkdG90YWxQYXlhYmxlOwogICAgICAgICAgICAgICAgJGF0WydiYW5rX3BheWFibGUnXSA9IDA7CiAgICAgICAgICAgICAgICAkYXRbJ3RkcyddID0gMDsKICAgICAgICAgICAgICAgICRhdFsncGF5X3N0YXR1cyddID0gJHYtPnBheV9zdGF0dXM7CiAgICAgICAgICAgICAgICAkYXRbJ3BheV90eXBlJ10gPSAkdi0+cGF5X3R5cGU7CiAgICAgICAgICAgICAgICAkYXRbJ2VtcF9zdGF0dXMnXSA9ICR2LT5lbXBfc3RhdHVzOwogICAgICAgICAgICAgICAgJGF0WydvdF9zdGF0dXMnXSA9ICR2LT5vdF9zdGF0dXM7CiAgICAgICAgICAgICAgICAkYXRbJ2Rlc2lnbmF0aW9uX2lkJ10gPSAkdi0+ZGVzaWduYXRpb25faWQ7CiAgICAgICAgICAgICAgICAkYXRbJ3N1YnNlY3Rpb25faWQnXSA9ICR2LT5zdWJfc2VjdGlvbl9pZDsKICAgICAgICAgICAgICAgICRhdFsnbG9jYXRpb25faWQnXSA9ICR2LT5sb2NhdGlvbl9pZDsKICAgICAgICAgICAgICAgICRhdFsndW5pdF9pZCddID0gJHYtPnVuaXRfaWQ7CiAgICAgICAgICAgICAgICBEQjo6dGFibGUoJHRhYmxlKS0+aW5zZXJ0KCRhdCk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgfQoKCiAgICAgICAgJGludiA9IERCOjp0YWJsZSgkdGFibGUpCiAgICAgICAgCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignYXNfaWQnLCAkYXNfaWQpCiAgICAgICAgICAgIC0+d2hlcmVJbignZW1wX3N0YXR1cycsIFsyLDVdKQogICAgICAgICAgICAtPndoZXJlKCdtb250aCcsICRtb250aCkKICAgICAgICAgICAgLT5wbHVjaygnYXNfaWQnLCdpZCcpOwoKCiAgICAgICAgcmV0dXJuICRpbnY7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRSb2NrZXQoKXsKICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgJGRhdGEgPSBbXTsgICAgIAogICAgICAgIAogICAgICAgICRlbXAgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicpCiAgICAgICAgICAgICAgICAtPnNlbGVjdCgnYi5hc19pZCcsJ2IuYXNzb2NpYXRlX2lkJywnYmVuLmJlbl9jdXJyZW50X3NhbGFyeScsJ2IuYXNfb3JhY2xlX2NvZGUnKQogICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYmVuZWZpdHMgYXMgYmVuJywnYi5hc3NvY2lhdGVfaWQnLCdiZW4uYmVuX2FzX2lkJykKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc191bml0X2lkJywgWzEsNCw1XSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYi5hc3NvY2lhdGVfaWQnLCBhcnJheV9rZXlzKCRkYXRhKSkKICAgICAgICAgICAgICAgIC0+Z2V0KCktPmtleUJ5KCdhc3NvY2lhdGVfaWQnKTsKICAgICAgICAkZHAgPSBbXTsKICAgICAgICBmb3JlYWNoKCRkYXRhIGFzICRrZXkgPT4gJGQpewogICAgICAgICAgICAvLyRrZXkgPSBpc3NldCgkZW1wWyRrZXldKT8ka2V5OidBJy4ka2V5OwogICAgICAgICAgICBpZihpc3NldCgkZW1wWyRrZXldKSl7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgREI6OnRhYmxlKCdocl9iZW5lZml0cycpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiZW5fYXNfaWQnLCAka2V5KQogICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdiZW5fYmFua19hbW91bnQnID0+ICRlbXBbJGtleV0tPmJlbl9jdXJyZW50X3NhbGFyeSwKICAgICAgICAgICAgICAgICAgICAnYmVuX2Nhc2hfYW1vdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdiYW5rX25hbWUnID0+ICdyb2NrZXQnLAogICAgICAgICAgICAgICAgICAgICdiYW5rX25vJyA9PiAkZFsnQWNjb3VudCddCiAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAKICAgICAgICAgICAkcXVldWUgPSAobmV3IFByb2Nlc3NVbml0V2lzZVNhbGFyeSgnaHJfYXR0ZW5kYW5jZV9tYm0nLCAnMDUnLCAyMDIxLCAkZW1wWyRrZXldLT5hc19pZCwgMzEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vblF1ZXVlKCdzYWxhcnlnZW5lcmF0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmRlbGF5KENhcmJvbjo6bm93KCktPmFkZFNlY29uZHMoMikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goJHF1ZXVlKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkZHBbJGtleV0gPSAkZFsnQWNjb3VudCddOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAobmV3IEZhc3RFeGNlbChjb2xsZWN0KCRkcCkpKS0+ZG93bmxvYWQoJ1JvY2tldC54bHN4Jyk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTYWxhcnkoKQogICAgewogICAgICAgICRlbXAgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIDMpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19sb2NhdGlvbicsOSkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2Fzc29jaWF0ZV9pZCcsICdhc19vcmFjbGVfY29kZScpOwoKICAgICAgICAkYmVuID0gREI6OnRhYmxlKCdocl9iZW5lZml0cycpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2Jlbl9hc19pZCcsICRlbXApCiAgICAgICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgICAgICAtPmtleUJ5KCdiZW5fYXNfaWQnKTsKICAgICAgICAkZGF0YSA9IFtdOwoKCiAgICAgICAgJHVwID0gW107ICRpbnMgPSBbXTsKCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkdmFsKSB7CgogICAgICAgICAgICBpZihpc3NldCgkZW1wWyRrZXldKSl7CiAgICAgICAgICAgICAgICAkYXNzID0gJGVtcFska2V5XTsKICAgICAgICAgICAgICAgIC8vIGNoZWNrIHNhbGFyeQogICAgICAgICAgICAgICAgJHVwWydiZW5fam9pbmluZ19zYWxhcnknXSA9ICR2YWxbJ3NhbGFyeSddOwogICAgICAgICAgICAgICAgJHVwWydiZW5fY3VycmVudF9zYWxhcnknXSA9ICR2YWxbJ3NhbGFyeSddOwogICAgICAgICAgICAgICAgJHVwWydiZW5fYmFzaWMnXSA9IGNlaWwoKCR2YWxbJ3NhbGFyeSddLTE4NTApLzEuNSk7CiAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9ob3VzZV9yZW50J10gPSAkdmFsWydzYWxhcnknXSAtMTg1MCAtICR1cFsnYmVuX2Jhc2ljJ107CgogICAgICAgICAgICAgICAgLy8gYmFuayAKICAgICAgICAgICAgICAvKiAgaWYoJHZhbFsnZGJibCddICE9ICcjTi9BJyl7CiAgICAgICAgICAgICAgICAgICAgJHVwWydiZW5fYmFua19hbW91bnQnXSA9ICR2YWxbJ2JhbmsnXTsKICAgICAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gJHZhbFsnc2FsYXJ5J10gLSAkdmFsWydiYW5rJ10gOwogICAgICAgICAgICAgICAgICAgICR1cFsnYmVuX3Rkc19hbW91bnQnXSA9ICR2YWxbJ3RkcyddOwogICAgICAgICAgICAgICAgICAgICR1cFsnYmFua19uYW1lJ10gPSAnZGJibCc7CiAgICAgICAgICAgICAgICAgICAgJHVwWydiYW5rX25vJ10gPSAkdmFsWydkYmJsJ107CgogICAgICAgICAgICAgICAgfWVsc2UgaWYoJHZhbFsncm9ja2V0J10gIT0gJyNOL0EnKXsKICAgICAgICAgICAgICAgIC8vIHJvY2tldAogICAgICAgICAgICAgICAgICAgICR1cFsnYmVuX2JhbmtfYW1vdW50J10gPSAkdmFsWydzYWxhcnknXTsKICAgICAgICAgICAgICAgICAgICAkdXBbJ2Jlbl9jYXNoX2Ftb3VudCddID0gMCA7CiAgICAgICAgICAgICAgICAgICAgJHVwWydiYW5rX25hbWUnXSA9ICdyb2NrZXQnOwogICAgICAgICAgICAgICAgICAgICR1cFsnYmFua19ubyddID0gJHZhbFsncm9ja2V0J107CiAgICAgICAgICAgICAgICB9ZWxzZXsqLwogICAgICAgICAgICAgICAgLy8gY2FzaAogICAgICAgICAgICAgICAgICAgICR1cFsnYmVuX2JhbmtfYW1vdW50J10gPSAwOwogICAgICAgICAgICAgICAgICAgICR1cFsnYmVuX2Nhc2hfYW1vdW50J10gPSAkdmFsWydzYWxhcnknXSA7CgogICAgICAgICAgICAgICAvKiB9Ki8KCgogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGJlblskYXNzXSkpewogICAgICAgICAgICAgICAgICAgIERCOjp0YWJsZSgnaHJfYmVuZWZpdHMnKS0+d2hlcmUoJ2Jlbl9hc19pZCcsICRhc3MpLT51cGRhdGUoJHVwKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRpbnNbJGFzc11bJ2Jlbl9hc19pZCddID0gJGFzczsKICAgICAgICAgICAgICAgICAgICAkaW5zWyRhc3NdID0gJHVwOwogICAgICAgICAgICAgICAgICAgICRpbnNbJGFzc11bJ2Jlbl9tZWRpY2FsJ10gPSA2MDA7CiAgICAgICAgICAgICAgICAgICAgJGluc1skYXNzXVsnYmVuX3RyYW5zcG9ydCddID0gMzUwOwogICAgICAgICAgICAgICAgICAgICRpbnNbJGFzc11bJ2Jlbl9mb29kJ10gPSA5MDA7CiAgICAgICAgICAgICAgICAgICAgJGluc1skYXNzXVsnYmVuX3N0YXR1cyddID0gMTsKICAgICAgICAgICAgICAgICAgICAkaW5zWyRhc3NdWydiZW5fYXNfaWQnXSA9ICRhc3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgREI6OnRhYmxlKCdocl9iZW5lZml0cycpLT5pbnNlcnQoJGlucyk7CiAgICB9CgoKCiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBncm9zczJwYXkoKQogICAgewoKICAgICAgICAkZGF0ZSA9ICcyMDIxLTA4LTE1JzsKICAgICAgICAkbW9udGggPSAgZGF0ZSgnbScsIHN0cnRvdGltZSgkZGF0ZSkpOwogICAgICAgICR5ZWFyICA9IGRhdGUoJ1knLCBzdHJ0b3RpbWUoJGRhdGUpKTsKICAgICAgICAkZ3IgPSAyOwogICAgICAgICRkYXlfY291bnQgPSBjYWxfZGF5c19pbl9tb250aChDQUxfR1JFR09SSUFOLCRtb250aCwkeWVhcik7CiAgICAgICAgCiAgICAgICAgJGV4ID0gREI6OnRhYmxlKCdocl9zYWxhcnlfYWRqdXN0X2RldGFpbHMgYXMgZCcpCiAgICAgICAgICAgICAgICAgICAgLT5zZWxlY3QoREI6OnJhdygnY29uY2F0KG0uYXNzb2NpYXRlX2lkLGQuZGF0ZSkgYXMgZCcpLCAnZC5hbW91bnQnKQogICAgICAgICAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX3NhbGFyeV9hZGp1c3RfbWFzdGVyIGFzIG0nLCAnbS5pZCcsJ2Quc2FsYXJ5X2FkanVzdF9tYXN0ZXJfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ20ubW9udGgnLCBkYXRlKCduJywgc3RydG90aW1lKCRkYXRlKSkpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZC50eXBlJywgMikKICAgICAgICAgICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgICAgICAgICAgLT5wbHVjaygnYW1vdW50JywnZCcpOwogICAgICAgIAogICAgICAgIAogICAgICAgICRkYXRhID0gREI6OnRhYmxlKCdocl9hdHRlbmRhbmNlX21ibSBhcyBhJykKICAgICAgICAgICAgICAgICAtPnNlbGVjdCgKICAgICAgICAgICAgICAgICAgICAnYi5hc19pZCcsJ2IuYXNzb2NpYXRlX2lkJywnYi5hc191bml0X2lkJywgCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnYmVuLmJlbl9jdXJyZW50X3NhbGFyeS8nLiRkYXlfY291bnQuJyBhcyBncycpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgLT5sZWZ0Sm9pbignaHJfYXNfYmFzaWNfaW5mbyBhcyBiJywgJ2IuYXNfaWQnLCAnYS5hc19pZCcpCiAgICAgICAgICAgICAgICAgLy8tPmxlZnRKb2luKCdob2xpZGF5X3JvYXN0ZXIgYXMgaCcsICdoLmFzX2lkJywgJ2IuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAtPmxlZnRKb2luKCdocl9iZW5lZml0cyBhcyBiZW4nLCAnYmVuLmJlbl9hc19pZCcsICdiLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgLy8tPndoZXJlSW4oJ2IuYXNzb2NpYXRlX2lkJyxbJzE5QzEwMTE3NE4nXSkKICAgICAgICAgICAgICAgICAvLy0+d2hlcmUoJ2IuYXNfc3Vic2VjdGlvbl9pZCcsMTA4KQogICAgICAgICAgICAgICAgIC8vLT53aGVyZSgnaC5yZW1hcmtzJywnT1QnKQogICAgICAgICAgICAgICAgIC8vLT53aGVyZSgnYi5hc19vdCcsMSkKICAgICAgICAgICAgICAgICAvLy0+d2hlcmUoJ2IuYXNfc3RhdHVzJywgMSkKICAgICAgICAgICAgICAgICAvLy0+d2hlcmUoJ2Iuc2hpZnRfcm9hc3Rlcl9zdGF0dXMnLCAwKQogICAgICAgICAgICAgICAgIC8vLT53aGVyZSgnYi5hc19kb2onLCc+JywnMjAyMS0wNS0xNycpCiAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLFsxLDQsNV0pCiAgICAgICAgICAgICAgICAgLT53aGVyZSgnYS5pbl9kYXRlJywgJGRhdGUpCiAgICAgICAgICAgICAgICAgLy8tPndoZXJlKCdoLmRhdGUnLCAkZGF0ZSkKICAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIAogICAgICAgIC8vcmV0dXJuICRkYXRhOwogICAgICAgIC8vcmV0dXJuIGNvdW50KCRkYXRhKTsgCiAgICAgICAgJGNoayA9IFtdOwogICAgICAgIGZvcmVhY2goJGRhdGEgYXMgJGQpewogICAgICAgICAgICAkdGFibGVOYW1lID0gZ2V0X2F0dF90YWJsZSgkZC0+YXNfdW5pdF9pZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkY2hrW10gPSAgJGQtPmFzc29jaWF0ZV9pZC4kZGF0ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRtYXN0ZXIgPSBTYWxhcnlBZGp1c3RNYXN0ZXI6OmZpcnN0T3JOZXcoWwogICAgICAgICAgICAgICAgJ2Fzc29jaWF0ZV9pZCcgPT4gJGQtPmFzc29jaWF0ZV9pZCwKICAgICAgICAgICAgICAgICdtb250aCcgPT4gJG1vbnRoLAogICAgICAgICAgICAgICAgJ3llYXInID0+ICR5ZWFyCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICAkbWFzdGVyLT5zYXZlKCk7CiAgICAgICAgICAgICRnb3IgPSAkZC0+Z3MgKiAkZ3I7CiAgICAgICAgICAgIFNhbGFyeUFkanVzdERldGFpbHM6OnVwZGF0ZU9yQ3JlYXRlKAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICdzYWxhcnlfYWRqdXN0X21hc3Rlcl9pZCcgPT4gJG1hc3Rlci0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2RhdGUnID0+ICRkYXRlLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAyLAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiBudW1iZXJfZm9ybWF0KChmbG9hdCkkZ29yLCAyLCAnLicsICcnKSwKICAgICAgICAgICAgICAgICAgICAnY29tbWVudCcgPT4gJycKICAgICAgICAgICAgICAgIF0gICAKICAgICAgICAgICAgKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRxdWV1ZSA9IChuZXcgUHJvY2Vzc1VuaXRXaXNlU2FsYXJ5KCR0YWJsZU5hbWUsICRtb250aCwgJHllYXIsICRkLT5hc19pZCwgJGRheV9jb3VudCkpCiAgICAgICAgICAgICAgICAtPm9uUXVldWUoJ3NhbGFyeWdlbmVyYXRlJykKICAgICAgICAgICAgICAgIC0+ZGVsYXkoQ2FyYm9uOjpub3coKS0+YWRkU2Vjb25kcygyKSk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgkcXVldWUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJGNoazsKICAgICAgICAKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGdpdmVSb2FzdGVyKCkKICAgIHsKICAgICAgICAkZGF0YSA9IFtdOwoKICAgICAgICAkZW1wID0gREI6OnRhYmxlKCdocl9hc19iYXNpY19pbmZvJykKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfb3JhY2xlX2NvZGUnLCBhcnJheV9rZXlzKCRkYXRhKSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX3VuaXRfaWQnLCA4KQogICAgICAgICAgICAgICAgLT5wbHVjaygnYXNfb3JhY2xlX2NvZGUnLCdhc19pZCcpOwoKICAgICAgICBmb3JlYWNoICgkZW1wIGFzICRrZXkgPT4gJHYpIHsKICAgICAgICAgICAgJGluc1tdID0gWwogICAgICAgICAgICAgICAgJ2FzX2lkJyA9PiAka2V5LAogICAgICAgICAgICAgICAgJ2RheScgPT4gdWNmaXJzdChzdHJ0b2xvd2VyKCRkYXRhWyR2XVsnUk9TVEVSJ10pKQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICBEQjo6dGFibGUoJ2hyX3JvYXN0ZXJfaG9saWRheScpCiAgICAgICAgICAgIC0+aW5zZXJ0KCRpbnMpOwoKICAgICAgICByZXR1cm4gJGVtcDsKCiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBtYWtlQWxsRGF5SG9saWRheSgpCiAgICB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICRmaXJzdF9kYXkgPSAnMjAyMS0wNy0zMSc7CiAgICAgICAgJGxhc3RfZGF5ICA9ICcyMDIxLTA3LTMxJzsKICAgICAgICAKICAgICAgICAkbW9udGggPSBkYXRlKCdtJywgc3RydG90aW1lKCRmaXJzdF9kYXkpKTsKICAgICAgICAKICAgICAgICAvKiRlbXAgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiLmFzX3VuaXRfaWQnLCA4KQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfc2hpZnRfaWQnLCchPScsJ05pZ2h0JykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX3N0YXR1cycsIDEpCiAgICAgICAgICAgICAgICAtPmdldCgpOyovCiAgICAgICAgICAgICAgICAKICAgICAgICAkZW1wID0gW107CiAgICAgICAgJGVtcCA9ICBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdiLmFzX3VuaXRfaWQnLCA4KQogICAgICAgICAgICAgICAgLT53aGVyZU5vdEluKCdhc3NvY2lhdGVfaWQnLCRlbXApCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19zdGF0dXMnLCAxKQogICAgICAgICAgICAgICAgLT5wbHVjaygnYXNzb2NpYXRlX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgIHJldHVybiAkZW1wOwogICAgICAgICAgICAgICAgCiAgICAgICAgJGV4aXN0cyA9IERCOjp0YWJsZSgnaG9saWRheV9yb2FzdGVyJykKICAgICAgICAgICAgLT5zZWxlY3QoCiAgICAgICAgICAgICAgICBEQjo6cmF3KCJDT05DQVQoZGF0ZSxhc19pZCkgQVMgcHAiKSwKICAgICAgICAgICAgICAgICdyZW1hcmtzJwogICAgICAgICAgICApCiAgICAgICAgICAgIC0+d2hlcmUoJ21vbnRoJywgJG1vbnRoKQogICAgICAgICAgICAtPndoZXJlKCd5ZWFyJywgZGF0ZSgnWScpKQogICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgIC0+a2V5QnkoJ3BwJyk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIAogICAgICAgICRkYXRlcyA9IFtdOwogICAgICAgICRkYXRlID0gJGZpcnN0X2RheTsKICAgICAgICB3aGlsZSgkZGF0ZSA8PSAkbGFzdF9kYXkpewogICAgICAgICAgICAkZGF0ZXNbXSA9ICRkYXRlOwogICAgICAgICAgICAKICAgICAgICAgICAgJGlucyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkZW1wIGFzICRrMSA9PiAkaCkgewogICAgICAgICAgICAgICAgaWYoIWlzc2V0KCRleGlzdHNbJGRhdGUuJGhdKSl7CgogICAgICAgICAgICAgICAgICAgICRpbnNbJGRhdGUuJGhdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICd5ZWFyJyAgPT4gZGF0ZSgnWScpLAogICAgICAgICAgICAgICAgICAgICAgICAnbW9udGgnID0+ICRtb250aCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FzX2lkJyA9PiAkaCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnICA9PiAgJGRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyAgID0+ICdIb2xpZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbW1lbnQnID0+ICdTcGVjaWFsIExlYXZlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hYnNlbnQnKS0+d2hlcmUoJ2Fzc29jaWF0ZV9pZCcsJGgpLT53aGVyZSgnZGF0ZScsICRkYXRlKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICAvL3JldHVybiAkaW5zOwogICAgICAgICAgICBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlcicpLT5pbnNlcnRPcklnbm9yZSgkaW5zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRkYXRlID0gXENhcmJvblxDYXJib246OnBhcnNlKCRkYXRlKS0+YWRkRGF5KCktPnRvRGF0ZVN0cmluZygpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gY291bnQoJGlucyk7CiAgICAgICAgCiAgICB9CiAgICAKICAgIAogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gcmZpZHB4KCl7CiAgICAgICAgCiAgICAgICAgICAgICRkYXRhID0gW107CiAgICAgICAgICAgICRlcnJvcnMgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCgkZGF0YSBhcyAkayA9PiAkdil7CiAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX3VuaXRfaWQnLCA4KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX29yYWNsZV9zbCcsICRrKQogICAgICAgICAgICAgICAgICAgIC0+dXBkYXRlKFsnYXNfcmZpZF9jb2RlJyA9PiAgJHZbJ3JmJ11dKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH1jYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgICAkZXJyb3JzW10gPSAkdlsncmYnXS4kZS0+Z2V0TWVzc2FnZSgpOwogICAgICAgIAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuICRlcnJvcnM7CiAgICAKfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRJbmNyZW1lbnRNb250aCgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAtPnNlbGVjdCgnYXNzb2NpYXRlX2lkJywnYXNfZG9qJywnYXNfZW1wX3R5cGVfaWQnKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAkaW5zZXJ0ID0gW107CgogICAgICAgIGZvcmVhY2ggKCRkYXRhIGFzICRrZXkgPT4gJHYpIHsKICAgICAgICAgICAgaWYoJHYtPmFzX2Rvail7CiAgICAgICAgICAgICAgICBpZigkdi0+YXNfZW1wX3R5cGVfaWQgPT0gMyAmJiAkdi0+YXNfZG9qIDwgJzIwMTgtMTItMDEnKXsKICAgICAgICAgICAgICAgICAgICAkaW5zZXJ0WyR2LT5hc3NvY2lhdGVfaWRdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICdhc3NvY2lhdGVfaWQnID0+ICR2LT5hc3NvY2lhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdtb250aCcgPT4gJ0RlYycsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZW1hcmtzJyA9PiAnRycKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJGluc2VydFskdi0+YXNzb2NpYXRlX2lkXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyA9PiAkdi0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnbW9udGgnID0+IGRhdGUoJ00nLCBzdHJ0b3RpbWUoJHYtPmFzX2RvaikpLAogICAgICAgICAgICAgICAgICAgICAgICAncmVtYXJrcycgPT4gbnVsbAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRkID0gYXJyYXlfY2h1bmsoJGluc2VydCwgMzAwKTsKCiAgICAgICAgZm9yZWFjaCAoJGQgYXMgJGtleSA9PiAkaW4pIHsKICAgICAgICAgICAgREI6OnRhYmxlKCdocl9pbmNyZW1lbnRfbW9udGgnKQogICAgICAgICAgICAgICAgICAgIC0+aW5zZXJ0T3JJZ25vcmUoJGluKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjb3VudCgkZCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGVEZXB0KCkKICAgIHsKICAgICAgICAkZGF0YSA9IFtdOwoKICAgICAgICAkc3ViID0gc3ViU2VjdGlvbl9ieV9pZCgpOwoKICAgICAgICBmb3JlYWNoICgkZGF0YSBhcyAka2V5ID0+ICR2KSB7CiAgICAgICAgICAgIGlmKGlzc2V0KCRzdWJbJHZbJ3N1Yl9zZWN0aW9uX2lkJ11dKSl7CiAgICAgICAgICAgICRzcyA9ICRzdWJbJHZbJ3N1Yl9zZWN0aW9uX2lkJ11dOwogICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNfdW5pdF9pZCcsIDgpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc3NvY2lhdGVfaWQnLCAka2V5KQogICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdhc19zdWJzZWN0aW9uX2lkJyA9PiAkdlsnc3ViX3NlY3Rpb25faWQnXSwKICAgICAgICAgICAgICAgICAgICAnYXNfc2VjdGlvbl9pZCcgPT4gJHNzWydocl9zdWJzZWNfc2VjdGlvbl9pZCddLAogICAgICAgICAgICAgICAgICAgICdhc19kZXBhcnRtZW50X2lkJyA9PiAkc3NbJ2hyX3N1YnNlY19kZXBhcnRtZW50X2lkJ10sCiAgICAgICAgICAgICAgICAgICAgJ2FzX2FyZWFfaWQnID0+ICRzc1snaHJfc3Vic2VjX2FyZWFfaWQnXQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAnZG9uZSc7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja0R1cGxpY2F0ZSgpCiAgICB7CiAgICAgICAgJHAgPSBbXTsKICAgICAgICAkZHQgPSBEQjo6dGFibGUoJ2hvbGlkYXlfcm9hc3RlciBhcyBoJykKICAgICAgICAgICAgLT5zZWxlY3QoJ2guZGF0ZScsJ2IuYXNfaWQnLCdiLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsJ2IuYXNzb2NpYXRlX2lkJywnaC5hc19pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2guZGF0ZScsJz49JywnMjAyMS0wMy0wMScpCiAgICAgICAgICAgIC0+d2hlcmUoJ2guZGF0ZScsJzw9JywnMjAyMS0wMy0zMScpCiAgICAgICAgICAgIC0+d2hlcmUoJ2gucmVtYXJrcycsICdIb2xpZGF5JykKICAgICAgICAgICAgLT53aGVyZUluKCdiLmFzX3VuaXRfaWQnLFsxLDQsNV0pCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgIGZvcmVhY2goJGR0IGFzICRrZXkgPT4gJGQpewogICAgICAgICAgICAvKiRhID0gREI6OnRhYmxlKCdocl9hdHRlbmRhbmNlX21ibScpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpbl9kYXRlJywgJGQtPmRhdGUpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc19pZCcsICRkLT5hc19pZCkKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsqLwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICRhID0gREI6OnRhYmxlKCdocl9hYnNlbnQnKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZGF0ZScsJGQtPmRhdGUpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhc3NvY2lhdGVfaWQnLCAkZC0+YXNzb2NpYXRlX2lkKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICBpZigkYSl7CiAgICAgICAgICAgICAgICAkcFtdID0gJGEgOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICByZXR1cm4gJHA7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZWZyaWRheSgpCiAgICB7CiAgICAgICAgJGR0ID0gJzIwMjEtMDMtMjYnOwogICAgICAgICRkYXRhID0gREI6OnRhYmxlKCdocl9zaGlmdF9yb2FzdGVyJykKICAgICAgICAgICAgLT53aGVyZSgnc2hpZnRfcm9hc3Rlcl9tb250aCcsJzAzJykKICAgICAgICAgICAgLT53aGVyZSgnZGF5XzI2JywnRnJpZGF5IERheScpCiAgICAgICAgICAgIC0+cGx1Y2soJ3NoaWZ0X3JvYXN0ZXJfdXNlcl9pZCcpLT50b0FycmF5KCk7CgogICAgICAgICRhdHQgPSBEQjo6dGFibGUoJ2hyX2F0dF9zcGVjaWFsJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2luX2RhdGUnLCAkZHQpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2FzX2lkJywkZGF0YSkKICAgICAgICAgICAgICAgIC0+ZGVsZXRlKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBmaW5kRnJpZGF5KCkKICAgIHsKICAgICAgICAkZHQgPSAnMjAyMS0wMy0yNic7CiAgICAgICAgJGRhdGEgPSBEQjo6dGFibGUoJ2hyX3NoaWZ0X3JvYXN0ZXIgYXMgaCcpCiAgICAgICAgICAgIC0+c2VsZWN0KCdiLionKQogICAgICAgICAgICAtPmxlZnRKb2luKCdocl9hc19iYXNpY19pbmZvIGFzIGInLCdiLmFzX2lkJywnaC5zaGlmdF9yb2FzdGVyX3VzZXJfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdoLnNoaWZ0X3JvYXN0ZXJfbW9udGgnLCcwMycpCiAgICAgICAgICAgIC0+d2hlcmUoJ2guZGF5XzI2JywnRnJpZGF5IE5pZ2h0JykKICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICAtPmtleUJ5KCdhc19pZCcpOwoKICAgICAgICAkYXMgPSBjb2xsZWN0KCRkYXRhKS0+cGx1Y2soJ2FzX2lkJyktPnRvQXJyYXkoKTsKCgogICAgICAgICRhdHQgPSBEQjo6dGFibGUoJ2hyX2F0dGVuZGFuY2VfaGlzdG9yeScpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdhdHRfZGF0ZScsICRkdCkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfaWQnLCRhcykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3VuaXQnLDgpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAkc2hpZnQgPSBEQjo6dGFibGUoJ2hyX3NoaWZ0JykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfc2hpZnRfbmFtZScsICdGcmlkYXkgT1QnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdocl9zaGlmdF91bml0X2lkJywgOCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnb3Rfc3RhdHVzJywgMSkKICAgICAgICAgICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdocl9zaGlmdF9pZCcsJ0RFU0MnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgIGZvcmVhY2ggKCRhdHQgYXMgJGtleSA9PiAkdmFsdWUpIHsKICAgICAgICAgICAgJHRoaXMtPmV4dHJhY3RTcGVjaWFsT1QoJGR0LCAkdmFsdWUtPnJhd19kYXRhLCAkZGF0YVskdmFsdWUtPmFzX2lkXSwgJHNoaWZ0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICdkb25lJzsKCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGV4dHJhY3RTcGVjaWFsT1QoJGRhdGUsICR0aW1lLCAkZW1wLCAkc2hpZnQpCiAgICB7CiAgICAgICAgJHN0YXJ0ID0gJGRhdGUuIiAiLiRzaGlmdC0+aHJfc2hpZnRfc3RhcnRfdGltZTsKCiAgICAgICAgJGluX3RpbWUgPSBDYXJib246OmNyZWF0ZUZyb21Gb3JtYXQoJ1ktbS1kIEg6aTpzJywgJHN0YXJ0KTsKICAgICAgICAkaW5fdGltZV9iZWdpbiA9ICRpbl90aW1lLT5jb3B5KCktPnN1YkhvdXJzKDIpOwogICAgICAgICRpbl90aW1lX2VuZCAgID0gJGluX3RpbWUtPmNvcHkoKS0+YWRkSG91cnMoMSk7CgoKCiAgICAgICAgJGVuZCAgID0gJGRhdGUuIiAiLiRzaGlmdC0+aHJfc2hpZnRfZW5kX3RpbWU7CiAgICAgICAgJG91dF90aW1lID0gQ2FyYm9uOjpjcmVhdGVGcm9tRm9ybWF0KCdZLW0tZCBIOmk6cycsICRlbmQpOwogICAgICAgICRvdXRfdGltZV9iZWdpbiA9ICRpbl90aW1lX2VuZC0+Y29weSgpLT5hZGRTZWNvbmQoKTsKICAgICAgICAkb3V0X3RpbWVfZW5kICAgPSAkb3V0X3RpbWUtPmNvcHkoKS0+YWRkSG91cnMoNCk7CgogICAgICAgCgogICAgICAgIGlmKCR0aW1lID4gJGluX3RpbWVfYmVnaW4gJiYgJHRpbWUgPCAkb3V0X3RpbWVfZW5kICl7CgogICAgICAgICAgICAkbGFzdF9wdW5jaCA9IERCOjp0YWJsZSgnaHJfYXR0X3NwZWNpYWwnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luX2RhdGUnID0+ICRkYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhc19pZCcgPT4gJGVtcC0+YXNfaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgICRkdCA9IFtdOwoKICAgICAgICAgICAgaWYoJGxhc3RfcHVuY2gpewogICAgICAgICAgICAgICAgLy8gY2hlY2sgaW4KICAgICAgICAgICAgICAgIGlmKCgkaW5fdGltZV9iZWdpbiA8PSAkdGltZSAmJiAgJGluX3RpbWVfZW5kID49ICR0aW1lKSAmJiAoJHRpbWUgPD0gJGxhc3RfcHVuY2gtPmluX3RpbWUgIHx8ICRsYXN0X3B1bmNoLT5pbl90aW1lID09IG51bGwpKXsKICAgICAgICAgICAgICAgICAgICAkZHRbJ2luX3RpbWUnXSA9ICR0aW1lOwogICAgICAgICAgICAgICAgICAgICRsYXN0X3B1bmNoLT5pbl90aW1lID0gJHRpbWU7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZigoJG91dF90aW1lX2JlZ2luIDw9ICR0aW1lICYmICAkb3V0X3RpbWVfZW5kID49ICR0aW1lKSAmJiAoJHRpbWUgPj0gJGxhc3RfcHVuY2gtPm91dF90aW1lIHx8ICRsYXN0X3B1bmNoLT5vdXRfdGltZSA9PSBudWxsICkpewogICAgICAgICAgICAgICAgICAgICRkdFsnb3V0X3RpbWUnXSA9ICR0aW1lOwogICAgICAgICAgICAgICAgICAgICRsYXN0X3B1bmNoLT5vdXRfdGltZSA9ICR0aW1lOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBvdAogICAgICAgICAgICAgICAgaWYoJGxhc3RfcHVuY2gtPmluX3RpbWUgIT0gbnVsbCAmJiAkbGFzdF9wdW5jaC0+b3V0X3RpbWUgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgJGR0WydvdF9ob3VyJ10gPSAkdGhpcy0+ZnVsbG90KCRsYXN0X3B1bmNoLT5pbl90aW1lLCAkc3RhcnQsICRsYXN0X3B1bmNoLT5vdXRfdGltZSwgICRzaGlmdC0+aHJfc2hpZnRfYnJlYWtfdGltZSk7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoJGR0KXsKCiAgICAgICAgICAgICAgICAgICAgREI6OnRhYmxlKCdocl9hdHRfc3BlY2lhbCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywkbGFzdF9wdW5jaC0+aWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2lkJywkZW1wLT5hc19pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoJGR0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGR0ID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgJ2luX2RhdGUnID0+ICRkYXRlLAogICAgICAgICAgICAgICAgICAgICdhc19pZCcgPT4gJGVtcC0+YXNfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2hyX3NoaWZ0X2NvZGUnID0+ICRzaGlmdC0+aHJfc2hpZnRfY29kZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmKCRpbl90aW1lX2JlZ2luIDw9ICR0aW1lICYmICAkaW5fdGltZV9lbmQgPj0gJHRpbWUpewogICAgICAgICAgICAgICAgICAgICRkdFsnaW5fdGltZSddID0gJHRpbWU7CiAgICAgICAgICAgICAgICB9ZWxzZSBpZigkb3V0X3RpbWVfYmVnaW4gPD0gJHRpbWUgJiYgICRvdXRfdGltZV9lbmQgPj0gJHRpbWUpewogICAgICAgICAgICAgICAgICAgICRkdFsnb3V0X3RpbWUnXSA9ICR0aW1lOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2F0dF9zcGVjaWFsJykKICAgICAgICAgICAgICAgICAgICAtPmluc2VydCgkZHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGZ1bGxvdCgkc3RhcnQsICRzaGlmdF9zdGFydCwgJGVuZCwgJGJyZWFrKQogICAgewogICAgICAgICRzdGFydCA9ICRzdGFydCA8ICRzaGlmdF9zdGFydD8gJHNoaWZ0X3N0YXJ0OiRzdGFydDsKICAgICAgICAkZGlmZiA9IChzdHJ0b3RpbWUoJGVuZCkgLSAoc3RydG90aW1lKCRzdGFydCkgKyAoJGJyZWFrKjYwKSkpLzM2MDA7CiAgICAgICAgJGRpZmYgPSAkZGlmZiA8IDAgPyAwOiRkaWZmOwoKICAgICAgICAkcGFydCAgICA9IGV4cGxvZGUoJy4nLCAkZGlmZik7CiAgICAgICAgJG1pbnV0ZXMgPSAoaXNzZXQoJHBhcnRbMV0pID8gJHBhcnRbMV0gOiAwKTsKICAgICAgICAkbWludXRlcyA9IGZsb2F0dmFsKCcwLicuJG1pbnV0ZXMpOwogICAgICAgIC8vIHJldHVybiAkbWludXRlczsKICAgICAgICBpZigkbWludXRlcyA+IDAuMTY2NjcgJiYgJG1pbnV0ZXMgPD0gMC43NSkgJG1pbnV0ZXMgPSAkbWludXRlczsKICAgICAgICBlbHNlIGlmKCRtaW51dGVzID49IDAuNzUpICRtaW51dGVzID0gMTsKICAgICAgICBlbHNlICRtaW51dGVzID0gMDsKICAgICAgICAKICAgICAgICBpZigkbWludXRlcyA+IDAgJiYgJG1pbnV0ZXMgIT0gMSl7CiAgICAgICAgICAgICRtaW4gPSAoaW50KXJvdW5kKCRtaW51dGVzKjYwKTsKICAgICAgICAgICAgJG1pbk9UID0gbWluX3RvX290KCk7CiAgICAgICAgICAgICRtaW51dGVzID0gJG1pbk9UWyRtaW5dPz8wOwogICAgICAgIH0KCiAgICAgICAgJG92ZXJ0aW1lcyA9ICRwYXJ0WzBdICsgJG1pbnV0ZXM7CiAgICAgICAgJG92ZXJ0aW1lcyA9IG51bWJlcl9mb3JtYXQoKGZsb2F0KSRvdmVydGltZXMsIDMsICcuJywgJycpOwoKICAgICAgICByZXR1cm4gICRvdmVydGltZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBmbG9vclVwZGF0ZSgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBbXTsKCiAgICAgICAgZm9yZWFjaCAoJGRhdGEgYXMgJGtleSA9PiAkdikgewogICAgICAgICAgICBEQjo6dGFibGUoJ2hyX2FzX2Jhc2ljX2luZm8nKQogICAgICAgICAgICAgICAgLT53aGVyZSgnYXNzb2NpYXRlX2lkJywka2V5KQogICAgICAgICAgICAgICAgLT51cGRhdGUoWydhc19mbG9vcl9pZCcgPT4gJHZbJ2ZsJ11dKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiByZWZsZWN0QXJlYXIoKQogICAgewogICAgICAgIHJldHVybiAnJzsKICAgICAgICAkZGF0YSA9IERCOjp0YWJsZSgnaHJfaW5jcmVtZW50IGFzIGknKQogICAgICAgICAgICAtPnNlbGVjdCgnaS4qJywnYi5hc19pZCcsJ2IuYXNfdW5pdF9pZCcpCiAgICAgICAgICAgIC0+bGVmdEpvaW4oJ2hyX2FzX2Jhc2ljX2luZm8gYXMgYicsJ2IuYXNzb2NpYXRlX2lkJywnaS5hc3NvY2lhdGVfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdpLmNyZWF0ZWRfYXQnLCAnPicsICcyMDIxLTA0LTIwJykKICAgICAgICAgICAgLT53aGVyZSgnaS5lZmZlY3RpdmVfZGF0ZScsICc+JywgJzIwMjAtMTItMzEnKQogICAgICAgICAgICAtPndoZXJlKCdpLmVmZmVjdGl2ZV9kYXRlJywgJzwnLCAnMjAyMS0wNC0wMScpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICRrID0gW107CiAgICAgICAgCiAgICAgICAgZm9yZWFjaCgkZGF0YSBhcyAka2V5ID0+ICRkKXsKICAgICAgICAgICAgJGFyZWFyTW9udGhzID0gNCAtIGRhdGUoJ24nLCBzdHJ0b3RpbWUoJGQtPmVmZmVjdGl2ZV9kYXRlKSk7CgogICAgICAgICAgICAka1skZC0+YXNzb2NpYXRlX2lkXSA9ICRhcmVhck1vbnRoczsKCiAgICAgICAgICAgaWYoJGFyZWFyTW9udGhzID4gMCl7CiAgICAgICAgICAgICAgICAkbWFzdGVyID0gU2FsYXJ5QWRqdXN0TWFzdGVyOjpmaXJzdE9yTmV3KFsKICAgICAgICAgICAgICAgICAgICAnYXNzb2NpYXRlX2lkJyA9PiAkZC0+YXNzb2NpYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICdtb250aCcgPT4gJzA0JywKICAgICAgICAgICAgICAgICAgICAneWVhcicgPT4gZGF0ZSgnWScpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICRtYXN0ZXItPnNhdmUoKTsKICAgIAogICAgICAgICAgICAgICAgJGRldGFpbCA9IG5ldyBTYWxhcnlBZGp1c3REZXRhaWxzKCk7CiAgICAgICAgICAgICAgICAkZGV0YWlsLT5zYWxhcnlfYWRqdXN0X21hc3Rlcl9pZCA9ICRtYXN0ZXItPmlkOwogICAgICAgICAgICAgICAgJGRldGFpbC0+ZGF0ZSAgICAgICAgICAgICAgICAgICAgPSAnMjAyMS0wNC0yNic7CiAgICAgICAgICAgICAgICAkZGV0YWlsLT5hbW91bnQgICAgICAgICAgICAgICAgICA9ICgkZC0+aW5jcmVtZW50X2Ftb3VudCAqICRhcmVhck1vbnRocyk7CiAgICAgICAgICAgICAgICAkZGV0YWlsLT50eXBlICAgICAgICAgICAgICAgICAgICA9IDM7CiAgICAgICAgICAgICAgICAkZGV0YWlsLT5zYXZlKCk7CiAgICAgICAgICAgfQogICAgICAgICAgICR0YWJsZW5hbWUgPSBnZXRfYXR0X3RhYmxlKCRkLT5hc191bml0X2lkKTsKICAgICAgICAgICAkcXVldWUgPSAobmV3IFByb2Nlc3NVbml0V2lzZVNhbGFyeSgkdGFibGVuYW1lLCAnMDQnLCAyMDIxLCAkZC0+YXNfaWQsIDMwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b25RdWV1ZSgnc2FsYXJ5Z2VuZXJhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5kZWxheShDYXJib246Om5vdygpLT5hZGRTZWNvbmRzKDIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKCRxdWV1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRrOwoKICAgIH0KCn0K